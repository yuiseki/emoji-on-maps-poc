(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))m(_);new MutationObserver(_=>{for(const w of _)if(w.type==="childList")for(const z of w.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&m(z)}).observe(document,{childList:!0,subtree:!0});function u(_){const w={};return _.integrity&&(w.integrity=_.integrity),_.referrerPolicy&&(w.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?w.credentials="include":_.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function m(_){if(_.ep)return;_.ep=!0;const w=u(_);fetch(_.href,w)}})();var V1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Zh={},j1={get exports(){return Zh},set exports(n){Zh=n}},yd={},dt={},G1={get exports(){return dt},set exports(n){dt=n}},zt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ic=Symbol.for("react.element"),Z1=Symbol.for("react.portal"),q1=Symbol.for("react.fragment"),W1=Symbol.for("react.strict_mode"),X1=Symbol.for("react.profiler"),H1=Symbol.for("react.provider"),K1=Symbol.for("react.context"),Y1=Symbol.for("react.forward_ref"),J1=Symbol.for("react.suspense"),Q1=Symbol.for("react.memo"),ew=Symbol.for("react.lazy"),Ey=Symbol.iterator;function tw(n){return n===null||typeof n!="object"?null:(n=Ey&&n[Ey]||n["@@iterator"],typeof n=="function"?n:null)}var V_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$_=Object.assign,j_={};function _l(n,o,u){this.props=n,this.context=o,this.refs=j_,this.updater=u||V_}_l.prototype.isReactComponent={};_l.prototype.setState=function(n,o){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,o,"setState")};_l.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function G_(){}G_.prototype=_l.prototype;function am(n,o,u){this.props=n,this.context=o,this.refs=j_,this.updater=u||V_}var lm=am.prototype=new G_;lm.constructor=am;$_(lm,_l.prototype);lm.isPureReactComponent=!0;var Ty=Array.isArray,Z_=Object.prototype.hasOwnProperty,um={current:null},q_={key:!0,ref:!0,__self:!0,__source:!0};function W_(n,o,u){var m,_={},w=null,z=null;if(o!=null)for(m in o.ref!==void 0&&(z=o.ref),o.key!==void 0&&(w=""+o.key),o)Z_.call(o,m)&&!q_.hasOwnProperty(m)&&(_[m]=o[m]);var l=arguments.length-2;if(l===1)_.children=u;else if(1<l){for(var U=Array(l),X=0;X<l;X++)U[X]=arguments[X+2];_.children=U}if(n&&n.defaultProps)for(m in l=n.defaultProps,l)_[m]===void 0&&(_[m]=l[m]);return{$$typeof:ic,type:n,key:w,ref:z,props:_,_owner:um.current}}function nw(n,o){return{$$typeof:ic,type:n.type,key:o,ref:n.ref,props:n.props,_owner:n._owner}}function cm(n){return typeof n=="object"&&n!==null&&n.$$typeof===ic}function iw(n){var o={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(u){return o[u]})}var ky=/\/+/g;function Op(n,o){return typeof n=="object"&&n!==null&&n.key!=null?iw(""+n.key):o.toString(36)}function Dh(n,o,u,m,_){var w=typeof n;(w==="undefined"||w==="boolean")&&(n=null);var z=!1;if(n===null)z=!0;else switch(w){case"string":case"number":z=!0;break;case"object":switch(n.$$typeof){case ic:case Z1:z=!0}}if(z)return z=n,_=_(z),n=m===""?"."+Op(z,0):m,Ty(_)?(u="",n!=null&&(u=n.replace(ky,"$&/")+"/"),Dh(_,o,u,"",function(X){return X})):_!=null&&(cm(_)&&(_=nw(_,u+(!_.key||z&&z.key===_.key?"":(""+_.key).replace(ky,"$&/")+"/")+n)),o.push(_)),1;if(z=0,m=m===""?".":m+":",Ty(n))for(var l=0;l<n.length;l++){w=n[l];var U=m+Op(w,l);z+=Dh(w,o,u,U,_)}else if(U=tw(n),typeof U=="function")for(n=U.call(n),l=0;!(w=n.next()).done;)w=w.value,U=m+Op(w,l++),z+=Dh(w,o,u,U,_);else if(w==="object")throw o=String(n),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return z}function gh(n,o,u){if(n==null)return n;var m=[],_=0;return Dh(n,m,"","",function(w){return o.call(u,w,_++)}),m}function rw(n){if(n._status===-1){var o=n._result;o=o(),o.then(function(u){(n._status===0||n._status===-1)&&(n._status=1,n._result=u)},function(u){(n._status===0||n._status===-1)&&(n._status=2,n._result=u)}),n._status===-1&&(n._status=0,n._result=o)}if(n._status===1)return n._result.default;throw n._result}var ki={current:null},Lh={transition:null},ow={ReactCurrentDispatcher:ki,ReactCurrentBatchConfig:Lh,ReactCurrentOwner:um};zt.Children={map:gh,forEach:function(n,o,u){gh(n,function(){o.apply(this,arguments)},u)},count:function(n){var o=0;return gh(n,function(){o++}),o},toArray:function(n){return gh(n,function(o){return o})||[]},only:function(n){if(!cm(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};zt.Component=_l;zt.Fragment=q1;zt.Profiler=X1;zt.PureComponent=am;zt.StrictMode=W1;zt.Suspense=J1;zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ow;zt.cloneElement=function(n,o,u){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var m=$_({},n.props),_=n.key,w=n.ref,z=n._owner;if(o!=null){if(o.ref!==void 0&&(w=o.ref,z=um.current),o.key!==void 0&&(_=""+o.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(U in o)Z_.call(o,U)&&!q_.hasOwnProperty(U)&&(m[U]=o[U]===void 0&&l!==void 0?l[U]:o[U])}var U=arguments.length-2;if(U===1)m.children=u;else if(1<U){l=Array(U);for(var X=0;X<U;X++)l[X]=arguments[X+2];m.children=l}return{$$typeof:ic,type:n.type,key:_,ref:w,props:m,_owner:z}};zt.createContext=function(n){return n={$$typeof:K1,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:H1,_context:n},n.Consumer=n};zt.createElement=W_;zt.createFactory=function(n){var o=W_.bind(null,n);return o.type=n,o};zt.createRef=function(){return{current:null}};zt.forwardRef=function(n){return{$$typeof:Y1,render:n}};zt.isValidElement=cm;zt.lazy=function(n){return{$$typeof:ew,_payload:{_status:-1,_result:n},_init:rw}};zt.memo=function(n,o){return{$$typeof:Q1,type:n,compare:o===void 0?null:o}};zt.startTransition=function(n){var o=Lh.transition;Lh.transition={};try{n()}finally{Lh.transition=o}};zt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};zt.useCallback=function(n,o){return ki.current.useCallback(n,o)};zt.useContext=function(n){return ki.current.useContext(n)};zt.useDebugValue=function(){};zt.useDeferredValue=function(n){return ki.current.useDeferredValue(n)};zt.useEffect=function(n,o){return ki.current.useEffect(n,o)};zt.useId=function(){return ki.current.useId()};zt.useImperativeHandle=function(n,o,u){return ki.current.useImperativeHandle(n,o,u)};zt.useInsertionEffect=function(n,o){return ki.current.useInsertionEffect(n,o)};zt.useLayoutEffect=function(n,o){return ki.current.useLayoutEffect(n,o)};zt.useMemo=function(n,o){return ki.current.useMemo(n,o)};zt.useReducer=function(n,o,u){return ki.current.useReducer(n,o,u)};zt.useRef=function(n){return ki.current.useRef(n)};zt.useState=function(n){return ki.current.useState(n)};zt.useSyncExternalStore=function(n,o,u){return ki.current.useSyncExternalStore(n,o,u)};zt.useTransition=function(){return ki.current.useTransition()};zt.version="18.2.0";(function(n){n.exports=zt})(G1);const sw=$1(dt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aw=dt,lw=Symbol.for("react.element"),uw=Symbol.for("react.fragment"),cw=Object.prototype.hasOwnProperty,hw=aw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,dw={key:!0,ref:!0,__self:!0,__source:!0};function X_(n,o,u){var m,_={},w=null,z=null;u!==void 0&&(w=""+u),o.key!==void 0&&(w=""+o.key),o.ref!==void 0&&(z=o.ref);for(m in o)cw.call(o,m)&&!dw.hasOwnProperty(m)&&(_[m]=o[m]);if(n&&n.defaultProps)for(m in o=n.defaultProps,o)_[m]===void 0&&(_[m]=o[m]);return{$$typeof:lw,type:n,key:w,ref:z,props:_,_owner:hw.current}}yd.Fragment=uw;yd.jsx=X_;yd.jsxs=X_;(function(n){n.exports=yd})(j1);const jn=Zh.jsx,qh=Zh.jsxs;var df={},Nu={},pw={get exports(){return Nu},set exports(n){Nu=n}},Ji={},pf={},fw={get exports(){return pf},set exports(n){pf=n}},H_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function o(Ze,at){var ut=Ze.length;Ze.push(at);e:for(;0<ut;){var Nt=ut-1>>>1,Xt=Ze[Nt];if(0<_(Xt,at))Ze[Nt]=at,Ze[ut]=Xt,ut=Nt;else break e}}function u(Ze){return Ze.length===0?null:Ze[0]}function m(Ze){if(Ze.length===0)return null;var at=Ze[0],ut=Ze.pop();if(ut!==at){Ze[0]=ut;e:for(var Nt=0,Xt=Ze.length,Ui=Xt>>>1;Nt<Ui;){var Qn=2*(Nt+1)-1,ei=Ze[Qn],Bn=Qn+1,di=Ze[Bn];if(0>_(ei,ut))Bn<Xt&&0>_(di,ei)?(Ze[Nt]=di,Ze[Bn]=ut,Nt=Bn):(Ze[Nt]=ei,Ze[Qn]=ut,Nt=Qn);else if(Bn<Xt&&0>_(di,ut))Ze[Nt]=di,Ze[Bn]=ut,Nt=Bn;else break e}}return at}function _(Ze,at){var ut=Ze.sortIndex-at.sortIndex;return ut!==0?ut:Ze.id-at.id}if(typeof performance=="object"&&typeof performance.now=="function"){var w=performance;n.unstable_now=function(){return w.now()}}else{var z=Date,l=z.now();n.unstable_now=function(){return z.now()-l}}var U=[],X=[],pe=1,le=null,W=3,Fe=!1,Le=!1,Ce=!1,Ot=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,ee=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function se(Ze){for(var at=u(X);at!==null;){if(at.callback===null)m(X);else if(at.startTime<=Ze)m(X),at.sortIndex=at.expirationTime,o(U,at);else break;at=u(X)}}function ke(Ze){if(Ce=!1,se(Ze),!Le)if(u(U)!==null)Le=!0,st(De);else{var at=u(X);at!==null&&hi(ke,at.startTime-Ze)}}function De(Ze,at){Le=!1,Ce&&(Ce=!1,ae(Qe),Qe=-1),Fe=!0;var ut=W;try{for(se(at),le=u(U);le!==null&&(!(le.expirationTime>at)||Ze&&!_n());){var Nt=le.callback;if(typeof Nt=="function"){le.callback=null,W=le.priorityLevel;var Xt=Nt(le.expirationTime<=at);at=n.unstable_now(),typeof Xt=="function"?le.callback=Xt:le===u(U)&&m(U),se(at)}else m(U);le=u(U)}if(le!==null)var Ui=!0;else{var Qn=u(X);Qn!==null&&hi(ke,Qn.startTime-at),Ui=!1}return Ui}finally{le=null,W=ut,Fe=!1}}var He=!1,Je=null,Qe=-1,Zt=5,mt=-1;function _n(){return!(n.unstable_now()-mt<Zt)}function Zn(){if(Je!==null){var Ze=n.unstable_now();mt=Ze;var at=!0;try{at=Je(!0,Ze)}finally{at?Ii():(He=!1,Je=null)}}else He=!1}var Ii;if(typeof ee=="function")Ii=function(){ee(Zn)};else if(typeof MessageChannel<"u"){var Ni=new MessageChannel,er=Ni.port2;Ni.port1.onmessage=Zn,Ii=function(){er.postMessage(null)}}else Ii=function(){Ot(Zn,0)};function st(Ze){Je=Ze,He||(He=!0,Ii())}function hi(Ze,at){Qe=Ot(function(){Ze(n.unstable_now())},at)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ze){Ze.callback=null},n.unstable_continueExecution=function(){Le||Fe||(Le=!0,st(De))},n.unstable_forceFrameRate=function(Ze){0>Ze||125<Ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Zt=0<Ze?Math.floor(1e3/Ze):5},n.unstable_getCurrentPriorityLevel=function(){return W},n.unstable_getFirstCallbackNode=function(){return u(U)},n.unstable_next=function(Ze){switch(W){case 1:case 2:case 3:var at=3;break;default:at=W}var ut=W;W=at;try{return Ze()}finally{W=ut}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ze,at){switch(Ze){case 1:case 2:case 3:case 4:case 5:break;default:Ze=3}var ut=W;W=Ze;try{return at()}finally{W=ut}},n.unstable_scheduleCallback=function(Ze,at,ut){var Nt=n.unstable_now();switch(typeof ut=="object"&&ut!==null?(ut=ut.delay,ut=typeof ut=="number"&&0<ut?Nt+ut:Nt):ut=Nt,Ze){case 1:var Xt=-1;break;case 2:Xt=250;break;case 5:Xt=1073741823;break;case 4:Xt=1e4;break;default:Xt=5e3}return Xt=ut+Xt,Ze={id:pe++,callback:at,priorityLevel:Ze,startTime:ut,expirationTime:Xt,sortIndex:-1},ut>Nt?(Ze.sortIndex=ut,o(X,Ze),u(U)===null&&Ze===u(X)&&(Ce?(ae(Qe),Qe=-1):Ce=!0,hi(ke,ut-Nt))):(Ze.sortIndex=Xt,o(U,Ze),Le||Fe||(Le=!0,st(De))),Ze},n.unstable_shouldYield=_n,n.unstable_wrapCallback=function(Ze){var at=W;return function(){var ut=W;W=at;try{return Ze.apply(this,arguments)}finally{W=ut}}}})(H_);(function(n){n.exports=H_})(fw);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K_=dt,Yi=pf;function Ie(n){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+n,u=1;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Y_=new Set,Uu={};function da(n,o){cl(n,o),cl(n+"Capture",o)}function cl(n,o){for(Uu[n]=o,n=0;n<o.length;n++)Y_.add(o[n])}var Eo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ff=Object.prototype.hasOwnProperty,mw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Cy={},Iy={};function gw(n){return ff.call(Iy,n)?!0:ff.call(Cy,n)?!1:mw.test(n)?Iy[n]=!0:(Cy[n]=!0,!1)}function yw(n,o,u,m){if(u!==null&&u.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return m?!1:u!==null?!u.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function _w(n,o,u,m){if(o===null||typeof o>"u"||yw(n,o,u,m))return!0;if(m)return!1;if(u!==null)switch(u.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Ci(n,o,u,m,_,w,z){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=m,this.attributeNamespace=_,this.mustUseProperty=u,this.propertyName=n,this.type=o,this.sanitizeURL=w,this.removeEmptyString=z}var Jn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Jn[n]=new Ci(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var o=n[0];Jn[o]=new Ci(o,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Jn[n]=new Ci(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Jn[n]=new Ci(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Jn[n]=new Ci(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Jn[n]=new Ci(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Jn[n]=new Ci(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Jn[n]=new Ci(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Jn[n]=new Ci(n,5,!1,n.toLowerCase(),null,!1,!1)});var hm=/[\-:]([a-z])/g;function dm(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var o=n.replace(hm,dm);Jn[o]=new Ci(o,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var o=n.replace(hm,dm);Jn[o]=new Ci(o,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var o=n.replace(hm,dm);Jn[o]=new Ci(o,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Jn[n]=new Ci(n,1,!1,n.toLowerCase(),null,!1,!1)});Jn.xlinkHref=new Ci("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Jn[n]=new Ci(n,1,!1,n.toLowerCase(),null,!0,!0)});function pm(n,o,u,m){var _=Jn.hasOwnProperty(o)?Jn[o]:null;(_!==null?_.type!==0:m||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(_w(o,u,_,m)&&(u=null),m||_===null?gw(o)&&(u===null?n.removeAttribute(o):n.setAttribute(o,""+u)):_.mustUseProperty?n[_.propertyName]=u===null?_.type===3?!1:"":u:(o=_.attributeName,m=_.attributeNamespace,u===null?n.removeAttribute(o):(_=_.type,u=_===3||_===4&&u===!0?"":""+u,m?n.setAttributeNS(m,o,u):n.setAttribute(o,u))))}var Io=K_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,yh=Symbol.for("react.element"),qa=Symbol.for("react.portal"),Wa=Symbol.for("react.fragment"),fm=Symbol.for("react.strict_mode"),mf=Symbol.for("react.profiler"),J_=Symbol.for("react.provider"),Q_=Symbol.for("react.context"),mm=Symbol.for("react.forward_ref"),gf=Symbol.for("react.suspense"),yf=Symbol.for("react.suspense_list"),gm=Symbol.for("react.memo"),ts=Symbol.for("react.lazy"),ex=Symbol.for("react.offscreen"),zy=Symbol.iterator;function _u(n){return n===null||typeof n!="object"?null:(n=zy&&n[zy]||n["@@iterator"],typeof n=="function"?n:null)}var dn=Object.assign,Np;function ku(n){if(Np===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Np=o&&o[1]||""}return`
`+Np+n}var Up=!1;function Vp(n,o){if(!n||Up)return"";Up=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(X){var m=X}Reflect.construct(n,[],o)}else{try{o.call()}catch(X){m=X}n.call(o.prototype)}else{try{throw Error()}catch(X){m=X}n()}}catch(X){if(X&&m&&typeof X.stack=="string"){for(var _=X.stack.split(`
`),w=m.stack.split(`
`),z=_.length-1,l=w.length-1;1<=z&&0<=l&&_[z]!==w[l];)l--;for(;1<=z&&0<=l;z--,l--)if(_[z]!==w[l]){if(z!==1||l!==1)do if(z--,l--,0>l||_[z]!==w[l]){var U=`
`+_[z].replace(" at new "," at ");return n.displayName&&U.includes("<anonymous>")&&(U=U.replace("<anonymous>",n.displayName)),U}while(1<=z&&0<=l);break}}}finally{Up=!1,Error.prepareStackTrace=u}return(n=n?n.displayName||n.name:"")?ku(n):""}function xw(n){switch(n.tag){case 5:return ku(n.type);case 16:return ku("Lazy");case 13:return ku("Suspense");case 19:return ku("SuspenseList");case 0:case 2:case 15:return n=Vp(n.type,!1),n;case 11:return n=Vp(n.type.render,!1),n;case 1:return n=Vp(n.type,!0),n;default:return""}}function _f(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Wa:return"Fragment";case qa:return"Portal";case mf:return"Profiler";case fm:return"StrictMode";case gf:return"Suspense";case yf:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Q_:return(n.displayName||"Context")+".Consumer";case J_:return(n._context.displayName||"Context")+".Provider";case mm:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case gm:return o=n.displayName||null,o!==null?o:_f(n.type)||"Memo";case ts:o=n._payload,n=n._init;try{return _f(n(o))}catch{}}return null}function vw(n){var o=n.type;switch(n.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=o.render,n=n.displayName||n.name||"",o.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _f(o);case 8:return o===fm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function gs(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function tx(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function ww(n){var o=tx(n)?"checked":"value",u=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),m=""+n[o];if(!n.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var _=u.get,w=u.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return _.call(this)},set:function(z){m=""+z,w.call(this,z)}}),Object.defineProperty(n,o,{enumerable:u.enumerable}),{getValue:function(){return m},setValue:function(z){m=""+z},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function _h(n){n._valueTracker||(n._valueTracker=ww(n))}function nx(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var u=o.getValue(),m="";return n&&(m=tx(n)?n.checked?"true":"false":n.value),n=m,n!==u?(o.setValue(n),!0):!1}function Wh(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function xf(n,o){var u=o.checked;return dn({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??n._wrapperState.initialChecked})}function Py(n,o){var u=o.defaultValue==null?"":o.defaultValue,m=o.checked!=null?o.checked:o.defaultChecked;u=gs(o.value!=null?o.value:u),n._wrapperState={initialChecked:m,initialValue:u,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function ix(n,o){o=o.checked,o!=null&&pm(n,"checked",o,!1)}function vf(n,o){ix(n,o);var u=gs(o.value),m=o.type;if(u!=null)m==="number"?(u===0&&n.value===""||n.value!=u)&&(n.value=""+u):n.value!==""+u&&(n.value=""+u);else if(m==="submit"||m==="reset"){n.removeAttribute("value");return}o.hasOwnProperty("value")?wf(n,o.type,u):o.hasOwnProperty("defaultValue")&&wf(n,o.type,gs(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(n.defaultChecked=!!o.defaultChecked)}function My(n,o,u){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var m=o.type;if(!(m!=="submit"&&m!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+n._wrapperState.initialValue,u||o===n.value||(n.value=o),n.defaultValue=o}u=n.name,u!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,u!==""&&(n.name=u)}function wf(n,o,u){(o!=="number"||Wh(n.ownerDocument)!==n)&&(u==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+u&&(n.defaultValue=""+u))}var Cu=Array.isArray;function rl(n,o,u,m){if(n=n.options,o){o={};for(var _=0;_<u.length;_++)o["$"+u[_]]=!0;for(u=0;u<n.length;u++)_=o.hasOwnProperty("$"+n[u].value),n[u].selected!==_&&(n[u].selected=_),_&&m&&(n[u].defaultSelected=!0)}else{for(u=""+gs(u),o=null,_=0;_<n.length;_++){if(n[_].value===u){n[_].selected=!0,m&&(n[_].defaultSelected=!0);return}o!==null||n[_].disabled||(o=n[_])}o!==null&&(o.selected=!0)}}function bf(n,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Ie(91));return dn({},o,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Ay(n,o){var u=o.value;if(u==null){if(u=o.children,o=o.defaultValue,u!=null){if(o!=null)throw Error(Ie(92));if(Cu(u)){if(1<u.length)throw Error(Ie(93));u=u[0]}o=u}o==null&&(o=""),u=o}n._wrapperState={initialValue:gs(u)}}function rx(n,o){var u=gs(o.value),m=gs(o.defaultValue);u!=null&&(u=""+u,u!==n.value&&(n.value=u),o.defaultValue==null&&n.defaultValue!==u&&(n.defaultValue=u)),m!=null&&(n.defaultValue=""+m)}function Dy(n){var o=n.textContent;o===n._wrapperState.initialValue&&o!==""&&o!==null&&(n.value=o)}function ox(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sf(n,o){return n==null||n==="http://www.w3.org/1999/xhtml"?ox(o):n==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var xh,sx=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,u,m,_){MSApp.execUnsafeLocalFunction(function(){return n(o,u,m,_)})}:n}(function(n,o){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=o;else{for(xh=xh||document.createElement("div"),xh.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=xh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;o.firstChild;)n.appendChild(o.firstChild)}});function Vu(n,o){if(o){var u=n.firstChild;if(u&&u===n.lastChild&&u.nodeType===3){u.nodeValue=o;return}}n.textContent=o}var Pu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bw=["Webkit","ms","Moz","O"];Object.keys(Pu).forEach(function(n){bw.forEach(function(o){o=o+n.charAt(0).toUpperCase()+n.substring(1),Pu[o]=Pu[n]})});function ax(n,o,u){return o==null||typeof o=="boolean"||o===""?"":u||typeof o!="number"||o===0||Pu.hasOwnProperty(n)&&Pu[n]?(""+o).trim():o+"px"}function lx(n,o){n=n.style;for(var u in o)if(o.hasOwnProperty(u)){var m=u.indexOf("--")===0,_=ax(u,o[u],m);u==="float"&&(u="cssFloat"),m?n.setProperty(u,_):n[u]=_}}var Sw=dn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ef(n,o){if(o){if(Sw[n]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Ie(137,n));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Ie(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Ie(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Ie(62))}}function Tf(n,o){if(n.indexOf("-")===-1)return typeof o.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kf=null;function ym(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Cf=null,ol=null,sl=null;function Ly(n){if(n=sc(n)){if(typeof Cf!="function")throw Error(Ie(280));var o=n.stateNode;o&&(o=bd(o),Cf(n.stateNode,n.type,o))}}function ux(n){ol?sl?sl.push(n):sl=[n]:ol=n}function cx(){if(ol){var n=ol,o=sl;if(sl=ol=null,Ly(n),o)for(n=0;n<o.length;n++)Ly(o[n])}}function hx(n,o){return n(o)}function dx(){}var $p=!1;function px(n,o,u){if($p)return n(o,u);$p=!0;try{return hx(n,o,u)}finally{$p=!1,(ol!==null||sl!==null)&&(dx(),cx())}}function $u(n,o){var u=n.stateNode;if(u===null)return null;var m=bd(u);if(m===null)return null;u=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(n=n.type,m=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!m;break e;default:n=!1}if(n)return null;if(u&&typeof u!="function")throw Error(Ie(231,o,typeof u));return u}var If=!1;if(Eo)try{var xu={};Object.defineProperty(xu,"passive",{get:function(){If=!0}}),window.addEventListener("test",xu,xu),window.removeEventListener("test",xu,xu)}catch{If=!1}function Ew(n,o,u,m,_,w,z,l,U){var X=Array.prototype.slice.call(arguments,3);try{o.apply(u,X)}catch(pe){this.onError(pe)}}var Mu=!1,Xh=null,Hh=!1,zf=null,Tw={onError:function(n){Mu=!0,Xh=n}};function kw(n,o,u,m,_,w,z,l,U){Mu=!1,Xh=null,Ew.apply(Tw,arguments)}function Cw(n,o,u,m,_,w,z,l,U){if(kw.apply(this,arguments),Mu){if(Mu){var X=Xh;Mu=!1,Xh=null}else throw Error(Ie(198));Hh||(Hh=!0,zf=X)}}function pa(n){var o=n,u=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,o.flags&4098&&(u=o.return),n=o.return;while(n)}return o.tag===3?u:null}function fx(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function Ry(n){if(pa(n)!==n)throw Error(Ie(188))}function Iw(n){var o=n.alternate;if(!o){if(o=pa(n),o===null)throw Error(Ie(188));return o!==n?null:n}for(var u=n,m=o;;){var _=u.return;if(_===null)break;var w=_.alternate;if(w===null){if(m=_.return,m!==null){u=m;continue}break}if(_.child===w.child){for(w=_.child;w;){if(w===u)return Ry(_),n;if(w===m)return Ry(_),o;w=w.sibling}throw Error(Ie(188))}if(u.return!==m.return)u=_,m=w;else{for(var z=!1,l=_.child;l;){if(l===u){z=!0,u=_,m=w;break}if(l===m){z=!0,m=_,u=w;break}l=l.sibling}if(!z){for(l=w.child;l;){if(l===u){z=!0,u=w,m=_;break}if(l===m){z=!0,m=w,u=_;break}l=l.sibling}if(!z)throw Error(Ie(189))}}if(u.alternate!==m)throw Error(Ie(190))}if(u.tag!==3)throw Error(Ie(188));return u.stateNode.current===u?n:o}function mx(n){return n=Iw(n),n!==null?gx(n):null}function gx(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var o=gx(n);if(o!==null)return o;n=n.sibling}return null}var yx=Yi.unstable_scheduleCallback,By=Yi.unstable_cancelCallback,zw=Yi.unstable_shouldYield,Pw=Yi.unstable_requestPaint,bn=Yi.unstable_now,Mw=Yi.unstable_getCurrentPriorityLevel,_m=Yi.unstable_ImmediatePriority,_x=Yi.unstable_UserBlockingPriority,Kh=Yi.unstable_NormalPriority,Aw=Yi.unstable_LowPriority,xx=Yi.unstable_IdlePriority,_d=null,Jr=null;function Dw(n){if(Jr&&typeof Jr.onCommitFiberRoot=="function")try{Jr.onCommitFiberRoot(_d,n,void 0,(n.current.flags&128)===128)}catch{}}var Mr=Math.clz32?Math.clz32:Bw,Lw=Math.log,Rw=Math.LN2;function Bw(n){return n>>>=0,n===0?32:31-(Lw(n)/Rw|0)|0}var vh=64,wh=4194304;function Iu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Yh(n,o){var u=n.pendingLanes;if(u===0)return 0;var m=0,_=n.suspendedLanes,w=n.pingedLanes,z=u&268435455;if(z!==0){var l=z&~_;l!==0?m=Iu(l):(w&=z,w!==0&&(m=Iu(w)))}else z=u&~_,z!==0?m=Iu(z):w!==0&&(m=Iu(w));if(m===0)return 0;if(o!==0&&o!==m&&!(o&_)&&(_=m&-m,w=o&-o,_>=w||_===16&&(w&4194240)!==0))return o;if(m&4&&(m|=u&16),o=n.entangledLanes,o!==0)for(n=n.entanglements,o&=m;0<o;)u=31-Mr(o),_=1<<u,m|=n[u],o&=~_;return m}function Fw(n,o){switch(n){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ow(n,o){for(var u=n.suspendedLanes,m=n.pingedLanes,_=n.expirationTimes,w=n.pendingLanes;0<w;){var z=31-Mr(w),l=1<<z,U=_[z];U===-1?(!(l&u)||l&m)&&(_[z]=Fw(l,o)):U<=o&&(n.expiredLanes|=l),w&=~l}}function Pf(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function vx(){var n=vh;return vh<<=1,!(vh&4194240)&&(vh=64),n}function jp(n){for(var o=[],u=0;31>u;u++)o.push(n);return o}function rc(n,o,u){n.pendingLanes|=o,o!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,o=31-Mr(o),n[o]=u}function Nw(n,o){var u=n.pendingLanes&~o;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=o,n.mutableReadLanes&=o,n.entangledLanes&=o,o=n.entanglements;var m=n.eventTimes;for(n=n.expirationTimes;0<u;){var _=31-Mr(u),w=1<<_;o[_]=0,m[_]=-1,n[_]=-1,u&=~w}}function xm(n,o){var u=n.entangledLanes|=o;for(n=n.entanglements;u;){var m=31-Mr(u),_=1<<m;_&o|n[m]&o&&(n[m]|=o),u&=~_}}var Gt=0;function wx(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var bx,vm,Sx,Ex,Tx,Mf=!1,bh=[],ls=null,us=null,cs=null,ju=new Map,Gu=new Map,is=[],Uw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Fy(n,o){switch(n){case"focusin":case"focusout":ls=null;break;case"dragenter":case"dragleave":us=null;break;case"mouseover":case"mouseout":cs=null;break;case"pointerover":case"pointerout":ju.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gu.delete(o.pointerId)}}function vu(n,o,u,m,_,w){return n===null||n.nativeEvent!==w?(n={blockedOn:o,domEventName:u,eventSystemFlags:m,nativeEvent:w,targetContainers:[_]},o!==null&&(o=sc(o),o!==null&&vm(o)),n):(n.eventSystemFlags|=m,o=n.targetContainers,_!==null&&o.indexOf(_)===-1&&o.push(_),n)}function Vw(n,o,u,m,_){switch(o){case"focusin":return ls=vu(ls,n,o,u,m,_),!0;case"dragenter":return us=vu(us,n,o,u,m,_),!0;case"mouseover":return cs=vu(cs,n,o,u,m,_),!0;case"pointerover":var w=_.pointerId;return ju.set(w,vu(ju.get(w)||null,n,o,u,m,_)),!0;case"gotpointercapture":return w=_.pointerId,Gu.set(w,vu(Gu.get(w)||null,n,o,u,m,_)),!0}return!1}function kx(n){var o=na(n.target);if(o!==null){var u=pa(o);if(u!==null){if(o=u.tag,o===13){if(o=fx(u),o!==null){n.blockedOn=o,Tx(n.priority,function(){Sx(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){n.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Rh(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var u=Af(n.domEventName,n.eventSystemFlags,o[0],n.nativeEvent);if(u===null){u=n.nativeEvent;var m=new u.constructor(u.type,u);kf=m,u.target.dispatchEvent(m),kf=null}else return o=sc(u),o!==null&&vm(o),n.blockedOn=u,!1;o.shift()}return!0}function Oy(n,o,u){Rh(n)&&u.delete(o)}function $w(){Mf=!1,ls!==null&&Rh(ls)&&(ls=null),us!==null&&Rh(us)&&(us=null),cs!==null&&Rh(cs)&&(cs=null),ju.forEach(Oy),Gu.forEach(Oy)}function wu(n,o){n.blockedOn===o&&(n.blockedOn=null,Mf||(Mf=!0,Yi.unstable_scheduleCallback(Yi.unstable_NormalPriority,$w)))}function Zu(n){function o(_){return wu(_,n)}if(0<bh.length){wu(bh[0],n);for(var u=1;u<bh.length;u++){var m=bh[u];m.blockedOn===n&&(m.blockedOn=null)}}for(ls!==null&&wu(ls,n),us!==null&&wu(us,n),cs!==null&&wu(cs,n),ju.forEach(o),Gu.forEach(o),u=0;u<is.length;u++)m=is[u],m.blockedOn===n&&(m.blockedOn=null);for(;0<is.length&&(u=is[0],u.blockedOn===null);)kx(u),u.blockedOn===null&&is.shift()}var al=Io.ReactCurrentBatchConfig,Jh=!0;function jw(n,o,u,m){var _=Gt,w=al.transition;al.transition=null;try{Gt=1,wm(n,o,u,m)}finally{Gt=_,al.transition=w}}function Gw(n,o,u,m){var _=Gt,w=al.transition;al.transition=null;try{Gt=4,wm(n,o,u,m)}finally{Gt=_,al.transition=w}}function wm(n,o,u,m){if(Jh){var _=Af(n,o,u,m);if(_===null)Qp(n,o,m,Qh,u),Fy(n,m);else if(Vw(_,n,o,u,m))m.stopPropagation();else if(Fy(n,m),o&4&&-1<Uw.indexOf(n)){for(;_!==null;){var w=sc(_);if(w!==null&&bx(w),w=Af(n,o,u,m),w===null&&Qp(n,o,m,Qh,u),w===_)break;_=w}_!==null&&m.stopPropagation()}else Qp(n,o,m,null,u)}}var Qh=null;function Af(n,o,u,m){if(Qh=null,n=ym(m),n=na(n),n!==null)if(o=pa(n),o===null)n=null;else if(u=o.tag,u===13){if(n=fx(o),n!==null)return n;n=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null);return Qh=n,null}function Cx(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Mw()){case _m:return 1;case _x:return 4;case Kh:case Aw:return 16;case xx:return 536870912;default:return 16}default:return 16}}var ss=null,bm=null,Bh=null;function Ix(){if(Bh)return Bh;var n,o=bm,u=o.length,m,_="value"in ss?ss.value:ss.textContent,w=_.length;for(n=0;n<u&&o[n]===_[n];n++);var z=u-n;for(m=1;m<=z&&o[u-m]===_[w-m];m++);return Bh=_.slice(n,1<m?1-m:void 0)}function Fh(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function Sh(){return!0}function Ny(){return!1}function Qi(n){function o(u,m,_,w,z){this._reactName=u,this._targetInst=_,this.type=m,this.nativeEvent=w,this.target=z,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(u=n[l],this[l]=u?u(w):w[l]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Sh:Ny,this.isPropagationStopped=Ny,this}return dn(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Sh)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Sh)},persist:function(){},isPersistent:Sh}),o}var xl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Sm=Qi(xl),oc=dn({},xl,{view:0,detail:0}),Zw=Qi(oc),Gp,Zp,bu,xd=dn({},oc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Em,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==bu&&(bu&&n.type==="mousemove"?(Gp=n.screenX-bu.screenX,Zp=n.screenY-bu.screenY):Zp=Gp=0,bu=n),Gp)},movementY:function(n){return"movementY"in n?n.movementY:Zp}}),Uy=Qi(xd),qw=dn({},xd,{dataTransfer:0}),Ww=Qi(qw),Xw=dn({},oc,{relatedTarget:0}),qp=Qi(Xw),Hw=dn({},xl,{animationName:0,elapsedTime:0,pseudoElement:0}),Kw=Qi(Hw),Yw=dn({},xl,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Jw=Qi(Yw),Qw=dn({},xl,{data:0}),Vy=Qi(Qw),eb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ib(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=nb[n])?!!o[n]:!1}function Em(){return ib}var rb=dn({},oc,{key:function(n){if(n.key){var o=eb[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=Fh(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?tb[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Em,charCode:function(n){return n.type==="keypress"?Fh(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Fh(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),ob=Qi(rb),sb=dn({},xd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$y=Qi(sb),ab=dn({},oc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Em}),lb=Qi(ab),ub=dn({},xl,{propertyName:0,elapsedTime:0,pseudoElement:0}),cb=Qi(ub),hb=dn({},xd,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),db=Qi(hb),pb=[9,13,27,32],Tm=Eo&&"CompositionEvent"in window,Au=null;Eo&&"documentMode"in document&&(Au=document.documentMode);var fb=Eo&&"TextEvent"in window&&!Au,zx=Eo&&(!Tm||Au&&8<Au&&11>=Au),jy=String.fromCharCode(32),Gy=!1;function Px(n,o){switch(n){case"keyup":return pb.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mx(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Xa=!1;function mb(n,o){switch(n){case"compositionend":return Mx(o);case"keypress":return o.which!==32?null:(Gy=!0,jy);case"textInput":return n=o.data,n===jy&&Gy?null:n;default:return null}}function gb(n,o){if(Xa)return n==="compositionend"||!Tm&&Px(n,o)?(n=Ix(),Bh=bm=ss=null,Xa=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return zx&&o.locale!=="ko"?null:o.data;default:return null}}var yb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zy(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!yb[n.type]:o==="textarea"}function Ax(n,o,u,m){ux(m),o=ed(o,"onChange"),0<o.length&&(u=new Sm("onChange","change",null,u,m),n.push({event:u,listeners:o}))}var Du=null,qu=null;function _b(n){jx(n,0)}function vd(n){var o=Ya(n);if(nx(o))return n}function xb(n,o){if(n==="change")return o}var Dx=!1;if(Eo){var Wp;if(Eo){var Xp="oninput"in document;if(!Xp){var qy=document.createElement("div");qy.setAttribute("oninput","return;"),Xp=typeof qy.oninput=="function"}Wp=Xp}else Wp=!1;Dx=Wp&&(!document.documentMode||9<document.documentMode)}function Wy(){Du&&(Du.detachEvent("onpropertychange",Lx),qu=Du=null)}function Lx(n){if(n.propertyName==="value"&&vd(qu)){var o=[];Ax(o,qu,n,ym(n)),px(_b,o)}}function vb(n,o,u){n==="focusin"?(Wy(),Du=o,qu=u,Du.attachEvent("onpropertychange",Lx)):n==="focusout"&&Wy()}function wb(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return vd(qu)}function bb(n,o){if(n==="click")return vd(o)}function Sb(n,o){if(n==="input"||n==="change")return vd(o)}function Eb(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var Dr=typeof Object.is=="function"?Object.is:Eb;function Wu(n,o){if(Dr(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var u=Object.keys(n),m=Object.keys(o);if(u.length!==m.length)return!1;for(m=0;m<u.length;m++){var _=u[m];if(!ff.call(o,_)||!Dr(n[_],o[_]))return!1}return!0}function Xy(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Hy(n,o){var u=Xy(n);n=0;for(var m;u;){if(u.nodeType===3){if(m=n+u.textContent.length,n<=o&&m>=o)return{node:u,offset:o-n};n=m}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=Xy(u)}}function Rx(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?Rx(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function Bx(){for(var n=window,o=Wh();o instanceof n.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)n=o.contentWindow;else break;o=Wh(n.document)}return o}function km(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function Tb(n){var o=Bx(),u=n.focusedElem,m=n.selectionRange;if(o!==u&&u&&u.ownerDocument&&Rx(u.ownerDocument.documentElement,u)){if(m!==null&&km(u)){if(o=m.start,n=m.end,n===void 0&&(n=o),"selectionStart"in u)u.selectionStart=o,u.selectionEnd=Math.min(n,u.value.length);else if(n=(o=u.ownerDocument||document)&&o.defaultView||window,n.getSelection){n=n.getSelection();var _=u.textContent.length,w=Math.min(m.start,_);m=m.end===void 0?w:Math.min(m.end,_),!n.extend&&w>m&&(_=m,m=w,w=_),_=Hy(u,w);var z=Hy(u,m);_&&z&&(n.rangeCount!==1||n.anchorNode!==_.node||n.anchorOffset!==_.offset||n.focusNode!==z.node||n.focusOffset!==z.offset)&&(o=o.createRange(),o.setStart(_.node,_.offset),n.removeAllRanges(),w>m?(n.addRange(o),n.extend(z.node,z.offset)):(o.setEnd(z.node,z.offset),n.addRange(o)))}}for(o=[],n=u;n=n.parentNode;)n.nodeType===1&&o.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<o.length;u++)n=o[u],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var kb=Eo&&"documentMode"in document&&11>=document.documentMode,Ha=null,Df=null,Lu=null,Lf=!1;function Ky(n,o,u){var m=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Lf||Ha==null||Ha!==Wh(m)||(m=Ha,"selectionStart"in m&&km(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Lu&&Wu(Lu,m)||(Lu=m,m=ed(Df,"onSelect"),0<m.length&&(o=new Sm("onSelect","select",null,o,u),n.push({event:o,listeners:m}),o.target=Ha)))}function Eh(n,o){var u={};return u[n.toLowerCase()]=o.toLowerCase(),u["Webkit"+n]="webkit"+o,u["Moz"+n]="moz"+o,u}var Ka={animationend:Eh("Animation","AnimationEnd"),animationiteration:Eh("Animation","AnimationIteration"),animationstart:Eh("Animation","AnimationStart"),transitionend:Eh("Transition","TransitionEnd")},Hp={},Fx={};Eo&&(Fx=document.createElement("div").style,"AnimationEvent"in window||(delete Ka.animationend.animation,delete Ka.animationiteration.animation,delete Ka.animationstart.animation),"TransitionEvent"in window||delete Ka.transitionend.transition);function wd(n){if(Hp[n])return Hp[n];if(!Ka[n])return n;var o=Ka[n],u;for(u in o)if(o.hasOwnProperty(u)&&u in Fx)return Hp[n]=o[u];return n}var Ox=wd("animationend"),Nx=wd("animationiteration"),Ux=wd("animationstart"),Vx=wd("transitionend"),$x=new Map,Yy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _s(n,o){$x.set(n,o),da(o,[n])}for(var Kp=0;Kp<Yy.length;Kp++){var Yp=Yy[Kp],Cb=Yp.toLowerCase(),Ib=Yp[0].toUpperCase()+Yp.slice(1);_s(Cb,"on"+Ib)}_s(Ox,"onAnimationEnd");_s(Nx,"onAnimationIteration");_s(Ux,"onAnimationStart");_s("dblclick","onDoubleClick");_s("focusin","onFocus");_s("focusout","onBlur");_s(Vx,"onTransitionEnd");cl("onMouseEnter",["mouseout","mouseover"]);cl("onMouseLeave",["mouseout","mouseover"]);cl("onPointerEnter",["pointerout","pointerover"]);cl("onPointerLeave",["pointerout","pointerover"]);da("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));da("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));da("onBeforeInput",["compositionend","keypress","textInput","paste"]);da("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));da("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));da("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zb=new Set("cancel close invalid load scroll toggle".split(" ").concat(zu));function Jy(n,o,u){var m=n.type||"unknown-event";n.currentTarget=u,Cw(m,o,void 0,n),n.currentTarget=null}function jx(n,o){o=(o&4)!==0;for(var u=0;u<n.length;u++){var m=n[u],_=m.event;m=m.listeners;e:{var w=void 0;if(o)for(var z=m.length-1;0<=z;z--){var l=m[z],U=l.instance,X=l.currentTarget;if(l=l.listener,U!==w&&_.isPropagationStopped())break e;Jy(_,l,X),w=U}else for(z=0;z<m.length;z++){if(l=m[z],U=l.instance,X=l.currentTarget,l=l.listener,U!==w&&_.isPropagationStopped())break e;Jy(_,l,X),w=U}}}if(Hh)throw n=zf,Hh=!1,zf=null,n}function rn(n,o){var u=o[Nf];u===void 0&&(u=o[Nf]=new Set);var m=n+"__bubble";u.has(m)||(Gx(o,n,2,!1),u.add(m))}function Jp(n,o,u){var m=0;o&&(m|=4),Gx(u,n,m,o)}var Th="_reactListening"+Math.random().toString(36).slice(2);function Xu(n){if(!n[Th]){n[Th]=!0,Y_.forEach(function(u){u!=="selectionchange"&&(zb.has(u)||Jp(u,!1,n),Jp(u,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[Th]||(o[Th]=!0,Jp("selectionchange",!1,o))}}function Gx(n,o,u,m){switch(Cx(o)){case 1:var _=jw;break;case 4:_=Gw;break;default:_=wm}u=_.bind(null,o,u,n),_=void 0,!If||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(_=!0),m?_!==void 0?n.addEventListener(o,u,{capture:!0,passive:_}):n.addEventListener(o,u,!0):_!==void 0?n.addEventListener(o,u,{passive:_}):n.addEventListener(o,u,!1)}function Qp(n,o,u,m,_){var w=m;if(!(o&1)&&!(o&2)&&m!==null)e:for(;;){if(m===null)return;var z=m.tag;if(z===3||z===4){var l=m.stateNode.containerInfo;if(l===_||l.nodeType===8&&l.parentNode===_)break;if(z===4)for(z=m.return;z!==null;){var U=z.tag;if((U===3||U===4)&&(U=z.stateNode.containerInfo,U===_||U.nodeType===8&&U.parentNode===_))return;z=z.return}for(;l!==null;){if(z=na(l),z===null)return;if(U=z.tag,U===5||U===6){m=w=z;continue e}l=l.parentNode}}m=m.return}px(function(){var X=w,pe=ym(u),le=[];e:{var W=$x.get(n);if(W!==void 0){var Fe=Sm,Le=n;switch(n){case"keypress":if(Fh(u)===0)break e;case"keydown":case"keyup":Fe=ob;break;case"focusin":Le="focus",Fe=qp;break;case"focusout":Le="blur",Fe=qp;break;case"beforeblur":case"afterblur":Fe=qp;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Fe=Uy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Fe=Ww;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Fe=lb;break;case Ox:case Nx:case Ux:Fe=Kw;break;case Vx:Fe=cb;break;case"scroll":Fe=Zw;break;case"wheel":Fe=db;break;case"copy":case"cut":case"paste":Fe=Jw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Fe=$y}var Ce=(o&4)!==0,Ot=!Ce&&n==="scroll",ae=Ce?W!==null?W+"Capture":null:W;Ce=[];for(var ee=X,se;ee!==null;){se=ee;var ke=se.stateNode;if(se.tag===5&&ke!==null&&(se=ke,ae!==null&&(ke=$u(ee,ae),ke!=null&&Ce.push(Hu(ee,ke,se)))),Ot)break;ee=ee.return}0<Ce.length&&(W=new Fe(W,Le,null,u,pe),le.push({event:W,listeners:Ce}))}}if(!(o&7)){e:{if(W=n==="mouseover"||n==="pointerover",Fe=n==="mouseout"||n==="pointerout",W&&u!==kf&&(Le=u.relatedTarget||u.fromElement)&&(na(Le)||Le[To]))break e;if((Fe||W)&&(W=pe.window===pe?pe:(W=pe.ownerDocument)?W.defaultView||W.parentWindow:window,Fe?(Le=u.relatedTarget||u.toElement,Fe=X,Le=Le?na(Le):null,Le!==null&&(Ot=pa(Le),Le!==Ot||Le.tag!==5&&Le.tag!==6)&&(Le=null)):(Fe=null,Le=X),Fe!==Le)){if(Ce=Uy,ke="onMouseLeave",ae="onMouseEnter",ee="mouse",(n==="pointerout"||n==="pointerover")&&(Ce=$y,ke="onPointerLeave",ae="onPointerEnter",ee="pointer"),Ot=Fe==null?W:Ya(Fe),se=Le==null?W:Ya(Le),W=new Ce(ke,ee+"leave",Fe,u,pe),W.target=Ot,W.relatedTarget=se,ke=null,na(pe)===X&&(Ce=new Ce(ae,ee+"enter",Le,u,pe),Ce.target=se,Ce.relatedTarget=Ot,ke=Ce),Ot=ke,Fe&&Le)t:{for(Ce=Fe,ae=Le,ee=0,se=Ce;se;se=Za(se))ee++;for(se=0,ke=ae;ke;ke=Za(ke))se++;for(;0<ee-se;)Ce=Za(Ce),ee--;for(;0<se-ee;)ae=Za(ae),se--;for(;ee--;){if(Ce===ae||ae!==null&&Ce===ae.alternate)break t;Ce=Za(Ce),ae=Za(ae)}Ce=null}else Ce=null;Fe!==null&&Qy(le,W,Fe,Ce,!1),Le!==null&&Ot!==null&&Qy(le,Ot,Le,Ce,!0)}}e:{if(W=X?Ya(X):window,Fe=W.nodeName&&W.nodeName.toLowerCase(),Fe==="select"||Fe==="input"&&W.type==="file")var De=xb;else if(Zy(W))if(Dx)De=Sb;else{De=wb;var He=vb}else(Fe=W.nodeName)&&Fe.toLowerCase()==="input"&&(W.type==="checkbox"||W.type==="radio")&&(De=bb);if(De&&(De=De(n,X))){Ax(le,De,u,pe);break e}He&&He(n,W,X),n==="focusout"&&(He=W._wrapperState)&&He.controlled&&W.type==="number"&&wf(W,"number",W.value)}switch(He=X?Ya(X):window,n){case"focusin":(Zy(He)||He.contentEditable==="true")&&(Ha=He,Df=X,Lu=null);break;case"focusout":Lu=Df=Ha=null;break;case"mousedown":Lf=!0;break;case"contextmenu":case"mouseup":case"dragend":Lf=!1,Ky(le,u,pe);break;case"selectionchange":if(kb)break;case"keydown":case"keyup":Ky(le,u,pe)}var Je;if(Tm)e:{switch(n){case"compositionstart":var Qe="onCompositionStart";break e;case"compositionend":Qe="onCompositionEnd";break e;case"compositionupdate":Qe="onCompositionUpdate";break e}Qe=void 0}else Xa?Px(n,u)&&(Qe="onCompositionEnd"):n==="keydown"&&u.keyCode===229&&(Qe="onCompositionStart");Qe&&(zx&&u.locale!=="ko"&&(Xa||Qe!=="onCompositionStart"?Qe==="onCompositionEnd"&&Xa&&(Je=Ix()):(ss=pe,bm="value"in ss?ss.value:ss.textContent,Xa=!0)),He=ed(X,Qe),0<He.length&&(Qe=new Vy(Qe,n,null,u,pe),le.push({event:Qe,listeners:He}),Je?Qe.data=Je:(Je=Mx(u),Je!==null&&(Qe.data=Je)))),(Je=fb?mb(n,u):gb(n,u))&&(X=ed(X,"onBeforeInput"),0<X.length&&(pe=new Vy("onBeforeInput","beforeinput",null,u,pe),le.push({event:pe,listeners:X}),pe.data=Je))}jx(le,o)})}function Hu(n,o,u){return{instance:n,listener:o,currentTarget:u}}function ed(n,o){for(var u=o+"Capture",m=[];n!==null;){var _=n,w=_.stateNode;_.tag===5&&w!==null&&(_=w,w=$u(n,u),w!=null&&m.unshift(Hu(n,w,_)),w=$u(n,o),w!=null&&m.push(Hu(n,w,_))),n=n.return}return m}function Za(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Qy(n,o,u,m,_){for(var w=o._reactName,z=[];u!==null&&u!==m;){var l=u,U=l.alternate,X=l.stateNode;if(U!==null&&U===m)break;l.tag===5&&X!==null&&(l=X,_?(U=$u(u,w),U!=null&&z.unshift(Hu(u,U,l))):_||(U=$u(u,w),U!=null&&z.push(Hu(u,U,l)))),u=u.return}z.length!==0&&n.push({event:o,listeners:z})}var Pb=/\r\n?/g,Mb=/\u0000|\uFFFD/g;function e_(n){return(typeof n=="string"?n:""+n).replace(Pb,`
`).replace(Mb,"")}function kh(n,o,u){if(o=e_(o),e_(n)!==o&&u)throw Error(Ie(425))}function td(){}var Rf=null,Bf=null;function Ff(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Of=typeof setTimeout=="function"?setTimeout:void 0,Ab=typeof clearTimeout=="function"?clearTimeout:void 0,t_=typeof Promise=="function"?Promise:void 0,Db=typeof queueMicrotask=="function"?queueMicrotask:typeof t_<"u"?function(n){return t_.resolve(null).then(n).catch(Lb)}:Of;function Lb(n){setTimeout(function(){throw n})}function ef(n,o){var u=o,m=0;do{var _=u.nextSibling;if(n.removeChild(u),_&&_.nodeType===8)if(u=_.data,u==="/$"){if(m===0){n.removeChild(_),Zu(o);return}m--}else u!=="$"&&u!=="$?"&&u!=="$!"||m++;u=_}while(u);Zu(o)}function hs(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return n}function n_(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var u=n.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return n;o--}else u==="/$"&&o++}n=n.previousSibling}return null}var vl=Math.random().toString(36).slice(2),Yr="__reactFiber$"+vl,Ku="__reactProps$"+vl,To="__reactContainer$"+vl,Nf="__reactEvents$"+vl,Rb="__reactListeners$"+vl,Bb="__reactHandles$"+vl;function na(n){var o=n[Yr];if(o)return o;for(var u=n.parentNode;u;){if(o=u[To]||u[Yr]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(n=n_(n);n!==null;){if(u=n[Yr])return u;n=n_(n)}return o}n=u,u=n.parentNode}return null}function sc(n){return n=n[Yr]||n[To],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ya(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Ie(33))}function bd(n){return n[Ku]||null}var Uf=[],Ja=-1;function xs(n){return{current:n}}function on(n){0>Ja||(n.current=Uf[Ja],Uf[Ja]=null,Ja--)}function nn(n,o){Ja++,Uf[Ja]=n.current,n.current=o}var ys={},ci=xs(ys),Bi=xs(!1),aa=ys;function hl(n,o){var u=n.type.contextTypes;if(!u)return ys;var m=n.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===o)return m.__reactInternalMemoizedMaskedChildContext;var _={},w;for(w in u)_[w]=o[w];return m&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=_),_}function Fi(n){return n=n.childContextTypes,n!=null}function nd(){on(Bi),on(ci)}function i_(n,o,u){if(ci.current!==ys)throw Error(Ie(168));nn(ci,o),nn(Bi,u)}function Zx(n,o,u){var m=n.stateNode;if(o=o.childContextTypes,typeof m.getChildContext!="function")return u;m=m.getChildContext();for(var _ in m)if(!(_ in o))throw Error(Ie(108,vw(n)||"Unknown",_));return dn({},u,m)}function id(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ys,aa=ci.current,nn(ci,n),nn(Bi,Bi.current),!0}function r_(n,o,u){var m=n.stateNode;if(!m)throw Error(Ie(169));u?(n=Zx(n,o,aa),m.__reactInternalMemoizedMergedChildContext=n,on(Bi),on(ci),nn(ci,n)):on(Bi),nn(Bi,u)}var vo=null,Sd=!1,tf=!1;function qx(n){vo===null?vo=[n]:vo.push(n)}function Fb(n){Sd=!0,qx(n)}function vs(){if(!tf&&vo!==null){tf=!0;var n=0,o=Gt;try{var u=vo;for(Gt=1;n<u.length;n++){var m=u[n];do m=m(!0);while(m!==null)}vo=null,Sd=!1}catch(_){throw vo!==null&&(vo=vo.slice(n+1)),yx(_m,vs),_}finally{Gt=o,tf=!1}}return null}var Qa=[],el=0,rd=null,od=0,ur=[],cr=0,la=null,wo=1,bo="";function ea(n,o){Qa[el++]=od,Qa[el++]=rd,rd=n,od=o}function Wx(n,o,u){ur[cr++]=wo,ur[cr++]=bo,ur[cr++]=la,la=n;var m=wo;n=bo;var _=32-Mr(m)-1;m&=~(1<<_),u+=1;var w=32-Mr(o)+_;if(30<w){var z=_-_%5;w=(m&(1<<z)-1).toString(32),m>>=z,_-=z,wo=1<<32-Mr(o)+_|u<<_|m,bo=w+n}else wo=1<<w|u<<_|m,bo=n}function Cm(n){n.return!==null&&(ea(n,1),Wx(n,1,0))}function Im(n){for(;n===rd;)rd=Qa[--el],Qa[el]=null,od=Qa[--el],Qa[el]=null;for(;n===la;)la=ur[--cr],ur[cr]=null,bo=ur[--cr],ur[cr]=null,wo=ur[--cr],ur[cr]=null}var Ki=null,Hi=null,ln=!1,Pr=null;function Xx(n,o){var u=hr(5,null,null,0);u.elementType="DELETED",u.stateNode=o,u.return=n,o=n.deletions,o===null?(n.deletions=[u],n.flags|=16):o.push(u)}function o_(n,o){switch(n.tag){case 5:var u=n.type;return o=o.nodeType!==1||u.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(n.stateNode=o,Ki=n,Hi=hs(o.firstChild),!0):!1;case 6:return o=n.pendingProps===""||o.nodeType!==3?null:o,o!==null?(n.stateNode=o,Ki=n,Hi=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(u=la!==null?{id:wo,overflow:bo}:null,n.memoizedState={dehydrated:o,treeContext:u,retryLane:1073741824},u=hr(18,null,null,0),u.stateNode=o,u.return=n,n.child=u,Ki=n,Hi=null,!0):!1;default:return!1}}function Vf(n){return(n.mode&1)!==0&&(n.flags&128)===0}function $f(n){if(ln){var o=Hi;if(o){var u=o;if(!o_(n,o)){if(Vf(n))throw Error(Ie(418));o=hs(u.nextSibling);var m=Ki;o&&o_(n,o)?Xx(m,u):(n.flags=n.flags&-4097|2,ln=!1,Ki=n)}}else{if(Vf(n))throw Error(Ie(418));n.flags=n.flags&-4097|2,ln=!1,Ki=n}}}function s_(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Ki=n}function Ch(n){if(n!==Ki)return!1;if(!ln)return s_(n),ln=!0,!1;var o;if((o=n.tag!==3)&&!(o=n.tag!==5)&&(o=n.type,o=o!=="head"&&o!=="body"&&!Ff(n.type,n.memoizedProps)),o&&(o=Hi)){if(Vf(n))throw Hx(),Error(Ie(418));for(;o;)Xx(n,o),o=hs(o.nextSibling)}if(s_(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Ie(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8){var u=n.data;if(u==="/$"){if(o===0){Hi=hs(n.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++}n=n.nextSibling}Hi=null}}else Hi=Ki?hs(n.stateNode.nextSibling):null;return!0}function Hx(){for(var n=Hi;n;)n=hs(n.nextSibling)}function dl(){Hi=Ki=null,ln=!1}function zm(n){Pr===null?Pr=[n]:Pr.push(n)}var Ob=Io.ReactCurrentBatchConfig;function Ir(n,o){if(n&&n.defaultProps){o=dn({},o),n=n.defaultProps;for(var u in n)o[u]===void 0&&(o[u]=n[u]);return o}return o}var sd=xs(null),ad=null,tl=null,Pm=null;function Mm(){Pm=tl=ad=null}function Am(n){var o=sd.current;on(sd),n._currentValue=o}function jf(n,o,u){for(;n!==null;){var m=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),n===u)break;n=n.return}}function ll(n,o){ad=n,Pm=tl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&o&&(Ri=!0),n.firstContext=null)}function pr(n){var o=n._currentValue;if(Pm!==n)if(n={context:n,memoizedValue:o,next:null},tl===null){if(ad===null)throw Error(Ie(308));tl=n,ad.dependencies={lanes:0,firstContext:n}}else tl=tl.next=n;return o}var ia=null;function Dm(n){ia===null?ia=[n]:ia.push(n)}function Kx(n,o,u,m){var _=o.interleaved;return _===null?(u.next=u,Dm(o)):(u.next=_.next,_.next=u),o.interleaved=u,ko(n,m)}function ko(n,o){n.lanes|=o;var u=n.alternate;for(u!==null&&(u.lanes|=o),u=n,n=n.return;n!==null;)n.childLanes|=o,u=n.alternate,u!==null&&(u.childLanes|=o),u=n,n=n.return;return u.tag===3?u.stateNode:null}var ns=!1;function Lm(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yx(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function So(n,o){return{eventTime:n,lane:o,tag:0,payload:null,callback:null,next:null}}function ds(n,o,u){var m=n.updateQueue;if(m===null)return null;if(m=m.shared,Rt&2){var _=m.pending;return _===null?o.next=o:(o.next=_.next,_.next=o),m.pending=o,ko(n,u)}return _=m.interleaved,_===null?(o.next=o,Dm(m)):(o.next=_.next,_.next=o),m.interleaved=o,ko(n,u)}function Oh(n,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194240)!==0)){var m=o.lanes;m&=n.pendingLanes,u|=m,o.lanes=u,xm(n,u)}}function a_(n,o){var u=n.updateQueue,m=n.alternate;if(m!==null&&(m=m.updateQueue,u===m)){var _=null,w=null;if(u=u.firstBaseUpdate,u!==null){do{var z={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};w===null?_=w=z:w=w.next=z,u=u.next}while(u!==null);w===null?_=w=o:w=w.next=o}else _=w=o;u={baseState:m.baseState,firstBaseUpdate:_,lastBaseUpdate:w,shared:m.shared,effects:m.effects},n.updateQueue=u;return}n=u.lastBaseUpdate,n===null?u.firstBaseUpdate=o:n.next=o,u.lastBaseUpdate=o}function ld(n,o,u,m){var _=n.updateQueue;ns=!1;var w=_.firstBaseUpdate,z=_.lastBaseUpdate,l=_.shared.pending;if(l!==null){_.shared.pending=null;var U=l,X=U.next;U.next=null,z===null?w=X:z.next=X,z=U;var pe=n.alternate;pe!==null&&(pe=pe.updateQueue,l=pe.lastBaseUpdate,l!==z&&(l===null?pe.firstBaseUpdate=X:l.next=X,pe.lastBaseUpdate=U))}if(w!==null){var le=_.baseState;z=0,pe=X=U=null,l=w;do{var W=l.lane,Fe=l.eventTime;if((m&W)===W){pe!==null&&(pe=pe.next={eventTime:Fe,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var Le=n,Ce=l;switch(W=o,Fe=u,Ce.tag){case 1:if(Le=Ce.payload,typeof Le=="function"){le=Le.call(Fe,le,W);break e}le=Le;break e;case 3:Le.flags=Le.flags&-65537|128;case 0:if(Le=Ce.payload,W=typeof Le=="function"?Le.call(Fe,le,W):Le,W==null)break e;le=dn({},le,W);break e;case 2:ns=!0}}l.callback!==null&&l.lane!==0&&(n.flags|=64,W=_.effects,W===null?_.effects=[l]:W.push(l))}else Fe={eventTime:Fe,lane:W,tag:l.tag,payload:l.payload,callback:l.callback,next:null},pe===null?(X=pe=Fe,U=le):pe=pe.next=Fe,z|=W;if(l=l.next,l===null){if(l=_.shared.pending,l===null)break;W=l,l=W.next,W.next=null,_.lastBaseUpdate=W,_.shared.pending=null}}while(1);if(pe===null&&(U=le),_.baseState=U,_.firstBaseUpdate=X,_.lastBaseUpdate=pe,o=_.shared.interleaved,o!==null){_=o;do z|=_.lane,_=_.next;while(_!==o)}else w===null&&(_.shared.lanes=0);ca|=z,n.lanes=z,n.memoizedState=le}}function l_(n,o,u){if(n=o.effects,o.effects=null,n!==null)for(o=0;o<n.length;o++){var m=n[o],_=m.callback;if(_!==null){if(m.callback=null,m=u,typeof _!="function")throw Error(Ie(191,_));_.call(m)}}}var Jx=new K_.Component().refs;function Gf(n,o,u,m){o=n.memoizedState,u=u(m,o),u=u==null?o:dn({},o,u),n.memoizedState=u,n.lanes===0&&(n.updateQueue.baseState=u)}var Ed={isMounted:function(n){return(n=n._reactInternals)?pa(n)===n:!1},enqueueSetState:function(n,o,u){n=n._reactInternals;var m=Ti(),_=fs(n),w=So(m,_);w.payload=o,u!=null&&(w.callback=u),o=ds(n,w,_),o!==null&&(Ar(o,n,_,m),Oh(o,n,_))},enqueueReplaceState:function(n,o,u){n=n._reactInternals;var m=Ti(),_=fs(n),w=So(m,_);w.tag=1,w.payload=o,u!=null&&(w.callback=u),o=ds(n,w,_),o!==null&&(Ar(o,n,_,m),Oh(o,n,_))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var u=Ti(),m=fs(n),_=So(u,m);_.tag=2,o!=null&&(_.callback=o),o=ds(n,_,m),o!==null&&(Ar(o,n,m,u),Oh(o,n,m))}};function u_(n,o,u,m,_,w,z){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(m,w,z):o.prototype&&o.prototype.isPureReactComponent?!Wu(u,m)||!Wu(_,w):!0}function Qx(n,o,u){var m=!1,_=ys,w=o.contextType;return typeof w=="object"&&w!==null?w=pr(w):(_=Fi(o)?aa:ci.current,m=o.contextTypes,w=(m=m!=null)?hl(n,_):ys),o=new o(u,w),n.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Ed,n.stateNode=o,o._reactInternals=n,m&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=_,n.__reactInternalMemoizedMaskedChildContext=w),o}function c_(n,o,u,m){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,m),o.state!==n&&Ed.enqueueReplaceState(o,o.state,null)}function Zf(n,o,u,m){var _=n.stateNode;_.props=u,_.state=n.memoizedState,_.refs=Jx,Lm(n);var w=o.contextType;typeof w=="object"&&w!==null?_.context=pr(w):(w=Fi(o)?aa:ci.current,_.context=hl(n,w)),_.state=n.memoizedState,w=o.getDerivedStateFromProps,typeof w=="function"&&(Gf(n,o,w,u),_.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(o=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),o!==_.state&&Ed.enqueueReplaceState(_,_.state,null),ld(n,u,_,m),_.state=n.memoizedState),typeof _.componentDidMount=="function"&&(n.flags|=4194308)}function Su(n,o,u){if(n=u.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(Ie(309));var m=u.stateNode}if(!m)throw Error(Ie(147,n));var _=m,w=""+n;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===w?o.ref:(o=function(z){var l=_.refs;l===Jx&&(l=_.refs={}),z===null?delete l[w]:l[w]=z},o._stringRef=w,o)}if(typeof n!="string")throw Error(Ie(284));if(!u._owner)throw Error(Ie(290,n))}return n}function Ih(n,o){throw n=Object.prototype.toString.call(o),Error(Ie(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n))}function h_(n){var o=n._init;return o(n._payload)}function e0(n){function o(ae,ee){if(n){var se=ae.deletions;se===null?(ae.deletions=[ee],ae.flags|=16):se.push(ee)}}function u(ae,ee){if(!n)return null;for(;ee!==null;)o(ae,ee),ee=ee.sibling;return null}function m(ae,ee){for(ae=new Map;ee!==null;)ee.key!==null?ae.set(ee.key,ee):ae.set(ee.index,ee),ee=ee.sibling;return ae}function _(ae,ee){return ae=ms(ae,ee),ae.index=0,ae.sibling=null,ae}function w(ae,ee,se){return ae.index=se,n?(se=ae.alternate,se!==null?(se=se.index,se<ee?(ae.flags|=2,ee):se):(ae.flags|=2,ee)):(ae.flags|=1048576,ee)}function z(ae){return n&&ae.alternate===null&&(ae.flags|=2),ae}function l(ae,ee,se,ke){return ee===null||ee.tag!==6?(ee=uf(se,ae.mode,ke),ee.return=ae,ee):(ee=_(ee,se),ee.return=ae,ee)}function U(ae,ee,se,ke){var De=se.type;return De===Wa?pe(ae,ee,se.props.children,ke,se.key):ee!==null&&(ee.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===ts&&h_(De)===ee.type)?(ke=_(ee,se.props),ke.ref=Su(ae,ee,se),ke.return=ae,ke):(ke=Gh(se.type,se.key,se.props,null,ae.mode,ke),ke.ref=Su(ae,ee,se),ke.return=ae,ke)}function X(ae,ee,se,ke){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==se.containerInfo||ee.stateNode.implementation!==se.implementation?(ee=cf(se,ae.mode,ke),ee.return=ae,ee):(ee=_(ee,se.children||[]),ee.return=ae,ee)}function pe(ae,ee,se,ke,De){return ee===null||ee.tag!==7?(ee=sa(se,ae.mode,ke,De),ee.return=ae,ee):(ee=_(ee,se),ee.return=ae,ee)}function le(ae,ee,se){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=uf(""+ee,ae.mode,se),ee.return=ae,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case yh:return se=Gh(ee.type,ee.key,ee.props,null,ae.mode,se),se.ref=Su(ae,null,ee),se.return=ae,se;case qa:return ee=cf(ee,ae.mode,se),ee.return=ae,ee;case ts:var ke=ee._init;return le(ae,ke(ee._payload),se)}if(Cu(ee)||_u(ee))return ee=sa(ee,ae.mode,se,null),ee.return=ae,ee;Ih(ae,ee)}return null}function W(ae,ee,se,ke){var De=ee!==null?ee.key:null;if(typeof se=="string"&&se!==""||typeof se=="number")return De!==null?null:l(ae,ee,""+se,ke);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case yh:return se.key===De?U(ae,ee,se,ke):null;case qa:return se.key===De?X(ae,ee,se,ke):null;case ts:return De=se._init,W(ae,ee,De(se._payload),ke)}if(Cu(se)||_u(se))return De!==null?null:pe(ae,ee,se,ke,null);Ih(ae,se)}return null}function Fe(ae,ee,se,ke,De){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return ae=ae.get(se)||null,l(ee,ae,""+ke,De);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case yh:return ae=ae.get(ke.key===null?se:ke.key)||null,U(ee,ae,ke,De);case qa:return ae=ae.get(ke.key===null?se:ke.key)||null,X(ee,ae,ke,De);case ts:var He=ke._init;return Fe(ae,ee,se,He(ke._payload),De)}if(Cu(ke)||_u(ke))return ae=ae.get(se)||null,pe(ee,ae,ke,De,null);Ih(ee,ke)}return null}function Le(ae,ee,se,ke){for(var De=null,He=null,Je=ee,Qe=ee=0,Zt=null;Je!==null&&Qe<se.length;Qe++){Je.index>Qe?(Zt=Je,Je=null):Zt=Je.sibling;var mt=W(ae,Je,se[Qe],ke);if(mt===null){Je===null&&(Je=Zt);break}n&&Je&&mt.alternate===null&&o(ae,Je),ee=w(mt,ee,Qe),He===null?De=mt:He.sibling=mt,He=mt,Je=Zt}if(Qe===se.length)return u(ae,Je),ln&&ea(ae,Qe),De;if(Je===null){for(;Qe<se.length;Qe++)Je=le(ae,se[Qe],ke),Je!==null&&(ee=w(Je,ee,Qe),He===null?De=Je:He.sibling=Je,He=Je);return ln&&ea(ae,Qe),De}for(Je=m(ae,Je);Qe<se.length;Qe++)Zt=Fe(Je,ae,Qe,se[Qe],ke),Zt!==null&&(n&&Zt.alternate!==null&&Je.delete(Zt.key===null?Qe:Zt.key),ee=w(Zt,ee,Qe),He===null?De=Zt:He.sibling=Zt,He=Zt);return n&&Je.forEach(function(_n){return o(ae,_n)}),ln&&ea(ae,Qe),De}function Ce(ae,ee,se,ke){var De=_u(se);if(typeof De!="function")throw Error(Ie(150));if(se=De.call(se),se==null)throw Error(Ie(151));for(var He=De=null,Je=ee,Qe=ee=0,Zt=null,mt=se.next();Je!==null&&!mt.done;Qe++,mt=se.next()){Je.index>Qe?(Zt=Je,Je=null):Zt=Je.sibling;var _n=W(ae,Je,mt.value,ke);if(_n===null){Je===null&&(Je=Zt);break}n&&Je&&_n.alternate===null&&o(ae,Je),ee=w(_n,ee,Qe),He===null?De=_n:He.sibling=_n,He=_n,Je=Zt}if(mt.done)return u(ae,Je),ln&&ea(ae,Qe),De;if(Je===null){for(;!mt.done;Qe++,mt=se.next())mt=le(ae,mt.value,ke),mt!==null&&(ee=w(mt,ee,Qe),He===null?De=mt:He.sibling=mt,He=mt);return ln&&ea(ae,Qe),De}for(Je=m(ae,Je);!mt.done;Qe++,mt=se.next())mt=Fe(Je,ae,Qe,mt.value,ke),mt!==null&&(n&&mt.alternate!==null&&Je.delete(mt.key===null?Qe:mt.key),ee=w(mt,ee,Qe),He===null?De=mt:He.sibling=mt,He=mt);return n&&Je.forEach(function(Zn){return o(ae,Zn)}),ln&&ea(ae,Qe),De}function Ot(ae,ee,se,ke){if(typeof se=="object"&&se!==null&&se.type===Wa&&se.key===null&&(se=se.props.children),typeof se=="object"&&se!==null){switch(se.$$typeof){case yh:e:{for(var De=se.key,He=ee;He!==null;){if(He.key===De){if(De=se.type,De===Wa){if(He.tag===7){u(ae,He.sibling),ee=_(He,se.props.children),ee.return=ae,ae=ee;break e}}else if(He.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===ts&&h_(De)===He.type){u(ae,He.sibling),ee=_(He,se.props),ee.ref=Su(ae,He,se),ee.return=ae,ae=ee;break e}u(ae,He);break}else o(ae,He);He=He.sibling}se.type===Wa?(ee=sa(se.props.children,ae.mode,ke,se.key),ee.return=ae,ae=ee):(ke=Gh(se.type,se.key,se.props,null,ae.mode,ke),ke.ref=Su(ae,ee,se),ke.return=ae,ae=ke)}return z(ae);case qa:e:{for(He=se.key;ee!==null;){if(ee.key===He)if(ee.tag===4&&ee.stateNode.containerInfo===se.containerInfo&&ee.stateNode.implementation===se.implementation){u(ae,ee.sibling),ee=_(ee,se.children||[]),ee.return=ae,ae=ee;break e}else{u(ae,ee);break}else o(ae,ee);ee=ee.sibling}ee=cf(se,ae.mode,ke),ee.return=ae,ae=ee}return z(ae);case ts:return He=se._init,Ot(ae,ee,He(se._payload),ke)}if(Cu(se))return Le(ae,ee,se,ke);if(_u(se))return Ce(ae,ee,se,ke);Ih(ae,se)}return typeof se=="string"&&se!==""||typeof se=="number"?(se=""+se,ee!==null&&ee.tag===6?(u(ae,ee.sibling),ee=_(ee,se),ee.return=ae,ae=ee):(u(ae,ee),ee=uf(se,ae.mode,ke),ee.return=ae,ae=ee),z(ae)):u(ae,ee)}return Ot}var pl=e0(!0),t0=e0(!1),ac={},Qr=xs(ac),Yu=xs(ac),Ju=xs(ac);function ra(n){if(n===ac)throw Error(Ie(174));return n}function Rm(n,o){switch(nn(Ju,o),nn(Yu,n),nn(Qr,ac),n=o.nodeType,n){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Sf(null,"");break;default:n=n===8?o.parentNode:o,o=n.namespaceURI||null,n=n.tagName,o=Sf(o,n)}on(Qr),nn(Qr,o)}function fl(){on(Qr),on(Yu),on(Ju)}function n0(n){ra(Ju.current);var o=ra(Qr.current),u=Sf(o,n.type);o!==u&&(nn(Yu,n),nn(Qr,u))}function Bm(n){Yu.current===n&&(on(Qr),on(Yu))}var cn=xs(0);function ud(n){for(var o=n;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var nf=[];function Fm(){for(var n=0;n<nf.length;n++)nf[n]._workInProgressVersionPrimary=null;nf.length=0}var Nh=Io.ReactCurrentDispatcher,rf=Io.ReactCurrentBatchConfig,ua=0,hn=null,Ln=null,$n=null,cd=!1,Ru=!1,Qu=0,Nb=0;function ai(){throw Error(Ie(321))}function Om(n,o){if(o===null)return!1;for(var u=0;u<o.length&&u<n.length;u++)if(!Dr(n[u],o[u]))return!1;return!0}function Nm(n,o,u,m,_,w){if(ua=w,hn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Nh.current=n===null||n.memoizedState===null?jb:Gb,n=u(m,_),Ru){w=0;do{if(Ru=!1,Qu=0,25<=w)throw Error(Ie(301));w+=1,$n=Ln=null,o.updateQueue=null,Nh.current=Zb,n=u(m,_)}while(Ru)}if(Nh.current=hd,o=Ln!==null&&Ln.next!==null,ua=0,$n=Ln=hn=null,cd=!1,o)throw Error(Ie(300));return n}function Um(){var n=Qu!==0;return Qu=0,n}function Kr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $n===null?hn.memoizedState=$n=n:$n=$n.next=n,$n}function fr(){if(Ln===null){var n=hn.alternate;n=n!==null?n.memoizedState:null}else n=Ln.next;var o=$n===null?hn.memoizedState:$n.next;if(o!==null)$n=o,Ln=n;else{if(n===null)throw Error(Ie(310));Ln=n,n={memoizedState:Ln.memoizedState,baseState:Ln.baseState,baseQueue:Ln.baseQueue,queue:Ln.queue,next:null},$n===null?hn.memoizedState=$n=n:$n=$n.next=n}return $n}function ec(n,o){return typeof o=="function"?o(n):o}function of(n){var o=fr(),u=o.queue;if(u===null)throw Error(Ie(311));u.lastRenderedReducer=n;var m=Ln,_=m.baseQueue,w=u.pending;if(w!==null){if(_!==null){var z=_.next;_.next=w.next,w.next=z}m.baseQueue=_=w,u.pending=null}if(_!==null){w=_.next,m=m.baseState;var l=z=null,U=null,X=w;do{var pe=X.lane;if((ua&pe)===pe)U!==null&&(U=U.next={lane:0,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null}),m=X.hasEagerState?X.eagerState:n(m,X.action);else{var le={lane:pe,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null};U===null?(l=U=le,z=m):U=U.next=le,hn.lanes|=pe,ca|=pe}X=X.next}while(X!==null&&X!==w);U===null?z=m:U.next=l,Dr(m,o.memoizedState)||(Ri=!0),o.memoizedState=m,o.baseState=z,o.baseQueue=U,u.lastRenderedState=m}if(n=u.interleaved,n!==null){_=n;do w=_.lane,hn.lanes|=w,ca|=w,_=_.next;while(_!==n)}else _===null&&(u.lanes=0);return[o.memoizedState,u.dispatch]}function sf(n){var o=fr(),u=o.queue;if(u===null)throw Error(Ie(311));u.lastRenderedReducer=n;var m=u.dispatch,_=u.pending,w=o.memoizedState;if(_!==null){u.pending=null;var z=_=_.next;do w=n(w,z.action),z=z.next;while(z!==_);Dr(w,o.memoizedState)||(Ri=!0),o.memoizedState=w,o.baseQueue===null&&(o.baseState=w),u.lastRenderedState=w}return[w,m]}function i0(){}function r0(n,o){var u=hn,m=fr(),_=o(),w=!Dr(m.memoizedState,_);if(w&&(m.memoizedState=_,Ri=!0),m=m.queue,Vm(a0.bind(null,u,m,n),[n]),m.getSnapshot!==o||w||$n!==null&&$n.memoizedState.tag&1){if(u.flags|=2048,tc(9,s0.bind(null,u,m,_,o),void 0,null),Gn===null)throw Error(Ie(349));ua&30||o0(u,o,_)}return _}function o0(n,o,u){n.flags|=16384,n={getSnapshot:o,value:u},o=hn.updateQueue,o===null?(o={lastEffect:null,stores:null},hn.updateQueue=o,o.stores=[n]):(u=o.stores,u===null?o.stores=[n]:u.push(n))}function s0(n,o,u,m){o.value=u,o.getSnapshot=m,l0(o)&&u0(n)}function a0(n,o,u){return u(function(){l0(o)&&u0(n)})}function l0(n){var o=n.getSnapshot;n=n.value;try{var u=o();return!Dr(n,u)}catch{return!0}}function u0(n){var o=ko(n,1);o!==null&&Ar(o,n,1,-1)}function d_(n){var o=Kr();return typeof n=="function"&&(n=n()),o.memoizedState=o.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ec,lastRenderedState:n},o.queue=n,n=n.dispatch=$b.bind(null,hn,n),[o.memoizedState,n]}function tc(n,o,u,m){return n={tag:n,create:o,destroy:u,deps:m,next:null},o=hn.updateQueue,o===null?(o={lastEffect:null,stores:null},hn.updateQueue=o,o.lastEffect=n.next=n):(u=o.lastEffect,u===null?o.lastEffect=n.next=n:(m=u.next,u.next=n,n.next=m,o.lastEffect=n)),n}function c0(){return fr().memoizedState}function Uh(n,o,u,m){var _=Kr();hn.flags|=n,_.memoizedState=tc(1|o,u,void 0,m===void 0?null:m)}function Td(n,o,u,m){var _=fr();m=m===void 0?null:m;var w=void 0;if(Ln!==null){var z=Ln.memoizedState;if(w=z.destroy,m!==null&&Om(m,z.deps)){_.memoizedState=tc(o,u,w,m);return}}hn.flags|=n,_.memoizedState=tc(1|o,u,w,m)}function p_(n,o){return Uh(8390656,8,n,o)}function Vm(n,o){return Td(2048,8,n,o)}function h0(n,o){return Td(4,2,n,o)}function d0(n,o){return Td(4,4,n,o)}function p0(n,o){if(typeof o=="function")return n=n(),o(n),function(){o(null)};if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function f0(n,o,u){return u=u!=null?u.concat([n]):null,Td(4,4,p0.bind(null,o,n),u)}function $m(){}function m0(n,o){var u=fr();o=o===void 0?null:o;var m=u.memoizedState;return m!==null&&o!==null&&Om(o,m[1])?m[0]:(u.memoizedState=[n,o],n)}function g0(n,o){var u=fr();o=o===void 0?null:o;var m=u.memoizedState;return m!==null&&o!==null&&Om(o,m[1])?m[0]:(n=n(),u.memoizedState=[n,o],n)}function y0(n,o,u){return ua&21?(Dr(u,o)||(u=vx(),hn.lanes|=u,ca|=u,n.baseState=!0),o):(n.baseState&&(n.baseState=!1,Ri=!0),n.memoizedState=u)}function Ub(n,o){var u=Gt;Gt=u!==0&&4>u?u:4,n(!0);var m=rf.transition;rf.transition={};try{n(!1),o()}finally{Gt=u,rf.transition=m}}function _0(){return fr().memoizedState}function Vb(n,o,u){var m=fs(n);if(u={lane:m,action:u,hasEagerState:!1,eagerState:null,next:null},x0(n))v0(o,u);else if(u=Kx(n,o,u,m),u!==null){var _=Ti();Ar(u,n,m,_),w0(u,o,m)}}function $b(n,o,u){var m=fs(n),_={lane:m,action:u,hasEagerState:!1,eagerState:null,next:null};if(x0(n))v0(o,_);else{var w=n.alternate;if(n.lanes===0&&(w===null||w.lanes===0)&&(w=o.lastRenderedReducer,w!==null))try{var z=o.lastRenderedState,l=w(z,u);if(_.hasEagerState=!0,_.eagerState=l,Dr(l,z)){var U=o.interleaved;U===null?(_.next=_,Dm(o)):(_.next=U.next,U.next=_),o.interleaved=_;return}}catch{}finally{}u=Kx(n,o,_,m),u!==null&&(_=Ti(),Ar(u,n,m,_),w0(u,o,m))}}function x0(n){var o=n.alternate;return n===hn||o!==null&&o===hn}function v0(n,o){Ru=cd=!0;var u=n.pending;u===null?o.next=o:(o.next=u.next,u.next=o),n.pending=o}function w0(n,o,u){if(u&4194240){var m=o.lanes;m&=n.pendingLanes,u|=m,o.lanes=u,xm(n,u)}}var hd={readContext:pr,useCallback:ai,useContext:ai,useEffect:ai,useImperativeHandle:ai,useInsertionEffect:ai,useLayoutEffect:ai,useMemo:ai,useReducer:ai,useRef:ai,useState:ai,useDebugValue:ai,useDeferredValue:ai,useTransition:ai,useMutableSource:ai,useSyncExternalStore:ai,useId:ai,unstable_isNewReconciler:!1},jb={readContext:pr,useCallback:function(n,o){return Kr().memoizedState=[n,o===void 0?null:o],n},useContext:pr,useEffect:p_,useImperativeHandle:function(n,o,u){return u=u!=null?u.concat([n]):null,Uh(4194308,4,p0.bind(null,o,n),u)},useLayoutEffect:function(n,o){return Uh(4194308,4,n,o)},useInsertionEffect:function(n,o){return Uh(4,2,n,o)},useMemo:function(n,o){var u=Kr();return o=o===void 0?null:o,n=n(),u.memoizedState=[n,o],n},useReducer:function(n,o,u){var m=Kr();return o=u!==void 0?u(o):o,m.memoizedState=m.baseState=o,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:o},m.queue=n,n=n.dispatch=Vb.bind(null,hn,n),[m.memoizedState,n]},useRef:function(n){var o=Kr();return n={current:n},o.memoizedState=n},useState:d_,useDebugValue:$m,useDeferredValue:function(n){return Kr().memoizedState=n},useTransition:function(){var n=d_(!1),o=n[0];return n=Ub.bind(null,n[1]),Kr().memoizedState=n,[o,n]},useMutableSource:function(){},useSyncExternalStore:function(n,o,u){var m=hn,_=Kr();if(ln){if(u===void 0)throw Error(Ie(407));u=u()}else{if(u=o(),Gn===null)throw Error(Ie(349));ua&30||o0(m,o,u)}_.memoizedState=u;var w={value:u,getSnapshot:o};return _.queue=w,p_(a0.bind(null,m,w,n),[n]),m.flags|=2048,tc(9,s0.bind(null,m,w,u,o),void 0,null),u},useId:function(){var n=Kr(),o=Gn.identifierPrefix;if(ln){var u=bo,m=wo;u=(m&~(1<<32-Mr(m)-1)).toString(32)+u,o=":"+o+"R"+u,u=Qu++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=Nb++,o=":"+o+"r"+u.toString(32)+":";return n.memoizedState=o},unstable_isNewReconciler:!1},Gb={readContext:pr,useCallback:m0,useContext:pr,useEffect:Vm,useImperativeHandle:f0,useInsertionEffect:h0,useLayoutEffect:d0,useMemo:g0,useReducer:of,useRef:c0,useState:function(){return of(ec)},useDebugValue:$m,useDeferredValue:function(n){var o=fr();return y0(o,Ln.memoizedState,n)},useTransition:function(){var n=of(ec)[0],o=fr().memoizedState;return[n,o]},useMutableSource:i0,useSyncExternalStore:r0,useId:_0,unstable_isNewReconciler:!1},Zb={readContext:pr,useCallback:m0,useContext:pr,useEffect:Vm,useImperativeHandle:f0,useInsertionEffect:h0,useLayoutEffect:d0,useMemo:g0,useReducer:sf,useRef:c0,useState:function(){return sf(ec)},useDebugValue:$m,useDeferredValue:function(n){var o=fr();return Ln===null?o.memoizedState=n:y0(o,Ln.memoizedState,n)},useTransition:function(){var n=sf(ec)[0],o=fr().memoizedState;return[n,o]},useMutableSource:i0,useSyncExternalStore:r0,useId:_0,unstable_isNewReconciler:!1};function ml(n,o){try{var u="",m=o;do u+=xw(m),m=m.return;while(m);var _=u}catch(w){_=`
Error generating stack: `+w.message+`
`+w.stack}return{value:n,source:o,stack:_,digest:null}}function af(n,o,u){return{value:n,source:null,stack:u??null,digest:o??null}}function qf(n,o){try{console.error(o.value)}catch(u){setTimeout(function(){throw u})}}var qb=typeof WeakMap=="function"?WeakMap:Map;function b0(n,o,u){u=So(-1,u),u.tag=3,u.payload={element:null};var m=o.value;return u.callback=function(){pd||(pd=!0,nm=m),qf(n,o)},u}function S0(n,o,u){u=So(-1,u),u.tag=3;var m=n.type.getDerivedStateFromError;if(typeof m=="function"){var _=o.value;u.payload=function(){return m(_)},u.callback=function(){qf(n,o)}}var w=n.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(u.callback=function(){qf(n,o),typeof m!="function"&&(ps===null?ps=new Set([this]):ps.add(this));var z=o.stack;this.componentDidCatch(o.value,{componentStack:z!==null?z:""})}),u}function f_(n,o,u){var m=n.pingCache;if(m===null){m=n.pingCache=new qb;var _=new Set;m.set(o,_)}else _=m.get(o),_===void 0&&(_=new Set,m.set(o,_));_.has(u)||(_.add(u),n=s2.bind(null,n,o,u),o.then(n,n))}function m_(n){do{var o;if((o=n.tag===13)&&(o=n.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return n;n=n.return}while(n!==null);return null}function g_(n,o,u,m,_){return n.mode&1?(n.flags|=65536,n.lanes=_,n):(n===o?n.flags|=65536:(n.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(o=So(-1,1),o.tag=2,ds(u,o,1))),u.lanes|=1),n)}var Wb=Io.ReactCurrentOwner,Ri=!1;function Ei(n,o,u,m){o.child=n===null?t0(o,null,u,m):pl(o,n.child,u,m)}function y_(n,o,u,m,_){u=u.render;var w=o.ref;return ll(o,_),m=Nm(n,o,u,m,w,_),u=Um(),n!==null&&!Ri?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~_,Co(n,o,_)):(ln&&u&&Cm(o),o.flags|=1,Ei(n,o,m,_),o.child)}function __(n,o,u,m,_){if(n===null){var w=u.type;return typeof w=="function"&&!Km(w)&&w.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(o.tag=15,o.type=w,E0(n,o,w,m,_)):(n=Gh(u.type,null,m,o,o.mode,_),n.ref=o.ref,n.return=o,o.child=n)}if(w=n.child,!(n.lanes&_)){var z=w.memoizedProps;if(u=u.compare,u=u!==null?u:Wu,u(z,m)&&n.ref===o.ref)return Co(n,o,_)}return o.flags|=1,n=ms(w,m),n.ref=o.ref,n.return=o,o.child=n}function E0(n,o,u,m,_){if(n!==null){var w=n.memoizedProps;if(Wu(w,m)&&n.ref===o.ref)if(Ri=!1,o.pendingProps=m=w,(n.lanes&_)!==0)n.flags&131072&&(Ri=!0);else return o.lanes=n.lanes,Co(n,o,_)}return Wf(n,o,u,m,_)}function T0(n,o,u){var m=o.pendingProps,_=m.children,w=n!==null?n.memoizedState:null;if(m.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},nn(il,Xi),Xi|=u;else{if(!(u&1073741824))return n=w!==null?w.baseLanes|u:u,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:n,cachePool:null,transitions:null},o.updateQueue=null,nn(il,Xi),Xi|=n,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=w!==null?w.baseLanes:u,nn(il,Xi),Xi|=m}else w!==null?(m=w.baseLanes|u,o.memoizedState=null):m=u,nn(il,Xi),Xi|=m;return Ei(n,o,_,u),o.child}function k0(n,o){var u=o.ref;(n===null&&u!==null||n!==null&&n.ref!==u)&&(o.flags|=512,o.flags|=2097152)}function Wf(n,o,u,m,_){var w=Fi(u)?aa:ci.current;return w=hl(o,w),ll(o,_),u=Nm(n,o,u,m,w,_),m=Um(),n!==null&&!Ri?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~_,Co(n,o,_)):(ln&&m&&Cm(o),o.flags|=1,Ei(n,o,u,_),o.child)}function x_(n,o,u,m,_){if(Fi(u)){var w=!0;id(o)}else w=!1;if(ll(o,_),o.stateNode===null)Vh(n,o),Qx(o,u,m),Zf(o,u,m,_),m=!0;else if(n===null){var z=o.stateNode,l=o.memoizedProps;z.props=l;var U=z.context,X=u.contextType;typeof X=="object"&&X!==null?X=pr(X):(X=Fi(u)?aa:ci.current,X=hl(o,X));var pe=u.getDerivedStateFromProps,le=typeof pe=="function"||typeof z.getSnapshotBeforeUpdate=="function";le||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(l!==m||U!==X)&&c_(o,z,m,X),ns=!1;var W=o.memoizedState;z.state=W,ld(o,m,z,_),U=o.memoizedState,l!==m||W!==U||Bi.current||ns?(typeof pe=="function"&&(Gf(o,u,pe,m),U=o.memoizedState),(l=ns||u_(o,u,l,m,W,U,X))?(le||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount()),typeof z.componentDidMount=="function"&&(o.flags|=4194308)):(typeof z.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=U),z.props=m,z.state=U,z.context=X,m=l):(typeof z.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{z=o.stateNode,Yx(n,o),l=o.memoizedProps,X=o.type===o.elementType?l:Ir(o.type,l),z.props=X,le=o.pendingProps,W=z.context,U=u.contextType,typeof U=="object"&&U!==null?U=pr(U):(U=Fi(u)?aa:ci.current,U=hl(o,U));var Fe=u.getDerivedStateFromProps;(pe=typeof Fe=="function"||typeof z.getSnapshotBeforeUpdate=="function")||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(l!==le||W!==U)&&c_(o,z,m,U),ns=!1,W=o.memoizedState,z.state=W,ld(o,m,z,_);var Le=o.memoizedState;l!==le||W!==Le||Bi.current||ns?(typeof Fe=="function"&&(Gf(o,u,Fe,m),Le=o.memoizedState),(X=ns||u_(o,u,X,m,W,Le,U)||!1)?(pe||typeof z.UNSAFE_componentWillUpdate!="function"&&typeof z.componentWillUpdate!="function"||(typeof z.componentWillUpdate=="function"&&z.componentWillUpdate(m,Le,U),typeof z.UNSAFE_componentWillUpdate=="function"&&z.UNSAFE_componentWillUpdate(m,Le,U)),typeof z.componentDidUpdate=="function"&&(o.flags|=4),typeof z.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof z.componentDidUpdate!="function"||l===n.memoizedProps&&W===n.memoizedState||(o.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&W===n.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=Le),z.props=m,z.state=Le,z.context=U,m=X):(typeof z.componentDidUpdate!="function"||l===n.memoizedProps&&W===n.memoizedState||(o.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&W===n.memoizedState||(o.flags|=1024),m=!1)}return Xf(n,o,u,m,w,_)}function Xf(n,o,u,m,_,w){k0(n,o);var z=(o.flags&128)!==0;if(!m&&!z)return _&&r_(o,u,!1),Co(n,o,w);m=o.stateNode,Wb.current=o;var l=z&&typeof u.getDerivedStateFromError!="function"?null:m.render();return o.flags|=1,n!==null&&z?(o.child=pl(o,n.child,null,w),o.child=pl(o,null,l,w)):Ei(n,o,l,w),o.memoizedState=m.state,_&&r_(o,u,!0),o.child}function C0(n){var o=n.stateNode;o.pendingContext?i_(n,o.pendingContext,o.pendingContext!==o.context):o.context&&i_(n,o.context,!1),Rm(n,o.containerInfo)}function v_(n,o,u,m,_){return dl(),zm(_),o.flags|=256,Ei(n,o,u,m),o.child}var Hf={dehydrated:null,treeContext:null,retryLane:0};function Kf(n){return{baseLanes:n,cachePool:null,transitions:null}}function I0(n,o,u){var m=o.pendingProps,_=cn.current,w=!1,z=(o.flags&128)!==0,l;if((l=z)||(l=n!==null&&n.memoizedState===null?!1:(_&2)!==0),l?(w=!0,o.flags&=-129):(n===null||n.memoizedState!==null)&&(_|=1),nn(cn,_&1),n===null)return $f(o),n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(o.mode&1?n.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(z=m.children,n=m.fallback,w?(m=o.mode,w=o.child,z={mode:"hidden",children:z},!(m&1)&&w!==null?(w.childLanes=0,w.pendingProps=z):w=Id(z,m,0,null),n=sa(n,m,u,null),w.return=o,n.return=o,w.sibling=n,o.child=w,o.child.memoizedState=Kf(u),o.memoizedState=Hf,n):jm(o,z));if(_=n.memoizedState,_!==null&&(l=_.dehydrated,l!==null))return Xb(n,o,z,m,l,_,u);if(w){w=m.fallback,z=o.mode,_=n.child,l=_.sibling;var U={mode:"hidden",children:m.children};return!(z&1)&&o.child!==_?(m=o.child,m.childLanes=0,m.pendingProps=U,o.deletions=null):(m=ms(_,U),m.subtreeFlags=_.subtreeFlags&14680064),l!==null?w=ms(l,w):(w=sa(w,z,u,null),w.flags|=2),w.return=o,m.return=o,m.sibling=w,o.child=m,m=w,w=o.child,z=n.child.memoizedState,z=z===null?Kf(u):{baseLanes:z.baseLanes|u,cachePool:null,transitions:z.transitions},w.memoizedState=z,w.childLanes=n.childLanes&~u,o.memoizedState=Hf,m}return w=n.child,n=w.sibling,m=ms(w,{mode:"visible",children:m.children}),!(o.mode&1)&&(m.lanes=u),m.return=o,m.sibling=null,n!==null&&(u=o.deletions,u===null?(o.deletions=[n],o.flags|=16):u.push(n)),o.child=m,o.memoizedState=null,m}function jm(n,o){return o=Id({mode:"visible",children:o},n.mode,0,null),o.return=n,n.child=o}function zh(n,o,u,m){return m!==null&&zm(m),pl(o,n.child,null,u),n=jm(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function Xb(n,o,u,m,_,w,z){if(u)return o.flags&256?(o.flags&=-257,m=af(Error(Ie(422))),zh(n,o,z,m)):o.memoizedState!==null?(o.child=n.child,o.flags|=128,null):(w=m.fallback,_=o.mode,m=Id({mode:"visible",children:m.children},_,0,null),w=sa(w,_,z,null),w.flags|=2,m.return=o,w.return=o,m.sibling=w,o.child=m,o.mode&1&&pl(o,n.child,null,z),o.child.memoizedState=Kf(z),o.memoizedState=Hf,w);if(!(o.mode&1))return zh(n,o,z,null);if(_.data==="$!"){if(m=_.nextSibling&&_.nextSibling.dataset,m)var l=m.dgst;return m=l,w=Error(Ie(419)),m=af(w,m,void 0),zh(n,o,z,m)}if(l=(z&n.childLanes)!==0,Ri||l){if(m=Gn,m!==null){switch(z&-z){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(m.suspendedLanes|z)?0:_,_!==0&&_!==w.retryLane&&(w.retryLane=_,ko(n,_),Ar(m,n,_,-1))}return Hm(),m=af(Error(Ie(421))),zh(n,o,z,m)}return _.data==="$?"?(o.flags|=128,o.child=n.child,o=a2.bind(null,n),_._reactRetry=o,null):(n=w.treeContext,Hi=hs(_.nextSibling),Ki=o,ln=!0,Pr=null,n!==null&&(ur[cr++]=wo,ur[cr++]=bo,ur[cr++]=la,wo=n.id,bo=n.overflow,la=o),o=jm(o,m.children),o.flags|=4096,o)}function w_(n,o,u){n.lanes|=o;var m=n.alternate;m!==null&&(m.lanes|=o),jf(n.return,o,u)}function lf(n,o,u,m,_){var w=n.memoizedState;w===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:u,tailMode:_}:(w.isBackwards=o,w.rendering=null,w.renderingStartTime=0,w.last=m,w.tail=u,w.tailMode=_)}function z0(n,o,u){var m=o.pendingProps,_=m.revealOrder,w=m.tail;if(Ei(n,o,m.children,u),m=cn.current,m&2)m=m&1|2,o.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&w_(n,u,o);else if(n.tag===19)w_(n,u,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}m&=1}if(nn(cn,m),!(o.mode&1))o.memoizedState=null;else switch(_){case"forwards":for(u=o.child,_=null;u!==null;)n=u.alternate,n!==null&&ud(n)===null&&(_=u),u=u.sibling;u=_,u===null?(_=o.child,o.child=null):(_=u.sibling,u.sibling=null),lf(o,!1,_,u,w);break;case"backwards":for(u=null,_=o.child,o.child=null;_!==null;){if(n=_.alternate,n!==null&&ud(n)===null){o.child=_;break}n=_.sibling,_.sibling=u,u=_,_=n}lf(o,!0,u,null,w);break;case"together":lf(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Vh(n,o){!(o.mode&1)&&n!==null&&(n.alternate=null,o.alternate=null,o.flags|=2)}function Co(n,o,u){if(n!==null&&(o.dependencies=n.dependencies),ca|=o.lanes,!(u&o.childLanes))return null;if(n!==null&&o.child!==n.child)throw Error(Ie(153));if(o.child!==null){for(n=o.child,u=ms(n,n.pendingProps),o.child=u,u.return=o;n.sibling!==null;)n=n.sibling,u=u.sibling=ms(n,n.pendingProps),u.return=o;u.sibling=null}return o.child}function Hb(n,o,u){switch(o.tag){case 3:C0(o),dl();break;case 5:n0(o);break;case 1:Fi(o.type)&&id(o);break;case 4:Rm(o,o.stateNode.containerInfo);break;case 10:var m=o.type._context,_=o.memoizedProps.value;nn(sd,m._currentValue),m._currentValue=_;break;case 13:if(m=o.memoizedState,m!==null)return m.dehydrated!==null?(nn(cn,cn.current&1),o.flags|=128,null):u&o.child.childLanes?I0(n,o,u):(nn(cn,cn.current&1),n=Co(n,o,u),n!==null?n.sibling:null);nn(cn,cn.current&1);break;case 19:if(m=(u&o.childLanes)!==0,n.flags&128){if(m)return z0(n,o,u);o.flags|=128}if(_=o.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),nn(cn,cn.current),m)break;return null;case 22:case 23:return o.lanes=0,T0(n,o,u)}return Co(n,o,u)}var P0,Yf,M0,A0;P0=function(n,o){for(var u=o.child;u!==null;){if(u.tag===5||u.tag===6)n.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return;u=u.return}u.sibling.return=u.return,u=u.sibling}};Yf=function(){};M0=function(n,o,u,m){var _=n.memoizedProps;if(_!==m){n=o.stateNode,ra(Qr.current);var w=null;switch(u){case"input":_=xf(n,_),m=xf(n,m),w=[];break;case"select":_=dn({},_,{value:void 0}),m=dn({},m,{value:void 0}),w=[];break;case"textarea":_=bf(n,_),m=bf(n,m),w=[];break;default:typeof _.onClick!="function"&&typeof m.onClick=="function"&&(n.onclick=td)}Ef(u,m);var z;u=null;for(X in _)if(!m.hasOwnProperty(X)&&_.hasOwnProperty(X)&&_[X]!=null)if(X==="style"){var l=_[X];for(z in l)l.hasOwnProperty(z)&&(u||(u={}),u[z]="")}else X!=="dangerouslySetInnerHTML"&&X!=="children"&&X!=="suppressContentEditableWarning"&&X!=="suppressHydrationWarning"&&X!=="autoFocus"&&(Uu.hasOwnProperty(X)?w||(w=[]):(w=w||[]).push(X,null));for(X in m){var U=m[X];if(l=_!=null?_[X]:void 0,m.hasOwnProperty(X)&&U!==l&&(U!=null||l!=null))if(X==="style")if(l){for(z in l)!l.hasOwnProperty(z)||U&&U.hasOwnProperty(z)||(u||(u={}),u[z]="");for(z in U)U.hasOwnProperty(z)&&l[z]!==U[z]&&(u||(u={}),u[z]=U[z])}else u||(w||(w=[]),w.push(X,u)),u=U;else X==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,l=l?l.__html:void 0,U!=null&&l!==U&&(w=w||[]).push(X,U)):X==="children"?typeof U!="string"&&typeof U!="number"||(w=w||[]).push(X,""+U):X!=="suppressContentEditableWarning"&&X!=="suppressHydrationWarning"&&(Uu.hasOwnProperty(X)?(U!=null&&X==="onScroll"&&rn("scroll",n),w||l===U||(w=[])):(w=w||[]).push(X,U))}u&&(w=w||[]).push("style",u);var X=w;(o.updateQueue=X)&&(o.flags|=4)}};A0=function(n,o,u,m){u!==m&&(o.flags|=4)};function Eu(n,o){if(!ln)switch(n.tailMode){case"hidden":o=n.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?n.tail=null:u.sibling=null;break;case"collapsed":u=n.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:m.sibling=null}}function li(n){var o=n.alternate!==null&&n.alternate.child===n.child,u=0,m=0;if(o)for(var _=n.child;_!==null;)u|=_.lanes|_.childLanes,m|=_.subtreeFlags&14680064,m|=_.flags&14680064,_.return=n,_=_.sibling;else for(_=n.child;_!==null;)u|=_.lanes|_.childLanes,m|=_.subtreeFlags,m|=_.flags,_.return=n,_=_.sibling;return n.subtreeFlags|=m,n.childLanes=u,o}function Kb(n,o,u){var m=o.pendingProps;switch(Im(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return li(o),null;case 1:return Fi(o.type)&&nd(),li(o),null;case 3:return m=o.stateNode,fl(),on(Bi),on(ci),Fm(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(n===null||n.child===null)&&(Ch(o)?o.flags|=4:n===null||n.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,Pr!==null&&(om(Pr),Pr=null))),Yf(n,o),li(o),null;case 5:Bm(o);var _=ra(Ju.current);if(u=o.type,n!==null&&o.stateNode!=null)M0(n,o,u,m,_),n.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!m){if(o.stateNode===null)throw Error(Ie(166));return li(o),null}if(n=ra(Qr.current),Ch(o)){m=o.stateNode,u=o.type;var w=o.memoizedProps;switch(m[Yr]=o,m[Ku]=w,n=(o.mode&1)!==0,u){case"dialog":rn("cancel",m),rn("close",m);break;case"iframe":case"object":case"embed":rn("load",m);break;case"video":case"audio":for(_=0;_<zu.length;_++)rn(zu[_],m);break;case"source":rn("error",m);break;case"img":case"image":case"link":rn("error",m),rn("load",m);break;case"details":rn("toggle",m);break;case"input":Py(m,w),rn("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!w.multiple},rn("invalid",m);break;case"textarea":Ay(m,w),rn("invalid",m)}Ef(u,w),_=null;for(var z in w)if(w.hasOwnProperty(z)){var l=w[z];z==="children"?typeof l=="string"?m.textContent!==l&&(w.suppressHydrationWarning!==!0&&kh(m.textContent,l,n),_=["children",l]):typeof l=="number"&&m.textContent!==""+l&&(w.suppressHydrationWarning!==!0&&kh(m.textContent,l,n),_=["children",""+l]):Uu.hasOwnProperty(z)&&l!=null&&z==="onScroll"&&rn("scroll",m)}switch(u){case"input":_h(m),My(m,w,!0);break;case"textarea":_h(m),Dy(m);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(m.onclick=td)}m=_,o.updateQueue=m,m!==null&&(o.flags|=4)}else{z=_.nodeType===9?_:_.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=ox(u)),n==="http://www.w3.org/1999/xhtml"?u==="script"?(n=z.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof m.is=="string"?n=z.createElement(u,{is:m.is}):(n=z.createElement(u),u==="select"&&(z=n,m.multiple?z.multiple=!0:m.size&&(z.size=m.size))):n=z.createElementNS(n,u),n[Yr]=o,n[Ku]=m,P0(n,o,!1,!1),o.stateNode=n;e:{switch(z=Tf(u,m),u){case"dialog":rn("cancel",n),rn("close",n),_=m;break;case"iframe":case"object":case"embed":rn("load",n),_=m;break;case"video":case"audio":for(_=0;_<zu.length;_++)rn(zu[_],n);_=m;break;case"source":rn("error",n),_=m;break;case"img":case"image":case"link":rn("error",n),rn("load",n),_=m;break;case"details":rn("toggle",n),_=m;break;case"input":Py(n,m),_=xf(n,m),rn("invalid",n);break;case"option":_=m;break;case"select":n._wrapperState={wasMultiple:!!m.multiple},_=dn({},m,{value:void 0}),rn("invalid",n);break;case"textarea":Ay(n,m),_=bf(n,m),rn("invalid",n);break;default:_=m}Ef(u,_),l=_;for(w in l)if(l.hasOwnProperty(w)){var U=l[w];w==="style"?lx(n,U):w==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,U!=null&&sx(n,U)):w==="children"?typeof U=="string"?(u!=="textarea"||U!=="")&&Vu(n,U):typeof U=="number"&&Vu(n,""+U):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Uu.hasOwnProperty(w)?U!=null&&w==="onScroll"&&rn("scroll",n):U!=null&&pm(n,w,U,z))}switch(u){case"input":_h(n),My(n,m,!1);break;case"textarea":_h(n),Dy(n);break;case"option":m.value!=null&&n.setAttribute("value",""+gs(m.value));break;case"select":n.multiple=!!m.multiple,w=m.value,w!=null?rl(n,!!m.multiple,w,!1):m.defaultValue!=null&&rl(n,!!m.multiple,m.defaultValue,!0);break;default:typeof _.onClick=="function"&&(n.onclick=td)}switch(u){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return li(o),null;case 6:if(n&&o.stateNode!=null)A0(n,o,n.memoizedProps,m);else{if(typeof m!="string"&&o.stateNode===null)throw Error(Ie(166));if(u=ra(Ju.current),ra(Qr.current),Ch(o)){if(m=o.stateNode,u=o.memoizedProps,m[Yr]=o,(w=m.nodeValue!==u)&&(n=Ki,n!==null))switch(n.tag){case 3:kh(m.nodeValue,u,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&kh(m.nodeValue,u,(n.mode&1)!==0)}w&&(o.flags|=4)}else m=(u.nodeType===9?u:u.ownerDocument).createTextNode(m),m[Yr]=o,o.stateNode=m}return li(o),null;case 13:if(on(cn),m=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(ln&&Hi!==null&&o.mode&1&&!(o.flags&128))Hx(),dl(),o.flags|=98560,w=!1;else if(w=Ch(o),m!==null&&m.dehydrated!==null){if(n===null){if(!w)throw Error(Ie(318));if(w=o.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(Ie(317));w[Yr]=o}else dl(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;li(o),w=!1}else Pr!==null&&(om(Pr),Pr=null),w=!0;if(!w)return o.flags&65536?o:null}return o.flags&128?(o.lanes=u,o):(m=m!==null,m!==(n!==null&&n.memoizedState!==null)&&m&&(o.child.flags|=8192,o.mode&1&&(n===null||cn.current&1?Rn===0&&(Rn=3):Hm())),o.updateQueue!==null&&(o.flags|=4),li(o),null);case 4:return fl(),Yf(n,o),n===null&&Xu(o.stateNode.containerInfo),li(o),null;case 10:return Am(o.type._context),li(o),null;case 17:return Fi(o.type)&&nd(),li(o),null;case 19:if(on(cn),w=o.memoizedState,w===null)return li(o),null;if(m=(o.flags&128)!==0,z=w.rendering,z===null)if(m)Eu(w,!1);else{if(Rn!==0||n!==null&&n.flags&128)for(n=o.child;n!==null;){if(z=ud(n),z!==null){for(o.flags|=128,Eu(w,!1),m=z.updateQueue,m!==null&&(o.updateQueue=m,o.flags|=4),o.subtreeFlags=0,m=u,u=o.child;u!==null;)w=u,n=m,w.flags&=14680066,z=w.alternate,z===null?(w.childLanes=0,w.lanes=n,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=z.childLanes,w.lanes=z.lanes,w.child=z.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=z.memoizedProps,w.memoizedState=z.memoizedState,w.updateQueue=z.updateQueue,w.type=z.type,n=z.dependencies,w.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),u=u.sibling;return nn(cn,cn.current&1|2),o.child}n=n.sibling}w.tail!==null&&bn()>gl&&(o.flags|=128,m=!0,Eu(w,!1),o.lanes=4194304)}else{if(!m)if(n=ud(z),n!==null){if(o.flags|=128,m=!0,u=n.updateQueue,u!==null&&(o.updateQueue=u,o.flags|=4),Eu(w,!0),w.tail===null&&w.tailMode==="hidden"&&!z.alternate&&!ln)return li(o),null}else 2*bn()-w.renderingStartTime>gl&&u!==1073741824&&(o.flags|=128,m=!0,Eu(w,!1),o.lanes=4194304);w.isBackwards?(z.sibling=o.child,o.child=z):(u=w.last,u!==null?u.sibling=z:o.child=z,w.last=z)}return w.tail!==null?(o=w.tail,w.rendering=o,w.tail=o.sibling,w.renderingStartTime=bn(),o.sibling=null,u=cn.current,nn(cn,m?u&1|2:u&1),o):(li(o),null);case 22:case 23:return Xm(),m=o.memoizedState!==null,n!==null&&n.memoizedState!==null!==m&&(o.flags|=8192),m&&o.mode&1?Xi&1073741824&&(li(o),o.subtreeFlags&6&&(o.flags|=8192)):li(o),null;case 24:return null;case 25:return null}throw Error(Ie(156,o.tag))}function Yb(n,o){switch(Im(o),o.tag){case 1:return Fi(o.type)&&nd(),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return fl(),on(Bi),on(ci),Fm(),n=o.flags,n&65536&&!(n&128)?(o.flags=n&-65537|128,o):null;case 5:return Bm(o),null;case 13:if(on(cn),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(Ie(340));dl()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return on(cn),null;case 4:return fl(),null;case 10:return Am(o.type._context),null;case 22:case 23:return Xm(),null;case 24:return null;default:return null}}var Ph=!1,ui=!1,Jb=typeof WeakSet=="function"?WeakSet:Set,tt=null;function nl(n,o){var u=n.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(m){yn(n,o,m)}else u.current=null}function Jf(n,o,u){try{u()}catch(m){yn(n,o,m)}}var b_=!1;function Qb(n,o){if(Rf=Jh,n=Bx(),km(n)){if("selectionStart"in n)var u={start:n.selectionStart,end:n.selectionEnd};else e:{u=(u=n.ownerDocument)&&u.defaultView||window;var m=u.getSelection&&u.getSelection();if(m&&m.rangeCount!==0){u=m.anchorNode;var _=m.anchorOffset,w=m.focusNode;m=m.focusOffset;try{u.nodeType,w.nodeType}catch{u=null;break e}var z=0,l=-1,U=-1,X=0,pe=0,le=n,W=null;t:for(;;){for(var Fe;le!==u||_!==0&&le.nodeType!==3||(l=z+_),le!==w||m!==0&&le.nodeType!==3||(U=z+m),le.nodeType===3&&(z+=le.nodeValue.length),(Fe=le.firstChild)!==null;)W=le,le=Fe;for(;;){if(le===n)break t;if(W===u&&++X===_&&(l=z),W===w&&++pe===m&&(U=z),(Fe=le.nextSibling)!==null)break;le=W,W=le.parentNode}le=Fe}u=l===-1||U===-1?null:{start:l,end:U}}else u=null}u=u||{start:0,end:0}}else u=null;for(Bf={focusedElem:n,selectionRange:u},Jh=!1,tt=o;tt!==null;)if(o=tt,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,tt=n;else for(;tt!==null;){o=tt;try{var Le=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Le!==null){var Ce=Le.memoizedProps,Ot=Le.memoizedState,ae=o.stateNode,ee=ae.getSnapshotBeforeUpdate(o.elementType===o.type?Ce:Ir(o.type,Ce),Ot);ae.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var se=o.stateNode.containerInfo;se.nodeType===1?se.textContent="":se.nodeType===9&&se.documentElement&&se.removeChild(se.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ie(163))}}catch(ke){yn(o,o.return,ke)}if(n=o.sibling,n!==null){n.return=o.return,tt=n;break}tt=o.return}return Le=b_,b_=!1,Le}function Bu(n,o,u){var m=o.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var _=m=m.next;do{if((_.tag&n)===n){var w=_.destroy;_.destroy=void 0,w!==void 0&&Jf(o,u,w)}_=_.next}while(_!==m)}}function kd(n,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var u=o=o.next;do{if((u.tag&n)===n){var m=u.create;u.destroy=m()}u=u.next}while(u!==o)}}function Qf(n){var o=n.ref;if(o!==null){var u=n.stateNode;switch(n.tag){case 5:n=u;break;default:n=u}typeof o=="function"?o(n):o.current=n}}function D0(n){var o=n.alternate;o!==null&&(n.alternate=null,D0(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&(delete o[Yr],delete o[Ku],delete o[Nf],delete o[Rb],delete o[Bb])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function L0(n){return n.tag===5||n.tag===3||n.tag===4}function S_(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||L0(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function em(n,o,u){var m=n.tag;if(m===5||m===6)n=n.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(n,o):u.insertBefore(n,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(n,u)):(o=u,o.appendChild(n)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=td));else if(m!==4&&(n=n.child,n!==null))for(em(n,o,u),n=n.sibling;n!==null;)em(n,o,u),n=n.sibling}function tm(n,o,u){var m=n.tag;if(m===5||m===6)n=n.stateNode,o?u.insertBefore(n,o):u.appendChild(n);else if(m!==4&&(n=n.child,n!==null))for(tm(n,o,u),n=n.sibling;n!==null;)tm(n,o,u),n=n.sibling}var Kn=null,zr=!1;function es(n,o,u){for(u=u.child;u!==null;)R0(n,o,u),u=u.sibling}function R0(n,o,u){if(Jr&&typeof Jr.onCommitFiberUnmount=="function")try{Jr.onCommitFiberUnmount(_d,u)}catch{}switch(u.tag){case 5:ui||nl(u,o);case 6:var m=Kn,_=zr;Kn=null,es(n,o,u),Kn=m,zr=_,Kn!==null&&(zr?(n=Kn,u=u.stateNode,n.nodeType===8?n.parentNode.removeChild(u):n.removeChild(u)):Kn.removeChild(u.stateNode));break;case 18:Kn!==null&&(zr?(n=Kn,u=u.stateNode,n.nodeType===8?ef(n.parentNode,u):n.nodeType===1&&ef(n,u),Zu(n)):ef(Kn,u.stateNode));break;case 4:m=Kn,_=zr,Kn=u.stateNode.containerInfo,zr=!0,es(n,o,u),Kn=m,zr=_;break;case 0:case 11:case 14:case 15:if(!ui&&(m=u.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){_=m=m.next;do{var w=_,z=w.destroy;w=w.tag,z!==void 0&&(w&2||w&4)&&Jf(u,o,z),_=_.next}while(_!==m)}es(n,o,u);break;case 1:if(!ui&&(nl(u,o),m=u.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=u.memoizedProps,m.state=u.memoizedState,m.componentWillUnmount()}catch(l){yn(u,o,l)}es(n,o,u);break;case 21:es(n,o,u);break;case 22:u.mode&1?(ui=(m=ui)||u.memoizedState!==null,es(n,o,u),ui=m):es(n,o,u);break;default:es(n,o,u)}}function E_(n){var o=n.updateQueue;if(o!==null){n.updateQueue=null;var u=n.stateNode;u===null&&(u=n.stateNode=new Jb),o.forEach(function(m){var _=l2.bind(null,n,m);u.has(m)||(u.add(m),m.then(_,_))})}}function Cr(n,o){var u=o.deletions;if(u!==null)for(var m=0;m<u.length;m++){var _=u[m];try{var w=n,z=o,l=z;e:for(;l!==null;){switch(l.tag){case 5:Kn=l.stateNode,zr=!1;break e;case 3:Kn=l.stateNode.containerInfo,zr=!0;break e;case 4:Kn=l.stateNode.containerInfo,zr=!0;break e}l=l.return}if(Kn===null)throw Error(Ie(160));R0(w,z,_),Kn=null,zr=!1;var U=_.alternate;U!==null&&(U.return=null),_.return=null}catch(X){yn(_,o,X)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)B0(o,n),o=o.sibling}function B0(n,o){var u=n.alternate,m=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Cr(o,n),Hr(n),m&4){try{Bu(3,n,n.return),kd(3,n)}catch(Ce){yn(n,n.return,Ce)}try{Bu(5,n,n.return)}catch(Ce){yn(n,n.return,Ce)}}break;case 1:Cr(o,n),Hr(n),m&512&&u!==null&&nl(u,u.return);break;case 5:if(Cr(o,n),Hr(n),m&512&&u!==null&&nl(u,u.return),n.flags&32){var _=n.stateNode;try{Vu(_,"")}catch(Ce){yn(n,n.return,Ce)}}if(m&4&&(_=n.stateNode,_!=null)){var w=n.memoizedProps,z=u!==null?u.memoizedProps:w,l=n.type,U=n.updateQueue;if(n.updateQueue=null,U!==null)try{l==="input"&&w.type==="radio"&&w.name!=null&&ix(_,w),Tf(l,z);var X=Tf(l,w);for(z=0;z<U.length;z+=2){var pe=U[z],le=U[z+1];pe==="style"?lx(_,le):pe==="dangerouslySetInnerHTML"?sx(_,le):pe==="children"?Vu(_,le):pm(_,pe,le,X)}switch(l){case"input":vf(_,w);break;case"textarea":rx(_,w);break;case"select":var W=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!w.multiple;var Fe=w.value;Fe!=null?rl(_,!!w.multiple,Fe,!1):W!==!!w.multiple&&(w.defaultValue!=null?rl(_,!!w.multiple,w.defaultValue,!0):rl(_,!!w.multiple,w.multiple?[]:"",!1))}_[Ku]=w}catch(Ce){yn(n,n.return,Ce)}}break;case 6:if(Cr(o,n),Hr(n),m&4){if(n.stateNode===null)throw Error(Ie(162));_=n.stateNode,w=n.memoizedProps;try{_.nodeValue=w}catch(Ce){yn(n,n.return,Ce)}}break;case 3:if(Cr(o,n),Hr(n),m&4&&u!==null&&u.memoizedState.isDehydrated)try{Zu(o.containerInfo)}catch(Ce){yn(n,n.return,Ce)}break;case 4:Cr(o,n),Hr(n);break;case 13:Cr(o,n),Hr(n),_=n.child,_.flags&8192&&(w=_.memoizedState!==null,_.stateNode.isHidden=w,!w||_.alternate!==null&&_.alternate.memoizedState!==null||(qm=bn())),m&4&&E_(n);break;case 22:if(pe=u!==null&&u.memoizedState!==null,n.mode&1?(ui=(X=ui)||pe,Cr(o,n),ui=X):Cr(o,n),Hr(n),m&8192){if(X=n.memoizedState!==null,(n.stateNode.isHidden=X)&&!pe&&n.mode&1)for(tt=n,pe=n.child;pe!==null;){for(le=tt=pe;tt!==null;){switch(W=tt,Fe=W.child,W.tag){case 0:case 11:case 14:case 15:Bu(4,W,W.return);break;case 1:nl(W,W.return);var Le=W.stateNode;if(typeof Le.componentWillUnmount=="function"){m=W,u=W.return;try{o=m,Le.props=o.memoizedProps,Le.state=o.memoizedState,Le.componentWillUnmount()}catch(Ce){yn(m,u,Ce)}}break;case 5:nl(W,W.return);break;case 22:if(W.memoizedState!==null){k_(le);continue}}Fe!==null?(Fe.return=W,tt=Fe):k_(le)}pe=pe.sibling}e:for(pe=null,le=n;;){if(le.tag===5){if(pe===null){pe=le;try{_=le.stateNode,X?(w=_.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(l=le.stateNode,U=le.memoizedProps.style,z=U!=null&&U.hasOwnProperty("display")?U.display:null,l.style.display=ax("display",z))}catch(Ce){yn(n,n.return,Ce)}}}else if(le.tag===6){if(pe===null)try{le.stateNode.nodeValue=X?"":le.memoizedProps}catch(Ce){yn(n,n.return,Ce)}}else if((le.tag!==22&&le.tag!==23||le.memoizedState===null||le===n)&&le.child!==null){le.child.return=le,le=le.child;continue}if(le===n)break e;for(;le.sibling===null;){if(le.return===null||le.return===n)break e;pe===le&&(pe=null),le=le.return}pe===le&&(pe=null),le.sibling.return=le.return,le=le.sibling}}break;case 19:Cr(o,n),Hr(n),m&4&&E_(n);break;case 21:break;default:Cr(o,n),Hr(n)}}function Hr(n){var o=n.flags;if(o&2){try{e:{for(var u=n.return;u!==null;){if(L0(u)){var m=u;break e}u=u.return}throw Error(Ie(160))}switch(m.tag){case 5:var _=m.stateNode;m.flags&32&&(Vu(_,""),m.flags&=-33);var w=S_(n);tm(n,w,_);break;case 3:case 4:var z=m.stateNode.containerInfo,l=S_(n);em(n,l,z);break;default:throw Error(Ie(161))}}catch(U){yn(n,n.return,U)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function e2(n,o,u){tt=n,F0(n)}function F0(n,o,u){for(var m=(n.mode&1)!==0;tt!==null;){var _=tt,w=_.child;if(_.tag===22&&m){var z=_.memoizedState!==null||Ph;if(!z){var l=_.alternate,U=l!==null&&l.memoizedState!==null||ui;l=Ph;var X=ui;if(Ph=z,(ui=U)&&!X)for(tt=_;tt!==null;)z=tt,U=z.child,z.tag===22&&z.memoizedState!==null?C_(_):U!==null?(U.return=z,tt=U):C_(_);for(;w!==null;)tt=w,F0(w),w=w.sibling;tt=_,Ph=l,ui=X}T_(n)}else _.subtreeFlags&8772&&w!==null?(w.return=_,tt=w):T_(n)}}function T_(n){for(;tt!==null;){var o=tt;if(o.flags&8772){var u=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:ui||kd(5,o);break;case 1:var m=o.stateNode;if(o.flags&4&&!ui)if(u===null)m.componentDidMount();else{var _=o.elementType===o.type?u.memoizedProps:Ir(o.type,u.memoizedProps);m.componentDidUpdate(_,u.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var w=o.updateQueue;w!==null&&l_(o,w,m);break;case 3:var z=o.updateQueue;if(z!==null){if(u=null,o.child!==null)switch(o.child.tag){case 5:u=o.child.stateNode;break;case 1:u=o.child.stateNode}l_(o,z,u)}break;case 5:var l=o.stateNode;if(u===null&&o.flags&4){u=l;var U=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":U.autoFocus&&u.focus();break;case"img":U.src&&(u.src=U.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var X=o.alternate;if(X!==null){var pe=X.memoizedState;if(pe!==null){var le=pe.dehydrated;le!==null&&Zu(le)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ie(163))}ui||o.flags&512&&Qf(o)}catch(W){yn(o,o.return,W)}}if(o===n){tt=null;break}if(u=o.sibling,u!==null){u.return=o.return,tt=u;break}tt=o.return}}function k_(n){for(;tt!==null;){var o=tt;if(o===n){tt=null;break}var u=o.sibling;if(u!==null){u.return=o.return,tt=u;break}tt=o.return}}function C_(n){for(;tt!==null;){var o=tt;try{switch(o.tag){case 0:case 11:case 15:var u=o.return;try{kd(4,o)}catch(U){yn(o,u,U)}break;case 1:var m=o.stateNode;if(typeof m.componentDidMount=="function"){var _=o.return;try{m.componentDidMount()}catch(U){yn(o,_,U)}}var w=o.return;try{Qf(o)}catch(U){yn(o,w,U)}break;case 5:var z=o.return;try{Qf(o)}catch(U){yn(o,z,U)}}}catch(U){yn(o,o.return,U)}if(o===n){tt=null;break}var l=o.sibling;if(l!==null){l.return=o.return,tt=l;break}tt=o.return}}var t2=Math.ceil,dd=Io.ReactCurrentDispatcher,Gm=Io.ReactCurrentOwner,dr=Io.ReactCurrentBatchConfig,Rt=0,Gn=null,Pn=null,Yn=0,Xi=0,il=xs(0),Rn=0,nc=null,ca=0,Cd=0,Zm=0,Fu=null,Li=null,qm=0,gl=1/0,xo=null,pd=!1,nm=null,ps=null,Mh=!1,as=null,fd=0,Ou=0,im=null,$h=-1,jh=0;function Ti(){return Rt&6?bn():$h!==-1?$h:$h=bn()}function fs(n){return n.mode&1?Rt&2&&Yn!==0?Yn&-Yn:Ob.transition!==null?(jh===0&&(jh=vx()),jh):(n=Gt,n!==0||(n=window.event,n=n===void 0?16:Cx(n.type)),n):1}function Ar(n,o,u,m){if(50<Ou)throw Ou=0,im=null,Error(Ie(185));rc(n,u,m),(!(Rt&2)||n!==Gn)&&(n===Gn&&(!(Rt&2)&&(Cd|=u),Rn===4&&rs(n,Yn)),Oi(n,m),u===1&&Rt===0&&!(o.mode&1)&&(gl=bn()+500,Sd&&vs()))}function Oi(n,o){var u=n.callbackNode;Ow(n,o);var m=Yh(n,n===Gn?Yn:0);if(m===0)u!==null&&By(u),n.callbackNode=null,n.callbackPriority=0;else if(o=m&-m,n.callbackPriority!==o){if(u!=null&&By(u),o===1)n.tag===0?Fb(I_.bind(null,n)):qx(I_.bind(null,n)),Db(function(){!(Rt&6)&&vs()}),u=null;else{switch(wx(m)){case 1:u=_m;break;case 4:u=_x;break;case 16:u=Kh;break;case 536870912:u=xx;break;default:u=Kh}u=Z0(u,O0.bind(null,n))}n.callbackPriority=o,n.callbackNode=u}}function O0(n,o){if($h=-1,jh=0,Rt&6)throw Error(Ie(327));var u=n.callbackNode;if(ul()&&n.callbackNode!==u)return null;var m=Yh(n,n===Gn?Yn:0);if(m===0)return null;if(m&30||m&n.expiredLanes||o)o=md(n,m);else{o=m;var _=Rt;Rt|=2;var w=U0();(Gn!==n||Yn!==o)&&(xo=null,gl=bn()+500,oa(n,o));do try{r2();break}catch(l){N0(n,l)}while(1);Mm(),dd.current=w,Rt=_,Pn!==null?o=0:(Gn=null,Yn=0,o=Rn)}if(o!==0){if(o===2&&(_=Pf(n),_!==0&&(m=_,o=rm(n,_))),o===1)throw u=nc,oa(n,0),rs(n,m),Oi(n,bn()),u;if(o===6)rs(n,m);else{if(_=n.current.alternate,!(m&30)&&!n2(_)&&(o=md(n,m),o===2&&(w=Pf(n),w!==0&&(m=w,o=rm(n,w))),o===1))throw u=nc,oa(n,0),rs(n,m),Oi(n,bn()),u;switch(n.finishedWork=_,n.finishedLanes=m,o){case 0:case 1:throw Error(Ie(345));case 2:ta(n,Li,xo);break;case 3:if(rs(n,m),(m&130023424)===m&&(o=qm+500-bn(),10<o)){if(Yh(n,0)!==0)break;if(_=n.suspendedLanes,(_&m)!==m){Ti(),n.pingedLanes|=n.suspendedLanes&_;break}n.timeoutHandle=Of(ta.bind(null,n,Li,xo),o);break}ta(n,Li,xo);break;case 4:if(rs(n,m),(m&4194240)===m)break;for(o=n.eventTimes,_=-1;0<m;){var z=31-Mr(m);w=1<<z,z=o[z],z>_&&(_=z),m&=~w}if(m=_,m=bn()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*t2(m/1960))-m,10<m){n.timeoutHandle=Of(ta.bind(null,n,Li,xo),m);break}ta(n,Li,xo);break;case 5:ta(n,Li,xo);break;default:throw Error(Ie(329))}}}return Oi(n,bn()),n.callbackNode===u?O0.bind(null,n):null}function rm(n,o){var u=Fu;return n.current.memoizedState.isDehydrated&&(oa(n,o).flags|=256),n=md(n,o),n!==2&&(o=Li,Li=u,o!==null&&om(o)),n}function om(n){Li===null?Li=n:Li.push.apply(Li,n)}function n2(n){for(var o=n;;){if(o.flags&16384){var u=o.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var m=0;m<u.length;m++){var _=u[m],w=_.getSnapshot;_=_.value;try{if(!Dr(w(),_))return!1}catch{return!1}}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function rs(n,o){for(o&=~Zm,o&=~Cd,n.suspendedLanes|=o,n.pingedLanes&=~o,n=n.expirationTimes;0<o;){var u=31-Mr(o),m=1<<u;n[u]=-1,o&=~m}}function I_(n){if(Rt&6)throw Error(Ie(327));ul();var o=Yh(n,0);if(!(o&1))return Oi(n,bn()),null;var u=md(n,o);if(n.tag!==0&&u===2){var m=Pf(n);m!==0&&(o=m,u=rm(n,m))}if(u===1)throw u=nc,oa(n,0),rs(n,o),Oi(n,bn()),u;if(u===6)throw Error(Ie(345));return n.finishedWork=n.current.alternate,n.finishedLanes=o,ta(n,Li,xo),Oi(n,bn()),null}function Wm(n,o){var u=Rt;Rt|=1;try{return n(o)}finally{Rt=u,Rt===0&&(gl=bn()+500,Sd&&vs())}}function ha(n){as!==null&&as.tag===0&&!(Rt&6)&&ul();var o=Rt;Rt|=1;var u=dr.transition,m=Gt;try{if(dr.transition=null,Gt=1,n)return n()}finally{Gt=m,dr.transition=u,Rt=o,!(Rt&6)&&vs()}}function Xm(){Xi=il.current,on(il)}function oa(n,o){n.finishedWork=null,n.finishedLanes=0;var u=n.timeoutHandle;if(u!==-1&&(n.timeoutHandle=-1,Ab(u)),Pn!==null)for(u=Pn.return;u!==null;){var m=u;switch(Im(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&nd();break;case 3:fl(),on(Bi),on(ci),Fm();break;case 5:Bm(m);break;case 4:fl();break;case 13:on(cn);break;case 19:on(cn);break;case 10:Am(m.type._context);break;case 22:case 23:Xm()}u=u.return}if(Gn=n,Pn=n=ms(n.current,null),Yn=Xi=o,Rn=0,nc=null,Zm=Cd=ca=0,Li=Fu=null,ia!==null){for(o=0;o<ia.length;o++)if(u=ia[o],m=u.interleaved,m!==null){u.interleaved=null;var _=m.next,w=u.pending;if(w!==null){var z=w.next;w.next=_,m.next=z}u.pending=m}ia=null}return n}function N0(n,o){do{var u=Pn;try{if(Mm(),Nh.current=hd,cd){for(var m=hn.memoizedState;m!==null;){var _=m.queue;_!==null&&(_.pending=null),m=m.next}cd=!1}if(ua=0,$n=Ln=hn=null,Ru=!1,Qu=0,Gm.current=null,u===null||u.return===null){Rn=1,nc=o,Pn=null;break}e:{var w=n,z=u.return,l=u,U=o;if(o=Yn,l.flags|=32768,U!==null&&typeof U=="object"&&typeof U.then=="function"){var X=U,pe=l,le=pe.tag;if(!(pe.mode&1)&&(le===0||le===11||le===15)){var W=pe.alternate;W?(pe.updateQueue=W.updateQueue,pe.memoizedState=W.memoizedState,pe.lanes=W.lanes):(pe.updateQueue=null,pe.memoizedState=null)}var Fe=m_(z);if(Fe!==null){Fe.flags&=-257,g_(Fe,z,l,w,o),Fe.mode&1&&f_(w,X,o),o=Fe,U=X;var Le=o.updateQueue;if(Le===null){var Ce=new Set;Ce.add(U),o.updateQueue=Ce}else Le.add(U);break e}else{if(!(o&1)){f_(w,X,o),Hm();break e}U=Error(Ie(426))}}else if(ln&&l.mode&1){var Ot=m_(z);if(Ot!==null){!(Ot.flags&65536)&&(Ot.flags|=256),g_(Ot,z,l,w,o),zm(ml(U,l));break e}}w=U=ml(U,l),Rn!==4&&(Rn=2),Fu===null?Fu=[w]:Fu.push(w),w=z;do{switch(w.tag){case 3:w.flags|=65536,o&=-o,w.lanes|=o;var ae=b0(w,U,o);a_(w,ae);break e;case 1:l=U;var ee=w.type,se=w.stateNode;if(!(w.flags&128)&&(typeof ee.getDerivedStateFromError=="function"||se!==null&&typeof se.componentDidCatch=="function"&&(ps===null||!ps.has(se)))){w.flags|=65536,o&=-o,w.lanes|=o;var ke=S0(w,l,o);a_(w,ke);break e}}w=w.return}while(w!==null)}$0(u)}catch(De){o=De,Pn===u&&u!==null&&(Pn=u=u.return);continue}break}while(1)}function U0(){var n=dd.current;return dd.current=hd,n===null?hd:n}function Hm(){(Rn===0||Rn===3||Rn===2)&&(Rn=4),Gn===null||!(ca&268435455)&&!(Cd&268435455)||rs(Gn,Yn)}function md(n,o){var u=Rt;Rt|=2;var m=U0();(Gn!==n||Yn!==o)&&(xo=null,oa(n,o));do try{i2();break}catch(_){N0(n,_)}while(1);if(Mm(),Rt=u,dd.current=m,Pn!==null)throw Error(Ie(261));return Gn=null,Yn=0,Rn}function i2(){for(;Pn!==null;)V0(Pn)}function r2(){for(;Pn!==null&&!zw();)V0(Pn)}function V0(n){var o=G0(n.alternate,n,Xi);n.memoizedProps=n.pendingProps,o===null?$0(n):Pn=o,Gm.current=null}function $0(n){var o=n;do{var u=o.alternate;if(n=o.return,o.flags&32768){if(u=Yb(u,o),u!==null){u.flags&=32767,Pn=u;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Rn=6,Pn=null;return}}else if(u=Kb(u,o,Xi),u!==null){Pn=u;return}if(o=o.sibling,o!==null){Pn=o;return}Pn=o=n}while(o!==null);Rn===0&&(Rn=5)}function ta(n,o,u){var m=Gt,_=dr.transition;try{dr.transition=null,Gt=1,o2(n,o,u,m)}finally{dr.transition=_,Gt=m}return null}function o2(n,o,u,m){do ul();while(as!==null);if(Rt&6)throw Error(Ie(327));u=n.finishedWork;var _=n.finishedLanes;if(u===null)return null;if(n.finishedWork=null,n.finishedLanes=0,u===n.current)throw Error(Ie(177));n.callbackNode=null,n.callbackPriority=0;var w=u.lanes|u.childLanes;if(Nw(n,w),n===Gn&&(Pn=Gn=null,Yn=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||Mh||(Mh=!0,Z0(Kh,function(){return ul(),null})),w=(u.flags&15990)!==0,u.subtreeFlags&15990||w){w=dr.transition,dr.transition=null;var z=Gt;Gt=1;var l=Rt;Rt|=4,Gm.current=null,Qb(n,u),B0(u,n),Tb(Bf),Jh=!!Rf,Bf=Rf=null,n.current=u,e2(u),Pw(),Rt=l,Gt=z,dr.transition=w}else n.current=u;if(Mh&&(Mh=!1,as=n,fd=_),w=n.pendingLanes,w===0&&(ps=null),Dw(u.stateNode),Oi(n,bn()),o!==null)for(m=n.onRecoverableError,u=0;u<o.length;u++)_=o[u],m(_.value,{componentStack:_.stack,digest:_.digest});if(pd)throw pd=!1,n=nm,nm=null,n;return fd&1&&n.tag!==0&&ul(),w=n.pendingLanes,w&1?n===im?Ou++:(Ou=0,im=n):Ou=0,vs(),null}function ul(){if(as!==null){var n=wx(fd),o=dr.transition,u=Gt;try{if(dr.transition=null,Gt=16>n?16:n,as===null)var m=!1;else{if(n=as,as=null,fd=0,Rt&6)throw Error(Ie(331));var _=Rt;for(Rt|=4,tt=n.current;tt!==null;){var w=tt,z=w.child;if(tt.flags&16){var l=w.deletions;if(l!==null){for(var U=0;U<l.length;U++){var X=l[U];for(tt=X;tt!==null;){var pe=tt;switch(pe.tag){case 0:case 11:case 15:Bu(8,pe,w)}var le=pe.child;if(le!==null)le.return=pe,tt=le;else for(;tt!==null;){pe=tt;var W=pe.sibling,Fe=pe.return;if(D0(pe),pe===X){tt=null;break}if(W!==null){W.return=Fe,tt=W;break}tt=Fe}}}var Le=w.alternate;if(Le!==null){var Ce=Le.child;if(Ce!==null){Le.child=null;do{var Ot=Ce.sibling;Ce.sibling=null,Ce=Ot}while(Ce!==null)}}tt=w}}if(w.subtreeFlags&2064&&z!==null)z.return=w,tt=z;else e:for(;tt!==null;){if(w=tt,w.flags&2048)switch(w.tag){case 0:case 11:case 15:Bu(9,w,w.return)}var ae=w.sibling;if(ae!==null){ae.return=w.return,tt=ae;break e}tt=w.return}}var ee=n.current;for(tt=ee;tt!==null;){z=tt;var se=z.child;if(z.subtreeFlags&2064&&se!==null)se.return=z,tt=se;else e:for(z=ee;tt!==null;){if(l=tt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:kd(9,l)}}catch(De){yn(l,l.return,De)}if(l===z){tt=null;break e}var ke=l.sibling;if(ke!==null){ke.return=l.return,tt=ke;break e}tt=l.return}}if(Rt=_,vs(),Jr&&typeof Jr.onPostCommitFiberRoot=="function")try{Jr.onPostCommitFiberRoot(_d,n)}catch{}m=!0}return m}finally{Gt=u,dr.transition=o}}return!1}function z_(n,o,u){o=ml(u,o),o=b0(n,o,1),n=ds(n,o,1),o=Ti(),n!==null&&(rc(n,1,o),Oi(n,o))}function yn(n,o,u){if(n.tag===3)z_(n,n,u);else for(;o!==null;){if(o.tag===3){z_(o,n,u);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(ps===null||!ps.has(m))){n=ml(u,n),n=S0(o,n,1),o=ds(o,n,1),n=Ti(),o!==null&&(rc(o,1,n),Oi(o,n));break}}o=o.return}}function s2(n,o,u){var m=n.pingCache;m!==null&&m.delete(o),o=Ti(),n.pingedLanes|=n.suspendedLanes&u,Gn===n&&(Yn&u)===u&&(Rn===4||Rn===3&&(Yn&130023424)===Yn&&500>bn()-qm?oa(n,0):Zm|=u),Oi(n,o)}function j0(n,o){o===0&&(n.mode&1?(o=wh,wh<<=1,!(wh&130023424)&&(wh=4194304)):o=1);var u=Ti();n=ko(n,o),n!==null&&(rc(n,o,u),Oi(n,u))}function a2(n){var o=n.memoizedState,u=0;o!==null&&(u=o.retryLane),j0(n,u)}function l2(n,o){var u=0;switch(n.tag){case 13:var m=n.stateNode,_=n.memoizedState;_!==null&&(u=_.retryLane);break;case 19:m=n.stateNode;break;default:throw Error(Ie(314))}m!==null&&m.delete(o),j0(n,u)}var G0;G0=function(n,o,u){if(n!==null)if(n.memoizedProps!==o.pendingProps||Bi.current)Ri=!0;else{if(!(n.lanes&u)&&!(o.flags&128))return Ri=!1,Hb(n,o,u);Ri=!!(n.flags&131072)}else Ri=!1,ln&&o.flags&1048576&&Wx(o,od,o.index);switch(o.lanes=0,o.tag){case 2:var m=o.type;Vh(n,o),n=o.pendingProps;var _=hl(o,ci.current);ll(o,u),_=Nm(null,o,m,n,_,u);var w=Um();return o.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Fi(m)?(w=!0,id(o)):w=!1,o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,Lm(o),_.updater=Ed,o.stateNode=_,_._reactInternals=o,Zf(o,m,n,u),o=Xf(null,o,m,!0,w,u)):(o.tag=0,ln&&w&&Cm(o),Ei(null,o,_,u),o=o.child),o;case 16:m=o.elementType;e:{switch(Vh(n,o),n=o.pendingProps,_=m._init,m=_(m._payload),o.type=m,_=o.tag=c2(m),n=Ir(m,n),_){case 0:o=Wf(null,o,m,n,u);break e;case 1:o=x_(null,o,m,n,u);break e;case 11:o=y_(null,o,m,n,u);break e;case 14:o=__(null,o,m,Ir(m.type,n),u);break e}throw Error(Ie(306,m,""))}return o;case 0:return m=o.type,_=o.pendingProps,_=o.elementType===m?_:Ir(m,_),Wf(n,o,m,_,u);case 1:return m=o.type,_=o.pendingProps,_=o.elementType===m?_:Ir(m,_),x_(n,o,m,_,u);case 3:e:{if(C0(o),n===null)throw Error(Ie(387));m=o.pendingProps,w=o.memoizedState,_=w.element,Yx(n,o),ld(o,m,null,u);var z=o.memoizedState;if(m=z.element,w.isDehydrated)if(w={element:m,isDehydrated:!1,cache:z.cache,pendingSuspenseBoundaries:z.pendingSuspenseBoundaries,transitions:z.transitions},o.updateQueue.baseState=w,o.memoizedState=w,o.flags&256){_=ml(Error(Ie(423)),o),o=v_(n,o,m,u,_);break e}else if(m!==_){_=ml(Error(Ie(424)),o),o=v_(n,o,m,u,_);break e}else for(Hi=hs(o.stateNode.containerInfo.firstChild),Ki=o,ln=!0,Pr=null,u=t0(o,null,m,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(dl(),m===_){o=Co(n,o,u);break e}Ei(n,o,m,u)}o=o.child}return o;case 5:return n0(o),n===null&&$f(o),m=o.type,_=o.pendingProps,w=n!==null?n.memoizedProps:null,z=_.children,Ff(m,_)?z=null:w!==null&&Ff(m,w)&&(o.flags|=32),k0(n,o),Ei(n,o,z,u),o.child;case 6:return n===null&&$f(o),null;case 13:return I0(n,o,u);case 4:return Rm(o,o.stateNode.containerInfo),m=o.pendingProps,n===null?o.child=pl(o,null,m,u):Ei(n,o,m,u),o.child;case 11:return m=o.type,_=o.pendingProps,_=o.elementType===m?_:Ir(m,_),y_(n,o,m,_,u);case 7:return Ei(n,o,o.pendingProps,u),o.child;case 8:return Ei(n,o,o.pendingProps.children,u),o.child;case 12:return Ei(n,o,o.pendingProps.children,u),o.child;case 10:e:{if(m=o.type._context,_=o.pendingProps,w=o.memoizedProps,z=_.value,nn(sd,m._currentValue),m._currentValue=z,w!==null)if(Dr(w.value,z)){if(w.children===_.children&&!Bi.current){o=Co(n,o,u);break e}}else for(w=o.child,w!==null&&(w.return=o);w!==null;){var l=w.dependencies;if(l!==null){z=w.child;for(var U=l.firstContext;U!==null;){if(U.context===m){if(w.tag===1){U=So(-1,u&-u),U.tag=2;var X=w.updateQueue;if(X!==null){X=X.shared;var pe=X.pending;pe===null?U.next=U:(U.next=pe.next,pe.next=U),X.pending=U}}w.lanes|=u,U=w.alternate,U!==null&&(U.lanes|=u),jf(w.return,u,o),l.lanes|=u;break}U=U.next}}else if(w.tag===10)z=w.type===o.type?null:w.child;else if(w.tag===18){if(z=w.return,z===null)throw Error(Ie(341));z.lanes|=u,l=z.alternate,l!==null&&(l.lanes|=u),jf(z,u,o),z=w.sibling}else z=w.child;if(z!==null)z.return=w;else for(z=w;z!==null;){if(z===o){z=null;break}if(w=z.sibling,w!==null){w.return=z.return,z=w;break}z=z.return}w=z}Ei(n,o,_.children,u),o=o.child}return o;case 9:return _=o.type,m=o.pendingProps.children,ll(o,u),_=pr(_),m=m(_),o.flags|=1,Ei(n,o,m,u),o.child;case 14:return m=o.type,_=Ir(m,o.pendingProps),_=Ir(m.type,_),__(n,o,m,_,u);case 15:return E0(n,o,o.type,o.pendingProps,u);case 17:return m=o.type,_=o.pendingProps,_=o.elementType===m?_:Ir(m,_),Vh(n,o),o.tag=1,Fi(m)?(n=!0,id(o)):n=!1,ll(o,u),Qx(o,m,_),Zf(o,m,_,u),Xf(null,o,m,!0,n,u);case 19:return z0(n,o,u);case 22:return T0(n,o,u)}throw Error(Ie(156,o.tag))};function Z0(n,o){return yx(n,o)}function u2(n,o,u,m){this.tag=n,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hr(n,o,u,m){return new u2(n,o,u,m)}function Km(n){return n=n.prototype,!(!n||!n.isReactComponent)}function c2(n){if(typeof n=="function")return Km(n)?1:0;if(n!=null){if(n=n.$$typeof,n===mm)return 11;if(n===gm)return 14}return 2}function ms(n,o){var u=n.alternate;return u===null?(u=hr(n.tag,o,n.key,n.mode),u.elementType=n.elementType,u.type=n.type,u.stateNode=n.stateNode,u.alternate=n,n.alternate=u):(u.pendingProps=o,u.type=n.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=n.flags&14680064,u.childLanes=n.childLanes,u.lanes=n.lanes,u.child=n.child,u.memoizedProps=n.memoizedProps,u.memoizedState=n.memoizedState,u.updateQueue=n.updateQueue,o=n.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=n.sibling,u.index=n.index,u.ref=n.ref,u}function Gh(n,o,u,m,_,w){var z=2;if(m=n,typeof n=="function")Km(n)&&(z=1);else if(typeof n=="string")z=5;else e:switch(n){case Wa:return sa(u.children,_,w,o);case fm:z=8,_|=8;break;case mf:return n=hr(12,u,o,_|2),n.elementType=mf,n.lanes=w,n;case gf:return n=hr(13,u,o,_),n.elementType=gf,n.lanes=w,n;case yf:return n=hr(19,u,o,_),n.elementType=yf,n.lanes=w,n;case ex:return Id(u,_,w,o);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case J_:z=10;break e;case Q_:z=9;break e;case mm:z=11;break e;case gm:z=14;break e;case ts:z=16,m=null;break e}throw Error(Ie(130,n==null?n:typeof n,""))}return o=hr(z,u,o,_),o.elementType=n,o.type=m,o.lanes=w,o}function sa(n,o,u,m){return n=hr(7,n,m,o),n.lanes=u,n}function Id(n,o,u,m){return n=hr(22,n,m,o),n.elementType=ex,n.lanes=u,n.stateNode={isHidden:!1},n}function uf(n,o,u){return n=hr(6,n,null,o),n.lanes=u,n}function cf(n,o,u){return o=hr(4,n.children!==null?n.children:[],n.key,o),o.lanes=u,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function h2(n,o,u,m,_){this.tag=o,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jp(0),this.expirationTimes=jp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jp(0),this.identifierPrefix=m,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function Ym(n,o,u,m,_,w,z,l,U){return n=new h2(n,o,u,l,U),o===1?(o=1,w===!0&&(o|=8)):o=0,w=hr(3,null,null,o),n.current=w,w.stateNode=n,w.memoizedState={element:m,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},Lm(w),n}function d2(n,o,u){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:qa,key:m==null?null:""+m,children:n,containerInfo:o,implementation:u}}function q0(n){if(!n)return ys;n=n._reactInternals;e:{if(pa(n)!==n||n.tag!==1)throw Error(Ie(170));var o=n;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Fi(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Ie(171))}if(n.tag===1){var u=n.type;if(Fi(u))return Zx(n,u,o)}return o}function W0(n,o,u,m,_,w,z,l,U){return n=Ym(u,m,!0,n,_,w,z,l,U),n.context=q0(null),u=n.current,m=Ti(),_=fs(u),w=So(m,_),w.callback=o??null,ds(u,w,_),n.current.lanes=_,rc(n,_,m),Oi(n,m),n}function zd(n,o,u,m){var _=o.current,w=Ti(),z=fs(_);return u=q0(u),o.context===null?o.context=u:o.pendingContext=u,o=So(w,z),o.payload={element:n},m=m===void 0?null:m,m!==null&&(o.callback=m),n=ds(_,o,z),n!==null&&(Ar(n,_,z,w),Oh(n,_,z)),z}function gd(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function P_(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var u=n.retryLane;n.retryLane=u!==0&&u<o?u:o}}function Jm(n,o){P_(n,o),(n=n.alternate)&&P_(n,o)}function p2(){return null}var X0=typeof reportError=="function"?reportError:function(n){console.error(n)};function Qm(n){this._internalRoot=n}Pd.prototype.render=Qm.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(Ie(409));zd(n,o,null,null)};Pd.prototype.unmount=Qm.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;ha(function(){zd(null,n,null,null)}),o[To]=null}};function Pd(n){this._internalRoot=n}Pd.prototype.unstable_scheduleHydration=function(n){if(n){var o=Ex();n={blockedOn:null,target:n,priority:o};for(var u=0;u<is.length&&o!==0&&o<is[u].priority;u++);is.splice(u,0,n),u===0&&kx(n)}};function eg(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Md(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function M_(){}function f2(n,o,u,m,_){if(_){if(typeof m=="function"){var w=m;m=function(){var X=gd(z);w.call(X)}}var z=W0(o,m,n,0,null,!1,!1,"",M_);return n._reactRootContainer=z,n[To]=z.current,Xu(n.nodeType===8?n.parentNode:n),ha(),z}for(;_=n.lastChild;)n.removeChild(_);if(typeof m=="function"){var l=m;m=function(){var X=gd(U);l.call(X)}}var U=Ym(n,0,!1,null,null,!1,!1,"",M_);return n._reactRootContainer=U,n[To]=U.current,Xu(n.nodeType===8?n.parentNode:n),ha(function(){zd(o,U,u,m)}),U}function Ad(n,o,u,m,_){var w=u._reactRootContainer;if(w){var z=w;if(typeof _=="function"){var l=_;_=function(){var U=gd(z);l.call(U)}}zd(o,z,n,_)}else z=f2(u,o,n,_,m);return gd(z)}bx=function(n){switch(n.tag){case 3:var o=n.stateNode;if(o.current.memoizedState.isDehydrated){var u=Iu(o.pendingLanes);u!==0&&(xm(o,u|1),Oi(o,bn()),!(Rt&6)&&(gl=bn()+500,vs()))}break;case 13:ha(function(){var m=ko(n,1);if(m!==null){var _=Ti();Ar(m,n,1,_)}}),Jm(n,1)}};vm=function(n){if(n.tag===13){var o=ko(n,134217728);if(o!==null){var u=Ti();Ar(o,n,134217728,u)}Jm(n,134217728)}};Sx=function(n){if(n.tag===13){var o=fs(n),u=ko(n,o);if(u!==null){var m=Ti();Ar(u,n,o,m)}Jm(n,o)}};Ex=function(){return Gt};Tx=function(n,o){var u=Gt;try{return Gt=n,o()}finally{Gt=u}};Cf=function(n,o,u){switch(o){case"input":if(vf(n,u),o=u.name,u.type==="radio"&&o!=null){for(u=n;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<u.length;o++){var m=u[o];if(m!==n&&m.form===n.form){var _=bd(m);if(!_)throw Error(Ie(90));nx(m),vf(m,_)}}}break;case"textarea":rx(n,u);break;case"select":o=u.value,o!=null&&rl(n,!!u.multiple,o,!1)}};hx=Wm;dx=ha;var m2={usingClientEntryPoint:!1,Events:[sc,Ya,bd,ux,cx,Wm]},Tu={findFiberByHostInstance:na,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},g2={bundleType:Tu.bundleType,version:Tu.version,rendererPackageName:Tu.rendererPackageName,rendererConfig:Tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Io.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=mx(n),n===null?null:n.stateNode},findFiberByHostInstance:Tu.findFiberByHostInstance||p2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ah=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ah.isDisabled&&Ah.supportsFiber)try{_d=Ah.inject(g2),Jr=Ah}catch{}}Ji.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=m2;Ji.createPortal=function(n,o){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!eg(o))throw Error(Ie(200));return d2(n,o,null,u)};Ji.createRoot=function(n,o){if(!eg(n))throw Error(Ie(299));var u=!1,m="",_=X0;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(_=o.onRecoverableError)),o=Ym(n,1,!1,null,null,u,!1,m,_),n[To]=o.current,Xu(n.nodeType===8?n.parentNode:n),new Qm(o)};Ji.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(Ie(188)):(n=Object.keys(n).join(","),Error(Ie(268,n)));return n=mx(o),n=n===null?null:n.stateNode,n};Ji.flushSync=function(n){return ha(n)};Ji.hydrate=function(n,o,u){if(!Md(o))throw Error(Ie(200));return Ad(null,n,o,!0,u)};Ji.hydrateRoot=function(n,o,u){if(!eg(n))throw Error(Ie(405));var m=u!=null&&u.hydratedSources||null,_=!1,w="",z=X0;if(u!=null&&(u.unstable_strictMode===!0&&(_=!0),u.identifierPrefix!==void 0&&(w=u.identifierPrefix),u.onRecoverableError!==void 0&&(z=u.onRecoverableError)),o=W0(o,null,n,1,u??null,_,!1,w,z),n[To]=o.current,Xu(n),m)for(n=0;n<m.length;n++)u=m[n],_=u._getVersion,_=_(u._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[u,_]:o.mutableSourceEagerHydrationData.push(u,_);return new Pd(o)};Ji.render=function(n,o,u){if(!Md(o))throw Error(Ie(200));return Ad(null,n,o,!1,u)};Ji.unmountComponentAtNode=function(n){if(!Md(n))throw Error(Ie(40));return n._reactRootContainer?(ha(function(){Ad(null,null,n,!1,function(){n._reactRootContainer=null,n[To]=null})}),!0):!1};Ji.unstable_batchedUpdates=Wm;Ji.unstable_renderSubtreeIntoContainer=function(n,o,u,m){if(!Md(u))throw Error(Ie(200));if(n==null||n._reactInternals===void 0)throw Error(Ie(38));return Ad(n,o,u,!1,m)};Ji.version="18.2.0-next-9e3b772b8-20220608";(function(n){function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(u){console.error(u)}}o(),n.exports=Ji})(pw);var A_=Nu;df.createRoot=A_.createRoot,df.hydrateRoot=A_.hydrateRoot;const y2="modulepreload",_2=function(n){return"/emoji-on-maps-poc/"+n},D_={},x2=function(o,u,m){if(!u||u.length===0)return o();const _=document.getElementsByTagName("link");return Promise.all(u.map(w=>{if(w=_2(w),w in D_)return;D_[w]=!0;const z=w.endsWith(".css"),l=z?'[rel="stylesheet"]':"";if(!!m)for(let pe=_.length-1;pe>=0;pe--){const le=_[pe];if(le.href===w&&(!z||le.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${w}"]${l}`))return;const X=document.createElement("link");if(X.rel=z?"stylesheet":y2,z||(X.as="script",X.crossOrigin=""),X.href=w,document.head.appendChild(X),z)return new Promise((pe,le)=>{X.addEventListener("load",pe),X.addEventListener("error",()=>le(new Error(`Unable to preload CSS for ${w}`)))})})).then(()=>o())},v2=dt.createContext(null);function w2(n){const o=n.clone();return o.pixelsToGLUnits=n.pixelsToGLUnits,o}function L_(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function R_(n,o){const u=o.viewState||o;let m=!1;if("longitude"in u&&"latitude"in u){const _=n.center;n.center=new _.constructor(u.longitude,u.latitude),m=m||_!==n.center}if("zoom"in u){const _=n.zoom;n.zoom=u.zoom,m=m||_!==n.zoom}if("bearing"in u){const _=n.bearing;n.bearing=u.bearing,m=m||_!==n.bearing}if("pitch"in u){const _=n.pitch;n.pitch=u.pitch,m=m||_!==n.pitch}return u.padding&&!n.isPaddingEqual(u.padding)&&(m=!0,n.padding=u.padding),m}const b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function B_(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const o={};for(const m of n.layers)o[m.id]=m;const u=n.layers.map(m=>{const _=o[m.ref];let w=null;if("interactive"in m&&(w={...m},delete w.interactive),_){w=w||{...m},delete w.ref;for(const z of b2)z in _&&(w[z]=_[z])}return w||m});return{...n,layers:u}}function S2(n,o){const u=Array.isArray(n)?n[0]:n?n.x:0,m=Array.isArray(n)?n[1]:n?n.y:0,_=Array.isArray(o)?o[0]:o?o.x:0,w=Array.isArray(o)?o[1]:o?o.y:0;return u===_&&m===w}function os(n,o){if(n===o)return!0;if(!n||!o)return!1;if(Array.isArray(n)){if(!Array.isArray(o)||n.length!==o.length)return!1;for(let u=0;u<n.length;u++)if(!os(n[u],o[u]))return!1;return!0}else if(Array.isArray(o))return!1;if(typeof n=="object"&&typeof o=="object"){const u=Object.keys(n),m=Object.keys(o);if(u.length!==m.length)return!1;for(const _ of u)if(!o.hasOwnProperty(_)||!os(n[_],o[_]))return!1;return!0}return!1}const F_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},hf={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},O_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},E2=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],T2=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class yl{constructor(o,u,m){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=_=>{const w=this.props[O_[_.type]];w&&w(_)},this._onPointerEvent=_=>{(_.type==="mousemove"||_.type==="mouseout")&&this._updateHover(_);const w=this.props[F_[_.type]];if(w){if(this.props.interactiveLayerIds&&_.type!=="mouseover"&&_.type!=="mouseout"){const z=this._hoveredFeatures||this._map.queryRenderedFeatures(_.point,{layers:this.props.interactiveLayerIds});_.features=z}w(_),delete _.features}},this._onCameraEvent=_=>{if(!this._internalUpdate){const w=this.props[hf[_.type]];w&&w(_)}_.type in this._deferredEvents&&(this._deferredEvents[_.type]=!1)},this._MapClass=o,this.props=u,this._initialize(m)}get map(){return this._map}get transform(){return this._renderTransform}setProps(o){const u=this.props;this.props=o;const m=this._updateSettings(o,u);m&&this._createShadowTransform(this._map);const _=this._updateSize(o),w=this._updateViewState(o,!0);this._updateStyle(o,u),this._updateStyleComponents(o,u),this._updateHandlers(o,u),(m||_||w&&!this._map.isMoving())&&this.redraw()}static reuse(o,u){const m=yl.savedMaps.pop();if(!m)return null;const _=m.map,w=_.getContainer();for(u.className=w.className;w.childNodes.length>0;)u.appendChild(w.childNodes[0]);_._container=u,m.setProps({...o,styleDiffing:!1}),_.resize();const{initialViewState:z}=o;return z&&(z.bounds?_.fitBounds(z.bounds,{...z.fitBoundsOptions,duration:0}):m._updateViewState(z,!1)),_.isStyleLoaded()?_.fire("load"):_.once("styledata",()=>_.fire("load")),m}_initialize(o){const{props:u}=this,m={...u,...u.initialViewState,accessToken:u.mapboxAccessToken||k2()||null,container:o,style:B_(u.mapStyle)},_=m.initialViewState||m.viewState||m;if(Object.assign(m,{center:[_.longitude||0,_.latitude||0],zoom:_.zoom||0,pitch:_.pitch||0,bearing:_.bearing||0}),u.gl){const X=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=X,u.gl)}const w=new this._MapClass(m);_.padding&&w.setPadding(_.padding),u.cursor&&(w.getCanvas().style.cursor=u.cursor),this._createShadowTransform(w);const z=w._render;w._render=X=>{this._inRender=!0,z.call(w,X),this._inRender=!1};const l=w._renderTaskQueue.run;w._renderTaskQueue.run=X=>{l.call(w._renderTaskQueue,X),this._onBeforeRepaint()},w.on("render",()=>this._onAfterRepaint());const U=w.fire;w.fire=this._fireEvent.bind(this,U),w.on("resize",()=>{this._renderTransform.resize(w.transform.width,w.transform.height)}),w.on("styledata",()=>this._updateStyleComponents(this.props,{})),w.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const X in F_)w.on(X,this._onPointerEvent);for(const X in hf)w.on(X,this._onCameraEvent);for(const X in O_)w.on(X,this._onEvent);this._map=w}recycle(){const u=this.map.getContainer().querySelector("[mapboxgl-children]");u==null||u.remove(),yl.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const o=this._map;!this._inRender&&o.style&&(o._frame&&(o._frame.cancel(),o._frame=null),o._render())}_createShadowTransform(o){const u=w2(o.transform);o.painter.transform=u,this._renderTransform=u}_updateSize(o){const{viewState:u}=o;if(u){const m=this._map;if(u.width!==m.transform.width||u.height!==m.transform.height)return m.resize(),!0}return!1}_updateViewState(o,u){if(this._internalUpdate)return!1;const m=this._map,_=this._renderTransform,{zoom:w,pitch:z,bearing:l}=_,U=m.isMoving();U&&(_.cameraElevationReference="sea");const X=R_(_,{...L_(m.transform),...o});if(U&&(_.cameraElevationReference="ground"),X&&u){const pe=this._deferredEvents;pe.move=!0,pe.zoom||(pe.zoom=w!==_.zoom),pe.rotate||(pe.rotate=l!==_.bearing),pe.pitch||(pe.pitch=z!==_.pitch)}return U||R_(m.transform,o),X}_updateSettings(o,u){const m=this._map;let _=!1;for(const w of E2)w in o&&!os(o[w],u[w])&&(_=!0,m[`set${w[0].toUpperCase()}${w.slice(1)}`](o[w]));return _}_updateStyle(o,u){if(o.cursor!==u.cursor&&(this._map.getCanvas().style.cursor=o.cursor),o.mapStyle!==u.mapStyle){const m={diff:o.styleDiffing};return"localIdeographFontFamily"in o&&(m.localIdeographFontFamily=o.localIdeographFontFamily),this._map.setStyle(B_(o.mapStyle),m),!0}return!1}_updateStyleComponents(o,u){const m=this._map;let _=!1;return m.style.loaded()&&("light"in o&&!os(o.light,u.light)&&(_=!0,m.setLight(o.light)),"fog"in o&&!os(o.fog,u.fog)&&(_=!0,m.setFog(o.fog)),"terrain"in o&&!os(o.terrain,u.terrain)&&(!o.terrain||m.getSource(o.terrain.source))&&(_=!0,m.setTerrain(o.terrain))),_}_updateHandlers(o,u){const m=this._map;let _=!1;for(const w of T2){const z=o[w];os(z,u[w])||(_=!0,z?m[w].enable(z):m[w].disable())}return _}_updateHover(o){var u;const{props:m}=this;if(m.interactiveLayerIds&&(m.onMouseMove||m.onMouseEnter||m.onMouseLeave)){const w=o.type,z=((u=this._hoveredFeatures)===null||u===void 0?void 0:u.length)>0;let l;if(w==="mousemove")try{l=this._map.queryRenderedFeatures(o.point,{layers:m.interactiveLayerIds})}catch{l=[]}else l=[];const U=l.length>0;!U&&z&&(o.type="mouseleave",this._onPointerEvent(o)),this._hoveredFeatures=l,U&&!z&&(o.type="mouseenter",this._onPointerEvent(o)),o.type=w}else this._hoveredFeatures=null}_fireEvent(o,u,m){const _=this._map,w=_.transform,z=typeof u=="string"?u:u.type;return z==="move"&&this._updateViewState(this.props,!1),z in hf&&(typeof u=="object"&&(u.viewState=L_(w)),this._map.isMoving())?(_.transform=this._renderTransform,o.call(_,u,m),_.transform=w,_):(o.call(_,u,m),_)}_onBeforeRepaint(){const o=this._map;this._internalUpdate=!0;for(const m in this._deferredEvents)this._deferredEvents[m]&&o.fire(m);this._internalUpdate=!1;const u=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=u}}}yl.savedMaps=[];function k2(){let n=null;if(typeof location<"u"){const o=/access_token=([^&\/]*)/.exec(location.search);n=o&&o[1]}try{n=n||{}.MapboxAccessToken}catch{}try{n=n||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return n}const C2=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function I2(n,o){if(!n)return null;const u=n.map,m={getMap:()=>u,getCenter:()=>n.transform.center,getZoom:()=>n.transform.zoom,getBearing:()=>n.transform.bearing,getPitch:()=>n.transform.pitch,getPadding:()=>n.transform.padding,getBounds:()=>n.transform.getBounds(),project:_=>n.transform.locationPoint(o.LngLat.convert(_)),unproject:_=>n.transform.pointLocation(o.Point.convert(_)),queryTerrainElevation:(_,w)=>{const z=u.transform;u.transform=n.transform;const l=u.queryTerrainElevation(_,w);return u.transform=z,l}};for(const _ of z2(u))!(_ in m)&&!C2.includes(_)&&(m[_]=u[_].bind(u));return m}function z2(n){const o=new Set;let u=n;for(;u;){for(const m of Object.getOwnPropertyNames(u))m[0]!=="_"&&typeof n[m]=="function"&&m!=="fire"&&m!=="setEventedParent"&&o.add(m);u=Object.getPrototypeOf(u)}return Array.from(o)}const P2=typeof document<"u"?dt.useLayoutEffect:dt.useEffect,M2=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function A2(n,o){for(const u of M2)u in o&&(n[u]=o[u]);o.RTLTextPlugin&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"&&n.setRTLTextPlugin(o.RTLTextPlugin,u=>{u&&console.error(u)},!1)}const Dd=dt.createContext(null),D2={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:n=>console.error(n.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},tg=dt.forwardRef((n,o)=>{const u=dt.useContext(v2),[m,_]=dt.useState(null),w=dt.useRef(),{current:z}=dt.useRef({mapLib:null,map:null});dt.useEffect(()=>{const U=n.mapLib;let X=!0,pe;return Promise.resolve(U||x2(()=>import("./index-fc2e9253.js").then(le=>le.i),[])).then(le=>{if(X){if(le.Map||(le=le.default),!le||!le.Map)throw new Error("Invalid mapLib");if(le.supported(n))A2(le,n),n.reuseMaps&&(pe=yl.reuse(n,w.current)),pe||(pe=new yl(le.Map,n,w.current)),z.map=I2(pe,le),z.mapLib=le,_(pe),u==null||u.onMapMount(z.map,n.id);else throw new Error("Map is not supported by this browser")}}).catch(le=>{n.onError({type:"error",target:null,originalEvent:null,error:le})}),()=>{X=!1,pe&&(u==null||u.onMapUnmount(n.id),n.reuseMaps?pe.recycle():pe.destroy())}},[]),P2(()=>{m&&m.setProps(n)}),dt.useImperativeHandle(o,()=>z.map,[m]);const l=dt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]);return dt.createElement("div",{id:n.id,ref:w,style:l},m&&dt.createElement(Dd.Provider,{value:z},dt.createElement("div",{"mapboxgl-children":""},n.children)))});tg.displayName="Map";tg.defaultProps=D2;const L2=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function fa(n,o){if(!n||!o)return;const u=n.style;for(const m in o){const _=o[m];Number.isFinite(_)&&!L2.test(m)?u[m]=`${_}px`:u[m]=_}}const R2={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function H0(n){const{map:o,mapLib:u}=dt.useContext(Dd),m=dt.useRef({props:n});m.current.props=n;const _=dt.useMemo(()=>{let w=!1;dt.Children.forEach(n.children,U=>{U&&(w=!0)});const z={...n,element:w?document.createElement("div"):null},l=new u.Marker(z).setLngLat([n.longitude,n.latitude]);return l.getElement().addEventListener("click",U=>{var X,pe;(pe=(X=m.current.props).onClick)===null||pe===void 0||pe.call(X,{type:"click",target:l,originalEvent:U})}),l.on("dragstart",U=>{var X,pe;const le=U;le.lngLat=_.getLngLat(),(pe=(X=m.current.props).onDragStart)===null||pe===void 0||pe.call(X,le)}),l.on("drag",U=>{var X,pe;const le=U;le.lngLat=_.getLngLat(),(pe=(X=m.current.props).onDrag)===null||pe===void 0||pe.call(X,le)}),l.on("dragend",U=>{var X,pe;const le=U;le.lngLat=_.getLngLat(),(pe=(X=m.current.props).onDragEnd)===null||pe===void 0||pe.call(X,le)}),l},[]);return dt.useEffect(()=>(_.addTo(o.getMap()),()=>{_.remove()}),[]),dt.useEffect(()=>{fa(_.getElement(),n.style)},[n.style]),(_.getLngLat().lng!==n.longitude||_.getLngLat().lat!==n.latitude)&&_.setLngLat([n.longitude,n.latitude]),n.offset&&!S2(_.getOffset(),n.offset)&&_.setOffset(n.offset),_.isDraggable()!==n.draggable&&_.setDraggable(n.draggable),_.getRotation()!==n.rotation&&_.setRotation(n.rotation),_.getRotationAlignment()!==n.rotationAlignment&&_.setRotationAlignment(n.rotationAlignment),_.getPitchAlignment()!==n.pitchAlignment&&_.setPitchAlignment(n.pitchAlignment),_.getPopup()!==n.popup&&_.setPopup(n.popup),Nu.createPortal(n.children,_.getElement())}H0.defaultProps=R2;const B2=dt.memo(H0);function N_(n){return new Set(n?n.trim().split(/\s+/):[])}function F2(n){const{map:o,mapLib:u}=dt.useContext(Dd),m=dt.useMemo(()=>document.createElement("div"),[]),_=dt.useRef({props:n});_.current.props=n;const w=dt.useMemo(()=>{const z={...n},l=new u.Popup(z).setLngLat([n.longitude,n.latitude]);return l.once("open",U=>{var X,pe;(pe=(X=_.current.props).onOpen)===null||pe===void 0||pe.call(X,U)}),l},[]);if(dt.useEffect(()=>{const z=l=>{var U,X;(X=(U=_.current.props).onClose)===null||X===void 0||X.call(U,l)};return w.on("close",z),w.setDOMContent(m).addTo(o.getMap()),()=>{w.off("close",z),w.isOpen()&&w.remove()}},[]),dt.useEffect(()=>{fa(w.getElement(),n.style)},[n.style]),w.isOpen()&&((w.getLngLat().lng!==n.longitude||w.getLngLat().lat!==n.latitude)&&w.setLngLat([n.longitude,n.latitude]),n.offset&&!os(w.options.offset,n.offset)&&w.setOffset(n.offset),(w.options.anchor!==n.anchor||w.options.maxWidth!==n.maxWidth)&&(w.options.anchor=n.anchor,w.setMaxWidth(n.maxWidth)),w.options.className!==n.className)){const z=N_(w.options.className),l=N_(n.className);for(const U of z)l.has(U)||w.removeClassName(U);for(const U of l)z.has(U)||w.addClassName(U);w.options.className=n.className}return Nu.createPortal(n.children,m)}dt.memo(F2);function lc(n,o,u,m){const _=dt.useContext(Dd),w=dt.useMemo(()=>n(_),[]);return dt.useEffect(()=>{const z=m||u||o,l=typeof o=="function"&&typeof u=="function"?o:null,U=typeof u=="function"?u:typeof o=="function"?o:null,{map:X}=_;return X.hasControl(w)||(X.addControl(w,z==null?void 0:z.position),l&&l(_)),()=>{U&&U(_),X.hasControl(w)&&X.removeControl(w)}},[]),w}function O2(n){const o=lc(({mapLib:u})=>new u.AttributionControl(n),{position:n.position});return dt.useEffect(()=>{fa(o._container,n.style)},[n.style]),null}const N2=dt.memo(O2);function U2(n){const o=lc(({mapLib:u})=>new u.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return dt.useEffect(()=>{fa(o._controlContainer,n.style)},[n.style]),null}dt.memo(U2);const K0=dt.forwardRef((n,o)=>{const u=dt.useRef({props:n}),m=lc(({mapLib:_})=>{const w=new _.GeolocateControl(n),z=w._setupUI;return w._setupUI=l=>{w._container.hasChildNodes()||z(l)},w.on("geolocate",l=>{var U,X;(X=(U=u.current.props).onGeolocate)===null||X===void 0||X.call(U,l)}),w.on("error",l=>{var U,X;(X=(U=u.current.props).onError)===null||X===void 0||X.call(U,l)}),w.on("outofmaxbounds",l=>{var U,X;(X=(U=u.current.props).onOutOfMaxBounds)===null||X===void 0||X.call(U,l)}),w.on("trackuserlocationstart",l=>{var U,X;(X=(U=u.current.props).onTrackUserLocationStart)===null||X===void 0||X.call(U,l)}),w.on("trackuserlocationend",l=>{var U,X;(X=(U=u.current.props).onTrackUserLocationEnd)===null||X===void 0||X.call(U,l)}),w},{position:n.position});return u.current.props=n,dt.useImperativeHandle(o,()=>({trigger:()=>m.trigger()}),[]),dt.useEffect(()=>{fa(m._container,n.style)},[n.style]),null});K0.displayName="GeolocateControl";dt.memo(K0);function V2(n){const o=lc(({mapLib:u})=>new u.NavigationControl(n),{position:n.position});return dt.useEffect(()=>{fa(o._container,n.style)},[n.style]),null}const $2=dt.memo(V2),j2={unit:"metric",maxWidth:100};function Y0(n){const o=lc(({mapLib:u})=>new u.ScaleControl(n),{position:n.position});return(o.options.unit!==n.unit||o.options.maxWidth!==n.maxWidth)&&(o.options.maxWidth=n.maxWidth,o.setUnit(n.unit)),dt.useEffect(()=>{fa(o._container,n.style)},[n.style]),null}Y0.defaultProps=j2;dt.memo(Y0);var sm={},G2={get exports(){return sm},set exports(n){sm=n}};(function(n,o){(function(u,m){n.exports=m()})(V1,function(){var u,m,_;function w(l,U){if(!u)u=U;else if(!m)m=U;else{var X="var sharedChunk = {}; ("+u+")(sharedChunk); ("+m+")(sharedChunk);",pe={};u(pe),_=U(pe),typeof window<"u"&&(_.workerUrl=window.URL.createObjectURL(new Blob([X],{type:"text/javascript"})))}}w(["exports"],function(l){var U=X;function X(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}function pe(i,e,r,a){const d=new U(i,e,r,a);return function(f){return d.solve(f)}}X.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var d=this.sampleCurveX(r)-i;if(Math.abs(d)<e)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=d/f}var y=0,v=1;for(r=i,a=0;a<20&&(d=this.sampleCurveX(r),!(Math.abs(d-i)<e));a++)i>d?y=r:v=r,r=.5*(v-y)+y;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const le=pe(.25,.1,.25,1);function W(i,e,r){return Math.min(r,Math.max(e,i))}function Fe(i,e,r){const a=r-e,d=((i-e)%a+a)%a+e;return d===e?r:d}function Le(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let Ce=1;function Ot(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ae(i,e,r){const a={};for(const d in i)a[d]=e.call(r||this,i[d],d,i);return a}function ee(i,e,r){const a={};for(const d in i)e.call(r||this,i[d],d,i)&&(a[d]=i[d]);return a}function se(i){return Array.isArray(i)?i.map(se):typeof i=="object"&&i?ae(i,se):i}const ke={};function De(i){ke[i]||(typeof console<"u"&&console.warn(i),ke[i]=!0)}function He(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Je(i){let e=0;for(let r,a,d=0,f=i.length,y=f-1;d<f;y=d++)r=i[d],a=i[y],e+=(a.x-r.x)*(r.y+a.y);return e}function Qe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Zt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,d,f)=>{const y=d||f;return e[a]=!y||y.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let mt,_n,Zn=null;function Ii(i){if(Zn==null){const e=i.navigator?i.navigator.userAgent:null;Zn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Zn}function Ni(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const er={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),a=r.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,a.drawImage(i,0,0,i.width,i.height),a.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(mt||(mt=document.createElement("a")),mt.href=i,mt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(_n==null&&(_n=matchMedia("(prefers-reduced-motion: reduce)")),_n.matches)}};var st=hi;function hi(i,e){this.x=i,this.y=e}hi.prototype={clone:function(){return new hi(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,e){var r=Math.cos(i),a=Math.sin(i),d=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},hi.convert=function(i){return i instanceof hi?i:Array.isArray(i)?new hi(i[0],i[1]):i};const Ze={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},at="mapbox-tiles";let ut,Nt,Xt=500,Ui=50;function Qn(){typeof caches>"u"||ut||(ut=caches.open(at))}let ei=1/0;const Bn={supported:!1,testSupport:function(i){!ti&&Lr&&(zo?ws(i):di=i)}};let di,Lr,ti=!1,zo=!1;function ws(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Lr),i.isContextLost())return;Bn.supported=!0}catch{}i.deleteTexture(e),ti=!0}typeof document<"u"&&(Lr=document.createElement("img"),Lr.onload=function(){di&&ws(di),di=null,zo=!0},Lr.onerror=function(){ti=!0,di=null},Lr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const mr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(mr);class pi extends Error{constructor(e,r,a,d){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=d}}const bs=Qe()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Rr(i,e){const r=new AbortController,a=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:bs(),signal:r.signal});let d=!1,f=!1;return i.type==="json"&&a.headers.set("Accept","application/json"),((y,v,b)=>{if(f)return;const T=Date.now();fetch(a).then(I=>I.ok?((M,L,B)=>{(i.type==="arrayBuffer"?M.arrayBuffer():i.type==="json"?M.json():M.text()).then(F=>{f||(L&&B&&function(H,q,oe){if(Qn(),!ut)return;const fe={status:q.status,statusText:q.statusText,headers:new Headers};q.headers.forEach((he,be)=>fe.headers.set(be,he));const re=Zt(q.headers.get("Cache-Control")||"");re["no-store"]||(re["max-age"]&&fe.headers.set("Expires",new Date(oe+1e3*re["max-age"]).toUTCString()),new Date(fe.headers.get("Expires")).getTime()-oe<42e4||function(he,be){if(Nt===void 0)try{new Response(new ReadableStream),Nt=!0}catch{Nt=!1}Nt?be(he.body):he.blob().then(be)}(q,he=>{const be=new Response(he,fe);Qn(),ut&&ut.then(we=>we.put(function(Ge){const Xe=Ge.indexOf("?");return Xe<0?Ge:Ge.slice(0,Xe)}(H.url),be)).catch(we=>De(we.message))}))}(a,L,B),d=!0,e(null,F,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch(F=>{f||e(new Error(F.message))})})(I,null,T):I.blob().then(M=>e(new pi(I.status,I.statusText,i.url,M)))).catch(I=>{I.code!==20&&e(new Error(I.message))})})(),{cancel:()=>{f=!0,d||r.abort()}}}const Po=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Qe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Qe()){const a=i.url.substring(0,i.url.indexOf("://"));return(Ze.REGISTERED_PROTOCOLS[a]||Rr)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(bs())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Rr(i,e);if(Qe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(a,d){const f=new XMLHttpRequest;f.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const y in a.headers)f.setRequestHeader(y,a.headers[y]);return a.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=a.credentials==="include",f.onerror=()=>{d(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let y=f.response;if(a.type==="json")try{y=JSON.parse(f.response)}catch(v){return d(v)}d(null,y,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else{const y=new Blob([f.response],{type:f.getResponseHeader("Content-Type")});d(new pi(f.status,f.statusText,a.url,y))}},f.send(a.body),{cancel:()=>f.abort()}}(i,e)},Mo=function(i,e){return Po(Le(i,{type:"arrayBuffer"}),e)};function Ss(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const Et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let tr,Br;tr=[],Br=0;const Fr=function(i,e){if(Bn.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Br>=Ze.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return tr.push(f),f}Br++;let r=!1;const a=()=>{if(!r)for(r=!0,Br--;tr.length&&Br<Ze.MAX_PARALLEL_IMAGE_REQUESTS;){const f=tr.shift(),{requestParameters:y,callback:v,cancelled:b}=f;b||(f.cancel=Fr(y,v).cancel)}},d=Mo(i,(f,y,v,b)=>{a(),f?e(f):y&&function(T,I){typeof createImageBitmap=="function"?function(M,L){const B=new Blob([new Uint8Array(M)],{type:"image/png"});createImageBitmap(B).then(F=>{L(null,F)}).catch(F=>{L(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(T,I):function(M,L){const B=new Image;B.onload=()=>{L(null,B),URL.revokeObjectURL(B.src),B.onload=null,window.requestAnimationFrame(()=>{B.src=Et})},B.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Blob([new Uint8Array(M)],{type:"image/png"});B.src=M.byteLength?URL.createObjectURL(F):Et}(T,I)}(y,(T,I)=>{T!=null?e(T):I!=null&&e(null,I,{cacheControl:v,expires:b})})});return{cancel:()=>{d.cancel(),a()}}};function Es(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function gr(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class yr{constructor(e,r={}){Le(this,r),this.type=e}}class Ao extends yr{constructor(e,r={}){super("error",Le({error:e},r))}}class _r{on(e,r){return this._listeners=this._listeners||{},Es(e,r,this._listeners),this}off(e,r){return gr(e,r,this._listeners),gr(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},Es(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new yr(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const d=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of d)v.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of f)gr(a,v,this._oneTimeListeners),v.call(this,e);const y=this._eventedParent;y&&(Le(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Ao&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Re{constructor(e,r,a,d){this.message=(e?`${e}: `:"")+a,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)}}function eo(i){const e=i.value;return e?[new Re(i.key,e,"constants have been deprecated as of v8")]:[]}function Vi(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}function Tt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function zi(i){if(Array.isArray(i))return i.map(zi);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=zi(i[r]);return e}return Tt(i)}class fi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class mi{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,d]of r)this.bindings[a]=d}concat(e){return new mi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Or={kind:"null"},Pe={kind:"number"},gt={kind:"string"},pt={kind:"boolean"},Mn={kind:"color"},Nr={kind:"object"},ht={kind:"value"},xr={kind:"collator"},Sn={kind:"formatted"},Do={kind:"padding"},pn={kind:"resolvedImage"};function qn(i,e){return{kind:"array",itemType:i,N:e}}function Bt(i){if(i.kind==="array"){const e=Bt(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Lo=[Or,Pe,gt,pt,Mn,Sn,Nr,qn(ht),Do,pn];function nr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!nr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of Lo)if(!nr(r,e))return null}}return`Expected ${Bt(i)} but found ${Bt(e)} instead.`}function to(i,e){return e.some(r=>r.kind===i.kind)}function no(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var Ro,io={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function V(i){return(i=Math.round(i))<0?0:i>255?255:i}function C(i){return V(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function A(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function O(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{Ro={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in io)return io[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),d=r.indexOf(")");if(a!==-1&&d+1===r.length){var f=r.substr(0,a),y=r.substr(a+1,d-(a+1)).split(","),v=1;switch(f){case"rgba":if(y.length!==4)return null;v=A(y.pop());case"rgb":return y.length!==3?null:[C(y[0]),C(y[1]),C(y[2]),v];case"hsla":if(y.length!==4)return null;v=A(y.pop());case"hsl":if(y.length!==3)return null;var b=(parseFloat(y[0])%360+360)%360/360,T=A(y[1]),I=A(y[2]),M=I<=.5?I*(T+1):I+T-I*T,L=2*I-M;return[V(255*O(L,M,b+1/3)),V(255*O(L,M,b)),V(255*O(L,M,b-1/3)),v];default:return null}}return null}}catch{}class N{constructor(e,r,a,d=1){this.r=e,this.g=r,this.b=a,this.a=d}static parse(e){if(!e)return;if(e instanceof N)return e;if(typeof e!="string")return;const r=Ro(e);return r?new N(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,d]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${d})`}toArray(){const{r:e,g:r,b:a,a:d}=this;return d===0?[0,0,0,0]:[255*e/d,255*r/d,255*a/d,d]}}N.black=new N(0,0,0,1),N.white=new N(1,1,1,1),N.transparent=new N(0,0,0,0),N.red=new N(1,0,0,1);class K{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class te{constructor(e,r,a,d,f){this.text=e,this.image=r,this.scale=a,this.fontStack=d,this.textColor=f}}class J{constructor(e){this.sections=e}static fromString(e){return new J([new te(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof J?e:J.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Y{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Y)return e;if(typeof e=="number")return new Y([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Y(e)}}toString(){return JSON.stringify(this.values)}}class ne{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ne({name:e,available:!1}):null}}function ge(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Se(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof N||i instanceof K||i instanceof J||i instanceof Y||i instanceof ne)return!0;if(Array.isArray(i)){for(const e of i)if(!Se(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Se(i[e]))return!1;return!0}return!1}function me(i){if(i===null)return Or;if(typeof i=="string")return gt;if(typeof i=="boolean")return pt;if(typeof i=="number")return Pe;if(i instanceof N)return Mn;if(i instanceof K)return xr;if(i instanceof J)return Sn;if(i instanceof Y)return Do;if(i instanceof ne)return pn;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const d=me(a);if(r){if(r===d)continue;r=ht;break}r=d}return qn(r||ht,e)}return Nr}function We(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof N||i instanceof J||i instanceof Y||i instanceof ne?i.toString():JSON.stringify(i)}class Ke{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Se(e[1]))return r.error("invalid value");const a=e[1];let d=me(a);const f=r.expectedType;return d.kind!=="array"||d.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(d=f),new Ke(d,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ve{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const rt={string:gt,number:Pe,boolean:pt,object:Nr};class lt{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,d=1;const f=e[0];if(f==="array"){let v,b;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in rt)||T==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=rt[T],d++}else v=ht;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],d++}a=qn(v,b)}else{if(!rt[f])throw new Error(`Types doesn't contain name = ${f}`);a=rt[f]}const y=[];for(;d<e.length;d++){const v=r.parse(e[d],d,ht);if(!v)return null;y.push(v)}return new lt(a,y)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!nr(this.type,me(a)))return a;if(r===this.args.length-1)throw new Ve(`Expected value to be of type ${Bt(this.type)}, but found ${Bt(me(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const kt={"to-boolean":pt,"to-color":Mn,"to-number":Pe,"to-string":gt};class ct{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!kt[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const d=kt[a],f=[];for(let y=1;y<e.length;y++){const v=r.parse(e[y],y,ht);if(!v)return null;f.push(v)}return new ct(d,f)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,a;for(const d of this.args){if(r=d.evaluate(e),a=null,r instanceof N)return r;if(typeof r=="string"){const f=e.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ge(r[0],r[1],r[2],r[3]),!a))return new N(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ve(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const a of this.args){r=a.evaluate(e);const d=Y.parse(r);if(d)return d}throw new Ve(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const d=Number(r);if(!isNaN(d))return d}throw new Ve(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?J.fromString(We(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ne.fromString(We(this.args[0].evaluate(e))):We(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const yt=["Unknown","Point","LineString","Polygon"];class Ct{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=N.parse(e)),r}}class Ut{constructor(e,r,a,d){this.name=e,this.type=r,this._evaluate=a,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],d=Ut.definitions[a];if(!d)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,v=y.filter(([T])=>!Array.isArray(T)||T.length===e.length-1);let b=null;for(const[T,I]of v){b=new Oo(r.registry,r.path,null,r.scope);const M=[];let L=!1;for(let B=1;B<e.length;B++){const F=e[B],H=Array.isArray(T)?T[B-1]:T.type,q=b.parse(F,1+M.length,H);if(!q){L=!0;break}M.push(q)}if(!L)if(Array.isArray(T)&&T.length!==M.length)b.error(`Expected ${T.length} arguments, but found ${M.length} instead.`);else{for(let B=0;B<M.length;B++){const F=Array.isArray(T)?T[B]:T.type,H=M[B];b.concat(B+1).checkSubtype(F,H.type)}if(b.errors.length===0)return new Ut(a,f,I,M)}}if(v.length===1)r.errors.push(...b.errors);else{const T=(v.length?v:y).map(([M])=>{return L=M,Array.isArray(L)?`(${L.map(Bt).join(", ")})`:`(${Bt(L.type)}...)`;var L}).join(" | "),I=[];for(let M=1;M<e.length;M++){const L=r.parse(e[M],1+I.length);if(!L)return null;I.push(Bt(L.type))}r.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){Ut.definitions=r;for(const a in r)e[a]=Ut}}class En{constructor(e,r,a){this.type=xr,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const d=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,pt);if(!d)return null;const f=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,pt);if(!f)return null;let y=null;return a.locale&&(y=r.parse(a.locale,1,gt),!y)?null:new En(d,f,y)}evaluate(e){return new K(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Ht=8192;function Fn(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Bo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Ts(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(r*d*Ht),Math.round(a*d*Ht)]}function Vt(i,e,r){const a=i[0]-e[0],d=i[1]-e[1],f=i[0]-r[0],y=i[1]-r[1];return a*y-f*d==0&&a*f<=0&&d*y<=0}function wl(i,e){let r=!1;for(let y=0,v=e.length;y<v;y++){const b=e[y];for(let T=0,I=b.length;T<I-1;T++){if(Vt(i,b[T],b[T+1]))return!1;(d=b[T])[1]>(a=i)[1]!=(f=b[T+1])[1]>a[1]&&a[0]<(f[0]-d[0])*(a[1]-d[1])/(f[1]-d[1])+d[0]&&(r=!r)}}var a,d,f;return r}function bl(i,e){for(let r=0;r<e.length;r++)if(wl(i,e[r]))return!0;return!1}function uc(i,e,r,a){const d=a[0]-r[0],f=a[1]-r[1],y=(i[0]-r[0])*f-d*(i[1]-r[1]),v=(e[0]-r[0])*f-d*(e[1]-r[1]);return y>0&&v<0||y<0&&v>0}function cc(i,e,r){for(const T of r)for(let I=0;I<T.length-1;++I)if((v=[(y=T[I+1])[0]-(f=T[I])[0],y[1]-f[1]])[0]*(b=[(d=e)[0]-(a=i)[0],d[1]-a[1]])[1]-v[1]*b[0]!=0&&uc(a,d,f,y)&&uc(f,y,a,d))return!0;var a,d,f,y,v,b;return!1}function Sl(i,e){for(let r=0;r<i.length;++r)if(!wl(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(cc(i[r],i[r+1],e))return!1;return!0}function Ld(i,e){for(let r=0;r<e.length;r++)if(Sl(i,e[r]))return!0;return!1}function ma(i,e,r){const a=[];for(let d=0;d<i.length;d++){const f=[];for(let y=0;y<i[d].length;y++){const v=Ts(i[d][y],r);Fn(e,v),f.push(v)}a.push(f)}return a}function El(i,e,r){const a=[];for(let d=0;d<i.length;d++){const f=ma(i[d],e,r);a.push(f)}return a}function hc(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const d=.5*a;let f=i[0]-r[0]>d?-a:r[0]-i[0]>d?a:0;f===0&&(f=i[0]-r[2]>d?-a:r[2]-i[0]>d?a:0),i[0]+=f}Fn(e,i)}function dc(i,e,r,a){const d=Math.pow(2,a.z)*Ht,f=[a.x*Ht,a.y*Ht],y=[];for(const v of i)for(const b of v){const T=[b.x+f[0],b.y+f[1]];hc(T,e,r,d),y.push(T)}return y}function pc(i,e,r,a){const d=Math.pow(2,a.z)*Ht,f=[a.x*Ht,a.y*Ht],y=[];for(const b of i){const T=[];for(const I of b){const M=[I.x+f[0],I.y+f[1]];Fn(e,M),T.push(M)}y.push(T)}if(e[2]-e[0]<=d/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of y)for(const T of b)hc(T,e,r,d)}var v;return y}class ro{constructor(e,r){this.type=pt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Se(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let d=0;d<a.features.length;++d){const f=a.features[d].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new ro(a,a.features[d].geometry)}else if(a.type==="Feature"){const d=a.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ro(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ro(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const d=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(a.type==="Polygon"){const v=ma(a.coordinates,f,y),b=dc(r.geometry(),d,f,y);if(!Bo(d,f))return!1;for(const T of b)if(!wl(T,v))return!1}if(a.type==="MultiPolygon"){const v=El(a.coordinates,f,y),b=dc(r.geometry(),d,f,y);if(!Bo(d,f))return!1;for(const T of b)if(!bl(T,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const d=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(a.type==="Polygon"){const v=ma(a.coordinates,f,y),b=pc(r.geometry(),d,f,y);if(!Bo(d,f))return!1;for(const T of b)if(!Sl(T,v))return!1}if(a.type==="MultiPolygon"){const v=El(a.coordinates,f,y),b=pc(r.geometry(),d,f,y);if(!Bo(d,f))return!1;for(const T of b)if(!Ld(T,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function ks(i){if(i instanceof Ut&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ro)return!1;let e=!0;return i.eachChild(r=>{e&&!ks(r)&&(e=!1)}),e}function Fo(i){if(i instanceof Ut&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Fo(r)&&(e=!1)}),e}function ga(i,e){if(i instanceof Ut&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!ga(a,e)&&(r=!1)}),r}class ya{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new ya(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Oo{constructor(e,r=[],a,d=new mi,f=[]){this.registry=e,this.path=r,this.key=r.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=f,this.expectedType=a}parse(e,r,a,d,f={}){return r?this.concat(r,a,d)._parse(e,f):this._parse(e,f)}_parse(e,r){function a(d,f,y){return y==="assert"?new lt(f,[d]):y==="coerce"?new ct(f,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[d];if(f){let y=f.parse(e,this);if(!y)return null;if(this.expectedType){const v=this.expectedType,b=y.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(v.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array"){if(this.checkSubtype(v,b))return null}else y=a(y,v,r.typeAnnotation||"coerce");else y=a(y,v,r.typeAnnotation||"coerce");else y=a(y,v,r.typeAnnotation||"assert")}if(!(y instanceof Ke)&&y.type.kind!=="resolvedImage"&&Tl(y)){const v=new Ct;try{y=new Ke(y.type,y.evaluate(v))}catch(b){return this.error(b.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const d=typeof e=="number"?this.path.concat(e):this.path,f=a?this.scope.concat(a):this.scope;return new Oo(this.registry,d,r||null,f,this.errors)}error(e,...r){const a=`${this.key}${r.map(d=>`[${d}]`).join("")}`;this.errors.push(new fi(a,e))}checkSubtype(e,r){const a=nr(e,r);return a&&this.error(a),a}}function Tl(i){if(i instanceof ya)return Tl(i.boundExpression);if(i instanceof Ut&&i.name==="error"||i instanceof En||i instanceof ro)return!1;const e=i instanceof ct||i instanceof lt;let r=!0;return i.eachChild(a=>{r=e?r&&Tl(a):r&&a instanceof Ke}),!!r&&ks(i)&&ga(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function _a(i,e){const r=i.length-1;let a,d,f=0,y=r,v=0;for(;f<=y;)if(v=Math.floor((f+y)/2),a=i[v],d=i[v+1],a<=e){if(v===r||e<d)return v;f=v+1}else{if(!(a>e))throw new Ve("Input is not a number.");y=v-1}return 0}class Cs{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[d,f]of a)this.labels.push(d),this.outputs.push(f)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Pe);if(!a)return null;const d=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let y=1;y<e.length;y+=2){const v=y===1?-1/0:e[y],b=e[y+1],T=y,I=y+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(d.length&&d[d.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const M=r.parse(b,I,f);if(!M)return null;f=f||M.type,d.push([v,M])}return new Cs(f,a,d)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return a[0].evaluate(e);const f=r.length;return d>=r[f-1]?a[f-1].evaluate(e):a[_a(r,d)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Kt(i,e,r){return i*(1-r)+e*r}var Is=Object.freeze({__proto__:null,number:Kt,color:function(i,e,r){return new N(Kt(i.r,e.r,r),Kt(i.g,e.g,r),Kt(i.b,e.b,r),Kt(i.a,e.a,r))},array:function(i,e,r){return i.map((a,d)=>Kt(a,e[d],r))},padding:function(i,e,r){const a=i.values,d=e.values;return new Y([Kt(a[0],d[0],r),Kt(a[1],d[1],r),Kt(a[2],d[2],r),Kt(a[3],d[3],r)])}});const fc=.95047,mc=1.08883,kl=4/29,xa=6/29,gc=3*xa*xa,Rd=Math.PI/180,Bd=180/Math.PI;function Cl(i){return i>.008856451679035631?Math.pow(i,1/3):i/gc+kl}function Il(i){return i>xa?i*i*i:gc*(i-kl)}function zl(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Pl(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Pt(i){const e=Pl(i.r),r=Pl(i.g),a=Pl(i.b),d=Cl((.4124564*e+.3575761*r+.1804375*a)/fc),f=Cl((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*f-16,a:500*(d-f),b:200*(f-Cl((.0193339*e+.119192*r+.9503041*a)/mc)),alpha:i.a}}function yc(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,a=isNaN(i.b)?e:e-i.b/200;return e=1*Il(e),r=fc*Il(r),a=mc*Il(a),new N(zl(3.2404542*r-1.5371385*e-.4985314*a),zl(-.969266*r+1.8760108*e+.041556*a),zl(.0556434*r-.2040259*e+1.0572252*a),i.alpha)}function Fd(i,e,r){const a=e-i;return i+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const zs={forward:Pt,reverse:yc,interpolate:function(i,e,r){return{l:Kt(i.l,e.l,r),a:Kt(i.a,e.a,r),b:Kt(i.b,e.b,r),alpha:Kt(i.alpha,e.alpha,r)}}},Ps={forward:function(i){const{l:e,a:r,b:a}=Pt(i),d=Math.atan2(a,r)*Bd;return{h:d<0?d+360:d,c:Math.sqrt(r*r+a*a),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Rd,r=i.c;return yc({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:Fd(i.h,e.h,r),c:Kt(i.c,e.c,r),l:Kt(i.l,e.l,r),alpha:Kt(i.alpha,e.alpha,r)}}};var _c=Object.freeze({__proto__:null,lab:zs,hcl:Ps});class gi{constructor(e,r,a,d,f){this.type=e,this.operator=r,this.interpolation=a,this.input=d,this.labels=[],this.outputs=[];for(const[y,v]of f)this.labels.push(y),this.outputs.push(v)}static interpolationFactor(e,r,a,d){let f=0;if(e.name==="exponential")f=Ml(r,e.base,a,d);else if(e.name==="linear")f=Ml(r,1,a,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;f=new U(y[0],y[1],y[2],y[3]).solve(Ml(r,1,a,d))}return f}static parse(e,r){let[a,d,f,...y]=e;if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const T=d[1];if(typeof T!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:T}}else{if(d[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const T=d.slice(1);if(T.length!==4||T.some(I=>typeof I!="number"||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,Pe),!f)return null;const v=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=Mn:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let T=0;T<y.length;T+=2){const I=y[T],M=y[T+1],L=T+3,B=T+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(v.length&&v[v.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const F=r.parse(M,B,b);if(!F)return null;b=b||F.type,v.push([I,F])}return b.kind==="number"||b.kind==="color"||b.kind==="padding"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new gi(b,a,d,f,v):r.error(`Type ${Bt(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return a[0].evaluate(e);const f=r.length;if(d>=r[f-1])return a[f-1].evaluate(e);const y=_a(r,d),v=gi.interpolationFactor(this.interpolation,d,r[y],r[y+1]),b=a[y].evaluate(e),T=a[y+1].evaluate(e);return this.operator==="interpolate"?Is[this.type.kind.toLowerCase()](b,T,v):this.operator==="interpolate-hcl"?Ps.reverse(Ps.interpolate(Ps.forward(b),Ps.forward(T),v)):zs.reverse(zs.interpolate(zs.forward(b),zs.forward(T),v))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ml(i,e,r,a){const d=a-r,f=i-r;return d===0?0:e===1?f/d:(Math.pow(e,f)-1)/(Math.pow(e,d)-1)}class va{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const d=r.expectedType;d&&d.kind!=="value"&&(a=d);const f=[];for(const v of e.slice(1)){const b=r.parse(v,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,f.push(b)}if(!a)throw new Error("No output type");const y=d&&f.some(v=>nr(d,v.type));return new va(y?ht:a,f)}evaluate(e){let r,a=null,d=0;for(const f of this.args)if(d++,a=f.evaluate(e),a&&a instanceof ne&&!a.available&&(r||(r=a.name),a=null,d===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class wa{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let f=1;f<e.length-1;f+=2){const y=e[f];if(typeof y!="string")return r.error(`Expected string, but found ${typeof y} instead.`,f);if(/[^a-zA-Z0-9_]/.test(y))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const v=r.parse(e[f+1],f+1);if(!v)return null;a.push([y,v])}const d=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return d?new wa(a,d):null}outputDefined(){return this.result.outputDefined()}}class Al{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Pe),d=r.parse(e[2],2,qn(r.expectedType||ht));return a&&d?new Al(d.type.itemType,a,d):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Ve(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Ve(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Ve(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Dl{constructor(e,r){this.type=pt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ht),d=r.parse(e[2],2,ht);return a&&d?to(a.type,[pt,gt,Pe,Or,ht])?new Dl(a,d):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bt(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!no(r,["boolean","string","number","null"]))throw new Ve(`Expected first argument to be of type boolean, string, number or null, but found ${Bt(me(r))} instead.`);if(!no(a,["string","array"]))throw new Ve(`Expected second argument to be of type array or string, but found ${Bt(me(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ba{constructor(e,r,a){this.type=Pe,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ht),d=r.parse(e[2],2,ht);if(!a||!d)return null;if(!to(a.type,[pt,gt,Pe,Or,ht]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bt(a.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,Pe);return f?new ba(a,d,f):null}return new ba(a,d)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!no(r,["boolean","string","number","null"]))throw new Ve(`Expected first argument to be of type boolean, string, number or null, but found ${Bt(me(r))} instead.`);if(!no(a,["string","array"]))throw new Ve(`Expected second argument to be of type array or string, but found ${Bt(me(a))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return a.indexOf(r,d)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Ll{constructor(e,r,a,d,f,y){this.inputType=e,this.type=r,this.input=a,this.cases=d,this.outputs=f,this.otherwise=y}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);const f={},y=[];for(let T=2;T<e.length-1;T+=2){let I=e[T];const M=e[T+1];Array.isArray(I)||(I=[I]);const L=r.concat(T);if(I.length===0)return L.error("Expected at least one branch label.");for(const F of I){if(typeof F!="number"&&typeof F!="string")return L.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return L.error("Numeric branch labels must be integer values.");if(a){if(L.checkSubtype(a,me(F)))return null}else a=me(F);if(f[String(F)]!==void 0)return L.error("Branch labels must be unique.");f[String(F)]=y.length}const B=r.parse(M,T,d);if(!B)return null;d=d||B.type,y.push(B)}const v=r.parse(e[1],1,ht);if(!v)return null;const b=r.parse(e[e.length-1],e.length-1,d);return b?v.type.kind!=="value"&&r.concat(1).checkSubtype(a,v.type)?null:new Ll(a,d,v,f,y,b):null}evaluate(e){const r=this.input.evaluate(e);return(me(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Rl{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const v=r.parse(e[y],y,pt);if(!v)return null;const b=r.parse(e[y+1],y+1,a);if(!b)return null;d.push([v,b]),a=a||b.type}const f=r.parse(e[e.length-1],e.length-1,a);if(!f)return null;if(!a)throw new Error("Can't infer output type");return new Rl(a,d,f)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Sa{constructor(e,r,a,d){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=d}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ht),d=r.parse(e[2],2,Pe);if(!a||!d)return null;if(!to(a.type,[qn(ht),gt,ht]))return r.error(`Expected first argument to be of type array or string, but found ${Bt(a.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,Pe);return f?new Sa(a.type,a,d,f):null}return new Sa(a.type,a,d)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!no(r,["string","array"]))throw new Ve(`Expected first argument to be of type array or string, but found ${Bt(me(r))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return r.slice(a,d)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function xc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function vc(i,e,r,a){return a.compare(e,r)===0}function No(i,e,r){const a=i!=="=="&&i!=="!=";return class J0{constructor(f,y,v){this.type=pt,this.lhs=f,this.rhs=y,this.collator=v,this.hasUntypedArgument=f.type.kind==="value"||y.type.kind==="value"}static parse(f,y){if(f.length!==3&&f.length!==4)return y.error("Expected two or three arguments.");const v=f[0];let b=y.parse(f[1],1,ht);if(!b)return null;if(!xc(v,b.type))return y.concat(1).error(`"${v}" comparisons are not supported for type '${Bt(b.type)}'.`);let T=y.parse(f[2],2,ht);if(!T)return null;if(!xc(v,T.type))return y.concat(2).error(`"${v}" comparisons are not supported for type '${Bt(T.type)}'.`);if(b.type.kind!==T.type.kind&&b.type.kind!=="value"&&T.type.kind!=="value")return y.error(`Cannot compare types '${Bt(b.type)}' and '${Bt(T.type)}'.`);a&&(b.type.kind==="value"&&T.type.kind!=="value"?b=new lt(T.type,[b]):b.type.kind!=="value"&&T.type.kind==="value"&&(T=new lt(b.type,[T])));let I=null;if(f.length===4){if(b.type.kind!=="string"&&T.type.kind!=="string"&&b.type.kind!=="value"&&T.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(I=y.parse(f[3],3,xr),!I)return null}return new J0(b,T,I)}evaluate(f){const y=this.lhs.evaluate(f),v=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const b=me(y),T=me(v);if(b.kind!==T.kind||b.kind!=="string"&&b.kind!=="number")throw new Ve(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${T.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=me(y),T=me(v);if(b.kind!=="string"||T.kind!=="string")return e(f,y,v)}return this.collator?r(f,y,v,this.collator.evaluate(f)):e(f,y,v)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const Od=No("==",function(i,e,r){return e===r},vc),Nd=No("!=",function(i,e,r){return e!==r},function(i,e,r,a){return!vc(0,e,r,a)}),Ud=No("<",function(i,e,r){return e<r},function(i,e,r,a){return a.compare(e,r)<0}),Vd=No(">",function(i,e,r){return e>r},function(i,e,r,a){return a.compare(e,r)>0}),$d=No("<=",function(i,e,r){return e<=r},function(i,e,r,a){return a.compare(e,r)<=0}),jd=No(">=",function(i,e,r){return e>=r},function(i,e,r,a){return a.compare(e,r)>=0});class Bl{constructor(e,r,a,d,f){this.type=gt,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Pe);if(!a)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");let f=null;if(d.locale&&(f=r.parse(d.locale,1,gt),!f))return null;let y=null;if(d.currency&&(y=r.parse(d.currency,1,gt),!y))return null;let v=null;if(d["min-fraction-digits"]&&(v=r.parse(d["min-fraction-digits"],1,Pe),!v))return null;let b=null;return d["max-fraction-digits"]&&(b=r.parse(d["max-fraction-digits"],1,Pe),!b)?null:new Bl(a,f,y,v,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ea{constructor(e){this.type=Sn,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const d=[];let f=!1;for(let y=1;y<=e.length-1;++y){const v=e[y];if(f&&typeof v=="object"&&!Array.isArray(v)){f=!1;let b=null;if(v["font-scale"]&&(b=r.parse(v["font-scale"],1,Pe),!b))return null;let T=null;if(v["text-font"]&&(T=r.parse(v["text-font"],1,qn(gt)),!T))return null;let I=null;if(v["text-color"]&&(I=r.parse(v["text-color"],1,Mn),!I))return null;const M=d[d.length-1];M.scale=b,M.font=T,M.textColor=I}else{const b=r.parse(e[y],1,ht);if(!b)return null;const T=b.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,d.push({content:b,scale:null,font:null,textColor:null})}}return new Ea(d)}evaluate(e){return new J(this.sections.map(r=>{const a=r.content.evaluate(e);return me(a)===pn?new te("",a,null,null,null):new te(We(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Fl{constructor(e){this.type=pn,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,gt);return a?new Fl(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=ne.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ol{constructor(e){this.type=Pe,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Bt(a.type)} instead.`):new Ol(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Ve(`Expected value to be of type string or array, but found ${Bt(me(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Uo={"==":Od,"!=":Nd,">":Vd,"<":Ud,">=":jd,"<=":$d,array:lt,at:Al,boolean:lt,case:Rl,coalesce:va,collator:En,format:Ea,image:Fl,in:Dl,"index-of":ba,interpolate:gi,"interpolate-hcl":gi,"interpolate-lab":gi,length:Ol,let:wa,literal:Ke,match:Ll,number:lt,"number-format":Bl,object:lt,slice:Sa,step:Cs,string:lt,"to-boolean":ct,"to-color":ct,"to-number":ct,"to-string":ct,var:ya,within:ro};function wc(i,[e,r,a,d]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const f=d?d.evaluate(i):1,y=ge(e,r,a,f);if(y)throw new Ve(y);return new N(e/255*f,r/255*f,a/255*f,f)}function bc(i,e){return i in e}function Ta(i,e){const r=e[i];return r===void 0?null:r}function oo(i){return{type:i}}function Sc(i){return{result:"success",value:i}}function Vo(i){return{result:"error",value:i}}function qt(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Ec(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function bt(i){return!!i.expression&&i.expression.interpolated}function Mt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function jt(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Yt(i){return i}function Ms(i,e){const r=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",d=a||!(a||i.property!==void 0),f=i.type||(bt(e)?"exponential":"interval");if(r||e.type==="padding"){const T=r?N.parse:Y.parse;(i=Vi({},i)).stops&&(i.stops=i.stops.map(I=>[I[0],T(I[1])])),i.default=T(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!_c[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let y,v,b;if(f==="exponential")y=Tc;else if(f==="interval")y=Zd;else if(f==="categorical"){y=Gd,v=Object.create(null);for(const T of i.stops)v[T[0]]=T[1];b=typeof i.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);y=qd}if(a){const T={},I=[];for(let B=0;B<i.stops.length;B++){const F=i.stops[B],H=F[0].zoom;T[H]===void 0&&(T[H]={zoom:H,type:i.type,property:i.property,default:i.default,stops:[]},I.push(H)),T[H].stops.push([F[0].value,F[1]])}const M=[];for(const B of I)M.push([T[B].zoom,Ms(T[B],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:gi.interpolationFactor.bind(void 0,L),zoomStops:M.map(B=>B[0]),evaluate:({zoom:B},F)=>Tc({stops:M,base:i.base},e,B).evaluate(B,F)}}if(d){const T=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:gi.interpolationFactor.bind(void 0,T),zoomStops:i.stops.map(I=>I[0]),evaluate:({zoom:I})=>y(i,e,I,v,b)}}return{kind:"source",evaluate(T,I){const M=I&&I.properties?I.properties[i.property]:void 0;return M===void 0?$o(i.default,e.default):y(i,e,M,v,b)}}}function $o(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Gd(i,e,r,a,d){return $o(typeof r===d?a[r]:void 0,i.default,e.default)}function Zd(i,e,r){if(Mt(r)!=="number")return $o(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const d=_a(i.stops.map(f=>f[0]),r);return i.stops[d][1]}function Tc(i,e,r){const a=i.base!==void 0?i.base:1;if(Mt(r)!=="number")return $o(i.default,e.default);const d=i.stops.length;if(d===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[d-1][0])return i.stops[d-1][1];const f=_a(i.stops.map(I=>I[0]),r),y=function(I,M,L,B){const F=B-L,H=I-L;return F===0?0:M===1?H/F:(Math.pow(M,H)-1)/(Math.pow(M,F)-1)}(r,a,i.stops[f][0],i.stops[f+1][0]),v=i.stops[f][1],b=i.stops[f+1][1];let T=Is[e.type]||Yt;if(i.colorSpace&&i.colorSpace!=="rgb"){const I=_c[i.colorSpace];T=(M,L)=>I.reverse(I.interpolate(I.forward(M),I.forward(L),y))}return typeof v.evaluate=="function"?{evaluate(...I){const M=v.evaluate.apply(void 0,I),L=b.evaluate.apply(void 0,I);if(M!==void 0&&L!==void 0)return T(M,L,y)}}:T(v,b,y)}function qd(i,e,r){switch(e.type){case"color":r=N.parse(r);break;case"formatted":r=J.fromString(r.toString());break;case"resolvedImage":r=ne.fromString(r.toString());break;case"padding":r=Y.parse(r);break;default:Mt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return $o(r,i.default,e.default)}Ut.register(Uo,{error:[{kind:"error"},[gt],(i,[e])=>{throw new Ve(e.evaluate(i))}],typeof:[gt,[ht],(i,[e])=>Bt(me(e.evaluate(i)))],"to-rgba":[qn(Pe,4),[Mn],(i,[e])=>e.evaluate(i).toArray()],rgb:[Mn,[Pe,Pe,Pe],wc],rgba:[Mn,[Pe,Pe,Pe,Pe],wc],has:{type:pt,overloads:[[[gt],(i,[e])=>bc(e.evaluate(i),i.properties())],[[gt,Nr],(i,[e,r])=>bc(e.evaluate(i),r.evaluate(i))]]},get:{type:ht,overloads:[[[gt],(i,[e])=>Ta(e.evaluate(i),i.properties())],[[gt,Nr],(i,[e,r])=>Ta(e.evaluate(i),r.evaluate(i))]]},"feature-state":[ht,[gt],(i,[e])=>Ta(e.evaluate(i),i.featureState||{})],properties:[Nr,[],i=>i.properties()],"geometry-type":[gt,[],i=>i.geometryType()],id:[ht,[],i=>i.id()],zoom:[Pe,[],i=>i.globals.zoom],"heatmap-density":[Pe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Pe,[],i=>i.globals.lineProgress||0],accumulated:[ht,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Pe,oo(Pe),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[Pe,oo(Pe),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:Pe,overloads:[[[Pe,Pe],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Pe],(i,[e])=>-e.evaluate(i)]]},"/":[Pe,[Pe,Pe],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Pe,[Pe,Pe],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Pe,[],()=>Math.LN2],pi:[Pe,[],()=>Math.PI],e:[Pe,[],()=>Math.E],"^":[Pe,[Pe,Pe],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Pe,[Pe],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))],log2:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Pe,[Pe],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Pe,[Pe],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Pe,[Pe],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Pe,[Pe],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Pe,[Pe],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Pe,[Pe],(i,[e])=>Math.atan(e.evaluate(i))],min:[Pe,oo(Pe),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Pe,oo(Pe),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Pe,[Pe],(i,[e])=>Math.abs(e.evaluate(i))],round:[Pe,[Pe],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Pe,[Pe],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Pe,[Pe],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[pt,[gt,ht],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[pt,[ht],(i,[e])=>i.id()===e.value],"filter-type-==":[pt,[gt],(i,[e])=>i.geometryType()===e.value],"filter-<":[pt,[gt,ht],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a<d}],"filter-id-<":[pt,[ht],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[pt,[gt,ht],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a>d}],"filter-id->":[pt,[ht],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[pt,[gt,ht],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a<=d}],"filter-id-<=":[pt,[ht],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[pt,[gt,ht],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a>=d}],"filter-id->=":[pt,[ht],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[pt,[ht],(i,[e])=>e.value in i.properties()],"filter-has-id":[pt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[pt,[qn(gt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[pt,[qn(ht)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[pt,[gt,qn(ht)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[pt,[gt,qn(ht)],(i,[e,r])=>function(a,d,f,y){for(;f<=y;){const v=f+y>>1;if(d[v]===a)return!0;d[v]>a?y=v-1:f=v+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:pt,overloads:[[[pt,pt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[oo(pt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:pt,overloads:[[[pt,pt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[oo(pt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[pt,[pt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[pt,[gt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[gt,[gt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[gt,[gt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[gt,oo(ht),(i,e)=>e.map(r=>We(r.evaluate(i))).join("")],"resolved-locale":[gt,[xr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ka{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Ct,this._defaultValue=r?function(a){return a.type==="color"&&jt(a.default)?new N(0,0,0,0):a.type==="color"?N.parse(a.default)||null:a.type==="padding"?Y.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,d,f,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=d,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,d,f,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=d,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Ve(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function As(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Uo}function Ds(i,e){const r=new Oo(Uo,[],e?function(d){const f={color:Mn,string:gt,number:Pe,enum:gt,boolean:pt,formatted:Sn,padding:Do,resolvedImage:pn};return d.type==="array"?qn(f[d.value]||ht,d.length):f[d.type]}(e):void 0),a=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Sc(new ka(a,e)):Vo(r.errors)}class Ls{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Fo(r.expression)}evaluateWithoutErrorHandling(e,r,a,d,f,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,d,f,y)}evaluate(e,r,a,d,f,y){return this._styleExpression.evaluate(e,r,a,d,f,y)}}class Nl{constructor(e,r,a,d){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Fo(r.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,r,a,d,f,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,d,f,y)}evaluate(e,r,a,d,f,y){return this._styleExpression.evaluate(e,r,a,d,f,y)}interpolationFactor(e,r,a){return this.interpolationType?gi.interpolationFactor(this.interpolationType,e,r,a):0}}function kc(i,e){const r=Ds(i,e);if(r.result==="error")return r;const a=r.value.expression,d=ks(a);if(!d&&!qt(e))return Vo([new fi("","data expressions not supported")]);const f=ga(a,["zoom"]);if(!f&&!Ec(e))return Vo([new fi("","zoom expressions not supported")]);const y=Ia(a);return y||f?y instanceof fi?Vo([y]):y instanceof gi&&!bt(e)?Vo([new fi("",'"interpolate" expressions cannot be used with this property')]):Sc(y?new Nl(d?"camera":"composite",r.value,y.labels,y instanceof gi?y.interpolation:void 0):new Ls(d?"constant":"source",r.value)):Vo([new fi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ca{constructor(e,r){this._parameters=e,this._specification=r,Vi(this,Ms(this._parameters,this._specification))}static deserialize(e){return new Ca(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ia(i){let e=null;if(i instanceof wa)e=Ia(i.result);else if(i instanceof va){for(const r of i.args)if(e=Ia(r),e)break}else(i instanceof Cs||i instanceof gi)&&i.input instanceof Ut&&i.input.name==="zoom"&&(e=i);return e instanceof fi||i.eachChild(r=>{const a=Ia(r);a instanceof fi?e=a:!e&&a?e=new fi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new fi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function $i(i){const e=i.key,r=i.value,a=i.valueSpec||{},d=i.objectElementValidators||{},f=i.style,y=i.styleSpec;let v=[];const b=Mt(r);if(b!=="object")return[new Re(e,r,`object expected, ${b} found`)];for(const T in r){const I=T.split(".")[0],M=a[I]||a["*"];let L;if(d[I])L=d[I];else if(a[I])L=_i;else if(d["*"])L=d["*"];else{if(!a["*"]){v.push(new Re(e,r[T],`unknown property "${T}"`));continue}L=_i}v=v.concat(L({key:(e&&`${e}.`)+T,value:r[T],valueSpec:M,style:f,styleSpec:y,object:r,objectKey:T},r))}for(const T in a)d[T]||a[T].required&&a[T].default===void 0&&r[T]===void 0&&v.push(new Re(e,r,`missing required property "${T}"`));return v}function Cc(i){const e=i.value,r=i.valueSpec,a=i.style,d=i.styleSpec,f=i.key,y=i.arrayElementValidator||_i;if(Mt(e)!=="array")return[new Re(f,e,`array expected, ${Mt(e)} found`)];if(r.length&&e.length!==r.length)return[new Re(f,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Re(f,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let v={type:r.value,values:r.values};d.$version<7&&(v.function=r.function),Mt(r.value)==="object"&&(v=r.value);let b=[];for(let T=0;T<e.length;T++)b=b.concat(y({array:e,arrayIndex:T,value:e[T],valueSpec:v,style:a,styleSpec:d,key:`${f}[${T}]`}));return b}function Ul(i){const e=i.key,r=i.value,a=i.valueSpec;let d=Mt(r);return d==="number"&&r!=r&&(d="NaN"),d!=="number"?[new Re(e,r,`number expected, ${d} found`)]:"minimum"in a&&r<a.minimum?[new Re(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new Re(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function Ic(i){const e=i.valueSpec,r=Tt(i.value.type);let a,d,f,y={};const v=r!=="categorical"&&i.value.property===void 0,b=!v,T=Mt(i.value.stops)==="array"&&Mt(i.value.stops[0])==="array"&&Mt(i.value.stops[0][0])==="object",I=$i({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(B){if(r==="identity")return[new Re(B.key,B.value,'identity function may not have a "stops" property')];let F=[];const H=B.value;return F=F.concat(Cc({key:B.key,value:H,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:M})),Mt(H)==="array"&&H.length===0&&F.push(new Re(B.key,H,"array must have at least one stop")),F},default:function(B){return _i({key:B.key,value:B.value,valueSpec:e,style:B.style,styleSpec:B.styleSpec})}}});return r==="identity"&&v&&I.push(new Re(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||I.push(new Re(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!bt(i.valueSpec)&&I.push(new Re(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!qt(i.valueSpec)?I.push(new Re(i.key,i.value,"property functions not supported")):v&&!Ec(i.valueSpec)&&I.push(new Re(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!T||i.value.property!==void 0||I.push(new Re(i.key,i.value,'"property" property is required')),I;function M(B){let F=[];const H=B.value,q=B.key;if(Mt(H)!=="array")return[new Re(q,H,`array expected, ${Mt(H)} found`)];if(H.length!==2)return[new Re(q,H,`array length 2 expected, length ${H.length} found`)];if(T){if(Mt(H[0])!=="object")return[new Re(q,H,`object expected, ${Mt(H[0])} found`)];if(H[0].zoom===void 0)return[new Re(q,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new Re(q,H,"object stop key must have value")];if(f&&f>Tt(H[0].zoom))return[new Re(q,H[0].zoom,"stop zoom values must appear in ascending order")];Tt(H[0].zoom)!==f&&(f=Tt(H[0].zoom),d=void 0,y={}),F=F.concat($i({key:`${q}[0]`,value:H[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Ul,value:L}}))}else F=F.concat(L({key:`${q}[0]`,value:H[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},H));return As(zi(H[1]))?F.concat([new Re(`${q}[1]`,H[1],"expressions are not allowed in function stops.")]):F.concat(_i({key:`${q}[1]`,value:H[1],valueSpec:e,style:B.style,styleSpec:B.styleSpec}))}function L(B,F){const H=Mt(B.value),q=Tt(B.value),oe=B.value!==null?B.value:F;if(a){if(H!==a)return[new Re(B.key,oe,`${H} stop domain type must match previous stop domain type ${a}`)]}else a=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new Re(B.key,oe,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&r!=="categorical"){let fe=`number expected, ${H} found`;return qt(e)&&r===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(B.key,oe,fe)]}return r!=="categorical"||H!=="number"||isFinite(q)&&Math.floor(q)===q?r!=="categorical"&&H==="number"&&d!==void 0&&q<d?[new Re(B.key,oe,"stop domain values must appear in ascending order")]:(d=q,r==="categorical"&&q in y?[new Re(B.key,oe,"stop domain values must be unique")]:(y[q]=!0,[])):[new Re(B.key,oe,`integer expected, found ${q}`)]}}function so(i){const e=(i.expressionContext==="property"?kc:Ds)(zi(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new Re(`${i.key}${a.key}`,i.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Re(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Fo(r))return[new Re(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Fo(r))return[new Re(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ga(r,["zoom","feature-state"]))return[new Re(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ks(r))return[new Re(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Rs(i){const e=i.key,r=i.value,a=i.valueSpec,d=[];return Array.isArray(a.values)?a.values.indexOf(Tt(r))===-1&&d.push(new Re(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Tt(r))===-1&&d.push(new Re(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),d}function jo(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!jo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Wd={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function za(i){if(i==null)return{filter:()=>!0,needGeometry:!1};jo(i)||(i=Bs(i));const e=Ds(i,Wd);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,d)=>e.value.evaluate(r,a,{},d),needGeometry:Pc(i)}}function zc(i,e){return i<e?-1:i>e?1:0}function Pc(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Pc(i[e]))return!0;return!1}function Bs(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Vl(i[1],i[2],"=="):e==="!="?Go(Vl(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Vl(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Bs))):e==="all"?["all"].concat(i.slice(1).map(Bs)):e==="none"?["all"].concat(i.slice(1).map(Bs).map(Go)):e==="in"?Pa(i[1],i.slice(2)):e==="!in"?Go(Pa(i[1],i.slice(2))):e==="has"?Fs(i[1]):e==="!has"?Go(Fs(i[1])):e!=="within"||i;var r}function Vl(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Pa(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(zc)]]:["filter-in-small",i,["literal",e]]}}function Fs(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Go(i){return["!",i]}function Os(i){return jo(zi(i.value))?so(Vi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Mc(i)}function Mc(i){const e=i.value,r=i.key;if(Mt(e)!=="array")return[new Re(r,e,`array expected, ${Mt(e)} found`)];const a=i.styleSpec;let d,f=[];if(e.length<1)return[new Re(r,e,"filter array must have at least 1 element")];switch(f=f.concat(Rs({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),Tt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Tt(e[1])==="$type"&&f.push(new Re(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new Re(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=Mt(e[1]),d!=="string"&&f.push(new Re(`${r}[1]`,e[1],`string expected, ${d} found`)));for(let y=2;y<e.length;y++)d=Mt(e[y]),Tt(e[1])==="$type"?f=f.concat(Rs({key:`${r}[${y}]`,value:e[y],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&f.push(new Re(`${r}[${y}]`,e[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)f=f.concat(Mc({key:`${r}[${y}]`,value:e[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=Mt(e[1]),e.length!==2?f.push(new Re(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&f.push(new Re(`${r}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=Mt(e[1]),e.length!==2?f.push(new Re(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="object"&&f.push(new Re(`${r}[1]`,e[1],`object expected, ${d} found`))}return f}function Ns(i,e){const r=i.key,a=i.style,d=i.styleSpec,f=i.value,y=i.objectKey,v=d[`${e}_${i.layerType}`];if(!v)return[];const b=y.match(/^(.*)-transition$/);if(e==="paint"&&b&&v[b[1]]&&v[b[1]].transition)return _i({key:r,value:f,valueSpec:d.transition,style:a,styleSpec:d});const T=i.valueSpec||v[y];if(!T)return[new Re(r,f,`unknown property "${y}"`)];let I;if(Mt(f)==="string"&&qt(T)&&!T.tokens&&(I=/^{([^}]+)}$/.exec(f)))return[new Re(r,f,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const M=[];return i.layerType==="symbol"&&(y==="text-field"&&a&&!a.glyphs&&M.push(new Re(r,f,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&jt(zi(f))&&Tt(f.type)==="identity"&&M.push(new Re(r,f,'"text-font" does not support identity functions'))),M.concat(_i({key:i.key,value:f,valueSpec:T,style:a,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function Ac(i){return Ns(i,"paint")}function Dc(i){return Ns(i,"layout")}function Lc(i){let e=[];const r=i.value,a=i.key,d=i.style,f=i.styleSpec;r.type||r.ref||e.push(new Re(a,r,'either "type" or "ref" is required'));let y=Tt(r.type);const v=Tt(r.ref);if(r.id){const b=Tt(r.id);for(let T=0;T<i.arrayIndex;T++){const I=d.layers[T];Tt(I.id)===b&&e.push(new Re(a,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(T=>{T in r&&e.push(new Re(a,r[T],`"${T}" is prohibited for ref layers`))}),d.layers.forEach(T=>{Tt(T.id)===v&&(b=T)}),b?b.ref?e.push(new Re(a,r.ref,"ref cannot reference another ref layer")):y=Tt(b.type):e.push(new Re(a,r.ref,`ref layer "${v}" not found`))}else if(y!=="background")if(r.source){const b=d.sources&&d.sources[r.source],T=b&&Tt(b.type);b?T==="vector"&&y==="raster"?e.push(new Re(a,r.source,`layer "${r.id}" requires a raster source`)):T==="raster"&&y!=="raster"?e.push(new Re(a,r.source,`layer "${r.id}" requires a vector source`)):T!=="vector"||r["source-layer"]?T==="raster-dem"&&y!=="hillshade"?e.push(new Re(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!r.paint||!r.paint["line-gradient"]||T==="geojson"&&b.lineMetrics||e.push(new Re(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Re(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Re(a,r.source,`source "${r.source}" not found`))}else e.push(new Re(a,r,'missing required property "source"'));return e=e.concat($i({key:a,value:r,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>_i({key:`${a}.type`,value:r.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:Os,layout:b=>$i({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>Dc(Vi({layerType:y},T))}}),paint:b=>$i({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>Ac(Vi({layerType:y},T))}})}})),e}function Zo(i){const e=i.value,r=i.key,a=Mt(e);return a!=="string"?[new Re(r,e,`string expected, ${a} found`)]:[]}const Rc={promoteId:function({key:i,value:e}){if(Mt(e)==="string")return Zo({key:i,value:e});{const r=[];for(const a in e)r.push(...Zo({key:`${i}.${a}`,value:e[a]}));return r}}};function Us(i){const e=i.value,r=i.key,a=i.styleSpec,d=i.style;if(!e.type)return[new Re(r,e,'"type" is required')];const f=Tt(e.type);let y;switch(f){case"vector":case"raster":case"raster-dem":return y=$i({key:r,value:e,valueSpec:a[`source_${f.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:Rc}),y;case"geojson":if(y=$i({key:r,value:e,valueSpec:a.source_geojson,style:d,styleSpec:a,objectElementValidators:Rc}),e.cluster)for(const v in e.clusterProperties){const[b,T]=e.clusterProperties[v],I=typeof b=="string"?[b,["accumulated"],["get",v]]:b;y.push(...so({key:`${r}.${v}.map`,value:T,expressionContext:"cluster-map"})),y.push(...so({key:`${r}.${v}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return y;case"video":return $i({key:r,value:e,valueSpec:a.source_video,style:d,styleSpec:a});case"image":return $i({key:r,value:e,valueSpec:a.source_image,style:d,styleSpec:a});case"canvas":return[new Re(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:a})}}function Vs(i){const e=i.value,r=i.styleSpec,a=r.light,d=i.style;let f=[];const y=Mt(e);if(e===void 0)return f;if(y!=="object")return f=f.concat([new Re("light",e,`object expected, ${y} found`)]),f;for(const v in e){const b=v.match(/^(.*)-transition$/);f=f.concat(b&&a[b[1]]&&a[b[1]].transition?_i({key:v,value:e[v],valueSpec:r.transition,style:d,styleSpec:r}):a[v]?_i({key:v,value:e[v],valueSpec:a[v],style:d,styleSpec:r}):[new Re(v,e[v],`unknown property "${v}"`)])}return f}function yi(i){const e=i.value,r=i.styleSpec,a=r.terrain,d=i.style;let f=[];const y=Mt(e);if(e===void 0)return f;if(y!=="object")return f=f.concat([new Re("terrain",e,`object expected, ${y} found`)]),f;for(const v in e)f=f.concat(a[v]?_i({key:v,value:e[v],valueSpec:a[v],style:d,styleSpec:r}):[new Re(v,e[v],`unknown property "${v}"`)]);return f}const $s={"*":()=>[],array:Cc,boolean:function(i){const e=i.value,r=i.key,a=Mt(e);return a!=="boolean"?[new Re(r,e,`boolean expected, ${a} found`)]:[]},number:Ul,color:function(i){const e=i.key,r=i.value,a=Mt(r);return a!=="string"?[new Re(e,r,`color expected, ${a} found`)]:Ro(r)===null?[new Re(e,r,`color expected, "${r}" found`)]:[]},constants:eo,enum:Rs,filter:Os,function:Ic,layer:Lc,object:$i,source:Us,light:Vs,terrain:yi,string:Zo,formatted:function(i){return Zo(i).length===0?[]:so(i)},resolvedImage:function(i){return Zo(i).length===0?[]:so(i)},padding:function(i){const e=i.key,r=i.value;if(Mt(r)==="array"){if(r.length<1||r.length>4)return[new Re(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let d=[];for(let f=0;f<r.length;f++)d=d.concat(_i({key:`${e}[${f}]`,value:r[f],valueSpec:a}));return d}return Ul({key:e,value:r,valueSpec:{}})}};function _i(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return r.expression&&jt(Tt(e))?Ic(i):r.expression&&As(zi(e))?so(i):r.type&&$s[r.type]?$s[r.type](i):$i(Vi({},i,{valueSpec:r.type?a[r.type]:r}))}function Xd(i){const e=i.value,r=i.key,a=Zo(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Re(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Re(r,e,'"glyphs" url must include a "{range}" token'))),a}function Ur(i,e=ve){let r=[];return r=r.concat(_i({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Xd,"*":()=>[]}})),i.constants&&(r=r.concat(eo({key:"constants",value:i.constants,style:i,styleSpec:e}))),Bc(r)}function Bc(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function vr(i){return function(...e){return Bc(i.apply(this,e))}}Ur.source=vr(Us),Ur.light=vr(Vs),Ur.terrain=vr(yi),Ur.layer=vr(Lc),Ur.filter=vr(Os),Ur.paintProperty=vr(Ac),Ur.layoutProperty=vr(Dc);const js=Ur,$l=js.light,Hd=js.paintProperty,Kd=js.layoutProperty;function Ma(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new Ao(new Error(a.message))),r=!0;return r}class Gs{constructor(e,r,a){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(r=y[1])+2*(a=y[2]);for(let b=0;b<this.d*this.d;b++){const T=y[3+b],I=y[3+b+1];d.push(T===I?null:y.subarray(T,I))}const v=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],v),this.bboxes=y.subarray(v),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let y=0;y<this.d*this.d;y++)d.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const f=a/r*e;this.min=-f,this.max=e+f}insert(e,r,a,d,f){this._forEachCell(r,a,d,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,d,f,y){this.cells[f].push(y)}query(e,r,a,d,f){const y=this.min,v=this.max;if(e<=y&&r<=y&&v<=a&&v<=d&&!f)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(e,r,a,d,this._queryCell,b,{},f),b}}_queryCell(e,r,a,d,f,y,v,b){const T=this.cells[f];if(T!==null){const I=this.keys,M=this.bboxes;for(let L=0;L<T.length;L++){const B=T[L];if(v[B]===void 0){const F=4*B;(b?b(M[F+0],M[F+1],M[F+2],M[F+3]):e<=M[F+2]&&r<=M[F+3]&&a>=M[F+0]&&d>=M[F+1])?(v[B]=!0,y.push(I[B])):v[B]=!1}}}}_forEachCell(e,r,a,d,f,y,v,b){const T=this._convertToCellCoord(e),I=this._convertToCellCoord(r),M=this._convertToCellCoord(a),L=this._convertToCellCoord(d);for(let B=T;B<=M;B++)for(let F=I;F<=L;F++){const H=this.d*F+B;if((!b||b(this._convertFromCellCoord(B),this._convertFromCellCoord(F),this._convertFromCellCoord(B+1),this._convertFromCellCoord(F+1)))&&f.call(this,e,r,a,d,H,y,v,b))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const d=new Int32Array(r+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let f=r;for(let y=0;y<e.length;y++){const v=e[y];d[3+y]=f,d.set(v,f),f+=v.length}return d[3+e.length]=f,d.set(this.keys,f),f+=this.keys.length,d[3+e.length+1]=f,d.set(this.bboxes,f),f+=this.bboxes.length,d.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new Gs(e.buffer)}}const wr={};function qe(i,e,r={}){if(wr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),wr[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}qe("Object",Object),qe("TransferableGridIndex",Gs),qe("Color",N),qe("Error",Error),qe("AJAXError",pi),qe("ResolvedImage",ne),qe("StylePropertyFunction",Ca),qe("StyleExpression",ka,{omit:["_evaluator"]}),qe("ZoomDependentExpression",Nl),qe("ZoomConstantExpression",Ls),qe("CompoundExpression",Ut,{omit:["_evaluate"]});for(const i in Uo)Uo[i]._classRegistryKey||qe(`Expression_${i}`,Uo[i]);function Fc(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ao(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Fc(i)||Ni(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const a of i)r.push(ao(a,e));return r}if(typeof i=="object"){const r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!wr[a])throw new Error(`${a} is not registered.`);const d=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||wr[a].omit.indexOf(f)>=0)continue;const y=i[f];d[f]=wr[a].shallow.indexOf(f)>=0?y:ao(y,e)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(d.$name=a),d}throw new Error("can't serialize object of type "+typeof i)}function Vr(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Fc(i)||Ni(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Vr);if(typeof i=="object"){const e=i.$name||"Object";if(!wr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=wr[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const d of Object.keys(i)){if(d==="$name")continue;const f=i[d];a[d]=wr[e].shallow.indexOf(d)>=0?f:Vr(f)}return a}throw new Error("can't deserialize object of type "+typeof i)}class jl{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Oe={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Aa(i){for(const e of i)if(Zl(e.charCodeAt(0)))return!0;return!1}function Yd(i){for(const e of i)if(!Gl(e.charCodeAt(0)))return!1;return!0}function Gl(i){return!(Oe.Arabic(i)||Oe["Arabic Supplement"](i)||Oe["Arabic Extended-A"](i)||Oe["Arabic Presentation Forms-A"](i)||Oe["Arabic Presentation Forms-B"](i))}function Zl(i){return!(i!==746&&i!==747&&(i<4352||!(Oe["Bopomofo Extended"](i)||Oe.Bopomofo(i)||Oe["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Oe["CJK Compatibility Ideographs"](i)||Oe["CJK Compatibility"](i)||Oe["CJK Radicals Supplement"](i)||Oe["CJK Strokes"](i)||!(!Oe["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Oe["CJK Unified Ideographs Extension A"](i)||Oe["CJK Unified Ideographs"](i)||Oe["Enclosed CJK Letters and Months"](i)||Oe["Hangul Compatibility Jamo"](i)||Oe["Hangul Jamo Extended-A"](i)||Oe["Hangul Jamo Extended-B"](i)||Oe["Hangul Jamo"](i)||Oe["Hangul Syllables"](i)||Oe.Hiragana(i)||Oe["Ideographic Description Characters"](i)||Oe.Kanbun(i)||Oe["Kangxi Radicals"](i)||Oe["Katakana Phonetic Extensions"](i)||Oe.Katakana(i)&&i!==12540||!(!Oe["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Oe["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Oe["Unified Canadian Aboriginal Syllabics"](i)||Oe["Unified Canadian Aboriginal Syllabics Extended"](i)||Oe["Vertical Forms"](i)||Oe["Yijing Hexagram Symbols"](i)||Oe["Yi Syllables"](i)||Oe["Yi Radicals"](i))))}function Oc(i){return!(Zl(i)||function(e){return!!(Oe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Oe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Oe["Letterlike Symbols"](e)||Oe["Number Forms"](e)||Oe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Oe["Control Pictures"](e)&&e!==9251||Oe["Optical Character Recognition"](e)||Oe["Enclosed Alphanumerics"](e)||Oe["Geometric Shapes"](e)||Oe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Oe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Oe["CJK Symbols and Punctuation"](e)||Oe.Katakana(e)||Oe["Private Use Area"](e)||Oe["CJK Compatibility Forms"](e)||Oe["Small Form Variants"](e)||Oe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Nc(i){return i>=1424&&i<=2303||Oe["Arabic Presentation Forms-A"](i)||Oe["Arabic Presentation Forms-B"](i)}function Jd(i,e){return!(!e&&Nc(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Oe.Khmer(i))}function Uc(i){for(const e of i)if(Nc(e.charCodeAt(0)))return!0;return!1}const ql="deferred",Wl="loading",Xl="loaded";let Hl=null,ni="unavailable",$r=null;const Vc=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(ni="error"),Hl&&Hl(i)};function qo(){Kl.fire(new yr("pluginStateChange",{pluginStatus:ni,pluginURL:$r}))}const Kl=new _r,Zs=function(){return ni},$c=function(){if(ni!==ql||!$r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ni=Wl,qo(),$r&&Mo({url:$r},i=>{i?Vc(i):(ni=Xl,qo())})},Pi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ni===Xl||Pi.applyArabicShaping!=null,isLoading:()=>ni===Wl,setState(i){if(!Qe())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");ni=i.pluginStatus,$r=i.pluginURL},isParsed(){if(!Qe())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Pi.applyArabicShaping!=null&&Pi.processBidirectionalText!=null&&Pi.processStyledBidirectionalText!=null},getPluginURL(){if(!Qe())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return $r}};class Jt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new jl,this.transition={})}isSupportedScript(e){return function(r,a){for(const d of r)if(!Jd(d.charCodeAt(0),a))return!1;return!0}(e,Pi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class qs{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,d){if(jt(a))return new Ca(a,d);if(As(a)){const f=kc(a,d);if(f.result==="error")throw new Error(f.value.map(y=>`${y.key}: ${y.message}`).join(", "));return f.value}{let f=a;return d.type==="color"&&typeof a=="string"?f=N.parse(a):d.type!=="padding"||typeof a!="number"&&!Array.isArray(a)||(f=Y.parse(a)),{kind:"constant",evaluate:()=>f}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class Da{constructor(e){this.property=e,this.value=new qs(e,void 0)}transitioned(e,r){return new Gc(this.property,this.value,r,Le({},e.transition,this.transition),e.now)}untransitioned(){return new Gc(this.property,this.value,null,{},0)}}class jc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return se(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Da(this._values[e].property)),this._values[e].value=new qs(this._values[e].property,r===null?void 0:se(r))}getTransition(e){return se(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Da(this._values[e].property)),this._values[e].transition=se(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const d=this.getTransition(r);d!==void 0&&(e[`${r}-transition`]=d)}return e}transitioned(e,r){const a=new Zc(this._properties);for(const d of Object.keys(this._values))a._values[d]=this._values[d].transitioned(e,r._values[d]);return a}untransitioned(){const e=new Zc(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Gc{constructor(e,r,a,d,f){this.property=e,this.value=r,this.begin=f+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const d=e.now||0,f=this.value.possiblyEvaluate(e,r,a),y=this.prior;if(y){if(d>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(d<this.begin)return y.possiblyEvaluate(e,r,a);{const v=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,r,a),f,function(b){if(b<=0)return 0;if(b>=1)return 1;const T=b*b,I=T*b;return 4*(b<.5?I:3*(b-T)+I-.75)}(v))}}return f}}class Zc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const d=new Ws(this._properties);for(const f of Object.keys(this._values))d._values[f]=this._values[f].possiblyEvaluate(e,r,a);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Qd{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return se(this._values[e].value)}setValue(e,r){this._values[e]=new qs(this._values[e].property,r===null?void 0:se(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const d=new Ws(this._properties);for(const f of Object.keys(this._values))d._values[f]=this._values[f].possiblyEvaluate(e,r,a);return d}}class ir{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,d){return this.property.evaluate(this.value,this.parameters,e,r,a,d)}}class Ws{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ye{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const d=Is[this.specification.type];return d?d(e,r,a):e}}class ot{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,d){return new ir(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,d)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ir(this,{kind:"constant",value:void 0},e.parameters);const d=Is[this.specification.type];return d?new ir(this,{kind:"constant",value:d(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,d,f,y){return e.kind==="constant"?e.value:e.evaluate(r,a,d,f,y)}}class Wo extends ot{possiblyEvaluate(e,r,a,d){if(e.value===void 0)return new ir(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},a,d),y=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,v=this._calculate(y,y,y,r);return new ir(this,{kind:"constant",value:v},r)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new ir(this,{kind:"constant",value:f},r)}return new ir(this,e.expression,r)}evaluate(e,r,a,d,f,y){if(e.kind==="source"){const v=e.evaluate(r,a,d,f,y);return this._calculate(v,v,v,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,d),e.evaluate({zoom:Math.floor(r.zoom)},a,d),e.evaluate({zoom:Math.floor(r.zoom)+1},a,d),r):e.value}_calculate(e,r,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class Yl{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},a,d);return this._calculate(f,f,f,r)}return this._calculate(e.expression.evaluate(new Jt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Jt(Math.floor(r.zoom),r)),e.expression.evaluate(new Jt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class jr{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,d){return!!e.expression.evaluate(r,null,{},a,d)}interpolate(){return!1}}class An{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const d=this.defaultPropertyValues[r]=new qs(a,void 0),f=this.defaultTransitionablePropertyValues[r]=new Da(a);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=d.possiblyEvaluate({})}}}qe("DataDrivenProperty",ot),qe("DataConstantProperty",Ye),qe("CrossFadedDataDrivenProperty",Wo),qe("CrossFadedProperty",Yl),qe("ColorRampProperty",jr);const Gr="-transition";class rr extends _r{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Qd(r.layout)),r.paint)){this._transitionablePaint=new jc(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ws(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(Kd,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Gr)?this._transitionablePaint.getTransition(e.slice(0,-Gr.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(Hd,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(Gr))return this._transitionablePaint.setTransition(e.slice(0,-Gr.length),r||void 0),!1;{const d=this._transitionablePaint._values[e],f=d.property.specification["property-type"]==="cross-faded-data-driven",y=d.value.isDataDriven(),v=d.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||y||f||this._handleOverridablePaintPropertyUpdate(e,v,b)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ee(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,d,f={}){return(!f||f.validate!==!1)&&Ma(this,e.call(js,{key:r,layerType:this.type,objectKey:a,value:d,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ir&&qt(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const qc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zr{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function fn(i,e=1){let r=0,a=0;return{members:i.map(d=>{const f=qc[d.type].BYTES_PER_ELEMENT,y=r=Jl(r,Math.max(e,f)),v=d.components||1;return a=Math.max(a,f),r+=f*v,{name:d.name,type:d.type,components:v,offset:y}}),size:Jl(r,Math.max(a,e)),alignment:e}}function Jl(i,e){return Math.ceil(i/e)*e}class lo extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const d=2*e;return this.int16[d+0]=r,this.int16[d+1]=a,e}}lo.prototype.bytesPerElement=4,qe("StructArrayLayout2i4",lo);class h extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,d)}emplace(e,r,a,d,f){const y=4*e;return this.int16[y+0]=r,this.int16[y+1]=a,this.int16[y+2]=d,this.int16[y+3]=f,e}}h.prototype.bytesPerElement=8,qe("StructArrayLayout4i8",h);class t extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,f,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,d,f,y)}emplace(e,r,a,d,f,y,v){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=d,this.int16[b+3]=f,this.int16[b+4]=y,this.int16[b+5]=v,e}}t.prototype.bytesPerElement=12,qe("StructArrayLayout2i4i12",t);class s extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,f,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,d,f,y)}emplace(e,r,a,d,f,y,v){const b=4*e,T=8*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.uint8[T+4]=d,this.uint8[T+5]=f,this.uint8[T+6]=y,this.uint8[T+7]=v,e}}s.prototype.bytesPerElement=8,qe("StructArrayLayout2i4ub8",s);class c extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const d=2*e;return this.float32[d+0]=r,this.float32[d+1]=a,e}}c.prototype.bytesPerElement=8,qe("StructArrayLayout2f8",c);class p extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,f,y,v,b,T,I){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,a,d,f,y,v,b,T,I)}emplace(e,r,a,d,f,y,v,b,T,I,M){const L=10*e;return this.uint16[L+0]=r,this.uint16[L+1]=a,this.uint16[L+2]=d,this.uint16[L+3]=f,this.uint16[L+4]=y,this.uint16[L+5]=v,this.uint16[L+6]=b,this.uint16[L+7]=T,this.uint16[L+8]=I,this.uint16[L+9]=M,e}}p.prototype.bytesPerElement=20,qe("StructArrayLayout10ui20",p);class g extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,f,y,v,b,T,I,M,L){const B=this.length;return this.resize(B+1),this.emplace(B,e,r,a,d,f,y,v,b,T,I,M,L)}emplace(e,r,a,d,f,y,v,b,T,I,M,L,B){const F=12*e;return this.int16[F+0]=r,this.int16[F+1]=a,this.int16[F+2]=d,this.int16[F+3]=f,this.uint16[F+4]=y,this.uint16[F+5]=v,this.uint16[F+6]=b,this.uint16[F+7]=T,this.int16[F+8]=I,this.int16[F+9]=M,this.int16[F+10]=L,this.int16[F+11]=B,e}}g.prototype.bytesPerElement=24,qe("StructArrayLayout4i4ui4i24",g);class x extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const f=3*e;return this.float32[f+0]=r,this.float32[f+1]=a,this.float32[f+2]=d,e}}x.prototype.bytesPerElement=12,qe("StructArrayLayout3f12",x);class S extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}S.prototype.bytesPerElement=4,qe("StructArrayLayout1ul4",S);class E extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,f,y,v,b,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,a,d,f,y,v,b,T)}emplace(e,r,a,d,f,y,v,b,T,I){const M=10*e,L=5*e;return this.int16[M+0]=r,this.int16[M+1]=a,this.int16[M+2]=d,this.int16[M+3]=f,this.int16[M+4]=y,this.int16[M+5]=v,this.uint32[L+3]=b,this.uint16[M+8]=T,this.uint16[M+9]=I,e}}E.prototype.bytesPerElement=20,qe("StructArrayLayout6i1ul2ui20",E);class k extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,f,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,d,f,y)}emplace(e,r,a,d,f,y,v){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=d,this.int16[b+3]=f,this.int16[b+4]=y,this.int16[b+5]=v,e}}k.prototype.bytesPerElement=12,qe("StructArrayLayout2i2i2i12",k);class P extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,d,f)}emplace(e,r,a,d,f,y){const v=4*e,b=8*e;return this.float32[v+0]=r,this.float32[v+1]=a,this.float32[v+2]=d,this.int16[b+6]=f,this.int16[b+7]=y,e}}P.prototype.bytesPerElement=16,qe("StructArrayLayout2f1f2i16",P);class D extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,d)}emplace(e,r,a,d,f){const y=12*e,v=3*e;return this.uint8[y+0]=r,this.uint8[y+1]=a,this.float32[v+1]=d,this.float32[v+2]=f,e}}D.prototype.bytesPerElement=12,qe("StructArrayLayout2ub2f12",D);class R extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const f=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=a,this.uint16[f+2]=d,e}}R.prototype.bytesPerElement=6,qe("StructArrayLayout3ui6",R);class G extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d,f,y,v,b,T,I,M,L,B,F,H,q,oe){const fe=this.length;return this.resize(fe+1),this.emplace(fe,e,r,a,d,f,y,v,b,T,I,M,L,B,F,H,q,oe)}emplace(e,r,a,d,f,y,v,b,T,I,M,L,B,F,H,q,oe,fe){const re=24*e,he=12*e,be=48*e;return this.int16[re+0]=r,this.int16[re+1]=a,this.uint16[re+2]=d,this.uint16[re+3]=f,this.uint32[he+2]=y,this.uint32[he+3]=v,this.uint32[he+4]=b,this.uint16[re+10]=T,this.uint16[re+11]=I,this.uint16[re+12]=M,this.float32[he+7]=L,this.float32[he+8]=B,this.uint8[be+36]=F,this.uint8[be+37]=H,this.uint8[be+38]=q,this.uint32[he+10]=oe,this.int16[re+22]=fe,e}}G.prototype.bytesPerElement=48,qe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",G);class $ extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d,f,y,v,b,T,I,M,L,B,F,H,q,oe,fe,re,he,be,we,Ge,Xe,Ne,Ae,ze,Ue){const Be=this.length;return this.resize(Be+1),this.emplace(Be,e,r,a,d,f,y,v,b,T,I,M,L,B,F,H,q,oe,fe,re,he,be,we,Ge,Xe,Ne,Ae,ze,Ue)}emplace(e,r,a,d,f,y,v,b,T,I,M,L,B,F,H,q,oe,fe,re,he,be,we,Ge,Xe,Ne,Ae,ze,Ue,Be){const Te=34*e,it=17*e;return this.int16[Te+0]=r,this.int16[Te+1]=a,this.int16[Te+2]=d,this.int16[Te+3]=f,this.int16[Te+4]=y,this.int16[Te+5]=v,this.int16[Te+6]=b,this.int16[Te+7]=T,this.uint16[Te+8]=I,this.uint16[Te+9]=M,this.uint16[Te+10]=L,this.uint16[Te+11]=B,this.uint16[Te+12]=F,this.uint16[Te+13]=H,this.uint16[Te+14]=q,this.uint16[Te+15]=oe,this.uint16[Te+16]=fe,this.uint16[Te+17]=re,this.uint16[Te+18]=he,this.uint16[Te+19]=be,this.uint16[Te+20]=we,this.uint16[Te+21]=Ge,this.uint16[Te+22]=Xe,this.uint32[it+12]=Ne,this.float32[it+13]=Ae,this.float32[it+14]=ze,this.float32[it+15]=Ue,this.float32[it+16]=Be,e}}$.prototype.bytesPerElement=68,qe("StructArrayLayout8i15ui1ul4f68",$);class j extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}j.prototype.bytesPerElement=4,qe("StructArrayLayout1f4",j);class Q extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const f=3*e;return this.int16[f+0]=r,this.int16[f+1]=a,this.int16[f+2]=d,e}}Q.prototype.bytesPerElement=6,qe("StructArrayLayout3i6",Q);class ie extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const f=4*e;return this.uint32[2*e+0]=r,this.uint16[f+2]=a,this.uint16[f+3]=d,e}}ie.prototype.bytesPerElement=8,qe("StructArrayLayout1ul2ui8",ie);class ue extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const d=2*e;return this.uint16[d+0]=r,this.uint16[d+1]=a,e}}ue.prototype.bytesPerElement=4,qe("StructArrayLayout2ui4",ue);class Z extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Z.prototype.bytesPerElement=2,qe("StructArrayLayout1ui2",Z);class de extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,d)}emplace(e,r,a,d,f){const y=4*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=d,this.float32[y+3]=f,e}}de.prototype.bytesPerElement=16,qe("StructArrayLayout4f16",de);class ce extends Zr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new st(this.anchorPointX,this.anchorPointY)}}ce.prototype.size=20;class _e extends E{get(e){return new ce(this,e)}}qe("CollisionBoxArray",_e);class xe extends Zr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}xe.prototype.size=48;class Ee extends G{get(e){return new xe(this,e)}}qe("PlacedSymbolArray",Ee);class ye extends Zr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}ye.prototype.size=68;class $e extends ${get(e){return new ye(this,e)}}qe("SymbolInstanceArray",$e);class Me extends j{getoffsetX(e){return this.float32[1*e+0]}}qe("GlyphOffsetArray",Me);class je extends Q{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}qe("SymbolLineVertexArray",je);class ft extends Zr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ft.prototype.size=8;class _t extends ie{get(e){return new ft(this,e)}}qe("FeatureIndexArray",_t);class nt extends lo{}class Dt extends lo{}class Lt extends lo{}class St extends t{}class It extends s{}class Ft extends c{}class Tn extends p{}class or extends g{}class ji extends x{}class sr extends S{}class qr extends k{}class Mi extends D{}class ii extends R{}class br extends ue{}const La=fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:xn}=La;class vt{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,d){let f=this.segments[this.segments.length-1];return e>vt.MAX_VERTEX_ARRAY_LENGTH&&De(`Max vertices per segment is ${vt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>vt.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==d)&&(f={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},d!==void 0&&(f.sortKey=d),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,d){return new vt([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:d,vaos:{},sortKey:0}])}}function At(i,e){return 256*(i=W(Math.floor(i),0,255))+W(Math.floor(e),0,255)}vt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qe("SegmentVector",vt);const kn=fn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Cn={exports:{}},Qt={exports:{}};Qt.exports=function(i,e){var r,a,d,f,y,v,b,T;for(a=i.length-(r=3&i.length),d=e,y=3432918353,v=461845907,T=0;T<a;)b=255&i.charCodeAt(T)|(255&i.charCodeAt(++T))<<8|(255&i.charCodeAt(++T))<<16|(255&i.charCodeAt(++T))<<24,++T,d=27492+(65535&(f=5*(65535&(d=(d^=b=(65535&(b=(b=(65535&b)*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&i.charCodeAt(T+2))<<16;case 2:b^=(255&i.charCodeAt(T+1))<<8;case 1:d^=b=(65535&(b=(b=(65535&(b^=255&i.charCodeAt(T)))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var Ai={exports:{}};Ai.exports=function(i,e){for(var r,a=i.length,d=e^a,f=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(f)|(255&i.charCodeAt(++f))<<8|(255&i.charCodeAt(++f))<<16|(255&i.charCodeAt(++f))<<24))+((1540483477*(r>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++f;switch(a){case 3:d^=(255&i.charCodeAt(f+2))<<16;case 2:d^=(255&i.charCodeAt(f+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(f)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var uo=Qt.exports,Ql=Ai.exports;Cn.exports=uo,Cn.exports.murmur3=uo,Cn.exports.murmur2=Ql;class Xo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,d){this.ids.push(Wc(e)),this.positions.push(r,a,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Wc(e);let a=0,d=this.ids.length-1;for(;a<d;){const y=a+d>>1;this.ids[y]>=r?d=y:a=y+1}const f=[];for(;this.ids[a]===r;)f.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return f}static serialize(e,r){const a=new Float64Array(e.ids),d=new Uint32Array(e.positions);return eu(a,d,0,a.length-1),r&&r.push(a.buffer,d.buffer),{ids:a,positions:d}}static deserialize(e){const r=new Xo;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Wc(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Cn.exports(String(i))}function eu(i,e,r,a){for(;r<a;){const d=i[r+a>>1];let f=r-1,y=a+1;for(;;){do f++;while(i[f]<d);do y--;while(i[y]>d);if(f>=y)break;Wr(i,f,y),Wr(e,3*f,3*y),Wr(e,3*f+1,3*y+1),Wr(e,3*f+2,3*y+2)}y-r<a-y?(eu(i,e,r,y),r=y+1):(eu(i,e,y+1,a),a=y)}}function Wr(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}qe("FeaturePositionMap",Xo);class co{constructor(e,r){this.gl=e.gl,this.location=r}}class ho extends co{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ra extends co{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ng extends co{constructor(e,r){super(e,r),this.current=N.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Q0=new Float32Array(16);function ep(i){return[At(255*i.r,255*i.g),At(255*i.b,255*i.a)]}class tu{constructor(e,r,a){this.value=e,this.uniformNames=r.map(d=>`u_${d}`),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new ng(e,r):new ho(e,r)}}class Ba{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,a,d){const f=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"?new Ra(e,r):new ho(e,r)}}class po{constructor(e,r,a,d){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,a,d,f){const y=this.paintVertexArray.length,v=this.expression.evaluate(new Jt(0),r,{},d,[],f);this.paintVertexArray.resize(e),this._setPaintValue(y,e,v)}updatePaintArray(e,r,a,d){const f=this.expression.evaluate({zoom:0},a,d);this._setPaintValue(e,r,f)}_setPaintValue(e,r,a){if(this.type==="color"){const d=ep(a);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sr{constructor(e,r,a,d,f,y){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=d,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,r,a,d,f){const y=this.expression.evaluate(new Jt(this.zoom),r,{},d,[],f),v=this.expression.evaluate(new Jt(this.zoom+1),r,{},d,[],f),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,y,v)}updatePaintArray(e,r,a,d){const f=this.expression.evaluate({zoom:this.zoom},a,d),y=this.expression.evaluate({zoom:this.zoom+1},a,d);this._setPaintValue(e,r,f,y)}_setPaintValue(e,r,a,d){if(this.type==="color"){const f=ep(a),y=ep(d);for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,f[0],f[1],y[0],y[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,a,d);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,d=W(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,r,a){return new ho(e,r)}}class Ho{constructor(e,r,a,d,f,y){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=d,this.layerId=y,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,r,a){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,d,f){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(e,r,a,d){if(!d||!a)return;const{min:f,mid:y,max:v}=a,b=d[f],T=d[y],I=d[v];if(b&&T&&I)for(let M=e;M<r;M++)this.zoomInPaintVertexArray.emplace(M,T.tl[0],T.tl[1],T.br[0],T.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],T.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,T.tl[0],T.tl[1],T.br[0],T.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],T.pixelRatio,I.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,kn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,kn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ig{constructor(e,r,a){this.binders={},this._buffers=[];const d=[];for(const f in e.paint._values){if(!a(f))continue;const y=e.paint.get(f);if(!(y instanceof ir&&qt(y.property.specification)))continue;const v=ev(f,e.type),b=y.value,T=y.property.specification.type,I=y.property.useIntegerZoom,M=y.property.specification["property-type"],L=M==="cross-faded"||M==="cross-faded-data-driven";if(b.kind==="constant")this.binders[f]=L?new Ba(b.value,v):new tu(b.value,v,T),d.push(`/u_${f}`);else if(b.kind==="source"||L){const B=rg(f,T,"source");this.binders[f]=L?new Ho(b,T,I,r,B,e.id):new po(b,v,T,B),d.push(`/a_${f}`)}else{const B=rg(f,T,"composite");this.binders[f]=new Sr(b,v,T,I,r,B),d.push(`/z_${f}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof po||r instanceof Sr?r.maxValue:0}populatePaintArrays(e,r,a,d,f){for(const y in this.binders){const v=this.binders[y];(v instanceof po||v instanceof Sr||v instanceof Ho)&&v.populatePaintArray(e,r,a,d,f)}}setConstantPatternPositions(e,r){for(const a in this.binders){const d=this.binders[a];d instanceof Ba&&d.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,d,f){let y=!1;for(const v in e){const b=r.getPositions(v);for(const T of b){const I=a.feature(T.index);for(const M in this.binders){const L=this.binders[M];if((L instanceof po||L instanceof Sr||L instanceof Ho)&&L.expression.isStateDependent===!0){const B=d.paint.get(M);L.expression=B.value,L.updatePaintArray(T.start,T.end,I,e[v],f),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof tu||a instanceof Ba)&&e.push(...a.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof po||a instanceof Sr)for(let d=0;d<a.paintVertexAttributes.length;d++)e.push(a.paintVertexAttributes[d].name);else if(a instanceof Ho)for(let d=0;d<kn.members.length;d++)e.push(kn.members[d].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof tu||a instanceof Ba||a instanceof Sr)for(const d of a.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const d in this.binders){const f=this.binders[d];if(f instanceof tu||f instanceof Ba||f instanceof Sr){for(const y of f.uniformNames)if(r[y]){const v=f.getBinding(e,r[y],y);a.push({name:y,property:d,binding:v})}}}return a}setUniforms(e,r,a,d){for(const{name:f,property:y,binding:v}of r)this.binders[y].setUniform(v,d,a.get(y),f)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof Ho){const d=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(a instanceof po||a instanceof Sr)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof po||a instanceof Sr||a instanceof Ho)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof po||r instanceof Sr||r instanceof Ho)&&r.destroy()}}}class Xs{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new ig(d,r,a);this.needsUpload=!1,this._featureMap=new Xo,this._bufferOffset=0}populatePaintArrays(e,r,a,d,f,y){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,r,d,f,y);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,d){for(const f of a)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,r,f,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ev(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function rg(i,e,r){const a={color:{source:c,composite:de},number:{source:j,composite:c}},d=function(f){return{"line-pattern":{source:Tn,composite:Tn},"fill-pattern":{source:Tn,composite:Tn},"fill-extrusion-pattern":{source:Tn,composite:Tn}}[f]}(i);return d&&d[r]||a[e][r]}qe("ConstantBinder",tu),qe("CrossFadedConstantBinder",Ba),qe("SourceExpressionBinder",po),qe("CrossFadedCompositeBinder",Ho),qe("CompositeExpressionBinder",Sr),qe("ProgramConfiguration",ig,{omit:["_buffers"]}),qe("ProgramConfigurationSet",Xs);var vn=8192;const tp=Math.pow(2,14)-1,og=-tp-1;function Hs(i){const e=vn/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){const d=r[a];for(let f=0;f<d.length;f++){const y=d[f],v=Math.round(y.x*e),b=Math.round(y.y*e);y.x=W(v,og,tp),y.y=W(b,og,tp),(v<y.x||v>y.x+1||b<y.y||b>y.y+1)&&De("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ks(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Hs(i):[]}}function Xc(i,e,r,a,d){i.emplaceBack(2*e+(a+1)/2,2*r+(d+1)/2)}class np{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Dt,this.indexArray=new ii,this.segments=new vt,this.programConfigurations=new Xs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){const d=this.layers[0],f=[];let y=null,v=!1;d.type==="circle"&&(y=d.layout.get("circle-sort-key"),v=!y.isConstant());for(const{feature:b,id:T,index:I,sourceLayerIndex:M}of e){const L=this.layers[0]._featureFilter.needGeometry,B=Ks(b,L);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),B,a))continue;const F=v?y.evaluate(B,{},a):void 0,H={id:T,properties:b.properties,type:b.type,sourceLayerIndex:M,index:I,geometry:L?B.geometry:Hs(b),patterns:{},sortKey:F};f.push(H)}v&&f.sort((b,T)=>b.sortKey-T.sortKey);for(const b of f){const{geometry:T,index:I,sourceLayerIndex:M}=b,L=e[I].feature;this.addFeature(b,T,I,a),r.featureIndex.insert(L,T,I,M,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,d){for(const f of r)for(const y of f){const v=y.x,b=y.y;if(v<0||v>=vn||b<0||b>=vn)continue;const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=T.vertexLength;Xc(this.layoutVertexArray,v,b,-1,-1),Xc(this.layoutVertexArray,v,b,1,-1),Xc(this.layoutVertexArray,v,b,1,1),Xc(this.layoutVertexArray,v,b,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},d)}}function sg(i,e){for(let r=0;r<i.length;r++)if(Fa(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Fa(i,e[r]))return!0;return!!ip(i,e)}function tv(i,e,r){return!!Fa(i,e)||!!rp(e,i,r)}function ag(i,e){if(i.length===1)return ug(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let d=0;d<a.length;d++)if(Fa(i,a[d]))return!0}for(let r=0;r<i.length;r++)if(ug(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(ip(i,e[r]))return!0;return!1}function nv(i,e,r){if(i.length>1){if(ip(i,e))return!0;for(let a=0;a<e.length;a++)if(rp(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(rp(i[a],e,r))return!0;return!1}function ip(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],d=i[r+1];for(let f=0;f<e.length-1;f++)if(iv(a,d,e[f],e[f+1]))return!0}return!1}function iv(i,e,r,a){return He(i,r,a)!==He(e,r,a)&&He(i,e,r)!==He(i,e,a)}function rp(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let d=1;d<e.length;d++)if(lg(i,e[d-1],e[d])<a)return!0;return!1}function lg(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const d=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(d<0?e:d>1?r:r.sub(e)._mult(d)._add(e))}function ug(i,e){let r,a,d,f=!1;for(let y=0;y<i.length;y++){r=i[y];for(let v=0,b=r.length-1;v<r.length;b=v++)a=r[v],d=r[b],a.y>e.y!=d.y>e.y&&e.x<(d.x-a.x)*(e.y-a.y)/(d.y-a.y)+a.x&&(f=!f)}return f}function Fa(i,e){let r=!1;for(let a=0,d=i.length-1;a<i.length;d=a++){const f=i[a],y=i[d];f.y>e.y!=y.y>e.y&&e.x<(y.x-f.x)*(e.y-f.y)/(y.y-f.y)+f.x&&(r=!r)}return r}function rv(i,e,r){const a=r[0],d=r[2];if(i.x<a.x&&e.x<a.x||i.x>d.x&&e.x>d.x||i.y<a.y&&e.y<a.y||i.y>d.y&&e.y>d.y)return!1;const f=He(i,e,r[0]);return f!==He(i,e,r[1])||f!==He(i,e,r[2])||f!==He(i,e,r[3])}function nu(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Hc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Kc(i,e,r,a,d){if(!e[0]&&!e[1])return i;const f=st.convert(e)._mult(d);r==="viewport"&&f._rotate(-a);const y=[];for(let v=0;v<i.length;v++)y.push(i[v].sub(f));return y}qe("CircleBucket",np,{omit:["layers"]});const ov=new An({"circle-sort-key":new ot(ve.layout_circle["circle-sort-key"])});var sv={paint:new An({"circle-radius":new ot(ve.paint_circle["circle-radius"]),"circle-color":new ot(ve.paint_circle["circle-color"]),"circle-blur":new ot(ve.paint_circle["circle-blur"]),"circle-opacity":new ot(ve.paint_circle["circle-opacity"]),"circle-translate":new Ye(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new Ye(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ye(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ye(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ot(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ot(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ot(ve.paint_circle["circle-stroke-opacity"])}),layout:ov},ri=1e-6,oi=typeof Float32Array<"u"?Float32Array:Array;function cg(){var i=new oi(9);return oi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function op(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function hg(i,e,r){var a=e[0],d=e[1],f=e[2],y=e[3],v=e[4],b=e[5],T=e[6],I=e[7],M=e[8],L=e[9],B=e[10],F=e[11],H=e[12],q=e[13],oe=e[14],fe=e[15],re=r[0],he=r[1],be=r[2],we=r[3];return i[0]=re*a+he*v+be*M+we*H,i[1]=re*d+he*b+be*L+we*q,i[2]=re*f+he*T+be*B+we*oe,i[3]=re*y+he*I+be*F+we*fe,i[4]=(re=r[4])*a+(he=r[5])*v+(be=r[6])*M+(we=r[7])*H,i[5]=re*d+he*b+be*L+we*q,i[6]=re*f+he*T+be*B+we*oe,i[7]=re*y+he*I+be*F+we*fe,i[8]=(re=r[8])*a+(he=r[9])*v+(be=r[10])*M+(we=r[11])*H,i[9]=re*d+he*b+be*L+we*q,i[10]=re*f+he*T+be*B+we*oe,i[11]=re*y+he*I+be*F+we*fe,i[12]=(re=r[12])*a+(he=r[13])*v+(be=r[14])*M+(we=r[15])*H,i[13]=re*d+he*b+be*L+we*q,i[14]=re*f+he*T+be*B+we*oe,i[15]=re*y+he*I+be*F+we*fe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var iu,av=hg;function dg(){var i=new oi(3);return oi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function pg(i,e,r){var a=new oi(3);return a[0]=i,a[1]=e,a[2]=r,a}function Yc(i,e,r){var a=e[0],d=e[1],f=e[2],y=e[3];return i[0]=r[0]*a+r[4]*d+r[8]*f+r[12]*y,i[1]=r[1]*a+r[5]*d+r[9]*f+r[13]*y,i[2]=r[2]*a+r[6]*d+r[10]*f+r[14]*y,i[3]=r[3]*a+r[7]*d+r[11]*f+r[15]*y,i}function fg(){var i=new oi(4);return oi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function mg(i,e){const r=Yc([],[i.x,i.y,0,1],e);return new st(r[0]/r[3],r[1]/r[3])}dg(),iu=new oi(4),oi!=Float32Array&&(iu[0]=0,iu[1]=0,iu[2]=0,iu[3]=0),dg(),pg(1,0,0),pg(0,1,0),fg(),fg(),cg(),function(){var i;i=new oi(2),oi!=Float32Array&&(i[0]=0,i[1]=0)}();class gg extends np{}qe("HeatmapBucket",gg,{omit:["layers"]});var lv={paint:new An({"heatmap-radius":new ot(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ot(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ye(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jr(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ye(ve.paint_heatmap["heatmap-opacity"])})};function sp(i,{width:e,height:r},a,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*r*a}`)}else d=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=d,i}function yg(i,{width:e,height:r},a){if(e===i.width&&r===i.height)return;const d=sp({},{width:e,height:r},a);ap(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},a),i.width=e,i.height=r,i.data=d.data}function ap(i,e,r,a,d,f){if(d.width===0||d.height===0)return e;if(d.width>i.width||d.height>i.height||r.x>i.width-d.width||r.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||a.x>e.width-d.width||a.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,v=e.data;if(y===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<d.height;b++){const T=((r.y+b)*i.width+r.x)*f,I=((a.y+b)*e.width+a.x)*f;for(let M=0;M<d.width*f;M++)v[I+M]=y[T+M]}return e}class ru{constructor(e,r){sp(this,e,1,r)}resize(e){yg(this,e,1)}clone(){return new ru({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,d,f){ap(e,r,a,d,f,1)}}class Gi{constructor(e,r){sp(this,e,4,r)}resize(e){yg(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Gi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,d,f){ap(e,r,a,d,f,4)}}function _g(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,d=i.image||new Gi({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const f=(y,v,b)=>{e[i.evaluationKey]=b;const T=i.expression.evaluate(e);d.data[y+v+0]=Math.floor(255*T.r/T.a),d.data[y+v+1]=Math.floor(255*T.g/T.a),d.data[y+v+2]=Math.floor(255*T.b/T.a),d.data[y+v+3]=Math.floor(255*T.a)};if(i.clips)for(let y=0,v=0;y<a;++y,v+=4*r)for(let b=0,T=0;b<r;b++,T+=4){const I=b/(r-1),{start:M,end:L}=i.clips[y];f(v,T,M*(1-I)+L*I)}else for(let y=0,v=0;y<r;y++,v+=4)f(0,v,y/(r-1));return d}qe("AlphaImage",ru),qe("RGBAImage",Gi);var uv={paint:new An({"hillshade-illumination-direction":new Ye(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ye(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ye(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ye(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ye(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ye(ve.paint_hillshade["hillshade-accent-color"])})};const cv=fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:hv}=cv;var Jc={exports:{}};function Qc(i,e,r){r=r||2;var a,d,f,y,v,b,T,I=e&&e.length,M=I?e[0]*r:i.length,L=xg(i,0,M,r,!0),B=[];if(!L||L.next===L.prev)return B;if(I&&(L=function(H,q,oe,fe){var re,he,be,we=[];for(re=0,he=q.length;re<he;re++)(be=xg(H,q[re]*fe,re<he-1?q[re+1]*fe:H.length,fe,!1))===be.next&&(be.steiner=!0),we.push(xv(be));for(we.sort(gv),re=0;re<we.length;re++)oe=yv(we[re],oe);return oe}(i,e,L,r)),i.length>80*r){a=f=i[0],d=y=i[1];for(var F=r;F<M;F+=r)(v=i[F])<a&&(a=v),(b=i[F+1])<d&&(d=b),v>f&&(f=v),b>y&&(y=b);T=(T=Math.max(f-a,y-d))!==0?32767/T:0}return ou(L,B,r,a,d,T,0),B}function xg(i,e,r,a,d){var f,y;if(d===cp(i,e,r,a)>0)for(f=e;f<r;f+=a)y=bg(f,i[f],i[f+1],y);else for(f=r-a;f>=e;f-=a)y=bg(f,i[f],i[f+1],y);return y&&eh(y,y.next)&&(au(y),y=y.next),y}function Ys(i,e){if(!i)return i;e||(e=i);var r,a=i;do if(r=!1,a.steiner||!eh(a,a.next)&&un(a.prev,a,a.next)!==0)a=a.next;else{if(au(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function ou(i,e,r,a,d,f,y){if(i){!y&&f&&function(I,M,L,B){var F=I;do F.z===0&&(F.z=lp(F.x,F.y,M,L,B)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==I);F.prevZ.nextZ=null,F.prevZ=null,function(H){var q,oe,fe,re,he,be,we,Ge,Xe=1;do{for(oe=H,H=null,he=null,be=0;oe;){for(be++,fe=oe,we=0,q=0;q<Xe&&(we++,fe=fe.nextZ);q++);for(Ge=Xe;we>0||Ge>0&&fe;)we!==0&&(Ge===0||!fe||oe.z<=fe.z)?(re=oe,oe=oe.nextZ,we--):(re=fe,fe=fe.nextZ,Ge--),he?he.nextZ=re:H=re,re.prevZ=he,he=re;oe=fe}he.nextZ=null,Xe*=2}while(be>1)}(F)}(i,a,d,f);for(var v,b,T=i;i.prev!==i.next;)if(v=i.prev,b=i.next,f?pv(i,a,d,f):dv(i))e.push(v.i/r|0),e.push(i.i/r|0),e.push(b.i/r|0),au(i),i=b.next,T=b.next;else if((i=b)===T){y?y===1?ou(i=fv(Ys(i),e,r),e,r,a,d,f,2):y===2&&mv(i,e,r,a,d,f):ou(Ys(i),e,r,a,d,f,1);break}}}function dv(i){var e=i.prev,r=i,a=i.next;if(un(e,r,a)>=0)return!1;for(var d=e.x,f=r.x,y=a.x,v=e.y,b=r.y,T=a.y,I=d<f?d<y?d:y:f<y?f:y,M=v<b?v<T?v:T:b<T?b:T,L=d>f?d>y?d:y:f>y?f:y,B=v>b?v>T?v:T:b>T?b:T,F=a.next;F!==e;){if(F.x>=I&&F.x<=L&&F.y>=M&&F.y<=B&&Oa(d,v,f,b,y,T,F.x,F.y)&&un(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function pv(i,e,r,a){var d=i.prev,f=i,y=i.next;if(un(d,f,y)>=0)return!1;for(var v=d.x,b=f.x,T=y.x,I=d.y,M=f.y,L=y.y,B=v<b?v<T?v:T:b<T?b:T,F=I<M?I<L?I:L:M<L?M:L,H=v>b?v>T?v:T:b>T?b:T,q=I>M?I>L?I:L:M>L?M:L,oe=lp(B,F,e,r,a),fe=lp(H,q,e,r,a),re=i.prevZ,he=i.nextZ;re&&re.z>=oe&&he&&he.z<=fe;){if(re.x>=B&&re.x<=H&&re.y>=F&&re.y<=q&&re!==d&&re!==y&&Oa(v,I,b,M,T,L,re.x,re.y)&&un(re.prev,re,re.next)>=0||(re=re.prevZ,he.x>=B&&he.x<=H&&he.y>=F&&he.y<=q&&he!==d&&he!==y&&Oa(v,I,b,M,T,L,he.x,he.y)&&un(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;re&&re.z>=oe;){if(re.x>=B&&re.x<=H&&re.y>=F&&re.y<=q&&re!==d&&re!==y&&Oa(v,I,b,M,T,L,re.x,re.y)&&un(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;he&&he.z<=fe;){if(he.x>=B&&he.x<=H&&he.y>=F&&he.y<=q&&he!==d&&he!==y&&Oa(v,I,b,M,T,L,he.x,he.y)&&un(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function fv(i,e,r){var a=i;do{var d=a.prev,f=a.next.next;!eh(d,f)&&vg(d,a,a.next,f)&&su(d,f)&&su(f,d)&&(e.push(d.i/r|0),e.push(a.i/r|0),e.push(f.i/r|0),au(a),au(a.next),a=i=f),a=a.next}while(a!==i);return Ys(a)}function mv(i,e,r,a,d,f){var y=i;do{for(var v=y.next.next;v!==y.prev;){if(y.i!==v.i&&vv(y,v)){var b=wg(y,v);return y=Ys(y,y.next),b=Ys(b,b.next),ou(y,e,r,a,d,f,0),void ou(b,e,r,a,d,f,0)}v=v.next}y=y.next}while(y!==i)}function gv(i,e){return i.x-e.x}function yv(i,e){var r=function(d,f){var y,v=f,b=d.x,T=d.y,I=-1/0;do{if(T<=v.y&&T>=v.next.y&&v.next.y!==v.y){var M=v.x+(T-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(M<=b&&M>I&&(I=M,y=v.x<v.next.x?v:v.next,M===b))return y}v=v.next}while(v!==f);if(!y)return null;var L,B=y,F=y.x,H=y.y,q=1/0;v=y;do b>=v.x&&v.x>=F&&b!==v.x&&Oa(T<H?b:I,T,F,H,T<H?I:b,T,v.x,v.y)&&(L=Math.abs(T-v.y)/(b-v.x),su(v,d)&&(L<q||L===q&&(v.x>y.x||v.x===y.x&&_v(y,v)))&&(y=v,q=L)),v=v.next;while(v!==B);return y}(i,e);if(!r)return e;var a=wg(r,i);return Ys(a,a.next),Ys(r,r.next)}function _v(i,e){return un(i.prev,i,e.prev)<0&&un(e.next,i,i.next)<0}function lp(i,e,r,a,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function xv(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Oa(i,e,r,a,d,f,y,v){return(d-y)*(e-v)>=(i-y)*(f-v)&&(i-y)*(a-v)>=(r-y)*(e-v)&&(r-y)*(f-v)>=(d-y)*(a-v)}function vv(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,a){var d=r;do{if(d.i!==r.i&&d.next.i!==r.i&&d.i!==a.i&&d.next.i!==a.i&&vg(d,d.next,r,a))return!0;d=d.next}while(d!==r);return!1}(i,e)&&(su(i,e)&&su(e,i)&&function(r,a){var d=r,f=!1,y=(r.x+a.x)/2,v=(r.y+a.y)/2;do d.y>v!=d.next.y>v&&d.next.y!==d.y&&y<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(f=!f),d=d.next;while(d!==r);return f}(i,e)&&(un(i.prev,i,e.prev)||un(i,e.prev,e))||eh(i,e)&&un(i.prev,i,i.next)>0&&un(e.prev,e,e.next)>0)}function un(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function eh(i,e){return i.x===e.x&&i.y===e.y}function vg(i,e,r,a){var d=nh(un(i,e,r)),f=nh(un(i,e,a)),y=nh(un(r,a,i)),v=nh(un(r,a,e));return d!==f&&y!==v||!(d!==0||!th(i,r,e))||!(f!==0||!th(i,a,e))||!(y!==0||!th(r,i,a))||!(v!==0||!th(r,e,a))}function th(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function nh(i){return i>0?1:i<0?-1:0}function su(i,e){return un(i.prev,i,i.next)<0?un(i,e,i.next)>=0&&un(i,i.prev,e)>=0:un(i,e,i.prev)<0||un(i,i.next,e)<0}function wg(i,e){var r=new up(i.i,i.x,i.y),a=new up(e.i,e.x,e.y),d=i.next,f=e.prev;return i.next=e,e.prev=i,r.next=d,d.prev=r,a.next=r,r.prev=a,f.next=a,a.prev=f,a}function bg(i,e,r,a){var d=new up(i,e,r);return a?(d.next=a.next,d.prev=a,a.next.prev=d,a.next=d):(d.prev=d,d.next=d),d}function au(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function up(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function cp(i,e,r,a){for(var d=0,f=e,y=r-a;f<r;f+=a)d+=(i[y]-i[f])*(i[f+1]+i[y+1]),y=f;return d}function wv(i,e,r,a,d){Sg(i,e,r||0,a||i.length-1,d||bv)}function Sg(i,e,r,a,d){for(;a>r;){if(a-r>600){var f=a-r+1,y=e-r+1,v=Math.log(f),b=.5*Math.exp(2*v/3),T=.5*Math.sqrt(v*b*(f-b)/f)*(y-f/2<0?-1:1);Sg(i,e,Math.max(r,Math.floor(e-y*b/f+T)),Math.min(a,Math.floor(e+(f-y)*b/f+T)),d)}var I=i[e],M=r,L=a;for(lu(i,r,e),d(i[a],I)>0&&lu(i,r,a);M<L;){for(lu(i,M,L),M++,L--;d(i[M],I)<0;)M++;for(;d(i[L],I)>0;)L--}d(i[r],I)===0?lu(i,r,L):lu(i,++L,a),L<=e&&(r=L+1),e<=L&&(a=L-1)}}function lu(i,e,r){var a=i[e];i[e]=i[r],i[r]=a}function bv(i,e){return i<e?-1:i>e?1:0}function hp(i,e){const r=i.length;if(r<=1)return[i];const a=[];let d,f;for(let y=0;y<r;y++){const v=Je(i[y]);v!==0&&(i[y].area=Math.abs(v),f===void 0&&(f=v<0),f===v<0?(d&&a.push(d),d=[i[y]]):d.push(i[y]))}if(d&&a.push(d),e>1)for(let y=0;y<a.length;y++)a[y].length<=e||(wv(a[y],e,1,a[y].length-1,Sv),a[y]=a[y].slice(0,e));return a}function Sv(i,e){return e.area-i.area}function dp(i,e,r){const a=r.patternDependencies;let d=!1;for(const f of e){const y=f.paint.get(`${i}-pattern`);y.isConstant()||(d=!0);const v=y.constantOr(null);v&&(d=!0,a[v.to]=!0,a[v.from]=!0)}return d}function pp(i,e,r,a,d){const f=d.patternDependencies;for(const y of e){const v=y.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:a-1},r,{},d.availableImages),T=v.evaluate({zoom:a},r,{},d.availableImages),I=v.evaluate({zoom:a+1},r,{},d.availableImages);b=b&&b.name?b.name:b,T=T&&T.name?T.name:T,I=I&&I.name?I.name:I,f[b]=!0,f[T]=!0,f[I]=!0,r.patterns[y.id]={min:b,mid:T,max:I}}}return r}Jc.exports=Qc,Jc.exports.default=Qc,Qc.deviation=function(i,e,r,a){var d=e&&e.length,f=Math.abs(cp(i,0,d?e[0]*r:i.length,r));if(d)for(var y=0,v=e.length;y<v;y++)f-=Math.abs(cp(i,e[y]*r,y<v-1?e[y+1]*r:i.length,r));var b=0;for(y=0;y<a.length;y+=3){var T=a[y]*r,I=a[y+1]*r,M=a[y+2]*r;b+=Math.abs((i[T]-i[M])*(i[I+1]-i[T+1])-(i[T]-i[I])*(i[M+1]-i[T+1]))}return f===0&&b===0?0:Math.abs((b-f)/f)},Qc.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,d=0;d<i.length;d++){for(var f=0;f<i[d].length;f++)for(var y=0;y<e;y++)r.vertices.push(i[d][f][y]);d>0&&r.holes.push(a+=i[d-1].length)}return r};class fp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Lt,this.indexArray=new ii,this.indexArray2=new br,this.programConfigurations=new Xs(e.layers,e.zoom),this.segments=new vt,this.segments2=new vt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=dp("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),f=!d.isConstant(),y=[];for(const{feature:v,id:b,index:T,sourceLayerIndex:I}of e){const M=this.layers[0]._featureFilter.needGeometry,L=Ks(v,M);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),L,a))continue;const B=f?d.evaluate(L,{},a,r.availableImages):void 0,F={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:T,geometry:M?L.geometry:Hs(v),patterns:{},sortKey:B};y.push(F)}f&&y.sort((v,b)=>v.sortKey-b.sortKey);for(const v of y){const{geometry:b,index:T,sourceLayerIndex:I}=v;if(this.hasPattern){const M=pp("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(M)}else this.addFeature(v,b,T,a,{});r.featureIndex.insert(e[T].feature,b,T,I,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hv),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,d,f){for(const y of hp(r,500)){let v=0;for(const B of y)v+=B.length;const b=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),T=b.vertexLength,I=[],M=[];for(const B of y){if(B.length===0)continue;B!==y[0]&&M.push(I.length/2);const F=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),H=F.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(H+B.length-1,H),I.push(B[0].x),I.push(B[0].y);for(let q=1;q<B.length;q++)this.layoutVertexArray.emplaceBack(B[q].x,B[q].y),this.indexArray2.emplaceBack(H+q-1,H+q),I.push(B[q].x),I.push(B[q].y);F.vertexLength+=B.length,F.primitiveLength+=B.length}const L=Jc.exports(I,M);for(let B=0;B<L.length;B+=3)this.indexArray.emplaceBack(T+L[B],T+L[B+1],T+L[B+2]);b.vertexLength+=v,b.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,d)}}qe("FillBucket",fp,{omit:["layers","patternFeatures"]});const Ev=new An({"fill-sort-key":new ot(ve.layout_fill["fill-sort-key"])});var Tv={paint:new An({"fill-antialias":new Ye(ve.paint_fill["fill-antialias"]),"fill-opacity":new ot(ve.paint_fill["fill-opacity"]),"fill-color":new ot(ve.paint_fill["fill-color"]),"fill-outline-color":new ot(ve.paint_fill["fill-outline-color"]),"fill-translate":new Ye(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new Ye(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Wo(ve.paint_fill["fill-pattern"])}),layout:Ev};const kv=fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Cv=fn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Iv}=kv;var Ko={},zv=st,Eg=Na;function Na(i,e,r,a,d){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=d,i.readFields(Pv,this,e)}function Pv(i,e,r){i==1?e.id=r.readVarint():i==2?function(a,d){for(var f=a.readVarint()+a.pos;a.pos<f;){var y=d._keys[a.readVarint()],v=d._values[a.readVarint()];d.properties[y]=v}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function Mv(i){for(var e,r,a=0,d=0,f=i.length,y=f-1;d<f;y=d++)a+=((r=i[y]).x-(e=i[d]).x)*(e.y+r.y);return a}Na.types=["Unknown","Point","LineString","Polygon"],Na.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,a=1,d=0,f=0,y=0,v=[];i.pos<r;){if(d<=0){var b=i.readVarint();a=7&b,d=b>>3}if(d--,a===1||a===2)f+=i.readSVarint(),y+=i.readSVarint(),a===1&&(e&&v.push(e),e=[]),e.push(new zv(f,y));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&v.push(e),v},Na.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,a=0,d=0,f=0,y=1/0,v=-1/0,b=1/0,T=-1/0;i.pos<e;){if(a<=0){var I=i.readVarint();r=7&I,a=I>>3}if(a--,r===1||r===2)(d+=i.readSVarint())<y&&(y=d),d>v&&(v=d),(f+=i.readSVarint())<b&&(b=f),f>T&&(T=f);else if(r!==7)throw new Error("unknown command "+r)}return[y,b,v,T]},Na.prototype.toGeoJSON=function(i,e,r){var a,d,f=this.extent*Math.pow(2,r),y=this.extent*i,v=this.extent*e,b=this.loadGeometry(),T=Na.types[this.type];function I(B){for(var F=0;F<B.length;F++){var H=B[F];B[F]=[360*(H.x+y)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+v)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(a=0;a<b.length;a++)M[a]=b[a][0];I(b=M);break;case 2:for(a=0;a<b.length;a++)I(b[a]);break;case 3:for(b=function(B){var F=B.length;if(F<=1)return[B];for(var H,q,oe=[],fe=0;fe<F;fe++){var re=Mv(B[fe]);re!==0&&(q===void 0&&(q=re<0),q===re<0?(H&&oe.push(H),H=[B[fe]]):H.push(B[fe]))}return H&&oe.push(H),oe}(b),a=0;a<b.length;a++)for(d=0;d<b[a].length;d++)I(b[a][d])}b.length===1?b=b[0]:T="Multi"+T;var L={type:"Feature",geometry:{type:T,coordinates:b},properties:this.properties};return"id"in this&&(L.id=this.id),L};var Av=Eg,Tg=kg;function kg(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Dv,this,e),this.length=this._features.length}function Dv(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(a){for(var d=null,f=a.readVarint()+a.pos;a.pos<f;){var y=a.readVarint()>>3;d=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return d}(r))}kg.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Av(this._pbf,e,this.extent,this._keys,this._values)};var Lv=Tg;function Rv(i,e,r){if(i===3){var a=new Lv(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}Ko.VectorTile=function(i,e){this.layers=i.readFields(Rv,{},e)},Ko.VectorTileFeature=Eg,Ko.VectorTileLayer=Tg;const Bv=Ko.VectorTileFeature.types,mp=Math.pow(2,13);function uu(i,e,r,a,d,f,y,v){i.emplaceBack(e,r,2*Math.floor(a*mp)+y,d*mp*2,f*mp*2,Math.round(v))}class gp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new St,this.centroidVertexArray=new nt,this.indexArray=new ii,this.programConfigurations=new Xs(e.layers,e.zoom),this.segments=new vt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.features=[],this.hasPattern=dp("fill-extrusion",this.layers,r);for(const{feature:d,id:f,index:y,sourceLayerIndex:v}of e){const b=this.layers[0]._featureFilter.needGeometry,T=Ks(d,b);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),T,a))continue;const I={id:f,sourceLayerIndex:v,index:y,geometry:b?T.geometry:Hs(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(pp("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,y,a,{}),r.featureIndex.insert(d,I.geometry,y,v,this.index,!0)}}addFeatures(e,r,a){for(const d of this.features){const{geometry:f}=d;this.addFeature(d,f,d.index,r,a)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Iv),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Cv.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,d,f){const y={x:0,y:0,vertexCount:0};for(const v of hp(r,500)){let b=0;for(const F of v)b+=F.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const F of v){if(F.length===0||Ov(F))continue;let H=0;for(let q=0;q<F.length;q++){const oe=F[q];if(q>=1){const fe=F[q-1];if(!Fv(oe,fe)){T.vertexLength+4>vt.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const re=oe.sub(fe)._perp()._unit(),he=fe.dist(oe);H+he>32768&&(H=0),uu(this.layoutVertexArray,oe.x,oe.y,re.x,re.y,0,0,H),uu(this.layoutVertexArray,oe.x,oe.y,re.x,re.y,0,1,H),y.x+=2*oe.x,y.y+=2*oe.y,y.vertexCount+=2,H+=he,uu(this.layoutVertexArray,fe.x,fe.y,re.x,re.y,0,0,H),uu(this.layoutVertexArray,fe.x,fe.y,re.x,re.y,0,1,H),y.x+=2*fe.x,y.y+=2*fe.y,y.vertexCount+=2;const be=T.vertexLength;this.indexArray.emplaceBack(be,be+2,be+1),this.indexArray.emplaceBack(be+1,be+2,be+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+b>vt.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),Bv[e.type]!=="Polygon")continue;const I=[],M=[],L=T.vertexLength;for(const F of v)if(F.length!==0){F!==v[0]&&M.push(I.length/2);for(let H=0;H<F.length;H++){const q=F[H];uu(this.layoutVertexArray,q.x,q.y,0,0,1,1,0),y.x+=q.x,y.y+=q.y,y.vertexCount+=1,I.push(q.x),I.push(q.y)}}const B=Jc.exports(I,M);for(let F=0;F<B.length;F+=3)this.indexArray.emplaceBack(L+B[F],L+B[F+2],L+B[F+1]);T.primitiveLength+=B.length/3,T.vertexLength+=b}for(let v=0;v<y.vertexCount;v++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,d)}}function Fv(i,e){return i.x===e.x&&(i.x<0||i.x>vn)||i.y===e.y&&(i.y<0||i.y>vn)}function Ov(i){return i.every(e=>e.x<0)||i.every(e=>e.x>vn)||i.every(e=>e.y<0)||i.every(e=>e.y>vn)}qe("FillExtrusionBucket",gp,{omit:["layers","features"]});var Nv={paint:new An({"fill-extrusion-opacity":new Ye(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ot(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ye(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ye(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Wo(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ot(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ot(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ye(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function cu(i,e){return i.x*e.x+i.y*e.y}function Cg(i,e){if(i.length===1){let r=0;const a=e[r++];let d;for(;!d||a.equals(d);)if(d=e[r++],!d)return 1/0;for(;r<e.length;r++){const f=e[r],y=i[0],v=d.sub(a),b=f.sub(a),T=y.sub(a),I=cu(v,v),M=cu(v,b),L=cu(b,b),B=cu(T,v),F=cu(T,b),H=I*L-M*M,q=(L*B-M*F)/H,oe=(I*F-M*B)/H,fe=a.z*(1-q-oe)+d.z*q+f.z*oe;if(isFinite(fe))return fe}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const Uv=fn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Vv}=Uv,$v=fn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:jv}=$v,Gv=Ko.VectorTileFeature.types,Zv=Math.cos(Math.PI/180*37.5),Ig=Math.pow(2,14)/.5;class yp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new It,this.layoutVertexArray2=new Ft,this.indexArray=new ii,this.programConfigurations=new Xs(e.layers,e.zoom),this.segments=new vt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=dp("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),f=!d.isConstant(),y=[];for(const{feature:v,id:b,index:T,sourceLayerIndex:I}of e){const M=this.layers[0]._featureFilter.needGeometry,L=Ks(v,M);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),L,a))continue;const B=f?d.evaluate(L,{},a):void 0,F={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:T,geometry:M?L.geometry:Hs(v),patterns:{},sortKey:B};y.push(F)}f&&y.sort((v,b)=>v.sortKey-b.sortKey);for(const v of y){const{geometry:b,index:T,sourceLayerIndex:I}=v;if(this.hasPattern){const M=pp("line",this.layers,v,this.zoom,r);this.patternFeatures.push(M)}else this.addFeature(v,b,T,a,{});r.featureIndex.insert(e[T].feature,b,T,I,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,jv)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vv),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,d,f){const y=this.layers[0].layout,v=y.get("line-join").evaluate(e,{}),b=y.get("line-cap"),T=y.get("line-miter-limit"),I=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of r)this.addLine(M,e,v,b,T,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,d)}addLine(e,r,a,d,f,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<e.length-1;oe++)this.totalDistance+=e[oe].dist(e[oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=Gv[r.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let T=0;for(;T<b-1&&e[T].equals(e[T+1]);)T++;if(b<(v?3:2))return;a==="bevel"&&(f=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,M=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let L,B,F,H,q;this.e1=this.e2=-1,v&&(L=e[b-2],q=e[T].sub(L)._unit()._perp());for(let oe=T;oe<b;oe++){if(F=oe===b-1?v?e[T+1]:void 0:e[oe+1],F&&e[oe].equals(F))continue;q&&(H=q),L&&(B=L),L=e[oe],q=F?F.sub(L)._unit()._perp():H,H=H||q;let fe=H.add(q);fe.x===0&&fe.y===0||fe._unit();const re=H.x*q.x+H.y*q.y,he=fe.x*q.x+fe.y*q.y,be=he!==0?1/he:1/0,we=2*Math.sqrt(2-2*he),Ge=he<Zv&&B&&F,Xe=H.x*q.y-H.y*q.x>0;if(Ge&&oe>T){const ze=L.dist(B);if(ze>2*I){const Ue=L.sub(L.sub(B)._mult(I/ze)._round());this.updateDistance(B,Ue),this.addCurrentVertex(Ue,H,0,0,M),B=Ue}}const Ne=B&&F;let Ae=Ne?a:v?"butt":d;if(Ne&&Ae==="round"&&(be<y?Ae="miter":be<=2&&(Ae="fakeround")),Ae==="miter"&&be>f&&(Ae="bevel"),Ae==="bevel"&&(be>2&&(Ae="flipbevel"),be<f&&(Ae="miter")),B&&this.updateDistance(B,L),Ae==="miter")fe._mult(be),this.addCurrentVertex(L,fe,0,0,M);else if(Ae==="flipbevel"){if(be>100)fe=q.mult(-1);else{const ze=be*H.add(q).mag()/H.sub(q).mag();fe._perp()._mult(ze*(Xe?-1:1))}this.addCurrentVertex(L,fe,0,0,M),this.addCurrentVertex(L,fe.mult(-1),0,0,M)}else if(Ae==="bevel"||Ae==="fakeround"){const ze=-Math.sqrt(be*be-1),Ue=Xe?ze:0,Be=Xe?0:ze;if(B&&this.addCurrentVertex(L,H,Ue,Be,M),Ae==="fakeround"){const Te=Math.round(180*we/Math.PI/20);for(let it=1;it<Te;it++){let et=it/Te;if(et!==.5){const Wt=et-.5;et+=et*Wt*(et-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*Wt*Wt+(.848013+re*(.215638*re-1.06021)))}const xt=q.sub(H)._mult(et)._add(H)._unit()._mult(Xe?-1:1);this.addHalfVertex(L,xt.x,xt.y,!1,Xe,0,M)}}F&&this.addCurrentVertex(L,q,-Ue,-Be,M)}else if(Ae==="butt")this.addCurrentVertex(L,fe,0,0,M);else if(Ae==="square"){const ze=B?1:-1;this.addCurrentVertex(L,fe,ze,ze,M)}else Ae==="round"&&(B&&(this.addCurrentVertex(L,H,0,0,M),this.addCurrentVertex(L,H,1,1,M,!0)),F&&(this.addCurrentVertex(L,q,-1,-1,M,!0),this.addCurrentVertex(L,q,0,0,M)));if(Ge&&oe<b-1){const ze=L.dist(F);if(ze>2*I){const Ue=L.add(F.sub(L)._mult(I/ze)._round());this.updateDistance(L,Ue),this.addCurrentVertex(Ue,q,0,0,M),L=Ue}}}}addCurrentVertex(e,r,a,d,f,y=!1){const v=r.y*d-r.x,b=-r.y-r.x*d;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,y,!1,a,f),this.addHalfVertex(e,v,b,y,!0,-d,f),this.distance>Ig/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,a,d,f,y))}addHalfVertex({x:e,y:r},a,d,f,y,v,b){const T=.5*(this.lineClips?this.scaledDistance*(Ig-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(r<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*d)+128,1+(v===0?0:v<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),y?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}qe("LineBucket",yp,{omit:["layers","patternFeatures"]});const qv=new An({"line-cap":new Ye(ve.layout_line["line-cap"]),"line-join":new ot(ve.layout_line["line-join"]),"line-miter-limit":new Ye(ve.layout_line["line-miter-limit"]),"line-round-limit":new Ye(ve.layout_line["line-round-limit"]),"line-sort-key":new ot(ve.layout_line["line-sort-key"])});var zg={paint:new An({"line-opacity":new ot(ve.paint_line["line-opacity"]),"line-color":new ot(ve.paint_line["line-color"]),"line-translate":new Ye(ve.paint_line["line-translate"]),"line-translate-anchor":new Ye(ve.paint_line["line-translate-anchor"]),"line-width":new ot(ve.paint_line["line-width"]),"line-gap-width":new ot(ve.paint_line["line-gap-width"]),"line-offset":new ot(ve.paint_line["line-offset"]),"line-blur":new ot(ve.paint_line["line-blur"]),"line-dasharray":new Yl(ve.paint_line["line-dasharray"]),"line-pattern":new Wo(ve.paint_line["line-pattern"]),"line-gradient":new jr(ve.paint_line["line-gradient"])}),layout:qv};const Pg=new class extends ot{possiblyEvaluate(i,e){return e=new Jt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,a){return e=Le({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,a)}}(zg.paint.properties["line-width"].specification);function Mg(i,e){return e>0?e+2*i:i}Pg.useIntegerZoom=!0;const Wv=fn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xv=fn([{name:"a_projected_pos",components:3,type:"Float32"}],4);fn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hv=fn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);fn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ag=fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Kv=fn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Yv(i,e,r){return i.sections.forEach(a=>{a.text=function(d,f,y){const v=f.layout.get("text-transform").evaluate(y,{});return v==="uppercase"?d=d.toLocaleUpperCase():v==="lowercase"&&(d=d.toLocaleLowerCase()),Pi.applyArabicShaping&&(d=Pi.applyArabicShaping(d)),d}(a.text,e,r)}),i}fn([{name:"triangle",components:3,type:"Uint16"}]),fn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),fn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),fn([{type:"Float32",name:"offsetX"}]),fn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const hu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Dn=24,_p=$t,Dg=function(i,e,r,a,d){var f,y,v=8*d-a-1,b=(1<<v)-1,T=b>>1,I=-7,M=r?d-1:0,L=r?-1:1,B=i[e+M];for(M+=L,f=B&(1<<-I)-1,B>>=-I,I+=v;I>0;f=256*f+i[e+M],M+=L,I-=8);for(y=f&(1<<-I)-1,f>>=-I,I+=a;I>0;y=256*y+i[e+M],M+=L,I-=8);if(f===0)f=1-T;else{if(f===b)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,a),f-=T}return(B?-1:1)*y*Math.pow(2,f-a)},Lg=function(i,e,r,a,d,f){var y,v,b,T=8*f-d-1,I=(1<<T)-1,M=I>>1,L=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=a?0:f-1,F=a?1:-1,H=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,y=I):(y=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-y))<1&&(y--,b*=2),(e+=y+M>=1?L/b:L*Math.pow(2,1-M))*b>=2&&(y++,b/=2),y+M>=I?(v=0,y=I):y+M>=1?(v=(e*b-1)*Math.pow(2,d),y+=M):(v=e*Math.pow(2,M-1)*Math.pow(2,d),y=0));d>=8;i[r+B]=255&v,B+=F,v/=256,d-=8);for(y=y<<d|v,T+=d;T>0;i[r+B]=255&y,B+=F,y/=256,T-=8);i[r+B-F]|=128*H};function $t(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}$t.Varint=0,$t.Fixed64=1,$t.Bytes=2,$t.Fixed32=5;var Yo,xp=4294967296,Rg=1/xp,Bg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function fo(i){return i.type===$t.Bytes?i.readVarint()+i.pos:i.pos+1}function Ua(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Fg(i,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var d=r.pos-1;d>=i;d--)r.buf[d+a]=r.buf[d]}function Jv(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Qv(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function e1(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function t1(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function n1(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function i1(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function r1(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function o1(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function s1(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function ih(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Va(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Og(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function a1(i,e,r){i===1&&r.readMessage(l1,e)}function l1(i,e,r){if(i===3){const{id:a,bitmap:d,width:f,height:y,left:v,top:b,advance:T}=r.readMessage(u1,{});e.push({id:a,bitmap:new ru({width:f+6,height:y+6},d),metrics:{width:f,height:y,left:v,top:b,advance:T}})}}function u1(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Ng(i){let e=0,r=0;for(const y of i)e+=y.w*y.h,r=Math.max(r,y.w);i.sort((y,v)=>v.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let d=0,f=0;for(const y of i)for(let v=a.length-1;v>=0;v--){const b=a[v];if(!(y.w>b.w||y.h>b.h)){if(y.x=b.x,y.y=b.y,f=Math.max(f,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===b.w&&y.h===b.h){const T=a.pop();v<a.length&&(a[v]=T)}else y.h===b.h?(b.x+=y.w,b.w-=y.w):y.w===b.w?(b.y+=y.h,b.h-=y.h):(a.push({x:b.x+y.w,y:b.y,w:b.w-y.w,h:y.h}),b.y+=y.h,b.h-=y.h);break}}return{w:d,h:f,fill:e/(d*f)||0}}$t.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),d=a>>3,f=this.pos;this.type=7&a,i(d,e,this),this.pos===f&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=ih(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Og(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=ih(this.buf,this.pos)+ih(this.buf,this.pos+4)*xp;return this.pos+=8,i},readSFixed64:function(){var i=ih(this.buf,this.pos)+Og(this.buf,this.pos+4)*xp;return this.pos+=8,i},readFloat:function(){var i=Dg(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Dg(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(d,f,y){var v,b,T=y.buf;if(v=(112&(b=T[y.pos++]))>>4,b<128||(v|=(127&(b=T[y.pos++]))<<3,b<128)||(v|=(127&(b=T[y.pos++]))<<10,b<128)||(v|=(127&(b=T[y.pos++]))<<17,b<128)||(v|=(127&(b=T[y.pos++]))<<24,b<128)||(v|=(1&(b=T[y.pos++]))<<31,b<128))return Ua(d,v,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Bg?function(r,a,d){return Bg.decode(r.subarray(a,d))}(this.buf,e,i):function(r,a,d){for(var f="",y=a;y<d;){var v,b,T,I=r[y],M=null,L=I>239?4:I>223?3:I>191?2:1;if(y+L>d)break;L===1?I<128&&(M=I):L===2?(192&(v=r[y+1]))==128&&(M=(31&I)<<6|63&v)<=127&&(M=null):L===3?(b=r[y+2],(192&(v=r[y+1]))==128&&(192&b)==128&&((M=(15&I)<<12|(63&v)<<6|63&b)<=2047||M>=55296&&M<=57343)&&(M=null)):L===4&&(b=r[y+2],T=r[y+3],(192&(v=r[y+1]))==128&&(192&b)==128&&(192&T)==128&&((M=(15&I)<<18|(63&v)<<12|(63&b)<<6|63&T)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,L=1):M>65535&&(M-=65536,f+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),f+=String.fromCharCode(M),y+=L}return f}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==$t.Bytes)return i.push(this.readVarint(e));var r=fo(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==$t.Bytes)return i.push(this.readSVarint());var e=fo(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==$t.Bytes)return i.push(this.readBoolean());var e=fo(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==$t.Bytes)return i.push(this.readFloat());var e=fo(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==$t.Bytes)return i.push(this.readDouble());var e=fo(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==$t.Bytes)return i.push(this.readFixed32());var e=fo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==$t.Bytes)return i.push(this.readSFixed32());var e=fo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==$t.Bytes)return i.push(this.readFixed64());var e=fo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==$t.Bytes)return i.push(this.readSFixed64());var e=fo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===$t.Varint)for(;this.buf[this.pos++]>127;);else if(e===$t.Bytes)this.pos=this.readVarint()+this.pos;else if(e===$t.Fixed32)this.pos+=4;else{if(e!==$t.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Va(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Va(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Va(this.buf,-1&i,this.pos),Va(this.buf,Math.floor(i*Rg),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Va(this.buf,-1&i,this.pos),Va(this.buf,Math.floor(i*Rg),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var a,d;if(e>=0?(a=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(f,y,v){v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,v.buf[v.pos]=127&(f>>>=7)}(a,0,r),function(f,y){var v=(7&f)<<4;y.buf[y.pos++]|=v|((f>>>=3)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f)))))}(d,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,d,f){for(var y,v,b=0;b<d.length;b++){if((y=d.charCodeAt(b))>55295&&y<57344){if(!v){y>56319||b+1===d.length?(a[f++]=239,a[f++]=191,a[f++]=189):v=y;continue}if(y<56320){a[f++]=239,a[f++]=191,a[f++]=189,v=y;continue}y=v-55296<<10|y-56320|65536,v=null}else v&&(a[f++]=239,a[f++]=191,a[f++]=189,v=null);y<128?a[f++]=y:(y<2048?a[f++]=y>>6|192:(y<65536?a[f++]=y>>12|224:(a[f++]=y>>18|240,a[f++]=y>>12&63|128),a[f++]=y>>6&63|128),a[f++]=63&y|128)}return f}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Fg(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Lg(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Lg(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var a=this.pos-r;a>=128&&Fg(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,r){this.writeTag(i,$t.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Jv,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Qv,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,n1,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,e1,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,t1,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,i1,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,r1,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,o1,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,s1,e)},writeBytesField:function(i,e){this.writeTag(i,$t.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,$t.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,$t.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,$t.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,$t.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,$t.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,$t.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,$t.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,$t.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,$t.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class vp{constructor(e,{pixelRatio:r,version:a,stretchX:d,stretchY:f,content:y}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=d,this.stretchY=f,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ug{constructor(e,r){const a={},d={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,a,f),this.addImages(r,d,f);const{w:y,h:v}=Ng(f),b=new Gi({width:y||1,height:v||1});for(const T in e){const I=e[T],M=a[T].paddedRect;Gi.copy(I.data,b,{x:0,y:0},{x:M.x+1,y:M.y+1},I.data)}for(const T in r){const I=r[T],M=d[T].paddedRect,L=M.x+1,B=M.y+1,F=I.data.width,H=I.data.height;Gi.copy(I.data,b,{x:0,y:0},{x:L,y:B},I.data),Gi.copy(I.data,b,{x:0,y:H-1},{x:L,y:B-1},{width:F,height:1}),Gi.copy(I.data,b,{x:0,y:0},{x:L,y:B+H},{width:F,height:1}),Gi.copy(I.data,b,{x:F-1,y:0},{x:L-1,y:B},{width:1,height:H}),Gi.copy(I.data,b,{x:0,y:0},{x:L+F,y:B},{width:1,height:H})}this.image=b,this.iconPositions=a,this.patternPositions=d}addImages(e,r,a){for(const d in e){const f=e[d],y={x:0,y:0,w:f.data.width+2,h:f.data.height+2};a.push(y),r[d]=new vp(y,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[d,f]=e.tl;a.update(r.data,void 0,{x:d,y:f})}}qe("ImagePosition",vp),qe("ImageAtlas",Ug),l.WritingMode=void 0,(Yo=l.WritingMode||(l.WritingMode={}))[Yo.none=0]="none",Yo[Yo.horizontal=1]="horizontal",Yo[Yo.vertical=2]="vertical",Yo[Yo.horizontalOnly=3]="horizontalOnly";const rh=-17;class du{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new du;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new du;return r.imageName=e,r}}class $a{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new $a;for(let d=0;d<e.sections.length;d++){const f=e.sections[d];f.image?a.addImageSection(f):a.addTextSection(f,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let a=0;a<e.length;a++){const d=e.charCodeAt(a+1)||null,f=e.charCodeAt(a-1)||null;r+=d&&Oc(d)&&!hu[e[a+1]]||f&&Oc(f)&&!hu[e[a-1]]||!hu[e[a]]?e[a]:hu[e[a]]}return r}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&sh[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&sh[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new $a;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(du.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void De("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(du.forImage(r)),this.sectionIndex.push(this.sections.length-1)):De("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function oh(i,e,r,a,d,f,y,v,b,T,I,M,L,B,F,H){const q=$a.fromFeature(i,d);let oe;M===l.WritingMode.vertical&&q.verticalizePunctuation();const{processBidirectionalText:fe,processStyledBidirectionalText:re}=Pi;if(fe&&q.sections.length===1){oe=[];const we=fe(q.toString(),wp(q,T,f,e,a,B,F));for(const Ge of we){const Xe=new $a;Xe.text=Ge,Xe.sections=q.sections;for(let Ne=0;Ne<Ge.length;Ne++)Xe.sectionIndex.push(0);oe.push(Xe)}}else if(re){oe=[];const we=re(q.text,q.sectionIndex,wp(q,T,f,e,a,B,F));for(const Ge of we){const Xe=new $a;Xe.text=Ge[0],Xe.sectionIndex=Ge[1],Xe.sections=q.sections,oe.push(Xe)}}else oe=function(we,Ge){const Xe=[],Ne=we.text;let Ae=0;for(const ze of Ge)Xe.push(we.substring(Ae,ze)),Ae=ze;return Ae<Ne.length&&Xe.push(we.substring(Ae,Ne.length)),Xe}(q,wp(q,T,f,e,a,B,F));const he=[],be={positionedLines:he,text:q.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function(we,Ge,Xe,Ne,Ae,ze,Ue,Be,Te,it,et,xt){let Wt=0,en=rh,wn=0,qi=0;const On=Be==="right"?1:Be==="left"?0:.5;let mn=0;for(const gn of Ae){gn.trim();const Un=gn.getMaxScale(),Xn=(Un-1)*Dn,si={positionedGlyphs:[],lineOffset:0};we.positionedLines[mn]=si;const vi=si.positionedGlyphs;let wi=0;if(!gn.length()){en+=ze,++mn;continue}for(let zn=0;zn<gn.length();zn++){const wt=gn.getSection(zn),Di=gn.getSectionIndex(zn),Vn=gn.getCharCode(zn);let Hn=0,ar=null,Er=null,Tr=null,go=Dn;const lr=!(Te===l.WritingMode.horizontal||!et&&!Zl(Vn)||et&&(sh[Vn]||(In=Vn,Oe.Arabic(In)||Oe["Arabic Supplement"](In)||Oe["Arabic Extended-A"](In)||Oe["Arabic Presentation Forms-A"](In)||Oe["Arabic Presentation Forms-B"](In))));if(wt.imageName){const Wi=Ne[wt.imageName];if(!Wi)continue;Tr=wt.imageName,we.iconsInText=we.iconsInText||!0,Er=Wi.paddedRect;const bi=Wi.displaySize;wt.scale=wt.scale*Dn/xt,ar={width:bi[0],height:bi[1],left:1,top:-3,advance:lr?bi[1]:bi[0]},Hn=Xn+(Dn-bi[1]*wt.scale),go=ar.advance;const yo=lr?bi[0]*wt.scale-Dn*Un:bi[1]*wt.scale-Dn*Un;yo>0&&yo>wi&&(wi=yo)}else{const Wi=Xe[wt.fontStack],bi=Wi&&Wi[Vn];if(bi&&bi.rect)Er=bi.rect,ar=bi.metrics;else{const yo=Ge[wt.fontStack],mu=yo&&yo[Vn];if(!mu)continue;ar=mu.metrics}Hn=(Un-wt.scale)*Dn}lr?(we.verticalizable=!0,vi.push({glyph:Vn,imageName:Tr,x:Wt,y:en+Hn,vertical:lr,scale:wt.scale,fontStack:wt.fontStack,sectionIndex:Di,metrics:ar,rect:Er}),Wt+=go*wt.scale+it):(vi.push({glyph:Vn,imageName:Tr,x:Wt,y:en+Hn,vertical:lr,scale:wt.scale,fontStack:wt.fontStack,sectionIndex:Di,metrics:ar,rect:Er}),Wt+=ar.advance*wt.scale+it)}vi.length!==0&&(wn=Math.max(Wt-it,wn),d1(vi,0,vi.length-1,On,wi)),Wt=0;const tn=ze*Un+wi;si.lineOffset=Math.max(wi,Xn),en+=tn,qi=Math.max(tn,qi),++mn}var In;const Nn=en-rh,{horizontalAlign:Wn,verticalAlign:xi}=bp(Ue);(function(gn,Un,Xn,si,vi,wi,tn,zn,wt){const Di=(Un-Xn)*vi;let Vn=0;Vn=wi!==tn?-zn*si-rh:(-si*wt+.5)*tn;for(const Hn of gn)for(const ar of Hn.positionedGlyphs)ar.x+=Di,ar.y+=Vn})(we.positionedLines,On,Wn,xi,wn,qi,ze,Nn,Ae.length),we.top+=-xi*Nn,we.bottom=we.top+Nn,we.left+=-Wn*wn,we.right=we.left+wn}(be,e,r,a,oe,y,v,b,M,T,L,H),!function(we){for(const Ge of we)if(Ge.positionedGlyphs.length!==0)return!1;return!0}(he)&&be}const sh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},c1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Vg(i,e,r,a,d,f){if(e.imageName){const y=a[e.imageName];return y?y.displaySize[0]*e.scale*Dn/f+d:0}{const y=r[e.fontStack],v=y&&y[i];return v?v.metrics.advance*e.scale+d:0}}function $g(i,e,r,a){const d=Math.pow(i-e,2);return a?i<e?d/2:2*d:d+Math.abs(r)*r}function h1(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function jg(i,e,r,a,d,f){let y=null,v=$g(e,r,d,f);for(const b of a){const T=$g(e-b.x,r,d,f)+b.badness;T<=v&&(y=b,v=T)}return{index:i,x:e,priorBreak:y,badness:v}}function Gg(i){return i?Gg(i.priorBreak).concat(i.index):[]}function wp(i,e,r,a,d,f,y){if(f!=="point")return[];if(!i)return[];const v=[],b=function(L,B,F,H,q,oe){let fe=0;for(let re=0;re<L.length();re++){const he=L.getSection(re);fe+=Vg(L.getCharCode(re),he,H,q,B,oe)}return fe/Math.max(1,Math.ceil(fe/F))}(i,e,r,a,d,y),T=i.text.indexOf("​")>=0;let I=0;for(let L=0;L<i.length();L++){const B=i.getSection(L),F=i.getCharCode(L);if(sh[F]||(I+=Vg(F,B,a,d,e,y)),L<i.length()-1){const H=!((M=F)<11904||!(Oe["Bopomofo Extended"](M)||Oe.Bopomofo(M)||Oe["CJK Compatibility Forms"](M)||Oe["CJK Compatibility Ideographs"](M)||Oe["CJK Compatibility"](M)||Oe["CJK Radicals Supplement"](M)||Oe["CJK Strokes"](M)||Oe["CJK Symbols and Punctuation"](M)||Oe["CJK Unified Ideographs Extension A"](M)||Oe["CJK Unified Ideographs"](M)||Oe["Enclosed CJK Letters and Months"](M)||Oe["Halfwidth and Fullwidth Forms"](M)||Oe.Hiragana(M)||Oe["Ideographic Description Characters"](M)||Oe["Kangxi Radicals"](M)||Oe["Katakana Phonetic Extensions"](M)||Oe.Katakana(M)||Oe["Vertical Forms"](M)||Oe["Yi Radicals"](M)||Oe["Yi Syllables"](M)));(c1[F]||H||B.imageName)&&v.push(jg(L+1,I,b,v,h1(F,i.getCharCode(L+1),H&&T),!1))}}var M;return Gg(jg(i.length(),I,b,v,0,!0))}function bp(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function d1(i,e,r,a,d){if(!a&&!d)return;const f=i[r],y=(i[r].x+f.metrics.advance*f.scale)*a;for(let v=e;v<=r;v++)i[v].x-=y,i[v].y+=d}function p1(i,e,r){const{horizontalAlign:a,verticalAlign:d}=bp(r),f=e[0]-i.displaySize[0]*a,y=e[1]-i.displaySize[1]*d;return{image:i,top:y,bottom:y+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function Zg(i,e,r,a,d,f){const y=i.image;let v;if(y.content){const q=y.content,oe=y.pixelRatio||1;v=[q[0]/oe,q[1]/oe,y.displaySize[0]-q[2]/oe,y.displaySize[1]-q[3]/oe]}const b=e.left*f,T=e.right*f;let I,M,L,B;r==="width"||r==="both"?(B=d[0]+b-a[3],M=d[0]+T+a[1]):(B=d[0]+(b+T-y.displaySize[0])/2,M=B+y.displaySize[0]);const F=e.top*f,H=e.bottom*f;return r==="height"||r==="both"?(I=d[1]+F-a[0],L=d[1]+H+a[2]):(I=d[1]+(F+H-y.displaySize[1])/2,L=I+y.displaySize[1]),{image:y,top:I,right:M,bottom:L,left:B,collisionPadding:v}}const mo=128;function qg(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Jt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:d}=r;let f=0;for(;f<a.length&&a[f]<=i;)f++;f=Math.max(0,f-1);let y=f;for(;y<a.length&&a[y]<i+1;)y++;y=Math.min(a.length-1,y);const v=a[f],b=a[y];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:d}:{kind:"camera",minZoom:v,maxZoom:b,minSize:r.evaluate(new Jt(v)),maxSize:r.evaluate(new Jt(b)),interpolationType:d}}}class Jo extends st{constructor(e,r,a,d){super(e,r),this.angle=a,d!==void 0&&(this.segment=d)}clone(){return new Jo(this.x,this.y,this.angle,this.segment)}}function Wg(i,e,r,a,d){if(e.segment===void 0)return!0;let f=e,y=e.segment+1,v=0;for(;v>-r/2;){if(y--,y<0)return!1;v-=i[y].dist(f),f=i[y]}v+=i[y].dist(i[y+1]),y++;const b=[];let T=0;for(;v<r/2;){const I=i[y],M=i[y+1];if(!M)return!1;let L=i[y-1].angleTo(I)-I.angleTo(M);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:L}),T+=L;v-b[0].distance>a;)T-=b.shift().angleDelta;if(T>d)return!1;y++,v+=I.dist(M)}return!0}function Xg(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Hg(i,e,r){return i?.6*e*r:0}function Kg(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function f1(i,e,r,a,d,f){const y=Hg(r,d,f),v=Kg(r,a)*f;let b=0;const T=Xg(i)/2;for(let I=0;I<i.length-1;I++){const M=i[I],L=i[I+1],B=M.dist(L);if(b+B>T){const F=(T-b)/B,H=Kt(M.x,L.x,F),q=Kt(M.y,L.y,F),oe=new Jo(H,q,L.angleTo(M),I);return oe._round(),!y||Wg(i,oe,v,y,e)?oe:void 0}b+=B}}function m1(i,e,r,a,d,f,y,v,b){const T=Hg(a,f,y),I=Kg(a,d),M=I*y,L=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return e-M<e/4&&(e=M+e/4),Yg(i,L?e/2*v%e:(I/2+2*f)*y*v%e,e,T,r,M,L,!1,b)}function Yg(i,e,r,a,d,f,y,v,b){const T=f/2,I=Xg(i);let M=0,L=e-r,B=[];for(let F=0;F<i.length-1;F++){const H=i[F],q=i[F+1],oe=H.dist(q),fe=q.angleTo(H);for(;L+r<M+oe;){L+=r;const re=(L-M)/oe,he=Kt(H.x,q.x,re),be=Kt(H.y,q.y,re);if(he>=0&&he<b&&be>=0&&be<b&&L-T>=0&&L+T<=I){const we=new Jo(he,be,fe,F);we._round(),a&&!Wg(i,we,f,a,d)||B.push(we)}}M+=oe}return v||B.length||y||(B=Yg(i,M/2,r,a,d,f,y,!0,b)),B}function Jg(i,e,r,a,d){const f=[];for(let y=0;y<i.length;y++){const v=i[y];let b;for(let T=0;T<v.length-1;T++){let I=v[T],M=v[T+1];I.x<e&&M.x<e||(I.x<e?I=new st(e,I.y+(e-I.x)/(M.x-I.x)*(M.y-I.y))._round():M.x<e&&(M=new st(e,I.y+(e-I.x)/(M.x-I.x)*(M.y-I.y))._round()),I.y<r&&M.y<r||(I.y<r?I=new st(I.x+(r-I.y)/(M.y-I.y)*(M.x-I.x),r)._round():M.y<r&&(M=new st(I.x+(r-I.y)/(M.y-I.y)*(M.x-I.x),r)._round()),I.x>=a&&M.x>=a||(I.x>=a?I=new st(a,I.y+(a-I.x)/(M.x-I.x)*(M.y-I.y))._round():M.x>=a&&(M=new st(a,I.y+(a-I.x)/(M.x-I.x)*(M.y-I.y))._round()),I.y>=d&&M.y>=d||(I.y>=d?I=new st(I.x+(d-I.y)/(M.y-I.y)*(M.x-I.x),d)._round():M.y>=d&&(M=new st(I.x+(d-I.y)/(M.y-I.y)*(M.x-I.x),d)._round()),b&&I.equals(b[b.length-1])||(b=[I],f.push(b)),b.push(M)))))}}return f}function Qg(i,e,r,a){const d=[],f=i.image,y=f.pixelRatio,v=f.paddedRect.w-2,b=f.paddedRect.h-2,T=i.right-i.left,I=i.bottom-i.top,M=f.stretchX||[[0,v]],L=f.stretchY||[[0,b]],B=(ze,Ue)=>ze+Ue[1]-Ue[0],F=M.reduce(B,0),H=L.reduce(B,0),q=v-F,oe=b-H;let fe=0,re=F,he=0,be=H,we=0,Ge=q,Xe=0,Ne=oe;if(f.content&&a){const ze=f.content;fe=ah(M,0,ze[0]),he=ah(L,0,ze[1]),re=ah(M,ze[0],ze[2]),be=ah(L,ze[1],ze[3]),we=ze[0]-fe,Xe=ze[1]-he,Ge=ze[2]-ze[0]-re,Ne=ze[3]-ze[1]-be}const Ae=(ze,Ue,Be,Te)=>{const it=lh(ze.stretch-fe,re,T,i.left),et=uh(ze.fixed-we,Ge,ze.stretch,F),xt=lh(Ue.stretch-he,be,I,i.top),Wt=uh(Ue.fixed-Xe,Ne,Ue.stretch,H),en=lh(Be.stretch-fe,re,T,i.left),wn=uh(Be.fixed-we,Ge,Be.stretch,F),qi=lh(Te.stretch-he,be,I,i.top),On=uh(Te.fixed-Xe,Ne,Te.stretch,H),mn=new st(it,xt),In=new st(en,xt),Nn=new st(en,qi),Wn=new st(it,qi),xi=new st(et/y,Wt/y),gn=new st(wn/y,On/y),Un=e*Math.PI/180;if(Un){const vi=Math.sin(Un),wi=Math.cos(Un),tn=[wi,-vi,vi,wi];mn._matMult(tn),In._matMult(tn),Wn._matMult(tn),Nn._matMult(tn)}const Xn=ze.stretch+ze.fixed,si=Ue.stretch+Ue.fixed;return{tl:mn,tr:In,bl:Wn,br:Nn,tex:{x:f.paddedRect.x+1+Xn,y:f.paddedRect.y+1+si,w:Be.stretch+Be.fixed-Xn,h:Te.stretch+Te.fixed-si},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xi,pixelOffsetBR:gn,minFontScaleX:Ge/y/T,minFontScaleY:Ne/y/I,isSDF:r}};if(a&&(f.stretchX||f.stretchY)){const ze=ey(M,q,F),Ue=ey(L,oe,H);for(let Be=0;Be<ze.length-1;Be++){const Te=ze[Be],it=ze[Be+1];for(let et=0;et<Ue.length-1;et++)d.push(Ae(Te,Ue[et],it,Ue[et+1]))}}else d.push(Ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return d}function ah(i,e,r){let a=0;for(const d of i)a+=Math.max(e,Math.min(r,d[1]))-Math.max(e,Math.min(r,d[0]));return a}function ey(i,e,r){const a=[{fixed:-1,stretch:0}];for(const[d,f]of i){const y=a[a.length-1];a.push({fixed:d-y.stretch,stretch:y.stretch}),a.push({fixed:d-y.stretch,stretch:y.stretch+(f-d)})}return a.push({fixed:e+1,stretch:r}),a}function lh(i,e,r,a){return i/e*r+a}function uh(i,e,r,a){return i-e*r/a}qe("Anchor",Jo);class ch{constructor(e,r,a,d,f,y,v,b,T,I){if(this.boxStartIndex=e.length,T){let M=y.top,L=y.bottom;const B=y.collisionPadding;B&&(M-=B[1],L+=B[3]);let F=L-M;F>0&&(F=Math.max(10,F),this.circleDiameter=F)}else{let M=y.top*v-b[0],L=y.bottom*v+b[2],B=y.left*v-b[3],F=y.right*v+b[1];const H=y.collisionPadding;if(H&&(B-=H[0]*v,M-=H[1]*v,F+=H[2]*v,L+=H[3]*v),I){const q=new st(B,M),oe=new st(F,M),fe=new st(B,L),re=new st(F,L),he=I*Math.PI/180;q._rotate(he),oe._rotate(he),fe._rotate(he),re._rotate(he),B=Math.min(q.x,oe.x,fe.x,re.x),F=Math.max(q.x,oe.x,fe.x,re.x),M=Math.min(q.y,oe.y,fe.y,re.y),L=Math.max(q.y,oe.y,fe.y,re.y)}e.emplaceBack(r.x,r.y,B,M,F,L,a,d,f)}this.boxEndIndex=e.length}}class g1{constructor(e=[],r=y1){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,d=r[e];for(;e>0;){const f=e-1>>1,y=r[f];if(a(d,y)>=0)break;r[e]=y,e=f}r[e]=d}_down(e){const{data:r,compare:a}=this,d=this.length>>1,f=r[e];for(;e<d;){let y=1+(e<<1),v=r[y];const b=y+1;if(b<this.length&&a(r[b],v)<0&&(y=b,v=r[b]),a(v,f)>=0)break;r[e]=v,e=y}r[e]=f}}function y1(i,e){return i<e?-1:i>e?1:0}function _1(i,e=1,r=!1){let a=1/0,d=1/0,f=-1/0,y=-1/0;const v=i[0];for(let B=0;B<v.length;B++){const F=v[B];(!B||F.x<a)&&(a=F.x),(!B||F.y<d)&&(d=F.y),(!B||F.x>f)&&(f=F.x),(!B||F.y>y)&&(y=F.y)}const b=Math.min(f-a,y-d);let T=b/2;const I=new g1([],x1);if(b===0)return new st(a,d);for(let B=a;B<f;B+=b)for(let F=d;F<y;F+=b)I.push(new ja(B+T,F+T,T,i));let M=function(B){let F=0,H=0,q=0;const oe=B[0];for(let fe=0,re=oe.length,he=re-1;fe<re;he=fe++){const be=oe[fe],we=oe[he],Ge=be.x*we.y-we.x*be.y;H+=(be.x+we.x)*Ge,q+=(be.y+we.y)*Ge,F+=3*Ge}return new ja(H/F,q/F,0,B)}(i),L=I.length;for(;I.length;){const B=I.pop();(B.d>M.d||!M.d)&&(M=B,r&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,L)),B.max-M.d<=e||(T=B.h/2,I.push(new ja(B.p.x-T,B.p.y-T,T,i)),I.push(new ja(B.p.x+T,B.p.y-T,T,i)),I.push(new ja(B.p.x-T,B.p.y+T,T,i)),I.push(new ja(B.p.x+T,B.p.y+T,T,i)),L+=4)}return r&&(console.log(`num probes: ${L}`),console.log(`best distance: ${M.d}`)),M.p}function x1(i,e){return e.max-i.max}function ja(i,e,r,a){this.p=new st(i,e),this.h=r,this.d=function(d,f){let y=!1,v=1/0;for(let b=0;b<f.length;b++){const T=f[b];for(let I=0,M=T.length,L=M-1;I<M;L=I++){const B=T[I],F=T[L];B.y>d.y!=F.y>d.y&&d.x<(F.x-B.x)*(d.y-B.y)/(F.y-B.y)+B.x&&(y=!y),v=Math.min(v,lg(d,B,F))}}return(y?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const Sp=Number.POSITIVE_INFINITY;function ty(i,e){return e[1]!==Sp?function(r,a,d){let f=0,y=0;switch(a=Math.abs(a),d=Math.abs(d),r){case"top-right":case"top-left":case"top":y=d-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-d}switch(r){case"top-right":case"bottom-right":case"right":f=-a;break;case"top-left":case"bottom-left":case"left":f=a}return[f,y]}(i,e[0],e[1]):function(r,a){let d=0,f=0;a<0&&(a=0);const y=a/Math.sqrt(2);switch(r){case"top-right":case"top-left":f=y-7;break;case"bottom-right":case"bottom-left":f=7-y;break;case"bottom":f=7-a;break;case"top":f=a-7}switch(r){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=a;break;case"right":d=-a}return[d,f]}(i,e[0])}function Ep(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function v1(i,e,r,a,d,f,y,v,b,T,I){let M=f.textMaxSize.evaluate(e,{});M===void 0&&(M=y);const L=i.layers[0].layout,B=L.get("icon-offset").evaluate(e,{},I),F=iy(r.horizontal),H=y/24,q=i.tilePixelRatio*H,oe=i.tilePixelRatio*M/24,fe=i.tilePixelRatio*v,re=i.tilePixelRatio*L.get("symbol-spacing"),he=L.get("text-padding")*i.tilePixelRatio,be=function(Te,it,et,xt=1){const Wt=Te.get("icon-padding").evaluate(it,{},et),en=Wt&&Wt.values;return[en[0]*xt,en[1]*xt,en[2]*xt,en[3]*xt]}(L,e,I,i.tilePixelRatio),we=L.get("text-max-angle")/180*Math.PI,Ge=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",Xe=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Ne=L.get("symbol-placement"),Ae=re/2,ze=L.get("icon-text-fit");let Ue;a&&ze!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ue=Zg(a,r.vertical,ze,L.get("icon-text-fit-padding"),B,H)),F&&(a=Zg(a,F,ze,L.get("icon-text-fit-padding"),B,H)));const Be=(Te,it)=>{it.x<0||it.x>=vn||it.y<0||it.y>=vn||function(et,xt,Wt,en,wn,qi,On,mn,In,Nn,Wn,xi,gn,Un,Xn,si,vi,wi,tn,zn,wt,Di,Vn,Hn,ar){const Er=et.addToLineVertexArray(xt,Wt);let Tr,go,lr,Wi,bi=0,yo=0,mu=0,xy=0,Lp=-1,Rp=-1;const _o={};let vy=Cn.exports(""),Bp=0,Fp=0;if(mn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Bp,Fp]=mn.layout.get("text-offset").evaluate(wt,{},Hn).map(Si=>Si*Dn):(Bp=mn.layout.get("text-radial-offset").evaluate(wt,{},Hn)*Dn,Fp=Sp),et.allowVerticalPlacement&&en.vertical){const Si=mn.layout.get("text-rotate").evaluate(wt,{},Hn)+90;lr=new ch(In,xt,Nn,Wn,xi,en.vertical,gn,Un,Xn,Si),On&&(Wi=new ch(In,xt,Nn,Wn,xi,On,vi,wi,Xn,Si))}if(wn){const Si=mn.layout.get("icon-rotate").evaluate(wt,{}),Xr=mn.layout.get("icon-text-fit")!=="none",gu=Qg(wn,Si,Vn,Xr),yu=On?Qg(On,Si,Vn,Xr):void 0;go=new ch(In,xt,Nn,Wn,xi,wn,vi,wi,!1,Si),bi=4*gu.length;const Sy=et.iconSizeData;let Qs=null;Sy.kind==="source"?(Qs=[mo*mn.layout.get("icon-size").evaluate(wt,{})],Qs[0]>Qo&&De(`${et.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Sy.kind==="composite"&&(Qs=[mo*Di.compositeIconSizes[0].evaluate(wt,{},Hn),mo*Di.compositeIconSizes[1].evaluate(wt,{},Hn)],(Qs[0]>Qo||Qs[1]>Qo)&&De(`${et.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),et.addSymbols(et.icon,gu,Qs,zn,tn,wt,l.WritingMode.none,xt,Er.lineStartIndex,Er.lineLength,-1,Hn),Lp=et.icon.placedSymbolArray.length-1,yu&&(yo=4*yu.length,et.addSymbols(et.icon,yu,Qs,zn,tn,wt,l.WritingMode.vertical,xt,Er.lineStartIndex,Er.lineLength,-1,Hn),Rp=et.icon.placedSymbolArray.length-1)}const wy=Object.keys(en.horizontal);for(const Si of wy){const Xr=en.horizontal[Si];if(!Tr){vy=Cn.exports(Xr.text);const yu=mn.layout.get("text-rotate").evaluate(wt,{},Hn);Tr=new ch(In,xt,Nn,Wn,xi,Xr,gn,Un,Xn,yu)}const gu=Xr.positionedLines.length===1;if(mu+=ny(et,xt,Xr,qi,mn,Xn,wt,si,Er,en.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,gu?wy:[Si],_o,Lp,Di,Hn),gu)break}en.vertical&&(xy+=ny(et,xt,en.vertical,qi,mn,Xn,wt,si,Er,l.WritingMode.vertical,["vertical"],_o,Rp,Di,Hn));const D1=Tr?Tr.boxStartIndex:et.collisionBoxArray.length,L1=Tr?Tr.boxEndIndex:et.collisionBoxArray.length,R1=lr?lr.boxStartIndex:et.collisionBoxArray.length,B1=lr?lr.boxEndIndex:et.collisionBoxArray.length,F1=go?go.boxStartIndex:et.collisionBoxArray.length,O1=go?go.boxEndIndex:et.collisionBoxArray.length,N1=Wi?Wi.boxStartIndex:et.collisionBoxArray.length,U1=Wi?Wi.boxEndIndex:et.collisionBoxArray.length;let kr=-1;const mh=(Si,Xr)=>Si&&Si.circleDiameter?Math.max(Si.circleDiameter,Xr):Xr;kr=mh(Tr,kr),kr=mh(lr,kr),kr=mh(go,kr),kr=mh(Wi,kr);const by=kr>-1?1:0;by&&(kr*=ar/Dn),et.glyphOffsetArray.length>=Ga.MAX_GLYPHS&&De("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wt.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,wt.sortKey),et.symbolInstances.emplaceBack(xt.x,xt.y,_o.right>=0?_o.right:-1,_o.center>=0?_o.center:-1,_o.left>=0?_o.left:-1,_o.vertical||-1,Lp,Rp,vy,D1,L1,R1,B1,F1,O1,N1,U1,Nn,mu,xy,bi,yo,by,0,gn,Bp,Fp,kr)}(i,it,Te,r,a,d,Ue,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,q,[he,he,he,he],Ge,b,fe,be,Xe,B,e,f,T,I,y)};if(Ne==="line")for(const Te of Jg(e.geometry,0,0,vn,vn)){const it=m1(Te,re,we,r.vertical||F,a,24,oe,i.overscaling,vn);for(const et of it){const xt=F;xt&&w1(i,xt.text,Ae,et)||Be(Te,et)}}else if(Ne==="line-center"){for(const Te of e.geometry)if(Te.length>1){const it=f1(Te,we,r.vertical||F,a,24,oe);it&&Be(Te,it)}}else if(e.type==="Polygon")for(const Te of hp(e.geometry,0)){const it=_1(Te,16);Be(Te[0],new Jo(it.x,it.y,0))}else if(e.type==="LineString")for(const Te of e.geometry)Be(Te,new Jo(Te[0].x,Te[0].y,0));else if(e.type==="Point")for(const Te of e.geometry)for(const it of Te)Be([it],new Jo(it.x,it.y,0))}const Qo=32640;function ny(i,e,r,a,d,f,y,v,b,T,I,M,L,B,F){const H=function(fe,re,he,be,we,Ge,Xe,Ne){const Ae=be.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,ze=[];for(const Ue of re.positionedLines)for(const Be of Ue.positionedGlyphs){if(!Be.rect)continue;const Te=Be.rect||{};let it=4,et=!0,xt=1,Wt=0;const en=(we||Ne)&&Be.vertical,wn=Be.metrics.advance*Be.scale/2;if(Ne&&re.verticalizable){const tn=(Be.scale-1)*Dn,zn=(Dn-Be.metrics.width*Be.scale)/2;Wt=Ue.lineOffset/2-(Be.imageName?-zn:tn)}if(Be.imageName){const tn=Xe[Be.imageName];et=tn.sdf,xt=tn.pixelRatio,it=1/xt}const qi=we?[Be.x+wn,Be.y]:[0,0];let On=we?[0,0]:[Be.x+wn+he[0],Be.y+he[1]-Wt],mn=[0,0];en&&(mn=On,On=[0,0]);const In=(Be.metrics.left-it)*Be.scale-wn+On[0],Nn=(-Be.metrics.top-it)*Be.scale+On[1],Wn=In+Te.w*Be.scale/xt,xi=Nn+Te.h*Be.scale/xt,gn=new st(In,Nn),Un=new st(Wn,Nn),Xn=new st(In,xi),si=new st(Wn,xi);if(en){const tn=new st(-wn,wn-rh),zn=-Math.PI/2,wt=12-wn,Di=new st(22-wt,-(Be.imageName?wt:0)),Vn=new st(...mn);gn._rotateAround(zn,tn)._add(Di)._add(Vn),Un._rotateAround(zn,tn)._add(Di)._add(Vn),Xn._rotateAround(zn,tn)._add(Di)._add(Vn),si._rotateAround(zn,tn)._add(Di)._add(Vn)}if(Ae){const tn=Math.sin(Ae),zn=Math.cos(Ae),wt=[zn,-tn,tn,zn];gn._matMult(wt),Un._matMult(wt),Xn._matMult(wt),si._matMult(wt)}const vi=new st(0,0),wi=new st(0,0);ze.push({tl:gn,tr:Un,bl:Xn,br:si,tex:Te,writingMode:re.writingMode,glyphOffset:qi,sectionIndex:Be.sectionIndex,isSDF:et,pixelOffsetTL:vi,pixelOffsetBR:wi,minFontScaleX:0,minFontScaleY:0})}return ze}(0,r,v,d,f,y,a,i.allowVerticalPlacement),q=i.textSizeData;let oe=null;q.kind==="source"?(oe=[mo*d.layout.get("text-size").evaluate(y,{})],oe[0]>Qo&&De(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):q.kind==="composite"&&(oe=[mo*B.compositeTextSizes[0].evaluate(y,{},F),mo*B.compositeTextSizes[1].evaluate(y,{},F)],(oe[0]>Qo||oe[1]>Qo)&&De(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,H,oe,v,f,y,T,e,b.lineStartIndex,b.lineLength,L,F);for(const fe of I)M[fe]=i.text.placedSymbolArray.length-1;return 4*H.length}function iy(i){for(const e in i)return i[e];return null}function w1(i,e,r,a){const d=i.compareText;if(e in d){const f=d[e];for(let y=f.length-1;y>=0;y--)if(a.dist(f[y])<r)return!0}else d[e]=[];return d[e].push(a),!1}const b1=Ko.VectorTileFeature.types,S1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hh(i,e,r,a,d,f,y,v,b,T,I,M,L){const B=v?Math.min(Qo,Math.round(v[0])):0,F=v?Math.min(Qo,Math.round(v[1])):0;i.emplaceBack(e,r,Math.round(32*a),Math.round(32*d),f,y,(B<<1)+(b?1:0),F,16*T,16*I,256*M,256*L)}function Tp(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function E1(i){for(const e of i.sections)if(Uc(e.text))return!0;return!1}class kp{constructor(e){this.layoutVertexArray=new or,this.indexArray=new ii,this.programConfigurations=e,this.segments=new vt,this.dynamicLayoutVertexArray=new ji,this.opacityVertexArray=new sr,this.placedSymbolArray=new Ee}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Xv.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,S1,!0),this.opacityVertexBuffer.itemSize=1),(a||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qe("SymbolBuffers",kp);class Cp{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new vt,this.collisionVertexArray=new Mi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Hv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qe("CollisionBuffers",Cp);class Ga{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=op([]),this.placementViewportMatrix=op([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qg(this.zoom,r["text-size"]),this.iconSizeData=qg(this.zoom,r["icon-size"]);const a=this.layers[0].layout,d=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.canOverlap=zp(a,"text-overlap","text-allow-overlap")!=="never"||zp(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>l.WritingMode[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new kp(new Xs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new kp(new Xs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Me,this.lineVertexArray=new je,this.symbolInstances=new $e}calculateGlyphDependencies(e,r,a,d,f){for(let y=0;y<e.length;y++)if(r[e.charCodeAt(y)]=!0,(a||d)&&f){const v=hu[e.charAt(y)];v&&(r[v.charCodeAt(0)]=!0)}}populate(e,r,a){const d=this.layers[0],f=d.layout,y=f.get("text-font"),v=f.get("text-field"),b=f.get("icon-image"),T=(v.value.kind!=="constant"||v.value.value instanceof J&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),I=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,M=f.get("symbol-sort-key");if(this.features=[],!T&&!I)return;const L=r.iconDependencies,B=r.glyphDependencies,F=r.availableImages,H=new Jt(this.zoom);for(const{feature:q,id:oe,index:fe,sourceLayerIndex:re}of e){const he=d._featureFilter.needGeometry,be=Ks(q,he);if(!d._featureFilter.filter(H,be,a))continue;let we,Ge;if(he||(be.geometry=Hs(q)),T){const Ne=d.getValueAndResolveTokens("text-field",be,a,F),Ae=J.factory(Ne);E1(Ae)&&(this.hasRTLText=!0),(!this.hasRTLText||Zs()==="unavailable"||this.hasRTLText&&Pi.isParsed())&&(we=Yv(Ae,d,be))}if(I){const Ne=d.getValueAndResolveTokens("icon-image",be,a,F);Ge=Ne instanceof ne?Ne:ne.fromString(Ne)}if(!we&&!Ge)continue;const Xe=this.sortFeaturesByKey?M.evaluate(be,{},a):void 0;if(this.features.push({id:oe,text:we,icon:Ge,index:fe,sourceLayerIndex:re,geometry:be.geometry,properties:q.properties,type:b1[q.type],sortKey:Xe}),Ge&&(L[Ge.name]=!0),we){const Ne=y.evaluate(be,{},a).join(","),Ae=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const ze of we.sections)if(ze.image)L[ze.image.name]=!0;else{const Ue=Aa(we.toString()),Be=ze.fontStack||Ne,Te=B[Be]=B[Be]||{};this.calculateGlyphDependencies(ze.text,Te,Ae,this.allowVerticalPlacement,Ue)}}}f.get("symbol-placement")==="line"&&(this.features=function(q){const oe={},fe={},re=[];let he=0;function be(Ne){re.push(q[Ne]),he++}function we(Ne,Ae,ze){const Ue=fe[Ne];return delete fe[Ne],fe[Ae]=Ue,re[Ue].geometry[0].pop(),re[Ue].geometry[0]=re[Ue].geometry[0].concat(ze[0]),Ue}function Ge(Ne,Ae,ze){const Ue=oe[Ae];return delete oe[Ae],oe[Ne]=Ue,re[Ue].geometry[0].shift(),re[Ue].geometry[0]=ze[0].concat(re[Ue].geometry[0]),Ue}function Xe(Ne,Ae,ze){const Ue=ze?Ae[0][Ae[0].length-1]:Ae[0][0];return`${Ne}:${Ue.x}:${Ue.y}`}for(let Ne=0;Ne<q.length;Ne++){const Ae=q[Ne],ze=Ae.geometry,Ue=Ae.text?Ae.text.toString():null;if(!Ue){be(Ne);continue}const Be=Xe(Ue,ze),Te=Xe(Ue,ze,!0);if(Be in fe&&Te in oe&&fe[Be]!==oe[Te]){const it=Ge(Be,Te,ze),et=we(Be,Te,re[it].geometry);delete oe[Be],delete fe[Te],fe[Xe(Ue,re[et].geometry,!0)]=et,re[it].geometry=null}else Be in fe?we(Be,Te,ze):Te in oe?Ge(Be,Te,ze):(be(Ne),oe[Be]=he-1,fe[Te]=he-1)}return re.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((q,oe)=>q.sortKey-oe.sortKey)}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(r[e.segment+1]),f=e.dist(r[e.segment]);const y={};for(let v=e.segment+1;v<r.length;v++)y[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:d},v<r.length-1&&(d+=r[v+1].dist(r[v]));for(let v=e.segment||0;v>=0;v--)y[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:f},v>0&&(f+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const b=y[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,d,f,y,v,b,T,I,M,L){const B=e.indexArray,F=e.layoutVertexArray,H=e.segments.prepareSegment(4*r.length,F,B,this.canOverlap?y.sortKey:void 0),q=this.glyphOffsetArray.length,oe=H.vertexLength,fe=this.allowVerticalPlacement&&v===l.WritingMode.vertical?Math.PI/2:0,re=y.text&&y.text.sections;for(let he=0;he<r.length;he++){const{tl:be,tr:we,bl:Ge,br:Xe,tex:Ne,pixelOffsetTL:Ae,pixelOffsetBR:ze,minFontScaleX:Ue,minFontScaleY:Be,glyphOffset:Te,isSDF:it,sectionIndex:et}=r[he],xt=H.vertexLength,Wt=Te[1];hh(F,b.x,b.y,be.x,Wt+be.y,Ne.x,Ne.y,a,it,Ae.x,Ae.y,Ue,Be),hh(F,b.x,b.y,we.x,Wt+we.y,Ne.x+Ne.w,Ne.y,a,it,ze.x,Ae.y,Ue,Be),hh(F,b.x,b.y,Ge.x,Wt+Ge.y,Ne.x,Ne.y+Ne.h,a,it,Ae.x,ze.y,Ue,Be),hh(F,b.x,b.y,Xe.x,Wt+Xe.y,Ne.x+Ne.w,Ne.y+Ne.h,a,it,ze.x,ze.y,Ue,Be),Tp(e.dynamicLayoutVertexArray,b,fe),B.emplaceBack(xt,xt+1,xt+2),B.emplaceBack(xt+1,xt+2,xt+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Te[0]),he!==r.length-1&&et===r[he+1].sectionIndex||e.programConfigurations.populatePaintArrays(F.length,y,y.index,{},L,re&&re[et])}e.placedSymbolArray.emplaceBack(b.x,b.y,q,this.glyphOffsetArray.length-q,oe,T,I,b.segment,a?a[0]:0,a?a[1]:0,d[0],d[1],v,0,!1,0,M)}_addCollisionDebugVertex(e,r,a,d,f,y){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,d,f,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,r,a,d,f,y,v){const b=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),T=b.vertexLength,I=f.layoutVertexArray,M=f.collisionVertexArray,L=v.anchorX,B=v.anchorY;this._addCollisionDebugVertex(I,M,y,L,B,new st(e,r)),this._addCollisionDebugVertex(I,M,y,L,B,new st(a,r)),this._addCollisionDebugVertex(I,M,y,L,B,new st(a,d)),this._addCollisionDebugVertex(I,M,y,L,B,new st(e,d)),b.vertexLength+=4;const F=f.indexArray;F.emplaceBack(T,T+1),F.emplaceBack(T+1,T+2),F.emplaceBack(T+2,T+3),F.emplaceBack(T+3,T),b.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,d){for(let f=e;f<r;f++){const y=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,d?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cp(qr,Ag.members,br),this.iconCollisionBox=new Cp(qr,Ag.members,br);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,d,f,y,v,b,T){const I={};for(let M=r;M<a;M++){const L=e.get(M);I.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.textFeatureIndex=L.featureIndex;break}for(let M=d;M<f;M++){const L=e.get(M);I.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalTextFeatureIndex=L.featureIndex;break}for(let M=y;M<v;M++){const L=e.get(M);I.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.iconFeatureIndex=L.featureIndex;break}for(let M=b;M<T;M++){const L=e.get(M);I.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalIconFeatureIndex=L.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),d=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<d;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),d=[],f=[],y=[];for(let v=0;v<this.symbolInstances.length;++v){y.push(v);const b=this.symbolInstances.get(v);d.push(0|Math.round(r*b.anchorX+a*b.anchorY)),f.push(b.featureIndex)}return y.sort((v,b)=>d[v]-d[b]||f[b]-f[v]),y}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((d,f,y)=>{d>=0&&y.indexOf(d)===f&&this.addIndicesForPlacedSymbol(this.text,d)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}qe("SymbolBucket",Ga,{omit:["layers","collisionBoxArray","features","compareText"]}),Ga.MAX_GLYPHS=65535,Ga.addDynamicAttributes=Tp;const T1=new An({"symbol-placement":new Ye(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new Ye(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ye(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ot(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ye(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ye(ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ye(ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ye(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ye(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ye(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new ot(ve.layout_symbol["icon-size"]),"icon-text-fit":new Ye(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ye(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new ot(ve.layout_symbol["icon-image"]),"icon-rotate":new ot(ve.layout_symbol["icon-rotate"]),"icon-padding":new ot(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new Ye(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new ot(ve.layout_symbol["icon-offset"]),"icon-anchor":new ot(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ye(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ye(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ye(ve.layout_symbol["text-rotation-alignment"]),"text-field":new ot(ve.layout_symbol["text-field"]),"text-font":new ot(ve.layout_symbol["text-font"]),"text-size":new ot(ve.layout_symbol["text-size"]),"text-max-width":new ot(ve.layout_symbol["text-max-width"]),"text-line-height":new Ye(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new ot(ve.layout_symbol["text-letter-spacing"]),"text-justify":new ot(ve.layout_symbol["text-justify"]),"text-radial-offset":new ot(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ye(ve.layout_symbol["text-variable-anchor"]),"text-anchor":new ot(ve.layout_symbol["text-anchor"]),"text-max-angle":new Ye(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new Ye(ve.layout_symbol["text-writing-mode"]),"text-rotate":new ot(ve.layout_symbol["text-rotate"]),"text-padding":new Ye(ve.layout_symbol["text-padding"]),"text-keep-upright":new Ye(ve.layout_symbol["text-keep-upright"]),"text-transform":new ot(ve.layout_symbol["text-transform"]),"text-offset":new ot(ve.layout_symbol["text-offset"]),"text-allow-overlap":new Ye(ve.layout_symbol["text-allow-overlap"]),"text-overlap":new Ye(ve.layout_symbol["text-overlap"]),"text-ignore-placement":new Ye(ve.layout_symbol["text-ignore-placement"]),"text-optional":new Ye(ve.layout_symbol["text-optional"])});var Ip={paint:new An({"icon-opacity":new ot(ve.paint_symbol["icon-opacity"]),"icon-color":new ot(ve.paint_symbol["icon-color"]),"icon-halo-color":new ot(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new ot(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ot(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new Ye(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ye(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new ot(ve.paint_symbol["text-opacity"]),"text-color":new ot(ve.paint_symbol["text-color"],{runtimeType:Mn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ot(ve.paint_symbol["text-halo-color"]),"text-halo-width":new ot(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new ot(ve.paint_symbol["text-halo-blur"]),"text-translate":new Ye(ve.paint_symbol["text-translate"]),"text-translate-anchor":new Ye(ve.paint_symbol["text-translate-anchor"])}),layout:T1};class ry{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Or,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qe("FormatSectionOverride",ry,{omit:["defaultValue"]});class dh extends rr{constructor(e){super(e,Ip)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const d=[];for(const f of a)d.indexOf(f)<0&&d.push(f);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,d){const f=this.layout.get(e).evaluate(r,{},a,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||As(y.value)||!f?f:function(v,b){return b.replace(/{([^{}]+)}/g,(T,I)=>I in v?String(v[I]):"")}(r.properties,f)}createBucket(e){return new Ga(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Ip.paint.overridableProperties){if(!dh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new ry(r),d=new ka(a,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new Ls("source",d):new Nl("composite",d,r.value.zoomStops),this.paint._values[e]=new ir(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&dh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),d=Ip.paint.properties[r];let f=!1;const y=v=>{for(const b of v)if(d.overrides&&d.overrides.hasOverride(b))return void(f=!0)};if(a.value.kind==="constant"&&a.value.value instanceof J)y(a.value.value.sections);else if(a.value.kind==="source"){const v=T=>{f||(T instanceof Ke&&me(T.value)===Sn?y(T.value.sections):T instanceof Ea?y(T.sections):T.eachChild(v))},b=a.value;b._styleExpression&&v(b._styleExpression.expression)}return f}}function zp(i,e,r){let a="never";const d=i.get(e);return d?a=d:i.get(r)&&(a="always"),a}var k1={paint:new An({"background-color":new Ye(ve.paint_background["background-color"]),"background-pattern":new Yl(ve.paint_background["background-pattern"]),"background-opacity":new Ye(ve.paint_background["background-opacity"])})},C1={paint:new An({"raster-opacity":new Ye(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ye(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ye(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ye(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new Ye(ve.paint_raster["raster-saturation"]),"raster-contrast":new Ye(ve.paint_raster["raster-contrast"]),"raster-resampling":new Ye(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new Ye(ve.paint_raster["raster-fade-duration"])})};class I1 extends rr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const z1={circle:class extends rr{constructor(i){super(i,sv)}createBucket(i){return new np(i)}queryRadius(i){const e=i;return nu("circle-radius",this,e)+nu("circle-stroke-width",this,e)+Hc(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,a,d,f,y,v){const b=Kc(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,y),T=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),I=this.paint.get("circle-pitch-alignment")==="map",M=I?b:function(B,F){return B.map(H=>mg(H,F))}(b,v),L=I?T*y:T;for(const B of a)for(const F of B){const H=I?F:mg(F,v);let q=L;const oe=Yc([],[F.x,F.y,0,1],v);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?q*=oe[3]/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(q*=f.cameraToCenterDistance/oe[3]),tv(M,H,q))return!0}return!1}},heatmap:class extends rr{constructor(i){super(i,lv),this._updateColorRamp()}createBucket(i){return new gg(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_g({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends rr{constructor(i){super(i,uv)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends rr{constructor(i){super(i,Tv)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new fp(i)}queryRadius(){return Hc(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,a,d,f,y){return ag(Kc(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,y),a)}isTileClipped(){return!0}},"fill-extrusion":class extends rr{constructor(i){super(i,Nv)}createBucket(i){return new gp(i)}queryRadius(){return Hc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,a,d,f,y,v){const b=Kc(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,y),T=this.paint.get("fill-extrusion-height").evaluate(e,r),I=this.paint.get("fill-extrusion-base").evaluate(e,r),M=function(B,F,H,q){const oe=[];for(const fe of B){const re=[fe.x,fe.y,0,1];Yc(re,re,F),oe.push(new st(re[0]/re[3],re[1]/re[3]))}return oe}(b,v),L=function(B,F,H,q){const oe=[],fe=[],re=q[8]*F,he=q[9]*F,be=q[10]*F,we=q[11]*F,Ge=q[8]*H,Xe=q[9]*H,Ne=q[10]*H,Ae=q[11]*H;for(const ze of B){const Ue=[],Be=[];for(const Te of ze){const it=Te.x,et=Te.y,xt=q[0]*it+q[4]*et+q[12],Wt=q[1]*it+q[5]*et+q[13],en=q[2]*it+q[6]*et+q[14],wn=q[3]*it+q[7]*et+q[15],qi=en+be,On=wn+we,mn=xt+Ge,In=Wt+Xe,Nn=en+Ne,Wn=wn+Ae,xi=new st((xt+re)/On,(Wt+he)/On);xi.z=qi/On,Ue.push(xi);const gn=new st(mn/Wn,In/Wn);gn.z=Nn/Wn,Be.push(gn)}oe.push(Ue),fe.push(Be)}return[oe,fe]}(a,I,T,v);return function(B,F,H){let q=1/0;ag(H,F)&&(q=Cg(H,F[0]));for(let oe=0;oe<F.length;oe++){const fe=F[oe],re=B[oe];for(let he=0;he<fe.length-1;he++){const be=fe[he],we=[be,fe[he+1],re[he+1],re[he],be];sg(H,we)&&(q=Math.min(q,Cg(H,we)))}}return q!==1/0&&q}(L[0],L[1],M)}},line:class extends rr{constructor(i){super(i,zg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Cs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Pg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new yp(i)}queryRadius(i){const e=i,r=Mg(nu("line-width",this,e),nu("line-gap-width",this,e)),a=nu("line-offset",this,e);return r/2+Math.abs(a)+Hc(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,a,d,f,y){const v=Kc(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,y),b=y/2*Mg(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),T=this.paint.get("line-offset").evaluate(e,r);return T&&(a=function(I,M){const L=[];for(let B=0;B<I.length;B++){const F=I[B],H=[];for(let q=0;q<F.length;q++){const oe=F[q-1],fe=F[q],re=F[q+1],he=q===0?new st(0,0):fe.sub(oe)._unit()._perp(),be=q===F.length-1?new st(0,0):re.sub(fe)._unit()._perp(),we=he._add(be)._unit(),Ge=we.x*be.x+we.y*be.y;Ge!==0&&we._mult(1/Ge),H.push(we._mult(M)._add(fe))}L.push(H)}return L}(a,T*y)),function(I,M,L){for(let B=0;B<M.length;B++){const F=M[B];if(I.length>=3){for(let H=0;H<F.length;H++)if(Fa(I,F[H]))return!0}if(nv(I,F,L))return!0}return!1}(v,a,b)}isTileClipped(){return!0}},symbol:dh,background:class extends rr{constructor(i){super(i,k1)}},raster:class extends rr{constructor(i){super(i,C1)}}};class P1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const oy=63710088e-1;class an{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new an(Fe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,d=e.lat*r,f=Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos((e.lng-this.lng)*r);return oy*Math.acos(Math.min(f,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new Js(new an(this.lng-a,this.lat-r),new an(this.lng+a,this.lat+r))}static convert(e){if(e instanceof an)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new an(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new an(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Js{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof an?new an(e.lng,e.lat):an.convert(e),this}setSouthWest(e){return this._sw=e instanceof an?new an(e.lng,e.lat):an.convert(e),this}extend(e){const r=this._sw,a=this._ne;let d,f;if(e instanceof an)d=e,f=e;else{if(!(e instanceof Js))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Js.convert(e)):this.extend(an.convert(e)):this;if(d=e._sw,f=e._ne,!d||!f)return this}return r||a?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),a.lng=Math.max(f.lng,a.lng),a.lat=Math.max(f.lat,a.lat)):(this._sw=new an(d.lng,d.lat),this._ne=new an(f.lng,f.lat)),this}getCenter(){return new an((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new an(this.getWest(),this.getNorth())}getSouthEast(){return new an(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=an.convert(e);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&d}static convert(e){return e instanceof Js?e:e&&new Js(e)}}const sy=2*Math.PI*oy;function ay(i){return sy*Math.cos(i*Math.PI/180)}function ly(i){return(180+i)/360}function uy(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function cy(i,e){return i/ay(e)}function Pp(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class ph{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=an.convert(e);return new ph(ly(a.lng),uy(a.lat),cy(r,a.lat))}toLngLat(){return new an(360*this.x-180,Pp(this.y))}toAltitude(){return this.z*ay(Pp(this.y))}meterInMercatorCoordinateUnits(){return 1/sy*(e=Pp(this.y),1/Math.cos(e*Math.PI/180));var e}}function hy(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Mp{constructor(e,r,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=pu(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const d=(y=this.y,v=this.z,b=hy(256*(f=this.x),256*(y=Math.pow(2,v)-y-1),v),T=hy(256*(f+1),256*(y+1),v),b[0]+","+b[1]+","+T[0]+","+T[1]);var f,y,v,b,T;const I=function(M,L,B){let F,H="";for(let q=M;q>0;q--)F=1<<q-1,H+=(L&F?1:0)+(B&F?2:0);return H}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new st((e.x*r-this.x)*vn,(e.y*r-this.y)*vn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dy{constructor(e,r){this.wrap=e,this.canonical=r,this.key=pu(e,r.z,r.z,r.x,r.y)}}class Zi{constructor(e,r,a,d,f){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Mp(a,+d,+f),this.key=pu(r,e,a,d,f)}clone(){return new Zi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Zi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zi(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?pu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):pu(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Zi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,d=2*this.canonical.y;return[new Zi(r,this.wrap,r,a,d),new Zi(r,this.wrap,r,a+1,d),new Zi(r,this.wrap,r,a,d+1),new Zi(r,this.wrap,r,a+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Zi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Zi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new ph(e.x-this.wrap,e.y))}}function pu(i,e,r,a,d){(i*=2)<0&&(i=-1*i-1);const f=1<<r;return(f*f*i+f*d+a).toString(36)+r.toString(36)+e.toString(36)}qe("CanonicalTileID",Mp),qe("OverscaledTileID",Zi,{omit:["posMatrix"]});class py{constructor(e,r,a){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void De(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const d=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=a||"mapbox";for(let f=0;f<d;f++)this.data[this._idx(-1,f)]=this.data[this._idx(0,f)],this.data[this._idx(d,f)]=this.data[this._idx(d-1,f)],this.data[this._idx(f,-1)]=this.data[this._idx(f,0)],this.data[this._idx(f,d)]=this.data[this._idx(f,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let f=0;f<d;f++)for(let y=0;y<d;y++){const v=this.get(f,y);v>this.max&&(this.max=v),v<this.min&&(this.min=v)}}get(e,r){const a=new Uint8Array(this.data.buffer),d=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(a[d],a[d+1],a[d+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,a){return(256*e*256+256*r+a)/10-1e4}_unpackTerrarium(e,r,a){return 256*e+r+a/256-32768}getPixels(){return new Gi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=r*this.dim,f=r*this.dim+this.dim,y=a*this.dim,v=a*this.dim+this.dim;switch(r){case-1:d=f-1;break;case 1:f=d+1}switch(a){case-1:y=v-1;break;case 1:v=y+1}const b=-r*this.dim,T=-a*this.dim;for(let I=y;I<v;I++)for(let M=d;M<f;M++)this.data[this._idx(M,I)]=e.data[this._idx(M+b,I+T)]}}qe("DEMData",py);class fy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class my{constructor(e,r,a,d,f){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=d,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class gy{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Gs(vn,16,0),this.grid3D=new Gs(vn,16,0),this.featureIndexArray=new _t,this.promoteId=r}insert(e,r,a,d,f,y){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,d,f);const b=y?this.grid3D:this.grid;for(let T=0;T<r.length;T++){const I=r[T],M=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){const B=I[L];M[0]=Math.min(M[0],B.x),M[1]=Math.min(M[1],B.y),M[2]=Math.max(M[2],B.x),M[3]=Math.max(M[3],B.y)}M[0]<vn&&M[1]<vn&&M[2]>=0&&M[3]>=0&&b.insert(v,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ko.VectorTile(new _p(this.rawTileData)).layers,this.sourceLayerCoder=new fy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,a,d){this.loadVTLayers();const f=e.params||{},y=vn/e.tileSize/e.scale,v=za(f.filter),b=e.queryGeometry,T=e.queryPadding*y,I=_y(b),M=this.grid.query(I.minX-T,I.minY-T,I.maxX+T,I.maxY+T),L=_y(e.cameraQueryGeometry),B=this.grid3D.query(L.minX-T,L.minY-T,L.maxX+T,L.maxY+T,(q,oe,fe,re)=>function(he,be,we,Ge,Xe){for(const Ae of he)if(be<=Ae.x&&we<=Ae.y&&Ge>=Ae.x&&Xe>=Ae.y)return!0;const Ne=[new st(be,we),new st(be,Xe),new st(Ge,Xe),new st(Ge,we)];if(he.length>2){for(const Ae of Ne)if(Fa(he,Ae))return!0}for(let Ae=0;Ae<he.length-1;Ae++)if(rv(he[Ae],he[Ae+1],Ne))return!0;return!1}(e.cameraQueryGeometry,q-T,oe-T,fe+T,re+T));for(const q of B)M.push(q);M.sort(M1);const F={};let H;for(let q=0;q<M.length;q++){const oe=M[q];if(oe===H)continue;H=oe;const fe=this.featureIndexArray.get(oe);let re=null;this.loadMatchingFeature(F,fe.bucketIndex,fe.sourceLayerIndex,fe.featureIndex,v,f.layers,f.availableImages,r,a,d,(he,be,we)=>(re||(re=Hs(he)),be.queryIntersectsFeature(b,he,we,re,this.z,e.transform,y,e.pixelPosMatrix)))}return F}loadMatchingFeature(e,r,a,d,f,y,v,b,T,I,M){const L=this.bucketLayerIDs[r];if(y&&!function(q,oe){for(let fe=0;fe<q.length;fe++)if(oe.indexOf(q[fe])>=0)return!0;return!1}(y,L))return;const B=this.sourceLayerCoder.decode(a),F=this.vtLayers[B].feature(d);if(f.needGeometry){const q=Ks(F,!0);if(!f.filter(new Jt(this.tileID.overscaledZ),q,this.tileID.canonical))return}else if(!f.filter(new Jt(this.tileID.overscaledZ),F))return;const H=this.getId(F,B);for(let q=0;q<L.length;q++){const oe=L[q];if(y&&y.indexOf(oe)<0)continue;const fe=b[oe];if(!fe)continue;let re={};H&&I&&(re=I.getState(fe.sourceLayer||"_geojsonTileLayer",H));const he=Le({},T[oe]);he.paint=yy(he.paint,fe.paint,F,re,v),he.layout=yy(he.layout,fe.layout,F,re,v);const be=!M||M(F,fe,re);if(!be)continue;const we=new my(F,this.z,this.x,this.y,H);we.layer=he;let Ge=e[oe];Ge===void 0&&(Ge=e[oe]=[]),Ge.push({featureIndex:d,feature:we,intersectionZ:be})}}lookupSymbolFeatures(e,r,a,d,f,y,v,b){const T={};this.loadVTLayers();const I=za(f);for(const M of e)this.loadMatchingFeature(T,a,d,M,I,y,v,b,r);return T}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function yy(i,e,r,a,d){return ae(i,(f,y)=>{const v=e instanceof Ws?e.get(y):null;return v&&v.evaluate?v.evaluate(r,a,d):v})}function _y(i){let e=1/0,r=1/0,a=-1/0,d=-1/0;for(const f of i)e=Math.min(e,f.x),r=Math.min(r,f.y),a=Math.max(a,f.x),d=Math.max(d,f.y);return{minX:e,minY:r,maxX:a,maxY:d}}function M1(i,e){return e-i}var Ap;qe("FeatureIndex",gy,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(Ap=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",Ap.load="load",Ap.fullLoad="fullLoad";let fh=null,fu=[];const Dp=1e3/30,A1={mark(i){performance.mark(i)},frame(i){const e=i;fh!=null&&fu.push(e-fh),fh=e},clearMetrics(){fh=null,fu=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=fu.length,a=1/(fu.reduce((f,y)=>f+y,0)/r/1e3),d=fu.filter(f=>f>Dp).reduce((f,y)=>f+(y-Dp)/Dp,0);return{loadTime:i,fullLoadTime:e,fps:a,percentDroppedFrames:d/(r+d)*100}}};l.AJAXError=pi,l.ARRAY_TYPE=oi,l.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ot(["receive","process"],this),this.invoker=new P1(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Qe()?i:window}send(i,e,r,a,d=!1){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[f]=r);const y=Ii(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:i,hasCallback:!!r,targetMapId:a,mustQueue:d,sourceMapId:this.mapId,data:ao(e,y)},y),{cancel:()=>{r&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a()}else Qe()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Vr(e.error)):r(null,Vr(e.data)))}else{let r=!1;const a=Ii(this.globalScope)?void 0:[],d=e.hasCallback?(v,b)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:v?ao(v):null,data:ao(b,a)},a)}:v=>{r=!0};let f=null;const y=Vr(e.data);if(this.parent[e.type])f=this.parent[e.type](e.sourceMapId,y,d);else if(this.parent.getWorkerSource){const v=e.type.split(".");f=this.parent.getWorkerSource(e.sourceMapId,v[0],y.source)[v[1]](y,d)}else d(new Error(`Could not find function ${e.type}`));!r&&f&&f.cancel&&(this.cancelCallbacks[i]=f.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=ru,l.CanonicalTileID=Mp,l.CollisionBoxArray=_e,l.CollisionCircleLayoutArray=class extends P{},l.Color=N,l.DEMData=py,l.DataConstantProperty=Ye,l.DictionaryCoder=fy,l.EXTENT=vn,l.ErrorEvent=Ao,l.EvaluationParameters=Jt,l.Event=yr,l.Evented=_r,l.FeatureIndex=gy,l.FillBucket=fp,l.FillExtrusionBucket=gp,l.GeoJSONFeature=my,l.ImageAtlas=Ug,l.ImagePosition=vp,l.LineBucket=yp,l.LineStripIndexArray=class extends Z{},l.LngLat=an,l.LngLatBounds=Js,l.MercatorCoordinate=ph,l.ONE_EM=Dn,l.OverscaledTileID=Zi,l.PerformanceUtils=A1,l.PosArray=nt,l.Properties=An,l.QuadTriangleArray=class extends R{},l.RGBAImage=Gi,l.RasterBoundsArray=class extends h{},l.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},l.ResourceType=mr,l.SegmentVector=vt,l.SymbolBucket=Ga,l.Transitionable=jc,l.TriangleIndexArray=ii,l.Uniform1f=ho,l.Uniform1i=class extends co{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},l.Uniform2f=class extends co{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},l.Uniform3f=class extends co{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},l.Uniform4f=Ra,l.UniformColor=ng,l.UniformMatrix4f=class extends co{constructor(i,e){super(i,e),this.current=Q0}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},l.UnwrappedTileID=dy,l.ValidationError=Re,l.ZoomHistory=jl,l.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},l.addDynamicAttributes=Tp,l.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let a=i.length;const d=new Array(i.length);let f=null;i.forEach((y,v)=>{e(y,(b,T)=>{b&&(f=b),d[v]=T,--a==0&&r(f,d)})})},l.bezier=pe,l.bindAll=Ot,l.cacheEntryPossiblyAdded=function(i){ei++,ei>Ui&&(i.getActor().send("enforceCacheSizeLimit",Xt),ei=0)},l.clamp=W,l.clearTileCache=function(i){const e=caches.delete(at);i&&e.catch(i).then(()=>i())},l.clipLine=Jg,l.clone=function(i){var e=new oi(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},l.clone$1=se,l.clone$2=function(i){var e=new oi(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},l.collisionCircleLayout=Kv,l.config=Ze,l.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},l.create=function(){var i=new oi(16);return oi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},l.create$1=cg,l.createExpression=Ds,l.createFilter=za,l.createLayout=fn,l.createStyleLayer=function(i){return i.type==="custom"?new I1(i):new z1[i.type](i)},l.cross=function(i,e,r){var a=e[0],d=e[1],f=e[2],y=r[0],v=r[1],b=r[2];return i[0]=d*b-f*v,i[1]=f*y-a*b,i[2]=a*v-d*y,i},l.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},l.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},l.ease=le,l.emitValidationErrors=Ma,l.enforceCacheSizeLimit=function(i){Qn(),ut&&ut.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-i;a++)e.delete(r[a])})})},l.equals=function(i,e){var r=i[0],a=i[1],d=i[2],f=i[3],y=i[4],v=i[5],b=i[6],T=i[7],I=i[8],M=i[9],L=i[10],B=i[11],F=i[12],H=i[13],q=i[14],oe=i[15],fe=e[0],re=e[1],he=e[2],be=e[3],we=e[4],Ge=e[5],Xe=e[6],Ne=e[7],Ae=e[8],ze=e[9],Ue=e[10],Be=e[11],Te=e[12],it=e[13],et=e[14],xt=e[15];return Math.abs(r-fe)<=ri*Math.max(1,Math.abs(r),Math.abs(fe))&&Math.abs(a-re)<=ri*Math.max(1,Math.abs(a),Math.abs(re))&&Math.abs(d-he)<=ri*Math.max(1,Math.abs(d),Math.abs(he))&&Math.abs(f-be)<=ri*Math.max(1,Math.abs(f),Math.abs(be))&&Math.abs(y-we)<=ri*Math.max(1,Math.abs(y),Math.abs(we))&&Math.abs(v-Ge)<=ri*Math.max(1,Math.abs(v),Math.abs(Ge))&&Math.abs(b-Xe)<=ri*Math.max(1,Math.abs(b),Math.abs(Xe))&&Math.abs(T-Ne)<=ri*Math.max(1,Math.abs(T),Math.abs(Ne))&&Math.abs(I-Ae)<=ri*Math.max(1,Math.abs(I),Math.abs(Ae))&&Math.abs(M-ze)<=ri*Math.max(1,Math.abs(M),Math.abs(ze))&&Math.abs(L-Ue)<=ri*Math.max(1,Math.abs(L),Math.abs(Ue))&&Math.abs(B-Be)<=ri*Math.max(1,Math.abs(B),Math.abs(Be))&&Math.abs(F-Te)<=ri*Math.max(1,Math.abs(F),Math.abs(Te))&&Math.abs(H-it)<=ri*Math.max(1,Math.abs(H),Math.abs(it))&&Math.abs(q-et)<=ri*Math.max(1,Math.abs(q),Math.abs(et))&&Math.abs(oe-xt)<=ri*Math.max(1,Math.abs(oe),Math.abs(xt))},l.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:d}){return i.kind==="source"?a/mo:i.kind==="composite"?Kt(a/mo,d/mo,r):e},l.evaluateSizeForZoom=function(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:d,minZoom:f,maxZoom:y}=i,v=d?W(gi.interpolationFactor(d,e,f,y),0,1):0;i.kind==="camera"?a=Kt(i.minSize,i.maxSize,v):r=v}return{uSizeT:r,uSize:a}},l.evaluateVariableOffset=ty,l.evented=Kl,l.exported=er,l.exported$1=Bn,l.extend=Le,l.filterObject=ee,l.fromRotation=function(i,e){var r=Math.sin(e),a=Math.cos(e);return i[0]=a,i[1]=r,i[2]=0,i[3]=-r,i[4]=a,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},l.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},l.getAnchorAlignment=bp,l.getAnchorJustification=Ep,l.getArrayBuffer=Mo,l.getImage=Fr,l.getJSON=function(i,e){return Po(Le(i,{type:"json"}),e)},l.getOverlapMode=zp,l.getRTLTextPluginStatus=Zs,l.getReferrer=bs,l.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<i.length;a++){const d=window.document.createElement("source");Ss(i[a])||(r.crossOrigin="Anonymous"),d.src=i[a],r.appendChild(d)}return{cancel:()=>{}}},l.identity=op,l.invert=function(i,e){var r=e[0],a=e[1],d=e[2],f=e[3],y=e[4],v=e[5],b=e[6],T=e[7],I=e[8],M=e[9],L=e[10],B=e[11],F=e[12],H=e[13],q=e[14],oe=e[15],fe=r*v-a*y,re=r*b-d*y,he=r*T-f*y,be=a*b-d*v,we=a*T-f*v,Ge=d*T-f*b,Xe=I*H-M*F,Ne=I*q-L*F,Ae=I*oe-B*F,ze=M*q-L*H,Ue=M*oe-B*H,Be=L*oe-B*q,Te=fe*Be-re*Ue+he*ze+be*Ae-we*Ne+Ge*Xe;return Te?(i[0]=(v*Be-b*Ue+T*ze)*(Te=1/Te),i[1]=(d*Ue-a*Be-f*ze)*Te,i[2]=(H*Ge-q*we+oe*be)*Te,i[3]=(L*we-M*Ge-B*be)*Te,i[4]=(b*Ae-y*Be-T*Ne)*Te,i[5]=(r*Be-d*Ae+f*Ne)*Te,i[6]=(q*he-F*Ge-oe*re)*Te,i[7]=(I*Ge-L*he+B*re)*Te,i[8]=(y*Ue-v*Ae+T*Xe)*Te,i[9]=(a*Ae-r*Ue-f*Xe)*Te,i[10]=(F*we-H*he+oe*fe)*Te,i[11]=(M*he-I*we-B*fe)*Te,i[12]=(v*Ne-y*ze-b*Xe)*Te,i[13]=(r*ze-a*Ne+d*Xe)*Te,i[14]=(H*re-F*be-q*fe)*Te,i[15]=(I*be-M*re+L*fe)*Te,i):null},l.isImageBitmap=Ni,l.isSafari=Ii,l.isWorker=Qe,l.keysDifference=function(i,e){const r=[];for(const a in i)a in e||r.push(a);return r},l.lazyLoadRTLTextPlugin=function(){Pi.isLoading()||Pi.isLoaded()||Zs()!=="deferred"||$c()},l.makeRequest=Po,l.mapObject=ae,l.mercatorXfromLng=ly,l.mercatorYfromLat=uy,l.mercatorZfromAltitude=cy,l.mul=av,l.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},l.multiply=hg,l.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},l.normalize=function(i,e){var r=e[0],a=e[1],d=e[2],f=r*r+a*a+d*d;return f>0&&(f=1/Math.sqrt(f)),i[0]=e[0]*f,i[1]=e[1]*f,i[2]=e[2]*f,i},l.number=Kt,l.ortho=function(i,e,r,a,d,f,y){var v=1/(e-r),b=1/(a-d),T=1/(f-y);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*T,i[11]=0,i[12]=(e+r)*v,i[13]=(d+a)*b,i[14]=(y+f)*T,i[15]=1,i},l.parseCacheControl=Zt,l.parseGlyphPbf=function(i){return new _p(i).readFields(a1,[])},l.pbf=_p,l.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=vn/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,r=i.bucket.layers[0]._unevaluatedLayout._values,a={layoutIconSize:r["icon-size"].possiblyEvaluate(new Jt(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Jt(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Jt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:b,maxZoom:T}=i.bucket.textSizeData;a.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Jt(b),i.canonical),r["text-size"].possiblyEvaluate(new Jt(T),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:b,maxZoom:T}=i.bucket.iconSizeData;a.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Jt(b),i.canonical),r["icon-size"].possiblyEvaluate(new Jt(T),i.canonical)]}const d=e.get("text-line-height")*Dn,f=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",y=e.get("text-keep-upright"),v=e.get("text-size");for(const b of i.bucket.features){const T=e.get("text-font").evaluate(b,{},i.canonical).join(","),I=v.evaluate(b,{},i.canonical),M=a.layoutTextSize.evaluate(b,{},i.canonical),L=a.layoutIconSize.evaluate(b,{},i.canonical),B={horizontal:{},vertical:void 0},F=b.text;let H,q=[0,0];if(F){const re=F.toString(),he=e.get("text-letter-spacing").evaluate(b,{},i.canonical)*Dn,be=Yd(re)?he:0,we=e.get("text-anchor").evaluate(b,{},i.canonical),Ge=e.get("text-variable-anchor");if(!Ge){const Ue=e.get("text-radial-offset").evaluate(b,{},i.canonical);q=Ue?ty(we,[Ue*Dn,Sp]):e.get("text-offset").evaluate(b,{},i.canonical).map(Be=>Be*Dn)}let Xe=f?"center":e.get("text-justify").evaluate(b,{},i.canonical);const Ne=e.get("symbol-placement"),Ae=Ne==="point"?e.get("text-max-width").evaluate(b,{},i.canonical)*Dn:0,ze=()=>{i.bucket.allowVerticalPlacement&&Aa(re)&&(B.vertical=oh(F,i.glyphMap,i.glyphPositions,i.imagePositions,T,Ae,d,we,"left",be,q,l.WritingMode.vertical,!0,Ne,M,I))};if(!f&&Ge){const Ue=Xe==="auto"?Ge.map(Te=>Ep(Te)):[Xe];let Be=!1;for(let Te=0;Te<Ue.length;Te++){const it=Ue[Te];if(!B.horizontal[it])if(Be)B.horizontal[it]=B.horizontal[0];else{const et=oh(F,i.glyphMap,i.glyphPositions,i.imagePositions,T,Ae,d,"center",it,be,q,l.WritingMode.horizontal,!1,Ne,M,I);et&&(B.horizontal[it]=et,Be=et.positionedLines.length===1)}}ze()}else{Xe==="auto"&&(Xe=Ep(we));const Ue=oh(F,i.glyphMap,i.glyphPositions,i.imagePositions,T,Ae,d,we,Xe,be,q,l.WritingMode.horizontal,!1,Ne,M,I);Ue&&(B.horizontal[Xe]=Ue),ze(),Aa(re)&&f&&y&&(B.vertical=oh(F,i.glyphMap,i.glyphPositions,i.imagePositions,T,Ae,d,we,Xe,be,q,l.WritingMode.vertical,!1,Ne,M,I))}}let oe=!1;if(b.icon&&b.icon.name){const re=i.imageMap[b.icon.name];re&&(H=p1(i.imagePositions[b.icon.name],e.get("icon-offset").evaluate(b,{},i.canonical),e.get("icon-anchor").evaluate(b,{},i.canonical)),oe=!!re.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=oe:i.bucket.sdfIcons!==oe&&De("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(re.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const fe=iy(B.horizontal)||B.vertical;i.bucket.iconsInText=!!fe&&fe.iconsInText,(fe||H)&&v1(i.bucket,b,B,H,i.imageMap,a,M,L,q,oe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},l.perspective=function(i,e,r,a,d){var f,y=1/Math.tan(e/2);return i[0]=y/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0?(i[10]=(d+a)*(f=1/(a-d)),i[14]=2*d*a*f):(i[10]=-1,i[14]=-2*a),i},l.pick=function(i,e){const r={};for(let a=0;a<e.length;a++){const d=e[a];d in i&&(r[d]=i[d])}return r},l.plugin=Pi,l.pointGeometry=st,l.polygonIntersectsPolygon=sg,l.potpack=Ng,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=qe,l.registerForPluginStateChange=function(i){return i({pluginStatus:ni,pluginURL:$r}),Kl.on("pluginStateChange",i),i},l.renderColorRamp=_g,l.rotateX=function(i,e,r){var a=Math.sin(r),d=Math.cos(r),f=e[4],y=e[5],v=e[6],b=e[7],T=e[8],I=e[9],M=e[10],L=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=f*d+T*a,i[5]=y*d+I*a,i[6]=v*d+M*a,i[7]=b*d+L*a,i[8]=T*d-f*a,i[9]=I*d-y*a,i[10]=M*d-v*a,i[11]=L*d-b*a,i},l.rotateZ=function(i,e,r){var a=Math.sin(r),d=Math.cos(r),f=e[0],y=e[1],v=e[2],b=e[3],T=e[4],I=e[5],M=e[6],L=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=f*d+T*a,i[1]=y*d+I*a,i[2]=v*d+M*a,i[3]=b*d+L*a,i[4]=T*d-f*a,i[5]=I*d-y*a,i[6]=M*d-v*a,i[7]=L*d-b*a,i},l.scale=function(i,e,r){var a=r[0],d=r[1],f=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*d,i[5]=e[5]*d,i[6]=e[6]*d,i[7]=e[7]*d,i[8]=e[8]*f,i[9]=e[9]*f,i[10]=e[10]*f,i[11]=e[11]*f,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},l.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},l.setCacheLimits=function(i,e){Xt=i,Ui=e},l.setRTLTextPlugin=function(i,e,r=!1){if(ni===ql||ni===Wl||ni===Xl)throw new Error("setRTLTextPlugin cannot be called multiple times.");$r=er.resolveURL(i),ni=ql,Hl=e,qo(),r||$c()},l.spec=ve,l.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},l.sqrLen=function(i){var e=i[0],r=i[1];return e*e+r*r},l.sub=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},l.toEvaluationFeature=Ks,l.transformMat3=function(i,e,r){var a=e[0],d=e[1],f=e[2];return i[0]=a*r[0]+d*r[3]+f*r[6],i[1]=a*r[1]+d*r[4]+f*r[7],i[2]=a*r[2]+d*r[5]+f*r[8],i},l.transformMat4=Yc,l.transformMat4$1=function(i,e,r){var a=e[0],d=e[1];return i[0]=r[0]*a+r[4]*d+r[12],i[1]=r[1]*a+r[5]*d+r[13],i},l.translate=function(i,e,r){var a,d,f,y,v,b,T,I,M,L,B,F,H=r[0],q=r[1],oe=r[2];return e===i?(i[12]=e[0]*H+e[4]*q+e[8]*oe+e[12],i[13]=e[1]*H+e[5]*q+e[9]*oe+e[13],i[14]=e[2]*H+e[6]*q+e[10]*oe+e[14],i[15]=e[3]*H+e[7]*q+e[11]*oe+e[15]):(d=e[1],f=e[2],y=e[3],v=e[4],b=e[5],T=e[6],I=e[7],M=e[8],L=e[9],B=e[10],F=e[11],i[0]=a=e[0],i[1]=d,i[2]=f,i[3]=y,i[4]=v,i[5]=b,i[6]=T,i[7]=I,i[8]=M,i[9]=L,i[10]=B,i[11]=F,i[12]=a*H+v*q+M*oe+e[12],i[13]=d*H+b*q+L*oe+e[13],i[14]=f*H+T*q+B*oe+e[14],i[15]=y*H+I*q+F*oe+e[15]),i},l.triggerPluginCompletionEvent=Vc,l.unicodeBlockLookup=Oe,l.uniqueId=function(){return Ce++},l.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},l.validateLight=$l,l.validateStyle=js,l.vectorTile=Ko,l.warnOnce=De,l.wrap=Fe}),w(["./shared"],function(l){function U(V){const C=typeof V;if(C==="number"||C==="boolean"||C==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){let N="[";for(const K of V)N+=`${U(K)},`;return`${N}]`}const A=Object.keys(V).sort();let O="{";for(let N=0;N<A.length;N++)O+=`${JSON.stringify(A[N])}:${U(V[A[N]])},`;return`${O}}`}function X(V){let C="";for(const A of l.refProperties)C+=`/${U(V[A])}`;return C}class pe{constructor(C){this.keyCache={},C&&this.replace(C)}replace(C){this._layerConfigs={},this._layers={},this.update(C,[])}update(C,A){for(const N of C){this._layerConfigs[N.id]=N;const K=this._layers[N.id]=l.createStyleLayer(N);K._featureFilter=l.createFilter(K.filter),this.keyCache[N.id]&&delete this.keyCache[N.id]}for(const N of A)delete this.keyCache[N],delete this._layerConfigs[N],delete this._layers[N];this.familiesBySource={};const O=function(N,K){const te={};for(let Y=0;Y<N.length;Y++){const ne=K&&K[N[Y].id]||X(N[Y]);K&&(K[N[Y].id]=ne);let ge=te[ne];ge||(ge=te[ne]=[]),ge.push(N[Y])}const J=[];for(const Y in te)J.push(te[Y]);return J}(Object.values(this._layerConfigs),this.keyCache);for(const N of O){const K=N.map(Se=>this._layers[Se.id]),te=K[0];if(te.visibility==="none")continue;const J=te.source||"";let Y=this.familiesBySource[J];Y||(Y=this.familiesBySource[J]={});const ne=te.sourceLayer||"_geojsonTileLayer";let ge=Y[ne];ge||(ge=Y[ne]=[]),ge.push(K)}}}class le{constructor(C){const A={},O=[];for(const J in C){const Y=C[J],ne=A[J]={};for(const ge in Y){const Se=Y[+ge];if(!Se||Se.bitmap.width===0||Se.bitmap.height===0)continue;const me={x:0,y:0,w:Se.bitmap.width+2,h:Se.bitmap.height+2};O.push(me),ne[ge]={rect:me,metrics:Se.metrics}}}const{w:N,h:K}=l.potpack(O),te=new l.AlphaImage({width:N||1,height:K||1});for(const J in C){const Y=C[J];for(const ne in Y){const ge=Y[+ne];if(!ge||ge.bitmap.width===0||ge.bitmap.height===0)continue;const Se=A[J][ne].rect;l.AlphaImage.copy(ge.bitmap,te,{x:0,y:0},{x:Se.x+1,y:Se.y+1},ge.bitmap)}}this.image=te,this.positions=A}}l.register("GlyphAtlas",le);class W{constructor(C){this.tileID=new l.OverscaledTileID(C.tileID.overscaledZ,C.tileID.wrap,C.tileID.canonical.z,C.tileID.canonical.x,C.tileID.canonical.y),this.uid=C.uid,this.zoom=C.zoom,this.pixelRatio=C.pixelRatio,this.tileSize=C.tileSize,this.source=C.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=C.showCollisionBoxes,this.collectResourceTiming=!!C.collectResourceTiming,this.returnDependencies=!!C.returnDependencies,this.promoteId=C.promoteId}parse(C,A,O,N,K){this.status="parsing",this.data=C,this.collisionBoxArray=new l.CollisionBoxArray;const te=new l.DictionaryCoder(Object.keys(C.layers).sort()),J=new l.FeatureIndex(this.tileID,this.promoteId);J.bucketLayerIDs=[];const Y={},ne={featureIndex:J,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:O},ge=A.familiesBySource[this.source];for(const ct in ge){const yt=C.layers[ct];if(!yt)continue;yt.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${ct}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ct=te.encode(ct),Ut=[];for(let En=0;En<yt.length;En++){const Ht=yt.feature(En),Fn=J.getId(Ht,ct);Ut.push({feature:Ht,id:Fn,index:En,sourceLayerIndex:Ct})}for(const En of ge[ct]){const Ht=En[0];Ht.source!==this.source&&l.warnOnce(`layer.source = ${Ht.source} does not equal this.source = ${this.source}`),Ht.minzoom&&this.zoom<Math.floor(Ht.minzoom)||Ht.maxzoom&&this.zoom>=Ht.maxzoom||Ht.visibility!=="none"&&(Fe(En,this.zoom,O),(Y[Ht.id]=Ht.createBucket({index:J.bucketLayerIDs.length,layers:En,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ct,sourceID:this.source})).populate(Ut,ne,this.tileID.canonical),J.bucketLayerIDs.push(En.map(Fn=>Fn.id)))}}let Se,me,We,Ke;const Ve=l.mapObject(ne.glyphDependencies,ct=>Object.keys(ct).map(Number));Object.keys(Ve).length?N.send("getGlyphs",{uid:this.uid,stacks:Ve},(ct,yt)=>{Se||(Se=ct,me=yt,kt.call(this))}):me={};const rt=Object.keys(ne.iconDependencies);rt.length?N.send("getImages",{icons:rt,source:this.source,tileID:this.tileID,type:"icons"},(ct,yt)=>{Se||(Se=ct,We=yt,kt.call(this))}):We={};const lt=Object.keys(ne.patternDependencies);function kt(){if(Se)return K(Se);if(me&&We&&Ke){const ct=new le(me),yt=new l.ImageAtlas(We,Ke);for(const Ct in Y){const Ut=Y[Ct];Ut instanceof l.SymbolBucket?(Fe(Ut.layers,this.zoom,O),l.performSymbolLayout({bucket:Ut,glyphMap:me,glyphPositions:ct.positions,imageMap:We,imagePositions:yt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ut.hasPattern&&(Ut instanceof l.LineBucket||Ut instanceof l.FillBucket||Ut instanceof l.FillExtrusionBucket)&&(Fe(Ut.layers,this.zoom,O),Ut.addFeatures(ne,this.tileID.canonical,yt.patternPositions))}this.status="done",K(null,{buckets:Object.values(Y).filter(Ct=>!Ct.isEmpty()),featureIndex:J,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ct.image,imageAtlas:yt,glyphMap:this.returnDependencies?me:null,iconMap:this.returnDependencies?We:null,glyphPositions:this.returnDependencies?ct.positions:null})}}lt.length?N.send("getImages",{icons:lt,source:this.source,tileID:this.tileID,type:"patterns"},(ct,yt)=>{Se||(Se=ct,Ke=yt,kt.call(this))}):Ke={},kt.call(this)}}function Fe(V,C,A){const O=new l.EvaluationParameters(C);for(const N of V)N.recalculate(O,A)}function Le(V,C){const A=l.getArrayBuffer(V.request,(O,N,K,te)=>{O?C(O):N&&C(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(N)),rawData:N,cacheControl:K,expires:te})});return()=>{A.cancel(),C()}}class Ce{constructor(C,A,O,N){this.actor=C,this.layerIndex=A,this.availableImages=O,this.loadVectorData=N||Le,this.loading={},this.loaded={}}loadTile(C,A){const O=C.uid;this.loading||(this.loading={});const N=!!(C&&C.request&&C.request.collectResourceTiming)&&new l.RequestPerformance(C.request),K=this.loading[O]=new W(C);K.abort=this.loadVectorData(C,(te,J)=>{if(delete this.loading[O],te||!J)return K.status="done",this.loaded[O]=K,A(te);const Y=J.rawData,ne={};J.expires&&(ne.expires=J.expires),J.cacheControl&&(ne.cacheControl=J.cacheControl);const ge={};if(N){const Se=N.finish();Se&&(ge.resourceTiming=JSON.parse(JSON.stringify(Se)))}K.vectorTile=J.vectorTile,K.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,(Se,me)=>{if(Se||!me)return A(Se);A(null,l.extend({rawTileData:Y.slice(0)},me,ne,ge))}),this.loaded=this.loaded||{},this.loaded[O]=K})}reloadTile(C,A){const O=this.loaded,N=C.uid,K=this;if(O&&O[N]){const te=O[N];te.showCollisionBoxes=C.showCollisionBoxes;const J=(Y,ne)=>{const ge=te.reloadCallback;ge&&(delete te.reloadCallback,te.parse(te.vectorTile,K.layerIndex,this.availableImages,K.actor,ge)),A(Y,ne)};te.status==="parsing"?te.reloadCallback=J:te.status==="done"&&(te.vectorTile?te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,J):J())}}abortTile(C,A){const O=this.loading,N=C.uid;O&&O[N]&&O[N].abort&&(O[N].abort(),delete O[N]),A()}removeTile(C,A){const O=this.loaded,N=C.uid;O&&O[N]&&delete O[N],A()}}class Ot{constructor(){this.loaded={}}loadTile(C,A){const{uid:O,encoding:N,rawImageData:K}=C,te=l.isImageBitmap(K)?this.getImageData(K):K,J=new l.DEMData(O,te,N);this.loaded=this.loaded||{},this.loaded[O]=J,A(null,J)}getImageData(C){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(C.width,C.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=C.width,this.offscreenCanvas.height=C.height,this.offscreenCanvasContext.drawImage(C,0,0,C.width,C.height);const A=this.offscreenCanvasContext.getImageData(-1,-1,C.width+2,C.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:A.width,height:A.height},A.data)}removeTile(C){const A=this.loaded,O=C.uid;A&&A[O]&&delete A[O]}}var ae=function V(C,A){var O,N=C&&C.type;if(N==="FeatureCollection")for(O=0;O<C.features.length;O++)V(C.features[O],A);else if(N==="GeometryCollection")for(O=0;O<C.geometries.length;O++)V(C.geometries[O],A);else if(N==="Feature")V(C.geometry,A);else if(N==="Polygon")ee(C.coordinates,A);else if(N==="MultiPolygon")for(O=0;O<C.coordinates.length;O++)ee(C.coordinates[O],A);return C};function ee(V,C){if(V.length!==0){se(V[0],C);for(var A=1;A<V.length;A++)se(V[A],!C)}}function se(V,C){for(var A=0,O=0,N=0,K=V.length,te=K-1;N<K;te=N++){var J=(V[N][0]-V[te][0])*(V[te][1]+V[N][1]),Y=A+J;O+=Math.abs(A)>=Math.abs(J)?A-Y+J:J-Y+A,A=Y}A+O>=0!=!!C&&V.reverse()}const ke=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class De{constructor(C){this._feature=C,this.extent=l.EXTENT,this.type=C.type,this.properties=C.tags,"id"in C&&!isNaN(C.id)&&(this.id=parseInt(C.id,10))}loadGeometry(){if(this._feature.type===1){const C=[];for(const A of this._feature.geometry)C.push([new l.pointGeometry(A[0],A[1])]);return C}{const C=[];for(const A of this._feature.geometry){const O=[];for(const N of A)O.push(new l.pointGeometry(N[0],N[1]));C.push(O)}return C}}toGeoJSON(C,A,O){return ke.call(this,C,A,O)}}class He{constructor(C){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=C.length,this._features=C}feature(C){return new De(this._features[C])}}var Je={exports:{}},Qe=l.pointGeometry,Zt=l.vectorTile.VectorTileFeature,mt=_n;function _n(V,C){this.options=C||{},this.features=V,this.length=V.length}function Zn(V,C){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=C||4096}_n.prototype.feature=function(V){return new Zn(this.features[V],this.options.extent)},Zn.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var C=0;C<V.length;C++){for(var A=V[C],O=[],N=0;N<A.length;N++)O.push(new Qe(A[N][0],A[N][1]));this.geometry.push(O)}return this.geometry},Zn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,C=1/0,A=-1/0,O=1/0,N=-1/0,K=0;K<V.length;K++)for(var te=V[K],J=0;J<te.length;J++){var Y=te[J];C=Math.min(C,Y.x),A=Math.max(A,Y.x),O=Math.min(O,Y.y),N=Math.max(N,Y.y)}return[C,O,A,N]},Zn.prototype.toGeoJSON=Zt.prototype.toGeoJSON;var Ii=l.pbf,Ni=mt;function er(V){var C=new Ii;return function(A,O){for(var N in A.layers)O.writeMessage(3,st,A.layers[N])}(V,C),C.finish()}function st(V,C){var A;C.writeVarintField(15,V.version||1),C.writeStringField(1,V.name||""),C.writeVarintField(5,V.extent||4096);var O={keys:[],values:[],keycache:{},valuecache:{}};for(A=0;A<V.length;A++)O.feature=V.feature(A),C.writeMessage(2,hi,O);var N=O.keys;for(A=0;A<N.length;A++)C.writeStringField(3,N[A]);var K=O.values;for(A=0;A<K.length;A++)C.writeMessage(4,Xt,K[A])}function hi(V,C){var A=V.feature;A.id!==void 0&&C.writeVarintField(1,A.id),C.writeMessage(2,Ze,V),C.writeVarintField(3,A.type),C.writeMessage(4,Nt,A)}function Ze(V,C){var A=V.feature,O=V.keys,N=V.values,K=V.keycache,te=V.valuecache;for(var J in A.properties){var Y=A.properties[J],ne=K[J];if(Y!==null){ne===void 0&&(O.push(J),K[J]=ne=O.length-1),C.writeVarint(ne);var ge=typeof Y;ge!=="string"&&ge!=="boolean"&&ge!=="number"&&(Y=JSON.stringify(Y));var Se=ge+":"+Y,me=te[Se];me===void 0&&(N.push(Y),te[Se]=me=N.length-1),C.writeVarint(me)}}}function at(V,C){return(C<<3)+(7&V)}function ut(V){return V<<1^V>>31}function Nt(V,C){for(var A=V.loadGeometry(),O=V.type,N=0,K=0,te=A.length,J=0;J<te;J++){var Y=A[J],ne=1;O===1&&(ne=Y.length),C.writeVarint(at(1,ne));for(var ge=O===3?Y.length-1:Y.length,Se=0;Se<ge;Se++){Se===1&&O!==1&&C.writeVarint(at(2,ge-1));var me=Y[Se].x-N,We=Y[Se].y-K;C.writeVarint(ut(me)),C.writeVarint(ut(We)),N+=me,K+=We}O===3&&C.writeVarint(at(7,1))}}function Xt(V,C){var A=typeof V;A==="string"?C.writeStringField(1,V):A==="boolean"?C.writeBooleanField(7,V):A==="number"&&(V%1!=0?C.writeDoubleField(3,V):V<0?C.writeSVarintField(6,V):C.writeVarintField(5,V))}function Ui(V,C,A,O,N,K){if(N-O<=A)return;const te=O+N>>1;Qn(V,C,te,O,N,K%2),Ui(V,C,A,O,te-1,K+1),Ui(V,C,A,te+1,N,K+1)}function Qn(V,C,A,O,N,K){for(;N>O;){if(N-O>600){const ne=N-O+1,ge=A-O+1,Se=Math.log(ne),me=.5*Math.exp(2*Se/3),We=.5*Math.sqrt(Se*me*(ne-me)/ne)*(ge-ne/2<0?-1:1);Qn(V,C,A,Math.max(O,Math.floor(A-ge*me/ne+We)),Math.min(N,Math.floor(A+(ne-ge)*me/ne+We)),K)}const te=C[2*A+K];let J=O,Y=N;for(ei(V,C,O,A),C[2*N+K]>te&&ei(V,C,O,N);J<Y;){for(ei(V,C,J,Y),J++,Y--;C[2*J+K]<te;)J++;for(;C[2*Y+K]>te;)Y--}C[2*O+K]===te?ei(V,C,O,Y):(Y++,ei(V,C,Y,N)),Y<=A&&(O=Y+1),A<=Y&&(N=Y-1)}}function ei(V,C,A,O){Bn(V,A,O),Bn(C,2*A,2*O),Bn(C,2*A+1,2*O+1)}function Bn(V,C,A){const O=V[C];V[C]=V[A],V[A]=O}function di(V,C,A,O){const N=V-A,K=C-O;return N*N+K*K}Je.exports=er,Je.exports.fromVectorTileJs=er,Je.exports.fromGeojsonVt=function(V,C){C=C||{};var A={};for(var O in V)A[O]=new Ni(V[O].features,C),A[O].name=O,A[O].version=C.version,A[O].extent=C.extent;return er({layers:A})},Je.exports.GeoJSONWrapper=Ni;const Lr=V=>V[0],ti=V=>V[1];class zo{constructor(C,A=Lr,O=ti,N=64,K=Float64Array){this.nodeSize=N,this.points=C;const te=C.length<65536?Uint16Array:Uint32Array,J=this.ids=new te(C.length),Y=this.coords=new K(2*C.length);for(let ne=0;ne<C.length;ne++)J[ne]=ne,Y[2*ne]=A(C[ne]),Y[2*ne+1]=O(C[ne]);Ui(J,Y,N,0,J.length-1,0)}range(C,A,O,N){return function(K,te,J,Y,ne,ge,Se){const me=[0,K.length-1,0],We=[];let Ke,Ve;for(;me.length;){const rt=me.pop(),lt=me.pop(),kt=me.pop();if(lt-kt<=Se){for(let Ct=kt;Ct<=lt;Ct++)Ke=te[2*Ct],Ve=te[2*Ct+1],Ke>=J&&Ke<=ne&&Ve>=Y&&Ve<=ge&&We.push(K[Ct]);continue}const ct=Math.floor((kt+lt)/2);Ke=te[2*ct],Ve=te[2*ct+1],Ke>=J&&Ke<=ne&&Ve>=Y&&Ve<=ge&&We.push(K[ct]);const yt=(rt+1)%2;(rt===0?J<=Ke:Y<=Ve)&&(me.push(kt),me.push(ct-1),me.push(yt)),(rt===0?ne>=Ke:ge>=Ve)&&(me.push(ct+1),me.push(lt),me.push(yt))}return We}(this.ids,this.coords,C,A,O,N,this.nodeSize)}within(C,A,O){return function(N,K,te,J,Y,ne){const ge=[0,N.length-1,0],Se=[],me=Y*Y;for(;ge.length;){const We=ge.pop(),Ke=ge.pop(),Ve=ge.pop();if(Ke-Ve<=ne){for(let yt=Ve;yt<=Ke;yt++)di(K[2*yt],K[2*yt+1],te,J)<=me&&Se.push(N[yt]);continue}const rt=Math.floor((Ve+Ke)/2),lt=K[2*rt],kt=K[2*rt+1];di(lt,kt,te,J)<=me&&Se.push(N[rt]);const ct=(We+1)%2;(We===0?te-Y<=lt:J-Y<=kt)&&(ge.push(Ve),ge.push(rt-1),ge.push(ct)),(We===0?te+Y>=lt:J+Y>=kt)&&(ge.push(rt+1),ge.push(Ke),ge.push(ct))}return Se}(this.ids,this.coords,C,A,O,this.nodeSize)}}const ws={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:V=>V},mr=Math.fround||(pi=new Float32Array(1),V=>(pi[0]=+V,pi[0]));var pi;class bs{constructor(C){this.options=Fr(Object.create(ws),C),this.trees=new Array(this.options.maxZoom+1)}load(C){const{log:A,minZoom:O,maxZoom:N,nodeSize:K}=this.options;A&&console.time("total time");const te=`prepare ${C.length} points`;A&&console.time(te),this.points=C;let J=[];for(let Y=0;Y<C.length;Y++)C[Y].geometry&&J.push(Po(C[Y],Y));this.trees[N+1]=new zo(J,Es,gr,K,Float32Array),A&&console.timeEnd(te);for(let Y=N;Y>=O;Y--){const ne=+Date.now();J=this._cluster(J,Y),this.trees[Y]=new zo(J,Es,gr,K,Float32Array),A&&console.log("z%d: %d clusters in %dms",Y,J.length,+Date.now()-ne)}return A&&console.timeEnd("total time"),this}getClusters(C,A){let O=((C[0]+180)%360+360)%360-180;const N=Math.max(-90,Math.min(90,C[1]));let K=C[2]===180?180:((C[2]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,C[3]));if(C[2]-C[0]>=360)O=-180,K=180;else if(O>K){const ge=this.getClusters([O,N,180,te],A),Se=this.getClusters([-180,N,K,te],A);return ge.concat(Se)}const J=this.trees[this._limitZoom(A)],Y=J.range(Et(O),tr(te),Et(K),tr(N)),ne=[];for(const ge of Y){const Se=J.points[ge];ne.push(Se.numPoints?Mo(Se):this.points[Se.index])}return ne}getChildren(C){const A=this._getOriginId(C),O=this._getOriginZoom(C),N="No cluster with the specified id.",K=this.trees[O];if(!K)throw new Error(N);const te=K.points[A];if(!te)throw new Error(N);const J=this.options.radius/(this.options.extent*Math.pow(2,O-1)),Y=K.within(te.x,te.y,J),ne=[];for(const ge of Y){const Se=K.points[ge];Se.parentId===C&&ne.push(Se.numPoints?Mo(Se):this.points[Se.index])}if(ne.length===0)throw new Error(N);return ne}getLeaves(C,A,O){const N=[];return this._appendLeaves(N,C,A=A||10,O=O||0,0),N}getTile(C,A,O){const N=this.trees[this._limitZoom(C)],K=Math.pow(2,C),{extent:te,radius:J}=this.options,Y=J/te,ne=(O-Y)/K,ge=(O+1+Y)/K,Se={features:[]};return this._addTileFeatures(N.range((A-Y)/K,ne,(A+1+Y)/K,ge),N.points,A,O,K,Se),A===0&&this._addTileFeatures(N.range(1-Y/K,ne,1,ge),N.points,K,O,K,Se),A===K-1&&this._addTileFeatures(N.range(0,ne,Y/K,ge),N.points,-1,O,K,Se),Se.features.length?Se:null}getClusterExpansionZoom(C){let A=this._getOriginZoom(C)-1;for(;A<=this.options.maxZoom;){const O=this.getChildren(C);if(A++,O.length!==1)break;C=O[0].properties.cluster_id}return A}_appendLeaves(C,A,O,N,K){const te=this.getChildren(A);for(const J of te){const Y=J.properties;if(Y&&Y.cluster?K+Y.point_count<=N?K+=Y.point_count:K=this._appendLeaves(C,Y.cluster_id,O,N,K):K<N?K++:C.push(J),C.length===O)break}return K}_addTileFeatures(C,A,O,N,K,te){for(const J of C){const Y=A[J],ne=Y.numPoints;let ge,Se,me;if(ne)ge=Ss(Y),Se=Y.x,me=Y.y;else{const Ve=this.points[Y.index];ge=Ve.properties,Se=Et(Ve.geometry.coordinates[0]),me=tr(Ve.geometry.coordinates[1])}const We={type:1,geometry:[[Math.round(this.options.extent*(Se*K-O)),Math.round(this.options.extent*(me*K-N))]],tags:ge};let Ke;ne?Ke=Y.id:this.options.generateId?Ke=Y.index:this.points[Y.index].id&&(Ke=this.points[Y.index].id),Ke!==void 0&&(We.id=Ke),te.features.push(We)}}_limitZoom(C){return Math.max(this.options.minZoom,Math.min(Math.floor(+C),this.options.maxZoom+1))}_cluster(C,A){const O=[],{radius:N,extent:K,reduce:te,minPoints:J}=this.options,Y=N/(K*Math.pow(2,A));for(let ne=0;ne<C.length;ne++){const ge=C[ne];if(ge.zoom<=A)continue;ge.zoom=A;const Se=this.trees[A+1],me=Se.within(ge.x,ge.y,Y),We=ge.numPoints||1;let Ke=We;for(const Ve of me){const rt=Se.points[Ve];rt.zoom>A&&(Ke+=rt.numPoints||1)}if(Ke>We&&Ke>=J){let Ve=ge.x*We,rt=ge.y*We,lt=te&&We>1?this._map(ge,!0):null;const kt=(ne<<5)+(A+1)+this.points.length;for(const ct of me){const yt=Se.points[ct];if(yt.zoom<=A)continue;yt.zoom=A;const Ct=yt.numPoints||1;Ve+=yt.x*Ct,rt+=yt.y*Ct,yt.parentId=kt,te&&(lt||(lt=this._map(ge,!0)),te(lt,this._map(yt)))}ge.parentId=kt,O.push(Rr(Ve/Ke,rt/Ke,kt,Ke,lt))}else if(O.push(ge),Ke>1)for(const Ve of me){const rt=Se.points[Ve];rt.zoom<=A||(rt.zoom=A,O.push(rt))}}return O}_getOriginId(C){return C-this.points.length>>5}_getOriginZoom(C){return(C-this.points.length)%32}_map(C,A){if(C.numPoints)return A?Fr({},C.properties):C.properties;const O=this.points[C.index].properties,N=this.options.map(O);return A&&N===O?Fr({},N):N}}function Rr(V,C,A,O,N){return{x:mr(V),y:mr(C),zoom:1/0,id:A,parentId:-1,numPoints:O,properties:N}}function Po(V,C){const[A,O]=V.geometry.coordinates;return{x:mr(Et(A)),y:mr(tr(O)),zoom:1/0,index:C,parentId:-1}}function Mo(V){return{type:"Feature",id:V.id,properties:Ss(V),geometry:{type:"Point",coordinates:[(C=V.x,360*(C-.5)),Br(V.y)]}};var C}function Ss(V){const C=V.numPoints,A=C>=1e4?`${Math.round(C/1e3)}k`:C>=1e3?Math.round(C/100)/10+"k":C;return Fr(Fr({},V.properties),{cluster:!0,cluster_id:V.id,point_count:C,point_count_abbreviated:A})}function Et(V){return V/360+.5}function tr(V){const C=Math.sin(V*Math.PI/180),A=.5-.25*Math.log((1+C)/(1-C))/Math.PI;return A<0?0:A>1?1:A}function Br(V){const C=(180-360*V)*Math.PI/180;return 360*Math.atan(Math.exp(C))/Math.PI-90}function Fr(V,C){for(const A in C)V[A]=C[A];return V}function Es(V){return V.x}function gr(V){return V.y}function yr(V,C,A,O){for(var N,K=O,te=A-C>>1,J=A-C,Y=V[C],ne=V[C+1],ge=V[A],Se=V[A+1],me=C+3;me<A;me+=3){var We=Ao(V[me],V[me+1],Y,ne,ge,Se);if(We>K)N=me,K=We;else if(We===K){var Ke=Math.abs(me-te);Ke<J&&(N=me,J=Ke)}}K>O&&(N-C>3&&yr(V,C,N,O),V[N+2]=K,A-N>3&&yr(V,N,A,O))}function Ao(V,C,A,O,N,K){var te=N-A,J=K-O;if(te!==0||J!==0){var Y=((V-A)*te+(C-O)*J)/(te*te+J*J);Y>1?(A=N,O=K):Y>0&&(A+=te*Y,O+=J*Y)}return(te=V-A)*te+(J=C-O)*J}function _r(V,C,A,O){var N={id:V===void 0?null:V,type:C,geometry:A,tags:O,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(K){var te=K.geometry,J=K.type;if(J==="Point"||J==="MultiPoint"||J==="LineString")ve(K,te);else if(J==="Polygon"||J==="MultiLineString")for(var Y=0;Y<te.length;Y++)ve(K,te[Y]);else if(J==="MultiPolygon")for(Y=0;Y<te.length;Y++)for(var ne=0;ne<te[Y].length;ne++)ve(K,te[Y][ne])}(N),N}function ve(V,C){for(var A=0;A<C.length;A+=3)V.minX=Math.min(V.minX,C[A]),V.minY=Math.min(V.minY,C[A+1]),V.maxX=Math.max(V.maxX,C[A]),V.maxY=Math.max(V.maxY,C[A+1])}function Re(V,C,A,O){if(C.geometry){var N=C.geometry.coordinates,K=C.geometry.type,te=Math.pow(A.tolerance/((1<<A.maxZoom)*A.extent),2),J=[],Y=C.id;if(A.promoteId?Y=C.properties[A.promoteId]:A.generateId&&(Y=O||0),K==="Point")eo(N,J);else if(K==="MultiPoint")for(var ne=0;ne<N.length;ne++)eo(N[ne],J);else if(K==="LineString")Vi(N,J,te,!1);else if(K==="MultiLineString"){if(A.lineMetrics){for(ne=0;ne<N.length;ne++)Vi(N[ne],J=[],te,!1),V.push(_r(Y,"LineString",J,C.properties));return}Tt(N,J,te,!1)}else if(K==="Polygon")Tt(N,J,te,!0);else{if(K!=="MultiPolygon"){if(K==="GeometryCollection"){for(ne=0;ne<C.geometry.geometries.length;ne++)Re(V,{id:Y,geometry:C.geometry.geometries[ne],properties:C.properties},A,O);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ne=0;ne<N.length;ne++){var ge=[];Tt(N[ne],ge,te,!0),J.push(ge)}}V.push(_r(Y,K,J,C.properties))}}function eo(V,C){C.push(zi(V[0])),C.push(fi(V[1])),C.push(0)}function Vi(V,C,A,O){for(var N,K,te=0,J=0;J<V.length;J++){var Y=zi(V[J][0]),ne=fi(V[J][1]);C.push(Y),C.push(ne),C.push(0),J>0&&(te+=O?(N*ne-Y*K)/2:Math.sqrt(Math.pow(Y-N,2)+Math.pow(ne-K,2))),N=Y,K=ne}var ge=C.length-3;C[2]=1,yr(C,0,ge,A),C[ge+2]=1,C.size=Math.abs(te),C.start=0,C.end=C.size}function Tt(V,C,A,O){for(var N=0;N<V.length;N++){var K=[];Vi(V[N],K,A,O),C.push(K)}}function zi(V){return V/360+.5}function fi(V){var C=Math.sin(V*Math.PI/180),A=.5-.25*Math.log((1+C)/(1-C))/Math.PI;return A<0?0:A>1?1:A}function mi(V,C,A,O,N,K,te,J){if(O/=C,K>=(A/=C)&&te<O)return V;if(te<A||K>=O)return null;for(var Y=[],ne=0;ne<V.length;ne++){var ge=V[ne],Se=ge.geometry,me=ge.type,We=N===0?ge.minX:ge.minY,Ke=N===0?ge.maxX:ge.maxY;if(We>=A&&Ke<O)Y.push(ge);else if(!(Ke<A||We>=O)){var Ve=[];if(me==="Point"||me==="MultiPoint")Or(Se,Ve,A,O,N);else if(me==="LineString")Pe(Se,Ve,A,O,N,!1,J.lineMetrics);else if(me==="MultiLineString")pt(Se,Ve,A,O,N,!1);else if(me==="Polygon")pt(Se,Ve,A,O,N,!0);else if(me==="MultiPolygon")for(var rt=0;rt<Se.length;rt++){var lt=[];pt(Se[rt],lt,A,O,N,!0),lt.length&&Ve.push(lt)}if(Ve.length){if(J.lineMetrics&&me==="LineString"){for(rt=0;rt<Ve.length;rt++)Y.push(_r(ge.id,me,Ve[rt],ge.tags));continue}me!=="LineString"&&me!=="MultiLineString"||(Ve.length===1?(me="LineString",Ve=Ve[0]):me="MultiLineString"),me!=="Point"&&me!=="MultiPoint"||(me=Ve.length===3?"Point":"MultiPoint"),Y.push(_r(ge.id,me,Ve,ge.tags))}}}return Y.length?Y:null}function Or(V,C,A,O,N){for(var K=0;K<V.length;K+=3){var te=V[K+N];te>=A&&te<=O&&(C.push(V[K]),C.push(V[K+1]),C.push(V[K+2]))}}function Pe(V,C,A,O,N,K,te){for(var J,Y,ne=gt(V),ge=N===0?Nr:ht,Se=V.start,me=0;me<V.length-3;me+=3){var We=V[me],Ke=V[me+1],Ve=V[me+2],rt=V[me+3],lt=V[me+4],kt=N===0?We:Ke,ct=N===0?rt:lt,yt=!1;te&&(J=Math.sqrt(Math.pow(We-rt,2)+Math.pow(Ke-lt,2))),kt<A?ct>A&&(Y=ge(ne,We,Ke,rt,lt,A),te&&(ne.start=Se+J*Y)):kt>O?ct<O&&(Y=ge(ne,We,Ke,rt,lt,O),te&&(ne.start=Se+J*Y)):Mn(ne,We,Ke,Ve),ct<A&&kt>=A&&(Y=ge(ne,We,Ke,rt,lt,A),yt=!0),ct>O&&kt<=O&&(Y=ge(ne,We,Ke,rt,lt,O),yt=!0),!K&&yt&&(te&&(ne.end=Se+J*Y),C.push(ne),ne=gt(V)),te&&(Se+=J)}var Ct=V.length-3;We=V[Ct],Ke=V[Ct+1],Ve=V[Ct+2],(kt=N===0?We:Ke)>=A&&kt<=O&&Mn(ne,We,Ke,Ve),Ct=ne.length-3,K&&Ct>=3&&(ne[Ct]!==ne[0]||ne[Ct+1]!==ne[1])&&Mn(ne,ne[0],ne[1],ne[2]),ne.length&&C.push(ne)}function gt(V){var C=[];return C.size=V.size,C.start=V.start,C.end=V.end,C}function pt(V,C,A,O,N,K){for(var te=0;te<V.length;te++)Pe(V[te],C,A,O,N,K,!1)}function Mn(V,C,A,O){V.push(C),V.push(A),V.push(O)}function Nr(V,C,A,O,N,K){var te=(K-C)/(O-C);return V.push(K),V.push(A+(N-A)*te),V.push(1),te}function ht(V,C,A,O,N,K){var te=(K-A)/(N-A);return V.push(C+(O-C)*te),V.push(K),V.push(1),te}function xr(V,C){for(var A=[],O=0;O<V.length;O++){var N,K=V[O],te=K.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")N=Sn(K.geometry,C);else if(te==="MultiLineString"||te==="Polygon"){N=[];for(var J=0;J<K.geometry.length;J++)N.push(Sn(K.geometry[J],C))}else if(te==="MultiPolygon")for(N=[],J=0;J<K.geometry.length;J++){for(var Y=[],ne=0;ne<K.geometry[J].length;ne++)Y.push(Sn(K.geometry[J][ne],C));N.push(Y)}A.push(_r(K.id,te,N,K.tags))}return A}function Sn(V,C){var A=[];A.size=V.size,V.start!==void 0&&(A.start=V.start,A.end=V.end);for(var O=0;O<V.length;O+=3)A.push(V[O]+C,V[O+1],V[O+2]);return A}function Do(V,C){if(V.transformed)return V;var A,O,N,K=1<<V.z,te=V.x,J=V.y;for(A=0;A<V.features.length;A++){var Y=V.features[A],ne=Y.geometry,ge=Y.type;if(Y.geometry=[],ge===1)for(O=0;O<ne.length;O+=2)Y.geometry.push(pn(ne[O],ne[O+1],C,K,te,J));else for(O=0;O<ne.length;O++){var Se=[];for(N=0;N<ne[O].length;N+=2)Se.push(pn(ne[O][N],ne[O][N+1],C,K,te,J));Y.geometry.push(Se)}}return V.transformed=!0,V}function pn(V,C,A,O,N,K){return[Math.round(A*(V*O-N)),Math.round(A*(C*O-K))]}function qn(V,C,A,O,N){for(var K=C===N.maxZoom?0:N.tolerance/((1<<C)*N.extent),te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:A,y:O,z:C,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},J=0;J<V.length;J++){te.numFeatures++,Bt(te,V[J],K,N);var Y=V[J].minX,ne=V[J].minY,ge=V[J].maxX,Se=V[J].maxY;Y<te.minX&&(te.minX=Y),ne<te.minY&&(te.minY=ne),ge>te.maxX&&(te.maxX=ge),Se>te.maxY&&(te.maxY=Se)}return te}function Bt(V,C,A,O){var N=C.geometry,K=C.type,te=[];if(K==="Point"||K==="MultiPoint")for(var J=0;J<N.length;J+=3)te.push(N[J]),te.push(N[J+1]),V.numPoints++,V.numSimplified++;else if(K==="LineString")Lo(te,N,V,A,!1,!1);else if(K==="MultiLineString"||K==="Polygon")for(J=0;J<N.length;J++)Lo(te,N[J],V,A,K==="Polygon",J===0);else if(K==="MultiPolygon")for(var Y=0;Y<N.length;Y++){var ne=N[Y];for(J=0;J<ne.length;J++)Lo(te,ne[J],V,A,!0,J===0)}if(te.length){var ge=C.tags||null;if(K==="LineString"&&O.lineMetrics){for(var Se in ge={},C.tags)ge[Se]=C.tags[Se];ge.mapbox_clip_start=N.start/N.size,ge.mapbox_clip_end=N.end/N.size}var me={geometry:te,type:K==="Polygon"||K==="MultiPolygon"?3:K==="LineString"||K==="MultiLineString"?2:1,tags:ge};C.id!==null&&(me.id=C.id),V.features.push(me)}}function Lo(V,C,A,O,N,K){var te=O*O;if(O>0&&C.size<(N?te:O))A.numPoints+=C.length/3;else{for(var J=[],Y=0;Y<C.length;Y+=3)(O===0||C[Y+2]>te)&&(A.numSimplified++,J.push(C[Y]),J.push(C[Y+1])),A.numPoints++;N&&function(ne,ge){for(var Se=0,me=0,We=ne.length,Ke=We-2;me<We;Ke=me,me+=2)Se+=(ne[me]-ne[Ke])*(ne[me+1]+ne[Ke+1]);if(Se>0===ge)for(me=0,We=ne.length;me<We/2;me+=2){var Ve=ne[me],rt=ne[me+1];ne[me]=ne[We-2-me],ne[me+1]=ne[We-1-me],ne[We-2-me]=Ve,ne[We-1-me]=rt}}(J,K),V.push(J)}}function nr(V,C){var A=(C=this.options=function(N,K){for(var te in K)N[te]=K[te];return N}(Object.create(this.options),C)).debug;if(A&&console.time("preprocess data"),C.maxZoom<0||C.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(C.promoteId&&C.generateId)throw new Error("promoteId and generateId cannot be used together.");var O=function(N,K){var te=[];if(N.type==="FeatureCollection")for(var J=0;J<N.features.length;J++)Re(te,N.features[J],K,J);else Re(te,N.type==="Feature"?N:{geometry:N},K);return te}(V,C);this.tiles={},this.tileCoords=[],A&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",C.indexMaxZoom,C.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),O=function(N,K){var te=K.buffer/K.extent,J=N,Y=mi(N,1,-1-te,te,0,-1,2,K),ne=mi(N,1,1-te,2+te,0,-1,2,K);return(Y||ne)&&(J=mi(N,1,-te,1+te,0,-1,2,K)||[],Y&&(J=xr(Y,1).concat(J)),ne&&(J=J.concat(xr(ne,-1)))),J}(O,C),O.length&&this.splitTile(O,0,0,0),A&&(O.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function to(V,C,A){return 32*((1<<V)*A+C)+V}function no(V,C){const A=V.tileID.canonical;if(!this._geoJSONIndex)return C(null,null);const O=this._geoJSONIndex.getTile(A.z,A.x,A.y);if(!O)return C(null,null);const N=new He(O.features);let K=Je.exports(N);K.byteOffset===0&&K.byteLength===K.buffer.byteLength||(K=new Uint8Array(K)),C(null,{vectorTile:N,rawData:K.buffer})}nr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},nr.prototype.splitTile=function(V,C,A,O,N,K,te){for(var J=[V,C,A,O],Y=this.options,ne=Y.debug;J.length;){O=J.pop(),A=J.pop(),C=J.pop(),V=J.pop();var ge=1<<C,Se=to(C,A,O),me=this.tiles[Se];if(!me&&(ne>1&&console.time("creation"),me=this.tiles[Se]=qn(V,C,A,O,Y),this.tileCoords.push({z:C,x:A,y:O}),ne)){ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",C,A,O,me.numFeatures,me.numPoints,me.numSimplified),console.timeEnd("creation"));var We="z"+C;this.stats[We]=(this.stats[We]||0)+1,this.total++}if(me.source=V,N){if(C===Y.maxZoom||C===N)continue;var Ke=1<<N-C;if(A!==Math.floor(K/Ke)||O!==Math.floor(te/Ke))continue}else if(C===Y.indexMaxZoom||me.numPoints<=Y.indexMaxPoints)continue;if(me.source=null,V.length!==0){ne>1&&console.time("clipping");var Ve,rt,lt,kt,ct,yt,Ct=.5*Y.buffer/Y.extent,Ut=.5-Ct,En=.5+Ct,Ht=1+Ct;Ve=rt=lt=kt=null,ct=mi(V,ge,A-Ct,A+En,0,me.minX,me.maxX,Y),yt=mi(V,ge,A+Ut,A+Ht,0,me.minX,me.maxX,Y),V=null,ct&&(Ve=mi(ct,ge,O-Ct,O+En,1,me.minY,me.maxY,Y),rt=mi(ct,ge,O+Ut,O+Ht,1,me.minY,me.maxY,Y),ct=null),yt&&(lt=mi(yt,ge,O-Ct,O+En,1,me.minY,me.maxY,Y),kt=mi(yt,ge,O+Ut,O+Ht,1,me.minY,me.maxY,Y),yt=null),ne>1&&console.timeEnd("clipping"),J.push(Ve||[],C+1,2*A,2*O),J.push(rt||[],C+1,2*A,2*O+1),J.push(lt||[],C+1,2*A+1,2*O),J.push(kt||[],C+1,2*A+1,2*O+1)}}},nr.prototype.getTile=function(V,C,A){var O=this.options,N=O.extent,K=O.debug;if(V<0||V>24)return null;var te=1<<V,J=to(V,C=(C%te+te)%te,A);if(this.tiles[J])return Do(this.tiles[J],N);K>1&&console.log("drilling down to z%d-%d-%d",V,C,A);for(var Y,ne=V,ge=C,Se=A;!Y&&ne>0;)ne--,ge=Math.floor(ge/2),Se=Math.floor(Se/2),Y=this.tiles[to(ne,ge,Se)];return Y&&Y.source?(K>1&&console.log("found parent tile z%d-%d-%d",ne,ge,Se),K>1&&console.time("drilling down"),this.splitTile(Y.source,ne,ge,Se,V,C,A),K>1&&console.timeEnd("drilling down"),this.tiles[J]?Do(this.tiles[J],N):null):null};class Ro extends Ce{constructor(C,A,O,N){super(C,A,O,no),N&&(this.loadGeoJSON=N)}loadData(C,A){var O;(O=this._pendingRequest)===null||O===void 0||O.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const N=!!(C&&C.request&&C.request.collectResourceTiming)&&new l.RequestPerformance(C.request);this._pendingCallback=A,this._pendingRequest=this.loadGeoJSON(C,(K,te)=>{if(delete this._pendingCallback,delete this._pendingRequest,K||!te)return A(K);if(typeof te!="object")return A(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`));{ae(te,!0);try{if(C.filter){const Y=l.createExpression(C.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(ge=>`${ge.key}: ${ge.message}`).join(", "));te={type:"FeatureCollection",features:te.features.filter(ge=>Y.value.evaluate({zoom:0},ge))}}this._geoJSONIndex=C.cluster?new bs(function({superclusterOptions:Y,clusterProperties:ne}){if(!ne||!Y)return Y;const ge={},Se={},me={accumulated:null,zoom:0},We={properties:null},Ke=Object.keys(ne);for(const Ve of Ke){const[rt,lt]=ne[Ve],kt=l.createExpression(lt),ct=l.createExpression(typeof rt=="string"?[rt,["accumulated"],["get",Ve]]:rt);ge[Ve]=kt.value,Se[Ve]=ct.value}return Y.map=Ve=>{We.properties=Ve;const rt={};for(const lt of Ke)rt[lt]=ge[lt].evaluate(me,We);return rt},Y.reduce=(Ve,rt)=>{We.properties=rt;for(const lt of Ke)me.accumulated=Ve[lt],Ve[lt]=Se[lt].evaluate(me,We)},Y}(C)).load(te.features):function(Y,ne){return new nr(Y,ne)}(te,C.geojsonVtOptions)}catch(Y){return A(Y)}this.loaded={};const J={};if(N){const Y=N.finish();Y&&(J.resourceTiming={},J.resourceTiming[C.source]=JSON.parse(JSON.stringify(Y)))}A(null,J)}})}reloadTile(C,A){const O=this.loaded;return O&&O[C.uid]?super.reloadTile(C,A):this.loadTile(C,A)}loadGeoJSON(C,A){if(C.request)return l.getJSON(C.request,A);if(typeof C.data=="string")try{A(null,JSON.parse(C.data))}catch{A(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`))}else A(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(C,A){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),A()}getClusterExpansionZoom(C,A){try{A(null,this._geoJSONIndex.getClusterExpansionZoom(C.clusterId))}catch(O){A(O)}}getClusterChildren(C,A){try{A(null,this._geoJSONIndex.getChildren(C.clusterId))}catch(O){A(O)}}getClusterLeaves(C,A){try{A(null,this._geoJSONIndex.getLeaves(C.clusterId,C.limit,C.offset))}catch(O){A(O)}}}class io{constructor(C){this.self=C,this.actor=new l.Actor(C,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ce,geojson:Ro},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(A,O)=>{if(this.workerSourceTypes[A])throw new Error(`Worker source with name "${A}" already registered.`);this.workerSourceTypes[A]=O},this.self.registerRTLTextPlugin=A=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=A.applyArabicShaping,l.plugin.processBidirectionalText=A.processBidirectionalText,l.plugin.processStyledBidirectionalText=A.processStyledBidirectionalText}}setReferrer(C,A){this.referrer=A}setImages(C,A,O){this.availableImages[C]=A;for(const N in this.workerSources[C]){const K=this.workerSources[C][N];for(const te in K)K[te].availableImages=A}O()}setLayers(C,A,O){this.getLayerIndex(C).replace(A),O()}updateLayers(C,A,O){this.getLayerIndex(C).update(A.layers,A.removedIds),O()}loadTile(C,A,O){this.getWorkerSource(C,A.type,A.source).loadTile(A,O)}loadDEMTile(C,A,O){this.getDEMWorkerSource(C,A.source).loadTile(A,O)}reloadTile(C,A,O){this.getWorkerSource(C,A.type,A.source).reloadTile(A,O)}abortTile(C,A,O){this.getWorkerSource(C,A.type,A.source).abortTile(A,O)}removeTile(C,A,O){this.getWorkerSource(C,A.type,A.source).removeTile(A,O)}removeDEMTile(C,A){this.getDEMWorkerSource(C,A.source).removeTile(A)}removeSource(C,A,O){if(!this.workerSources[C]||!this.workerSources[C][A.type]||!this.workerSources[C][A.type][A.source])return;const N=this.workerSources[C][A.type][A.source];delete this.workerSources[C][A.type][A.source],N.removeSource!==void 0?N.removeSource(A,O):O()}loadWorkerSource(C,A,O){try{this.self.importScripts(A.url),O()}catch(N){O(N.toString())}}syncRTLPluginState(C,A,O){try{l.plugin.setState(A);const N=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&N!=null){this.self.importScripts(N);const K=l.plugin.isParsed();O(K?void 0:new Error(`RTL Text Plugin failed to import scripts from ${N}`),K)}}catch(N){O(N.toString())}}getAvailableImages(C){let A=this.availableImages[C];return A||(A=[]),A}getLayerIndex(C){let A=this.layerIndexes[C];return A||(A=this.layerIndexes[C]=new pe),A}getWorkerSource(C,A,O){if(this.workerSources[C]||(this.workerSources[C]={}),this.workerSources[C][A]||(this.workerSources[C][A]={}),!this.workerSources[C][A][O]){const N={send:(K,te,J)=>{this.actor.send(K,te,J,C)}};this.workerSources[C][A][O]=new this.workerSourceTypes[A](N,this.getLayerIndex(C),this.getAvailableImages(C))}return this.workerSources[C][A][O]}getDEMWorkerSource(C,A){return this.demWorkerSources[C]||(this.demWorkerSources[C]={}),this.demWorkerSources[C][A]||(this.demWorkerSources[C][A]=new Ot),this.demWorkerSources[C][A]}enforceCacheSizeLimit(C,A){l.enforceCacheSizeLimit(A)}}return l.isWorker()&&(self.worker=new io(self)),io}),w(["./shared"],function(l){var U=X;function X(h){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var c,p,g=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(g);try{p=new Worker(x),c=!0}catch{c=!1}return p&&p.terminate(),URL.revokeObjectURL(x),c}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var c=document.createElement("canvas");c.width=c.height=1;var p=c.getContext("2d");if(!p)return!1;var g=p.getImageData(0,0,1,1);return g&&g.width===c.width}()?(pe[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(pe[s]=function(c){var p,g=function(x){var S=document.createElement("canvas"),E=Object.create(X.webGLContextAttributes);return E.failIfMajorPerformanceCaveat=x,S.getContext("webgl",E)||S.getContext("experimental-webgl",E)}(c);if(!g)return!1;try{p=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!p||g.isContextLost())&&(g.shaderSource(p,"void main() {}"),g.compileShader(p),g.getShaderParameter(p,g.COMPILE_STATUS)===!0)}(s)),pe[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(h)}var pe={};function le(h,t){if(Array.isArray(h)){if(!Array.isArray(t)||h.length!==t.length)return!1;for(let s=0;s<h.length;s++)if(!le(h[s],t[s]))return!1;return!0}if(typeof h=="object"&&h!==null&&t!==null){if(typeof t!="object"||Object.keys(h).length!==Object.keys(t).length)return!1;for(const s in h)if(!le(h[s],t[s]))return!1;return!0}return h===t}X.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class W{static testProp(t){if(!W.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in W.docStyle)return t[s];return t[0]}static create(t,s,c){const p=window.document.createElement(t);return s!==void 0&&(p.className=s),c&&c.appendChild(p),p}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){W.docStyle&&W.selectProp&&(W.userSelect=W.docStyle[W.selectProp],W.docStyle[W.selectProp]="none")}static enableDrag(){W.docStyle&&W.selectProp&&(W.docStyle[W.selectProp]=W.userSelect)}static setTransform(t,s){t.style[W.transformProp]=s}static addEventListener(t,s,c,p={}){t.addEventListener(s,c,"passive"in p?p:p.capture)}static removeEventListener(t,s,c,p={}){t.removeEventListener(s,c,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",W.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",W.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",W.suppressClickInternal,!0)},0)}static mousePos(t,s){const c=t.getBoundingClientRect();return new l.pointGeometry(s.clientX-c.left-t.clientLeft,s.clientY-c.top-t.clientTop)}static touchPos(t,s){const c=t.getBoundingClientRect(),p=[];for(let g=0;g<s.length;g++)p.push(new l.pointGeometry(s[g].clientX-c.left-t.clientLeft,s[g].clientY-c.top-t.clientTop));return p}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}W.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,W.selectProp=W.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),W.transformProp=W.testProp(["transform","WebkitTransform"]);class Fe{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,c){const p=function(g){const x=g.match(Le);if(!x)throw new Error(`Unable to parse URL "${g}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(t);return p.path+=`${s}${c}`,function(g){const x=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${x}`}(p)}setTransformRequest(t){this._transformRequestFn=t}}const Le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class Ce{constructor(t,s,c,p){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(s,p)}update(t,s,c){const{width:p,height:g}=t,x=!(this.size&&this.size[0]===p&&this.size[1]===g||c),{context:S}=this,{gl:E}=S;if(this.useMipmap=Boolean(s&&s.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!s||s.premultiply!==!1)),x)this.size=[p,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.isImageBitmap(t)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,t):E.texImage2D(E.TEXTURE_2D,0,this.format,p,g,0,this.format,E.UNSIGNED_BYTE,t.data);else{const{x:k,y:P}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.isImageBitmap(t)?E.texSubImage2D(E.TEXTURE_2D,0,k,P,E.RGBA,E.UNSIGNED_BYTE,t):E.texSubImage2D(E.TEXTURE_2D,0,k,P,p,g,E.RGBA,E.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(t,s,c){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),c!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,c||t),this.filter=t),s!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Ot(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class ae extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:c}of this.requestors)this._notify(s,c);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let c=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(s.content,s)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,s){if(!t)return!0;let c=0;for(const p of t){if(p[0]<c||p[1]<p[0]||s<p[1])return!1;c=p[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){const c=this.images[t];if(c.data.width!==s.data.width||c.data.height!==s.data.height)throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=c.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let c=!0;if(!this.isLoaded())for(const p of t)this.images[p]||(c=!1);this.isLoaded()||c?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const c={};for(const p of t){this.images[p]||this.fire(new l.Event("styleimagemissing",{id:p}));const g=this.images[p];g?c[p]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:l.warnOnce(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,c)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],c=this.getImage(t);if(!c)return null;if(s&&s.position.version===c.version)return s.position;if(s)s.position.version=c.version;else{const p={w:c.data.width+2,h:c.data.height+2,x:0,y:0},g=new l.ImagePosition(p,c);this.patterns[t]={bin:p,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ce(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:s,h:c}=l.potpack(t),p=this.atlasImage;p.resize({width:s||1,height:c||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],S=x.x+1,E=x.y+1,k=this.images[g].data,P=k.width,D=k.height;l.RGBAImage.copy(k,p,{x:0,y:0},{x:S,y:E},{width:P,height:D}),l.RGBAImage.copy(k,p,{x:0,y:D-1},{x:S,y:E-1},{width:P,height:1}),l.RGBAImage.copy(k,p,{x:0,y:0},{x:S,y:E+D},{width:P,height:1}),l.RGBAImage.copy(k,p,{x:P-1,y:0},{x:S-1,y:E},{width:1,height:D}),l.RGBAImage.copy(k,p,{x:0,y:0},{x:S+P,y:E},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const c=this.images[s];c||l.warnOnce(`Image with ID: "${s}" was not found`),Ot(c)&&this.updateImage(s,c)}}}const ee=1e20;function se(h,t,s,c,p,g,x,S,E){for(let k=t;k<t+c;k++)ke(h,s*g+k,g,p,x,S,E);for(let k=s;k<s+p;k++)ke(h,k*g+t,1,c,x,S,E)}function ke(h,t,s,c,p,g,x){g[0]=0,x[0]=-ee,x[1]=ee,p[0]=h[t];for(let S=1,E=0,k=0;S<c;S++){p[S]=h[t+S*s];const P=S*S;do{const D=g[E];k=(p[S]-p[D]+P-D*D)/(S-D)/2}while(k<=x[E]&&--E>-1);E++,g[E]=S,x[E]=k,x[E+1]=ee}for(let S=0,E=0;S<c;S++){for(;x[E+1]<S;)E++;const k=g[E],P=S-k;h[t+S*s]=p[k]+P*P}}class De{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const c=[];for(const p in t)for(const g of t[p])c.push({stack:p,id:g});l.asyncAll(c,({stack:p,id:g},x)=>{let S=this.entries[p];S||(S=this.entries[p]={glyphs:{},requests:{},ranges:{}});let E=S.glyphs[g];if(E!==void 0)return void x(null,{stack:p,id:g,glyph:E});if(E=this._tinySDF(S,p,g),E)return S.glyphs[g]=E,void x(null,{stack:p,id:g,glyph:E});const k=Math.floor(g/256);if(256*k>65535)return void x(new Error("glyphs > 65535 not supported"));if(S.ranges[k])return void x(null,{stack:p,id:g,glyph:E});let P=S.requests[k];P||(P=S.requests[k]=[],De.loadGlyphRange(p,k,this.url,this.requestManager,(D,R)=>{if(R){for(const G in R)this._doesCharSupportLocalGlyph(+G)||(S.glyphs[+G]=R[+G]);S.ranges[k]=!0}for(const G of P)G(D,R);delete S.requests[k]})),P.push((D,R)=>{D?x(D):R&&x(null,{stack:p,id:g,glyph:R[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const x={};for(const{stack:S,id:E,glyph:k}of g)(x[S]||(x[S]={}))[E]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};s(null,x)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](t)||l.unicodeBlockLookup["Hangul Syllables"](t)||l.unicodeBlockLookup.Hiragana(t)||l.unicodeBlockLookup.Katakana(t))}_tinySDF(t,s,c){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let g=t.tinySDF;if(!g){let S="400";/bold/i.test(s)?S="900":/medium/i.test(s)?S="500":/light/i.test(s)&&(S="200"),g=t.tinySDF=new De.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:p,fontWeight:S})}const x=g.draw(String.fromCharCode(c));return{id:c,bitmap:new l.AlphaImage({width:x.width||30,height:x.height||30},x.data),metrics:{width:x.glyphWidth||24,height:x.glyphHeight||24,left:x.glyphLeft||0,top:x.glyphTop-27||-8,advance:x.glyphAdvance||24}}}}De.loadGlyphRange=function(h,t,s,c,p){const g=256*t,x=g+255,S=c.transformRequest(s.replace("{fontstack}",h).replace("{range}",`${g}-${x}`),l.ResourceType.Glyphs);l.getArrayBuffer(S,(E,k)=>{if(E)p(E);else if(k){const P={};for(const D of l.parseGlyphPbf(k))P[D.id]=D;p(null,P)}})},De.TinySDF=class{constructor({fontSize:h=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const S=this.size=h+4*t,E=this._createCanvas(S),k=this.ctx=E.getContext("2d",{willReadFrequently:!0});k.font=`${x} ${g} ${h}px ${p}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(h){const t=document.createElement("canvas");return t.width=t.height=h,t}draw(h){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(h),x=Math.ceil(s),S=Math.min(this.size-this.buffer,Math.ceil(g-p)),E=Math.min(this.size-this.buffer,x+Math.ceil(c)),k=S+2*this.buffer,P=E+2*this.buffer,D=Math.max(k*P,0),R=new Uint8ClampedArray(D),G={data:R,width:k,height:P,glyphWidth:S,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(S===0||E===0)return G;const{ctx:$,buffer:j,gridInner:Q,gridOuter:ie}=this;$.clearRect(j,j,S,E),$.fillText(h,j,j+x);const ue=$.getImageData(j,j,S,E);ie.fill(ee,0,D),Q.fill(0,0,D);for(let Z=0;Z<E;Z++)for(let de=0;de<S;de++){const ce=ue.data[4*(Z*S+de)+3]/255;if(ce===0)continue;const _e=(Z+j)*k+de+j;if(ce===1)ie[_e]=0,Q[_e]=ee;else{const xe=.5-ce;ie[_e]=xe>0?xe*xe:0,Q[_e]=xe<0?xe*xe:0}}se(ie,0,0,k,P,k,this.f,this.v,this.z),se(Q,j,j,S,E,k,this.f,this.v,this.z);for(let Z=0;Z<D;Z++){const de=Math.sqrt(ie[Z])-Math.sqrt(Q[Z]);R[Z]=Math.round(255-255*(de/this.radius+this.cutoff))}return G}};const He=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(h,t){return l.sphericalToCartesian(h.expression.evaluate(t))}interpolate(h,t,s){return{x:l.number(h.x,t.x,s),y:l.number(h.y,t.y,s),z:l.number(h.z,t.z,s)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Je="-transition";class Qe extends l.Evented{constructor(t){super(),this._transitionable=new l.Transitionable(He),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(l.validateLight,t,s))for(const c in t){const p=t[c];c.endsWith(Je)?this._transitionable.setTransition(c.slice(0,-Je.length),p):this._transitionable.setValue(c,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,c){return(!c||c.validate!==!1)&&l.emitValidationErrors(this,t.call(l.validateStyle,l.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Zt{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const c=t.join(",")+String(s);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,s)),this.dashEntry[c]}getDashRanges(t,s,c){const p=[];let g=t.length%2==1?-t[t.length-1]*c:0,x=t[0]*c,S=!0;p.push({left:g,right:x,isDash:S,zeroLength:t[0]===0});let E=t[0];for(let k=1;k<t.length;k++){S=!S;const P=t[k];g=E*c,E+=P,x=E*c,p.push({left:g,right:x,isDash:S,zeroLength:P===0})}return p}addRoundDash(t,s,c){const p=s/2;for(let g=-c;g<=c;g++){const x=this.width*(this.nextRow+c+g);let S=0,E=t[S];for(let k=0;k<this.width;k++){k/E.right>1&&(E=t[++S]);const P=Math.abs(k-E.left),D=Math.abs(k-E.right),R=Math.min(P,D);let G;const $=g/c*(p+1);if(E.isDash){const j=p-Math.abs($);G=Math.sqrt(R*R+j*j)}else G=p-Math.sqrt(R*R+$*$);this.data[x+k]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(t){for(let S=t.length-1;S>=0;--S){const E=t[S],k=t[S+1];E.zeroLength?t.splice(S,1):k&&k.isDash===E.isDash&&(k.left=E.left,t.splice(S,1))}const s=t[0],c=t[t.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const p=this.width*this.nextRow;let g=0,x=t[g];for(let S=0;S<this.width;S++){S/x.right>1&&(x=t[++g]);const E=Math.abs(S-x.left),k=Math.abs(S-x.right),P=Math.min(E,k);this.data[p+S]=Math.max(0,Math.min(255,(x.isDash?P:-P)+128))}}addDash(t,s){const c=s?7:0,p=2*c+1;if(this.nextRow+p>this.height)return l.warnOnce("LineAtlas out of space"),null;let g=0;for(let S=0;S<t.length;S++)g+=t[S];if(g!==0){const S=this.width/g,E=this.getDashRanges(t,this.width,S);s?this.addRoundDash(E,S,c):this.addRegularDash(E)}const x={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:g};return this.nextRow+=p,this.dirty=!0,x}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class mt{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const c=this.workerPool.acquire(this.id);for(let p=0;p<c.length;p++){const g=new mt.Actor(c[p],s,this.id);g.name=`Worker ${p}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,c){l.asyncAll(this.actors,(p,g)=>{p.send(t,s,g)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function _n(h,t,s){const c=function(p,g){if(p)return s(p);if(g){const x=l.pick(l.extend(g,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(x.vectorLayers=g.vector_layers,x.vectorLayerIds=x.vectorLayers.map(S=>S.id)),s(null,x)}};return h.url?l.getJSON(t.transformRequest(h.url,l.ResourceType.Source),c):l.exported.frame(()=>c(null,h))}mt.Actor=l.Actor;class Zn{constructor(t,s,c){this.bounds=l.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),c=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*s),p=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*s),g=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*s),x=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=c&&t.x<g&&t.y>=p&&t.y<x}}class Ii extends l.Evented{constructor(t,s,c,p){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(s,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_n(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new l.ErrorEvent(t)):s&&(l.extend(this,s),s.bounds&&(this.tileBounds=new Zn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(c,l.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(x,S){return delete t.request,t.aborted?s(null):x&&x.status!==404?s(x):(S&&S.resourceTiming&&(t.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&t.setExpiryData(S),t.loadVectorData(S,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",p,g.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",p,g.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ni extends l.Evented{constructor(t,s,c,p){super(),this.id=t,this.dispatcher=c,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},s),l.extend(this,l.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_n(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new l.ErrorEvent(t)):s&&(l.extend(this,s),s.bounds&&(this.tileBounds=new Zn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=l.getImage(this.map._requestManager.transformRequest(c,l.ResourceType.Tile),(p,g,x)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(p)t.state="errored",s(p);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(x);const S=this.map.painter.context,E=S.gl;t.texture=this.map.painter.getTileTexture(g.width),t.texture?t.texture.update(g,{useMipmap:!0}):(t.texture=new Ce(S,g,E.RGBA,{useMipmap:!0}),t.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),t.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let er;class st extends Ni{constructor(t,s,c,p){super(t,s,c,p),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function p(g,x){g&&(t.state="errored",s(g)),x&&(t.dem=x,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.request=l.getImage(this.map._requestManager.transformRequest(c,l.ResourceType.Tile),function(g,x){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(g)t.state="errored",s(g);else if(x){this.map._refreshExpiredTiles&&t.setExpiryData(x),delete x.cacheControl,delete x.expires;const S=l.isImageBitmap(x)&&(er==null&&(er=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),er)?x:l.exported.getImageData(x,1),E={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:S,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",E,p.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const s=t.canonical,c=Math.pow(2,s.z),p=(s.x-1+c)%c,g=s.x===0?t.wrap-1:t.wrap,x=(s.x+1+c)%c,S=s.x+1===c?t.wrap+1:t.wrap,E={};return E[new l.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y).key]={backfilled:!1},E[new l.OverscaledTileID(t.overscaledZ,S,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(E[new l.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y-1).key]={backfilled:!1},E[new l.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},E[new l.OverscaledTileID(t.overscaledZ,S,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<c&&(E[new l.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y+1).key]={backfilled:!1},E[new l.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},E[new l.OverscaledTileID(t.overscaledZ,S,s.z,x,s.y+1).key]={backfilled:!1}),E}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class hi extends l.Evented{constructor(t,s,c,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(p),this._data=s.data,this._options=l.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const g=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*g,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*g,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.EXTENT,radius:(s.clusterRadius||50)*g,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:c},p),this}_updateWorkerData(t){const s=l.extend({},this.workerOptions),c=this._data;typeof c=="string"?(s.request=this.map._requestManager.transformRequest(l.exported.resolveURL(c),l.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(p,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:t}));let x=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(x=g.resourceTiming[this.id].slice(0)),p)return void this.fire(new l.ErrorEvent(p));const S={dataType:"source",sourceDataType:t};this._collectResourceTiming&&x&&x.length>0&&l.extend(S,{resourceTiming:x}),this.fire(new l.Event("data",S))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const c=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const p={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(c,p,(g,x)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):g?s(g):(t.loadVectorData(x,this.map.painter,c==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ze=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class at extends l.Evented{constructor(t,s,c,p){super(),this.id=t,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s}load(t,s){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(c,p)=>{this._loaded=!0,c?this.fire(new l.ErrorEvent(c)):p&&(this.image=p,t&&(this.coordinates=t),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const s=t.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(p){let g=1/0,x=1/0,S=-1/0,E=-1/0;for(const R of p)g=Math.min(g,R.x),x=Math.min(x,R.y),S=Math.max(S,R.x),E=Math.max(E,R.y);const k=Math.max(S-g,E-x),P=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),D=Math.pow(2,P);return new l.CanonicalTileID(P,Math.floor((g+S)/2*D),Math.floor((x+E)/2*D))}(s),this.minzoom=this.maxzoom=this.tileID.z;const c=s.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(c[2].x,c[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ze.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ce(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ut extends at{constructor(t,s,c,p){super(t,s,c,p),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,l.ResourceType.Source).url);l.getVideo(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new l.ErrorEvent(s)):c&&(this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ze.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new Ce(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Nt extends at{constructor(t,s,c,p){super(t,s,c,p),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,c=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ze.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ce(s,this.canvas,c.RGBA,{premultiply:!0});for(const p in this.tiles){const g=this.tiles[p];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Xt={vector:Ii,raster:Ni,"raster-dem":st,geojson:hi,video:ut,image:at,canvas:Nt};function Ui(h,t){const s=l.create();return l.translate(s,s,[1,1,0]),l.scale(s,s,[.5*h.width,.5*h.height,1]),l.multiply(s,s,h.calculatePosMatrix(t.toUnwrapped()))}function Qn(h,t,s,c,p,g){const x=function(D,R,G){if(D)for(const $ of D){const j=R[$];if(j&&j.source===G&&j.type==="fill-extrusion")return!0}else for(const $ in R){const j=R[$];if(j.source===G&&j.type==="fill-extrusion")return!0}return!1}(p&&p.layers,t,h.id),S=g.maxPitchScaleFactor(),E=h.tilesIn(c,S,x);E.sort(ei);const k=[];for(const D of E)k.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(t,s,h._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,p,g,S,Ui(h.transform,D.tileID))});const P=function(D){const R={},G={};for(const $ of D){const j=$.queryResults,Q=$.wrappedTileID,ie=G[Q]=G[Q]||{};for(const ue in j){const Z=j[ue],de=ie[ue]=ie[ue]||{},ce=R[ue]=R[ue]||[];for(const _e of Z)de[_e.featureIndex]||(de[_e.featureIndex]=!0,ce.push(_e))}}return R}(k);for(const D in P)P[D].forEach(R=>{const G=R.feature,$=h.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=$});return P}function ei(h,t){const s=h.tileID,c=t.tileID;return s.overscaledZ-c.overscaledZ||s.canonical.y-c.canonical.y||s.wrap-c.wrap||s.canonical.x-c.canonical.x}class Bn{constructor(t,s){this.tileID=t,this.uid=l.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<l.exported.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(s=>t.saveTileTexture(s)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(p,g){const x={};if(!g)return x;for(const S of p){const E=S.layerIds.map(k=>g.getLayer(k)).filter(Boolean);if(E.length!==0){S.layers=E,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(k=>E.filter(P=>P.id===k)[0]));for(const k of E)x[k.id]=S}}return x}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof l.SymbolBucket&&g.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ce(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ce(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,c,p,g,x,S,E,k,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:P,transform:E,params:S,queryPadding:this.queryPadding*k},t,s,c):{}}querySourceFeatures(t,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),g=s?s.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(!x)return;const S=l.createFilter(s&&s.filter),{z:E,x:k,y:P}=this.tileID.canonical,D={z:E,x:k,y:P};for(let R=0;R<x.length;R++){const G=x.feature(R);if(S.needGeometry){const Q=l.toEvaluationFeature(G,!0);if(!S.filter(new l.EvaluationParameters(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!S.filter(new l.EvaluationParameters(this.tileID.overscaledZ),G))continue;const $=c.getId(G,g),j=new l.GeoJSONFeature(G,E,k,P,$);j.tile=D,t.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const c=l.parseCacheControl(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",S=c[x],E=t[x];if(!S||!E||Object.keys(E).length===0)continue;g.update(E,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=s&&s.style&&s.style.getLayer(p);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=l.exported.now()+t}setDependencies(t,s){const c={};for(const p of s)c[p]=!0;this.dependencies[t]=c}hasDependency(t,s){for(const c of t){const p=this.dependencies[c];if(p){for(const g of s)if(p[g])return!0}}return!1}}class di{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,c){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:s,timeout:void 0};if(c!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},c)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const c=t.wrapped().key,p=s===void 0?0:this.data[c].indexOf(s),g=this.data[c][p];return this.data[c].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const c in this.data)for(const p of this.data[c])t(p.value)||s.push(p);for(const c of s)this.remove(c.value.tileID,c)}}class Lr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,c){const p=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},l.extend(this.stateChanges[t][p],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==p&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const g in this.state[t][p])c[g]||(this.deletedStates[t][p][g]=null)}else for(const g in c)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][g]===null&&delete this.deletedStates[t][p][g]}removeFeatureState(t,s,c){if(this.deletedStates[t]===null)return;const p=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&s!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][c]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(c in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][c]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,s){const c=String(s),p=l.extend({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][s];if(g===null)return{};for(const x in g)delete p[x]}return p}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),l.extend(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];c[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const x in this.state[p])g[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else for(const S of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][S];g[x]=this.state[p][x]}c[p]=c[p]||{},l.extend(c[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const p in t)t[p].setFeatureState(c,s)}}class ti extends l.Evented{constructor(t,s,c){super(),this.id=t,this.dispatcher=c,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(p,g,x,S){const E=new Xt[g.type](p,g,x,S);if(E.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${E.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],E),E}(t,s,c,this),this._tiles={},this._cache=new di(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Lr}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new l.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(zo).map(t=>t.key)}getRenderableIds(t){const s=[];for(const c in this._tiles)this._isIdRenderable(c,t)&&s.push(this._tiles[c]);return t?s.sort((c,p)=>{const g=c.tileID,x=p.tileID,S=new l.pointGeometry(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),E=new l.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-x.overscaledZ||E.y-S.y||E.x-S.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(zo).map(c=>c.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,t,s)))}_tileLoaded(t,s,c,p){if(p)return t.state="errored",void(p.status!==404?this._source.fire(new l.ErrorEvent(p,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=l.exported.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const g=s[p];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);c(t,x),c(x,t)}}function c(p,g){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-p.tileID.canonical.x;const S=g.tileID.canonical.y-p.tileID.canonical.y,E=Math.pow(2,p.tileID.canonical.z),k=g.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+E)===1?x+=E:Math.abs(x-E)===1&&(x-=E)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,x,S),p.neighboringTiles&&p.neighboringTiles[k]&&(p.neighboringTiles[k].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,c,p){for(const g in this._tiles){let x=this._tiles[g];if(p[g]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>c)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const k=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[k.key],x&&x.hasData()&&(S=k)}let E=S;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){p[S.key]=S;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=t.overscaledZ-1;c>=s;c--){const p=t.scaledTo(c),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(s*c*5),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const c={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new l.OverscaledTileID(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(c=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(c=c.filter(k=>this._source.hasTile(k)))):c=[];const p=t.coveringZoomLevel(this._source),g=Math.max(p-ti.maxOverzooming,this._source.minzoom),x=Math.max(p+ti.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const P of c)if(P.canonical.z>this._source.minzoom){const D=P.scaledTo(P.canonical.z-1);k[D.key]=D;const R=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));k[R.key]=R}c=c.concat(Object.values(k))}const S=this._updateRetainedTiles(c,p);if(ws(this._source.type)){const k={},P={},D=Object.keys(S);for(const R of D){const G=S[R],$=this._tiles[R];if(!$||$.fadeEndTime&&$.fadeEndTime<=l.exported.now())continue;const j=this.findLoadedParent(G,g);j&&(this._addTile(j.tileID),k[j.tileID.key]=j.tileID),P[R]=G}this._retainLoadedChildren(P,p,x,S);for(const R in k)S[R]||(this._coveredTiles[R]=!0,S[R]=k[R]);if(s){const R={},G={};for(const $ of c)this._tiles[$.key].hasData()?R[$.key]=$:G[$.key]=$;for(const $ in G){const j=G[$].children(this._source.maxzoom);this._tiles[j[0].key]&&this._tiles[j[1].key]&&this._tiles[j[2].key]&&this._tiles[j[3].key]&&(R[j[0].key]=S[j[0].key]=j[0],R[j[1].key]=S[j[1].key]=j[1],R[j[2].key]=S[j[2].key]=j[2],R[j[3].key]=S[j[3].key]=j[3],delete G[$])}for(const $ in G){const j=this.findLoadedParent(G[$],this._source.minzoom);if(j){R[j.tileID.key]=S[j.tileID.key]=j.tileID;for(const Q in R)R[Q].isChildOf(j.tileID)&&delete R[Q]}}for(const $ in this._tiles)R[$]||(this._coveredTiles[$]=!0)}}for(const k in S)this._tiles[k].clearFadeHold();const E=l.keysDifference(this._tiles,S);for(const k of E){const P=this._tiles[k];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const c={},p={},g=Math.max(s-ti.maxOverzooming,this._source.minzoom),x=Math.max(s+ti.maxUnderzooming,this._source.minzoom),S={};for(const E of t){const k=this._addTile(E);c[E.key]=E,k.hasData()||s<this._source.maxzoom&&(S[E.key]=E)}this._retainLoadedChildren(S,s,x,c);for(const E of t){let k=this._tiles[E.key];if(k.hasData())continue;if(s+1>this._source.maxzoom){const D=E.children(this._source.maxzoom)[0],R=this.getTile(D);if(R&&R.hasData()){c[D.key]=D;continue}}else{const D=E.children(this._source.maxzoom);if(c[D[0].key]&&c[D[1].key]&&c[D[2].key]&&c[D[3].key])continue}let P=k.wasRequested();for(let D=E.overscaledZ-1;D>=g;--D){const R=E.scaledTo(D);if(p[R.key]||(p[R.key]=!0,k=this.getTile(R),!k&&P&&(k=this._addTile(R)),k&&(c[R.key]=R,P=k.wasRequested(),k.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let c,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}s.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;p=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const c=s;return s||(s=new Bn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,c||this._source.fire(new l.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=s.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,c){const p=[],g=this.transform;if(!g)return p;const x=c?g.getCameraQueryGeometry(t):t,S=t.map($=>g.pointCoordinate($,this.terrain)),E=x.map($=>g.pointCoordinate($,this.terrain)),k=this.getIds();let P=1/0,D=1/0,R=-1/0,G=-1/0;for(const $ of E)P=Math.min(P,$.x),D=Math.min(D,$.y),R=Math.max(R,$.x),G=Math.max(G,$.y);for(let $=0;$<k.length;$++){const j=this._tiles[k[$]];if(j.holdingForFade())continue;const Q=j.tileID,ie=Math.pow(2,g.zoom-j.tileID.overscaledZ),ue=s*j.queryPadding*l.EXTENT/j.tileSize/ie,Z=[Q.getTilePoint(new l.MercatorCoordinate(P,D)),Q.getTilePoint(new l.MercatorCoordinate(R,G))];if(Z[0].x-ue<l.EXTENT&&Z[0].y-ue<l.EXTENT&&Z[1].x+ue>=0&&Z[1].y+ue>=0){const de=S.map(_e=>Q.getTilePoint(_e)),ce=E.map(_e=>Q.getTilePoint(_e));p.push({tile:j,tileID:Q,queryGeometry:de,cameraQueryGeometry:ce,scale:ie})}}return p}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);for(const c of s)c.posMatrix=this.transform.calculatePosMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(ws(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(t,s,c){this._state.updateState(t=t||"_geojsonTileLayer",s,c)}removeFeatureState(t,s,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,c)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,c){const p=this._tiles[t];p&&p.setDependencies(s,c)}reloadTilesForDependencies(t,s){for(const c in this._tiles)this._tiles[c].hasDependency(t,s)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(t,s))}}function zo(h,t){const s=Math.abs(2*h.wrap)-+(h.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||c-s||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function ws(h){return h==="raster"||h==="image"||h==="video"}ti.maxOverzooming=10,ti.maxUnderzooming=3;const mr="mapboxgl_preloaded_worker_pool";class pi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<pi.workerCount;)this.workers.push(new Worker(lo.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mr]}numActive(){return Object.keys(this.active).length}}const bs=Math.floor(l.exported.hardwareConcurrency/2);let Rr;function Po(){return Rr||(Rr=new pi),Rr}function Mo(h,t){const s={};for(const c in h)c!=="ref"&&(s[c]=h[c]);return l.refProperties.forEach(c=>{c in t&&(s[c]=t[c])}),s}function Ss(h){h=h.slice();const t=Object.create(null);for(let s=0;s<h.length;s++)t[h[s].id]=h[s];for(let s=0;s<h.length;s++)"ref"in h[s]&&(h[s]=Mo(h[s],t[h[s].ref]));return h}pi.workerCount=Math.max(Math.min(bs,6),1);const Et={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function tr(h,t,s){s.push({command:Et.addSource,args:[h,t[h]]})}function Br(h,t,s){t.push({command:Et.removeSource,args:[h]}),s[h]=!0}function Fr(h,t,s,c){Br(h,s,c),tr(h,t,s)}function Es(h,t,s){let c;for(c in h[s])if(Object.prototype.hasOwnProperty.call(h[s],c)&&c!=="data"&&!le(h[s][c],t[s][c]))return!1;for(c in t[s])if(Object.prototype.hasOwnProperty.call(t[s],c)&&c!=="data"&&!le(h[s][c],t[s][c]))return!1;return!0}function gr(h,t,s,c,p,g){let x;for(x in t=t||{},h=h||{})Object.prototype.hasOwnProperty.call(h,x)&&(le(h[x],t[x])||s.push({command:g,args:[c,x,t[x],p]}));for(x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(h,x)&&(le(h[x],t[x])||s.push({command:g,args:[c,x,t[x],p]}))}function yr(h){return h.id}function Ao(h,t){return h[t.id]=t,h}class _r{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.clamp(t,0,1);let s=1,c=this._distances[s];const p=t*this.paddedLength+this.padding;for(;c<p&&s<this._distances.length;)c=this._distances[++s];const g=s-1,x=this._distances[g],S=c-x,E=S>0?(p-x)/S:0;return this.points[g].mult(1-E).add(this.points[s].mult(E))}}function ve(h,t){let s=!0;return h==="always"||h!=="never"&&t!=="never"||(s=!1),s}class Re{constructor(t,s,c){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(s/c);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,c,p,g){this._forEachCell(s,c,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(t,s,c,p){this._forEachCell(s-p,c-p,s+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(c),this.circles.push(p)}_insertBoxCell(t,s,c,p,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,s,c,p,g,x){this.circleCells[g].push(x)}_query(t,s,c,p,g,x,S){if(c<0||t>this.width||p<0||s>this.height)return[];const E=[];if(t<=0&&s<=0&&this.width<=c&&this.height<=p){if(g)return[{key:null,x1:t,y1:s,x2:c,y2:p}];for(let k=0;k<this.boxKeys.length;k++)E.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const P=this.circles[3*k],D=this.circles[3*k+1],R=this.circles[3*k+2];E.push({key:this.circleKeys[k],x1:P-R,y1:D-R,x2:P+R,y2:D+R})}}else this._forEachCell(t,s,c,p,this._queryCell,E,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},S);return E}query(t,s,c,p){return this._query(t,s,c,p,!1,null)}hitTest(t,s,c,p,g,x){return this._query(t,s,c,p,!0,g,x).length>0}hitTestCircle(t,s,c,p,g){const x=t-c,S=t+c,E=s-c,k=s+c;if(S<0||x>this.width||k<0||E>this.height)return!1;const P=[];return this._forEachCell(x,E,S,k,this._queryCellCircle,P,{hitTest:!0,overlapMode:p,circle:{x:t,y:s,radius:c},seenUids:{box:{},circle:{}}},g),P.length>0}_queryCell(t,s,c,p,g,x,S,E){const{seenUids:k,hitTest:P,overlapMode:D}=S,R=this.boxCells[g];if(R!==null){const $=this.bboxes;for(const j of R)if(!k.box[j]){k.box[j]=!0;const Q=4*j,ie=this.boxKeys[j];if(t<=$[Q+2]&&s<=$[Q+3]&&c>=$[Q+0]&&p>=$[Q+1]&&(!E||E(ie))&&(!P||!ve(D,ie.overlapMode))&&(x.push({key:ie,x1:$[Q],y1:$[Q+1],x2:$[Q+2],y2:$[Q+3]}),P))return!0}}const G=this.circleCells[g];if(G!==null){const $=this.circles;for(const j of G)if(!k.circle[j]){k.circle[j]=!0;const Q=3*j,ie=this.circleKeys[j];if(this._circleAndRectCollide($[Q],$[Q+1],$[Q+2],t,s,c,p)&&(!E||E(ie))&&(!P||!ve(D,ie.overlapMode))){const ue=$[Q],Z=$[Q+1],de=$[Q+2];if(x.push({key:ie,x1:ue-de,y1:Z-de,x2:ue+de,y2:Z+de}),P)return!0}}}return!1}_queryCellCircle(t,s,c,p,g,x,S,E){const{circle:k,seenUids:P,overlapMode:D}=S,R=this.boxCells[g];if(R!==null){const $=this.bboxes;for(const j of R)if(!P.box[j]){P.box[j]=!0;const Q=4*j,ie=this.boxKeys[j];if(this._circleAndRectCollide(k.x,k.y,k.radius,$[Q+0],$[Q+1],$[Q+2],$[Q+3])&&(!E||E(ie))&&!ve(D,ie.overlapMode))return x.push(!0),!0}}const G=this.circleCells[g];if(G!==null){const $=this.circles;for(const j of G)if(!P.circle[j]){P.circle[j]=!0;const Q=3*j,ie=this.circleKeys[j];if(this._circlesCollide($[Q],$[Q+1],$[Q+2],k.x,k.y,k.radius)&&(!E||E(ie))&&!ve(D,ie.overlapMode))return x.push(!0),!0}}}_forEachCell(t,s,c,p,g,x,S,E){const k=this._convertToXCellCoord(t),P=this._convertToYCellCoord(s),D=this._convertToXCellCoord(c),R=this._convertToYCellCoord(p);for(let G=k;G<=D;G++)for(let $=P;$<=R;$++)if(g.call(this,t,s,c,p,this.xCellCount*$+G,x,S,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,c,p,g,x){const S=p-t,E=g-s,k=c+x;return k*k>S*S+E*E}_circleAndRectCollide(t,s,c,p,g,x,S){const E=(x-p)/2,k=Math.abs(t-(p+E));if(k>E+c)return!1;const P=(S-g)/2,D=Math.abs(s-(g+P));if(D>P+c)return!1;if(k<=E||D<=P)return!0;const R=k-E,G=D-P;return R*R+G*G<=c*c}}function eo(h,t,s,c,p){const g=l.create();return t?(l.scale(g,g,[1/p,1/p,1]),s||l.rotateZ(g,g,c.angle)):l.multiply(g,c.labelPlaneMatrix,h),g}function Vi(h,t,s,c,p){if(t){const g=l.clone(h);return l.scale(g,g,[p,p,1]),s||l.rotateZ(g,g,-c.angle),g}return c.glCoordMatrix}function Tt(h,t,s){let c;s?(c=[h.x,h.y,s(h.x,h.y),1],l.transformMat4(c,c,t)):(c=[h.x,h.y,0,1],xr(c,c,t));const p=c[3];return{point:new l.pointGeometry(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function zi(h,t){return .5+h/t*.5}function fi(h,t){const s=h[0]/h[3],c=h[1]/h[3];return s>=-t[0]&&s<=t[0]&&c>=-t[1]&&c<=t[1]}function mi(h,t,s,c,p,g,x,S,E,k){const P=c?h.textSizeData:h.iconSizeData,D=l.evaluateSizeForZoom(P,s.transform.zoom),R=[256/s.width*2+1,256/s.height*2+1],G=c?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;G.clear();const $=h.lineVertexArray,j=c?h.text.placedSymbolArray:h.icon.placedSymbolArray,Q=s.transform.width/s.transform.height;let ie=!1;for(let ue=0;ue<j.length;ue++){const Z=j.get(ue);if(Z.hidden||Z.writingMode===l.WritingMode.vertical&&!ie){ht(Z.numGlyphs,G);continue}let de;if(ie=!1,k?(de=[Z.anchorX,Z.anchorY,k(Z.anchorX,Z.anchorY),1],l.transformMat4(de,de,t)):(de=[Z.anchorX,Z.anchorY,0,1],xr(de,de,t)),!fi(de,R)){ht(Z.numGlyphs,G);continue}const ce=zi(s.transform.cameraToCenterDistance,de[3]),_e=l.evaluateSizeForFeature(P,D,Z),xe=x?_e/ce:_e*ce,Ee=new l.pointGeometry(Z.anchorX,Z.anchorY),ye=Tt(Ee,p,k).point,$e={},Me=gt(Z,xe,!1,S,t,p,g,h.glyphOffsetArray,$,G,ye,Ee,$e,Q,E,k);ie=Me.useVertical,(Me.notEnoughRoom||ie||Me.needsFlipping&&gt(Z,xe,!0,S,t,p,g,h.glyphOffsetArray,$,G,ye,Ee,$e,Q,E,k).notEnoughRoom)&&ht(Z.numGlyphs,G)}c?h.text.dynamicLayoutVertexBuffer.updateData(G):h.icon.dynamicLayoutVertexBuffer.updateData(G)}function Or(h,t,s,c,p,g,x,S,E,k,P,D,R){const G=S.glyphStartIndex+S.numGlyphs,$=S.lineStartIndex,j=S.lineStartIndex+S.lineLength,Q=t.getoffsetX(S.glyphStartIndex),ie=t.getoffsetX(G-1),ue=Mn(h*Q,s,c,p,g,x,S.segment,$,j,E,k,P,D,R);if(!ue)return null;const Z=Mn(h*ie,s,c,p,g,x,S.segment,$,j,E,k,P,D,R);return Z?{first:ue,last:Z}:null}function Pe(h,t,s,c){return h===l.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*c?{useVertical:!0}:(h===l.WritingMode.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function gt(h,t,s,c,p,g,x,S,E,k,P,D,R,G,$,j){const Q=t/24,ie=h.lineOffsetX*Q,ue=h.lineOffsetY*Q;let Z;if(h.numGlyphs>1){const de=h.glyphStartIndex+h.numGlyphs,ce=h.lineStartIndex,_e=h.lineStartIndex+h.lineLength,xe=Or(Q,S,ie,ue,s,P,D,h,E,g,R,$,j);if(!xe)return{notEnoughRoom:!0};const Ee=Tt(xe.first.point,x,j).point,ye=Tt(xe.last.point,x,j).point;if(c&&!s){const $e=Pe(h.writingMode,Ee,ye,G);if($e)return $e}Z=[xe.first];for(let $e=h.glyphStartIndex+1;$e<de-1;$e++)Z.push(Mn(Q*S.getoffsetX($e),ie,ue,s,P,D,h.segment,ce,_e,E,g,R,$,j));Z.push(xe.last)}else{if(c&&!s){const ce=Tt(D,p,j).point,_e=h.lineStartIndex+h.segment+1,xe=new l.pointGeometry(E.getx(_e),E.gety(_e)),Ee=Tt(xe,p,j),ye=Ee.signedDistanceFromCamera>0?Ee.point:pt(D,xe,ce,1,p,j),$e=Pe(h.writingMode,ce,ye,G);if($e)return $e}const de=Mn(Q*S.getoffsetX(h.glyphStartIndex),ie,ue,s,P,D,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,E,g,R,$,j);if(!de)return{notEnoughRoom:!0};Z=[de]}for(const de of Z)l.addDynamicAttributes(k,de.point,de.angle);return{}}function pt(h,t,s,c,p,g){const x=Tt(h.add(h.sub(t)._unit()),p,g).point,S=s.sub(x);return s.add(S._mult(c/S.mag()))}function Mn(h,t,s,c,p,g,x,S,E,k,P,D,R,G){const $=c?h-t:h+t;let j=$>0?1:-1,Q=0;c&&(j*=-1,Q=Math.PI),j<0&&(Q+=Math.PI);let ie=j>0?S+x:S+x+1,ue=p,Z=p,de=0,ce=0;const _e=Math.abs($),xe=[];for(;de+ce<=_e;){if(ie+=j,ie<S||ie>=E)return null;if(Z=ue,xe.push(ue),ue=D[ie],ue===void 0){const je=new l.pointGeometry(k.getx(ie),k.gety(ie)),ft=Tt(je,P,G);if(ft.signedDistanceFromCamera>0)ue=D[ie]=ft.point;else{const _t=ie-j;ue=pt(de===0?g:new l.pointGeometry(k.getx(_t),k.gety(_t)),je,Z,_e-de+1,P,G)}}de+=ce,ce=Z.dist(ue)}const Ee=(_e-de)/ce,ye=ue.sub(Z),$e=ye.mult(Ee)._add(Z);$e._add(ye._unit()._perp()._mult(s*j));const Me=Q+Math.atan2(ue.y-Z.y,ue.x-Z.x);return xe.push($e),{point:$e,angle:R?Me:0,path:xe}}const Nr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ht(h,t){for(let s=0;s<h;s++){const c=t.length;t.resize(c+4),t.float32.set(Nr,3*c)}}function xr(h,t,s){const c=t[0],p=t[1];return h[0]=s[0]*c+s[4]*p+s[12],h[1]=s[1]*c+s[5]*p+s[13],h[3]=s[3]*c+s[7]*p+s[15],h}const Sn=100;class Do{constructor(t,s=new Re(t.width+200,t.height+200,25),c=new Re(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=c,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Sn,this.screenBottomBoundary=t.height+Sn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,c,p,g,x){const S=this.projectAndGetPerspectiveRatio(p,t.anchorPointX,t.anchorPointY,x),E=c*S.perspectiveRatio,k=t.x1*E+S.point.x,P=t.y1*E+S.point.y,D=t.x2*E+S.point.x,R=t.y2*E+S.point.y;return!this.isInsideGrid(k,P,D,R)||s!=="always"&&this.grid.hitTest(k,P,D,R,s,g)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[k,P,D,R],offscreen:this.isOffscreen(k,P,D,R)}}placeCollisionCircles(t,s,c,p,g,x,S,E,k,P,D,R,G,$){const j=[],Q=new l.pointGeometry(s.anchorX,s.anchorY),ie=Tt(Q,x,$),ue=zi(this.transform.cameraToCenterDistance,ie.signedDistanceFromCamera),Z=(P?g/ue:g*ue)/l.ONE_EM,de=Tt(Q,S,$).point,ce=Or(Z,p,s.lineOffsetX*Z,s.lineOffsetY*Z,!1,de,Q,s,c,S,{},!1,$);let _e=!1,xe=!1,Ee=!0;if(ce){const ye=.5*R*ue+G,$e=new l.pointGeometry(-100,-100),Me=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),je=new _r,ft=ce.first,_t=ce.last;let nt=[];for(let St=ft.path.length-1;St>=1;St--)nt.push(ft.path[St]);for(let St=1;St<_t.path.length;St++)nt.push(_t.path[St]);const Dt=2.5*ye;if(E){const St=nt.map(It=>Tt(It,E,$));nt=St.some(It=>It.signedDistanceFromCamera<=0)?[]:St.map(It=>It.point)}let Lt=[];if(nt.length>0){const St=nt[0].clone(),It=nt[0].clone();for(let Ft=1;Ft<nt.length;Ft++)St.x=Math.min(St.x,nt[Ft].x),St.y=Math.min(St.y,nt[Ft].y),It.x=Math.max(It.x,nt[Ft].x),It.y=Math.max(It.y,nt[Ft].y);Lt=St.x>=$e.x&&It.x<=Me.x&&St.y>=$e.y&&It.y<=Me.y?[nt]:It.x<$e.x||St.x>Me.x||It.y<$e.y||St.y>Me.y?[]:l.clipLine([nt],$e.x,$e.y,Me.x,Me.y)}for(const St of Lt){je.reset(St,.25*ye);let It=0;It=je.length<=.5*ye?1:Math.ceil(je.paddedLength/Dt)+1;for(let Ft=0;Ft<It;Ft++){const Tn=Ft/Math.max(It-1,1),or=je.lerp(Tn),ji=or.x+Sn,sr=or.y+Sn;j.push(ji,sr,ye,0);const qr=ji-ye,Mi=sr-ye,ii=ji+ye,br=sr+ye;if(Ee=Ee&&this.isOffscreen(qr,Mi,ii,br),xe=xe||this.isInsideGrid(qr,Mi,ii,br),t!=="always"&&this.grid.hitTestCircle(ji,sr,ye,t,D)&&(_e=!0,!k))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!k&&_e||!xe||ue<this.perspectiveRatioCutoff?[]:j,offscreen:Ee,collisionDetected:_e}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let c=1/0,p=1/0,g=-1/0,x=-1/0;for(const P of t){const D=new l.pointGeometry(P.x+Sn,P.y+Sn);c=Math.min(c,D.x),p=Math.min(p,D.y),g=Math.max(g,D.x),x=Math.max(x,D.y),s.push(D)}const S=this.grid.query(c,p,g,x).concat(this.ignoredGrid.query(c,p,g,x)),E={},k={};for(const P of S){const D=P.key;if(E[D.bucketInstanceId]===void 0&&(E[D.bucketInstanceId]={}),E[D.bucketInstanceId][D.featureIndex])continue;const R=[new l.pointGeometry(P.x1,P.y1),new l.pointGeometry(P.x2,P.y1),new l.pointGeometry(P.x2,P.y2),new l.pointGeometry(P.x1,P.y2)];l.polygonIntersectsPolygon(s,R)&&(E[D.bucketInstanceId][D.featureIndex]=!0,k[D.bucketInstanceId]===void 0&&(k[D.bucketInstanceId]=[]),k[D.bucketInstanceId].push(D.featureIndex))}return k}insertCollisionBox(t,s,c,p,g,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,c,p,g,x){const S=c?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:s};for(let k=0;k<t.length;k+=4)S.insertCircle(E,t[k],t[k+1],t[k+2])}projectAndGetPerspectiveRatio(t,s,c,p){let g;return p?(g=[s,c,p(s,c),1],l.transformMat4(g,g,t)):(g=[s,c,0,1],xr(g,g,t)),{point:new l.pointGeometry((g[0]/g[3]+1)/2*this.transform.width+Sn,(-g[1]/g[3]+1)/2*this.transform.height+Sn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(t,s,c,p){return c<Sn||t>=this.screenRightBoundary||p<Sn||s>this.screenBottomBoundary}isInsideGrid(t,s,c,p){return c>=0&&t<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=l.identity([]);return l.translate(t,t,[-100,-100,0]),t}}function pn(h,t,s){return t*(l.EXTENT/(h.tileSize*Math.pow(2,s-h.tileID.overscaledZ)))}class qn{constructor(t,s,c,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):p&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Bt{constructor(t,s,c,p,g){this.text=new qn(t?t.text:null,s,c,g),this.icon=new qn(t?t.icon:null,s,p,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Lo{constructor(t,s,c){this.text=t,this.icon=s,this.skipFade=c}}class nr{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class to{constructor(t,s,c,p,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=g}}class no{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:c=>c.collisionGroupID===s}}return this.collisionGroups[t]}}function Ro(h,t,s,c,p){const{horizontalAlign:g,verticalAlign:x}=l.getAnchorAlignment(h),S=-(g-.5)*t,E=-(x-.5)*s,k=l.evaluateVariableOffset(h,c);return new l.pointGeometry(S+k[0]*p,E+k[1]*p)}function io(h,t,s,c,p,g){const{x1:x,x2:S,y1:E,y2:k,anchorPointX:P,anchorPointY:D}=h,R=new l.pointGeometry(t,s);return c&&R._rotate(p?g:-g),{x1:x+R.x,y1:E+R.y,x2:S+R.x,y2:k+R.y,anchorPointX:P,anchorPointY:D}}class V{constructor(t,s,c,p,g){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new Do(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new no(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,c,p){const g=c.getBucket(s),x=c.latestFeatureIndex;if(!g||!x||s.id!==g.layerIds[0])return;const S=c.collisionBoxArray,E=g.layers[0].layout,k=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),P=c.tileSize/l.EXTENT,D=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),R=E.get("text-pitch-alignment")==="map",G=E.get("text-rotation-alignment")==="map",$=pn(c,1,this.transform.zoom),j=eo(D,R,G,this.transform,$);let Q=null;if(R){const ue=Vi(D,R,G,this.transform,$);Q=l.multiply([],this.transform.labelPlaneMatrix,ue)}this.retainedQueryData[g.bucketInstanceId]=new to(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,c.tileID);const ie={bucket:g,layout:E,posMatrix:D,textLabelPlaneMatrix:j,labelToScreenMatrix:Q,scale:k,textPixelRatio:P,holdingForFade:c.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(p)for(const ue of g.sortKeyRanges){const{sortKey:Z,symbolInstanceStart:de,symbolInstanceEnd:ce}=ue;t.push({sortKey:Z,symbolInstanceStart:de,symbolInstanceEnd:ce,parameters:ie})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(t,s,c,p,g,x,S,E,k,P,D,R,G,$,j,Q){const ie=[R.textOffset0,R.textOffset1],ue=Ro(t,c,p,ie,g),Z=this.collisionIndex.placeCollisionBox(io(s,ue.x,ue.y,x,S,this.transform.angle),D,E,k,P.predicate,Q);if((!j||this.collisionIndex.placeCollisionBox(io(j,ue.x,ue.y,x,S,this.transform.angle),D,E,k,P.predicate,Q).box.length!==0)&&Z.box.length>0){let de;if(this.prevPlacement&&this.prevPlacement.variableOffsets[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID].text&&(de=this.prevPlacement.variableOffsets[R.crossTileID].anchor),R.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[R.crossTileID]={textOffset:ie,width:c,height:p,anchor:t,textBoxScale:g,prevAnchor:de},this.markUsedJustification(G,t,R,$),G.allowVerticalPlacement&&(this.markUsedOrientation(G,$,R),this.placedOrientations[R.crossTileID]=$),{shift:ue,placedGlyphBoxes:Z}}}placeLayerBucketPart(t,s,c){const{bucket:p,layout:g,posMatrix:x,textLabelPlaneMatrix:S,labelToScreenMatrix:E,textPixelRatio:k,holdingForFade:P,collisionBoxArray:D,partiallyEvaluatedTextSize:R,collisionGroup:G}=t.parameters,$=g.get("text-optional"),j=g.get("icon-optional"),Q=l.getOverlapMode(g,"text-overlap","text-allow-overlap"),ie=Q==="always",ue=l.getOverlapMode(g,"icon-overlap","icon-allow-overlap"),Z=ue==="always",de=g.get("text-rotation-alignment")==="map",ce=g.get("text-pitch-alignment")==="map",_e=g.get("icon-text-fit")!=="none",xe=g.get("symbol-z-order")==="viewport-y",Ee=ie&&(Z||!p.hasIconData()||j),ye=Z&&(ie||!p.hasTextData()||$);!p.collisionArrays&&D&&p.deserializeCollisionBoxes(D);const $e=(Me,je)=>{if(s[Me.crossTileID])return;if(P)return void(this.placements[Me.crossTileID]=new Lo(!1,!1,!1));let ft=!1,_t=!1,nt=!0,Dt=null,Lt={box:null,offscreen:null},St={box:null,offscreen:null},It=null,Ft=null,Tn=null,or=0,ji=0,sr=0;je.textFeatureIndex?or=je.textFeatureIndex:Me.useRuntimeCollisionCircles&&(or=Me.featureIndex),je.verticalTextFeatureIndex&&(ji=je.verticalTextFeatureIndex);const qr=this.retainedQueryData[p.bucketInstanceId].tileID,Mi=this.terrain?(xn,vt)=>this.terrain.getElevation(qr,xn,vt):null;for(const xn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const vt=je[xn];vt&&(vt.elevation=Mi?Mi(vt.anchorPointX,vt.anchorPointY):0)}const ii=je.textBox;if(ii){const xn=At=>{let kn=l.WritingMode.horizontal;if(p.allowVerticalPlacement&&!At&&this.prevPlacement){const Cn=this.prevPlacement.placedOrientations[Me.crossTileID];Cn&&(this.placedOrientations[Me.crossTileID]=Cn,kn=Cn,this.markUsedOrientation(p,kn,Me))}return kn},vt=(At,kn)=>{if(p.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&je.verticalTextBox){for(const Cn of p.writingModes)if(Cn===l.WritingMode.vertical?(Lt=kn(),St=Lt):Lt=At(),Lt&&Lt.box&&Lt.box.length)break}else Lt=At()};if(g.get("text-variable-anchor")){let At=g.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Me.crossTileID]){const Qt=this.prevPlacement.variableOffsets[Me.crossTileID];At.indexOf(Qt.anchor)>0&&(At=At.filter(Ai=>Ai!==Qt.anchor),At.unshift(Qt.anchor))}const kn=(Qt,Ai,uo)=>{const Ql=Qt.x2-Qt.x1,Xo=Qt.y2-Qt.y1,Wc=Me.textBoxScale,eu=_e&&ue==="never"?Ai:null;let Wr={box:[],offscreen:!1};const co=Q!=="never"?2*At.length:At.length;for(let ho=0;ho<co;++ho){const Ra=this.attemptAnchorPlacement(At[ho%At.length],Qt,Ql,Xo,Wc,de,ce,k,x,G,ho>=At.length?Q:"never",Me,p,uo,eu,Mi);if(Ra&&(Wr=Ra.placedGlyphBoxes,Wr&&Wr.box&&Wr.box.length)){ft=!0,Dt=Ra.shift;break}}return Wr};vt(()=>kn(ii,je.iconBox,l.WritingMode.horizontal),()=>{const Qt=je.verticalTextBox;return p.allowVerticalPlacement&&!(Lt&&Lt.box&&Lt.box.length)&&Me.numVerticalGlyphVertices>0&&Qt?kn(Qt,je.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),Lt&&(ft=Lt.box,nt=Lt.offscreen);const Cn=xn(Lt&&Lt.box);if(!ft&&this.prevPlacement){const Qt=this.prevPlacement.variableOffsets[Me.crossTileID];Qt&&(this.variableOffsets[Me.crossTileID]=Qt,this.markUsedJustification(p,Qt.anchor,Me,Cn))}}else{const At=(kn,Cn)=>{const Qt=this.collisionIndex.placeCollisionBox(kn,Q,k,x,G.predicate,Mi);return Qt&&Qt.box&&Qt.box.length&&(this.markUsedOrientation(p,Cn,Me),this.placedOrientations[Me.crossTileID]=Cn),Qt};vt(()=>At(ii,l.WritingMode.horizontal),()=>{const kn=je.verticalTextBox;return p.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&kn?At(kn,l.WritingMode.vertical):{box:null,offscreen:null}}),xn(Lt&&Lt.box&&Lt.box.length)}}if(It=Lt,ft=It&&It.box&&It.box.length>0,nt=It&&It.offscreen,Me.useRuntimeCollisionCircles){const xn=p.text.placedSymbolArray.get(Me.centerJustifiedTextSymbolIndex),vt=l.evaluateSizeForFeature(p.textSizeData,R,xn),At=g.get("text-padding");Ft=this.collisionIndex.placeCollisionCircles(Q,xn,p.lineVertexArray,p.glyphOffsetArray,vt,x,S,E,c,ce,G.predicate,Me.collisionCircleDiameter,At,Mi),Ft.circles.length&&Ft.collisionDetected&&!c&&l.warnOnce("Collisions detected, but collision boxes are not shown"),ft=ie||Ft.circles.length>0&&!Ft.collisionDetected,nt=nt&&Ft.offscreen}if(je.iconFeatureIndex&&(sr=je.iconFeatureIndex),je.iconBox){const xn=vt=>{const At=_e&&Dt?io(vt,Dt.x,Dt.y,de,ce,this.transform.angle):vt;return this.collisionIndex.placeCollisionBox(At,ue,k,x,G.predicate,Mi)};St&&St.box&&St.box.length&&je.verticalIconBox?(Tn=xn(je.verticalIconBox),_t=Tn.box.length>0):(Tn=xn(je.iconBox),_t=Tn.box.length>0),nt=nt&&Tn.offscreen}const br=$||Me.numHorizontalGlyphVertices===0&&Me.numVerticalGlyphVertices===0,La=j||Me.numIconVertices===0;if(br||La?La?br||(_t=_t&&ft):ft=_t&&ft:_t=ft=_t&&ft,ft&&It&&It.box&&this.collisionIndex.insertCollisionBox(It.box,Q,g.get("text-ignore-placement"),p.bucketInstanceId,St&&St.box&&ji?ji:or,G.ID),_t&&Tn&&this.collisionIndex.insertCollisionBox(Tn.box,ue,g.get("icon-ignore-placement"),p.bucketInstanceId,sr,G.ID),Ft&&(ft&&this.collisionIndex.insertCollisionCircles(Ft.circles,Q,g.get("text-ignore-placement"),p.bucketInstanceId,or,G.ID),c)){const xn=p.bucketInstanceId;let vt=this.collisionCircleArrays[xn];vt===void 0&&(vt=this.collisionCircleArrays[xn]=new nr);for(let At=0;At<Ft.circles.length;At+=4)vt.circles.push(Ft.circles[At+0]),vt.circles.push(Ft.circles[At+1]),vt.circles.push(Ft.circles[At+2]),vt.circles.push(Ft.collisionDetected?1:0)}if(Me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Me.crossTileID]=new Lo(ft||Ee,_t||ye,nt||p.justReloaded),s[Me.crossTileID]=!0};if(xe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Me=p.getSortedSymbolIndexes(this.transform.angle);for(let je=Me.length-1;je>=0;--je){const ft=Me[je];$e(p.symbolInstances.get(ft),p.collisionArrays[ft])}}else for(let Me=t.symbolInstanceStart;Me<t.symbolInstanceEnd;Me++)$e(p.symbolInstances.get(Me),p.collisionArrays[Me]);if(c&&p.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[p.bucketInstanceId];l.invert(Me.invProjMatrix,x),Me.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(t,s,c,p){let g;g=p===l.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(s)];const x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const S of x)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=g>=0&&S!==g?0:c.crossTileID)}markUsedOrientation(t,s,c){const p=s===l.WritingMode.horizontal||s===l.WritingMode.horizontalOnly?s:0,g=s===l.WritingMode.vertical?s:0,x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const S of x)t.text.placedSymbolArray.get(S).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let c=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},x=s?s.variableOffsets:{},S=s?s.placedOrientations:{};for(const E in this.placements){const k=this.placements[E],P=g[E];P?(this.opacities[E]=new Bt(P,p,k.text,k.icon),c=c||k.text!==P.text.placed||k.icon!==P.icon.placed):(this.opacities[E]=new Bt(null,p,k.text,k.icon,k.skipFade),c=c||k.text||k.icon)}for(const E in g){const k=g[E];if(!this.opacities[E]){const P=new Bt(k,p,!1,!1);P.isHidden()||(this.opacities[E]=P,c=c||k.text.placed||k.icon.placed)}}for(const E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(const E in S)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=S[E]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const c={};for(const p of s){const g=p.getBucket(t);g&&p.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,c,p.collisionBoxArray)}}updateBucketOpacities(t,s,c){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const p=t.layers[0].layout,g=new Bt(null,0,!1,!1,!0),x=p.get("text-allow-overlap"),S=p.get("icon-allow-overlap"),E=p.get("text-variable-anchor"),k=p.get("text-rotation-alignment")==="map",P=p.get("text-pitch-alignment")==="map",D=p.get("icon-text-fit")!=="none",R=new Bt(null,0,x&&(S||!t.hasIconData()||p.get("icon-optional")),S&&(x||!t.hasTextData()||p.get("text-optional")),!0);!t.collisionArrays&&c&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(c);const G=($,j,Q)=>{for(let ie=0;ie<j/4;ie++)$.opacityVertexArray.emplaceBack(Q)};for(let $=0;$<t.symbolInstances.length;$++){const j=t.symbolInstances.get($),{numHorizontalGlyphVertices:Q,numVerticalGlyphVertices:ie,crossTileID:ue}=j;let Z=this.opacities[ue];s[ue]?Z=g:Z||(Z=R,this.opacities[ue]=Z),s[ue]=!0;const de=j.numIconVertices>0,ce=this.placedOrientations[j.crossTileID],_e=ce===l.WritingMode.vertical,xe=ce===l.WritingMode.horizontal||ce===l.WritingMode.horizontalOnly;if(Q>0||ie>0){const Ee=ne(Z.text);G(t.text,Q,_e?ge:Ee),G(t.text,ie,xe?ge:Ee);const ye=Z.text.isHidden();[j.rightJustifiedTextSymbolIndex,j.centerJustifiedTextSymbolIndex,j.leftJustifiedTextSymbolIndex].forEach(je=>{je>=0&&(t.text.placedSymbolArray.get(je).hidden=ye||_e?1:0)}),j.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(j.verticalPlacedTextSymbolIndex).hidden=ye||xe?1:0);const $e=this.variableOffsets[j.crossTileID];$e&&this.markUsedJustification(t,$e.anchor,j,ce);const Me=this.placedOrientations[j.crossTileID];Me&&(this.markUsedJustification(t,"left",j,Me),this.markUsedOrientation(t,Me,j))}if(de){const Ee=ne(Z.icon),ye=!(D&&j.verticalPlacedIconSymbolIndex&&_e);j.placedIconSymbolIndex>=0&&(G(t.icon,j.numIconVertices,ye?Ee:ge),t.icon.placedSymbolArray.get(j.placedIconSymbolIndex).hidden=Z.icon.isHidden()),j.verticalPlacedIconSymbolIndex>=0&&(G(t.icon,j.numVerticalIconVertices,ye?ge:Ee),t.icon.placedSymbolArray.get(j.verticalPlacedIconSymbolIndex).hidden=Z.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ee=t.collisionArrays[$];if(Ee){let ye=new l.pointGeometry(0,0);if(Ee.textBox||Ee.verticalTextBox){let Me=!0;if(E){const je=this.variableOffsets[ue];je?(ye=Ro(je.anchor,je.width,je.height,je.textOffset,je.textBoxScale),k&&ye._rotate(P?this.transform.angle:-this.transform.angle)):Me=!1}Ee.textBox&&C(t.textCollisionBox.collisionVertexArray,Z.text.placed,!Me||_e,ye.x,ye.y),Ee.verticalTextBox&&C(t.textCollisionBox.collisionVertexArray,Z.text.placed,!Me||xe,ye.x,ye.y)}const $e=Boolean(!xe&&Ee.verticalIconBox);Ee.iconBox&&C(t.iconCollisionBox.collisionVertexArray,Z.icon.placed,$e,D?ye.x:0,D?ye.y:0),Ee.verticalIconBox&&C(t.iconCollisionBox.collisionVertexArray,Z.icon.placed,!$e,D?ye.x:0,D?ye.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=$.invProjMatrix,t.placementViewportMatrix=$.viewportMatrix,t.collisionCircleArray=$.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const c=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function C(h,t,s,c,p){h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0)}const A=Math.pow(2,25),O=Math.pow(2,24),N=Math.pow(2,17),K=Math.pow(2,16),te=Math.pow(2,9),J=Math.pow(2,8),Y=Math.pow(2,1);function ne(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,s=Math.floor(127*h.opacity);return s*A+t*O+s*N+t*K+s*te+t*J+s*Y+t}const ge=0;class Se{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,c,p,g){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(x,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((S,E)=>S.sortKey-E.sortKey));this._currentPartIndex<x.length;)if(s.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,g())return!0;return!1}}class me{constructor(t,s,c,p,g,x,S,E){this.placement=new V(t,s,x,S,E),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,s,c){const p=l.exported.now(),g=()=>{const x=l.exported.now()-p;return!this._forceFullPlacement&&x>2};for(;this._currentPlacementIndex>=0;){const x=s[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Se(x)),this._inProgressLayer.continuePlacement(c[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const We=512/l.EXTENT/2;class Ke{constructor(t,s,c){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(let p=0;p<s.length;p++){const g=s.get(p),x=g.key;this.indexedSymbolInstances[x]||(this.indexedSymbolInstances[x]=[]),this.indexedSymbolInstances[x].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,t)})}}getScaledCoordinates(t,s){const c=We/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*l.EXTENT+t.anchorX)*c),y:Math.floor((s.canonical.y*l.EXTENT+t.anchorY)*c)}}findMatches(t,s,c){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let g=0;g<t.length;g++){const x=t.get(g);if(x.crossTileID)continue;const S=this.indexedSymbolInstances[x.key];if(!S)continue;const E=this.getScaledCoordinates(x,s);for(const k of S)if(Math.abs(k.coord.x-E.x)<=p&&Math.abs(k.coord.y-E.y)<=p&&!c[k.crossTileID]){c[k.crossTileID]=!0,x.crossTileID=k.crossTileID;break}}}}class Ve{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const c in this.indexes){const p=this.indexes[c],g={};for(const x in p){const S=p[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+s),g[S.tileID.key]=S}this.indexes[c]=g}this.lng=t}addBucket(t,s,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const S in x){const E=x[S];E.tileID.isChildOf(t)&&E.findMatches(s.symbolInstances,t,p)}else{const S=x[t.scaledTo(Number(g)).key];S&&S.findMatches(s.symbolInstances,t,p)}}for(let g=0;g<s.symbolInstances.length;g++){const x=s.symbolInstances.get(g);x.crossTileID||(x.crossTileID=c.generate(),p[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ke(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const c in s.indexedSymbolInstances)for(const p of s.indexedSymbolInstances[c])delete this.usedCrossTileIDs[t][p.crossTileID]}removeStaleBuckets(t){let s=!1;for(const c in this.indexes){const p=this.indexes[c];for(const g in p)t[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[g]),delete p[g],s=!0)}return s}}class lt{constructor(){this.layerIndexes={},this.crossTileIDs=new Ve,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,c){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new rt);let g=!1;const x={};p.handleWrapJump(c);for(const S of s){const E=S.getBucket(t);E&&t.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(S.tileID,E,this.crossTileIDs)&&(g=!0),x[E.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(t){const s={};t.forEach(c=>{s[c]=!0});for(const c in this.layerIndexes)s[c]||delete this.layerIndexes[c]}}var kt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class ct extends l.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const s=this._tiles[t];s.textures.forEach(c=>c.destroy()),s.textures=[]}}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),l.ortho(c.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[c.key]=new Bn(c,this.tileSize))}removeOutdated(t){const s={};this.renderHistory=this.renderHistory.filter((c,p)=>this.renderHistory.indexOf(c)===p).slice(0,this.renderHistorySize);for(const c of this._renderableTilesKeys)s[c]=!0;for(const c of this.renderHistory)s[c]=!0;for(const c in this._tiles)s[c]||(this._tiles[c].clearTextures(t),delete this._tiles[c])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const c of this._renderableTilesKeys){const p=this._tiles[c].tileID;if(p.canonical.equals(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16),l.ortho(g.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),s[c]=g}else if(p.canonical.isChildOf(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=p.canonical.z-t.canonical.z,S=p.canonical.x-(p.canonical.x>>x<<x),E=p.canonical.y-(p.canonical.y>>x<<x),k=l.EXTENT>>x;l.ortho(g.posMatrix,0,k,0,k,0,1),l.translate(g.posMatrix,g.posMatrix,[-S*k,-E*k,0]),s[c]=g}else if(t.canonical.isChildOf(p.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=t.canonical.z-p.canonical.z,S=t.canonical.x-(t.canonical.x>>x<<x),E=t.canonical.y-(t.canonical.y>>x<<x),k=l.EXTENT>>x;l.ortho(g.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(g.posMatrix,g.posMatrix,[S*k,E*k,0]),l.scale(g.posMatrix,g.posMatrix,[1/2**x,1/2**x,0]),s[c]=g}}return s}getSourceTile(t,s){const c=this.sourceCache._source;let p=t.overscaledZ-this.deltaZoom;if(p>c.maxzoom&&(p=c.maxzoom),p<c.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!g||!g.dem)&&s)for(;p>=c.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(t.scaledTo(p--).key);return g}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeLoaded>=t)}}class yt{constructor(t,s,c){this.style=t,this.sourceCache=new ct(s),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.elevationOffset=typeof c.elevationOffset=="number"?c.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,s,c,p=l.EXTENT){if(!(s>=0&&s<p&&c>=0&&c<p))return this.elevationOffset;let g=0;const x=this.getTerrainData(t);if(x.tile&&x.tile.dem){const S=l.transformMat4$1([],[s/p*l.EXTENT,c/p*l.EXTENT],x.u_terrain_matrix),E=[S[0]*x.tile.dem.dim,S[1]*x.tile.dem.dim],k=[Math.floor(E[0]),Math.floor(E[1])],P=x.tile.dem.get(k[0],k[1]),D=x.tile.dem.get(k[0],k[1]+1),R=x.tile.dem.get(k[0]+1,k[1]),G=x.tile.dem.get(k[0]+1,k[1]+1);g=l.number(l.number(P,D,E[0]-k[0]),l.number(R,G,E[0]-k[0]),E[1]-k[1])}return g}rememberForRerender(t,s){for(const c in this.sourceCache._tiles){const p=this.sourceCache._tiles[c];(p.tileID.equals(s)||p.tileID.isChildOf(s))&&(t===this.sourceCache.sourceCache.id&&(p.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][p.tileID.key]=!0)}}needsRerender(t,s){return this._rerender[t]&&this._rerender[t][s.key]}clearRerenderCache(){this._rerender={}}getElevation(t,s,c,p=l.EXTENT){return(this.getDEMElevation(t,s,c,p)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.style.map.painter.context,g=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ce(p,g,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ce(p,new l.RGBAImage({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const p=this.style.map.painter.context;s.demTexture=this.style.map.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new Ce(p,s.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),s.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const c=s&&s+s.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const p=this.sourceCache.sourceCache._source.maxzoom;let g=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?g=t.canonical.z-p:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>g<<g),S=t.canonical.y-(t.canonical.y>>g<<g),E=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<g),1/(l.EXTENT<<g),0]);l.translate(E,E,[x*l.EXTENT,S*l.EXTENT,0]),this._demMatrixCache[t.key]={matrix:E,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const s=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(s,s,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,s,s))}return this._rttFramebuffer}getFramebuffer(t){const s=this.style.map.painter,c=s.width/devicePixelRatio,p=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ce(s.context,{width:c,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ce(s.context,{width:c,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(c,p,!0),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,c,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)s[x+0]=255&S,s[x+1]=255&g,s[x+2]=S>>8<<4|g>>8,s[x+3]=0;const c=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),p=new Ce(t,c,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){const s=new Uint8Array(4),c=this.style.map.painter,p=c.context,g=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(t.x,c.height/devicePixelRatio-t.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,s),p.bindFramebuffer.set(null);const x=s[0]+(s[2]>>4<<8),S=s[1]+((15&s[2])<<8),E=this.coordsIndex[255-s[3]],k=E&&this.sourceCache.getTileByID(E);if(!k)return null;const P=this._coordsTextureSize,D=(1<<k.tileID.canonical.z)*P;return new l.MercatorCoordinate((k.tileID.canonical.x*P+x)/D,(k.tileID.canonical.y*P+S)/D,this.getElevation(k.tileID,x,S,P))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,s=new l.PosArray,c=new l.TriangleIndexArray,p=this.meshSize,g=l.EXTENT/p,x=p*p;for(let S=0;S<=p;S++)for(let E=0;E<=p;E++)s.emplaceBack(E*g,S*g);for(let S=0;S<x;S+=p+1)for(let E=0;E<p;E++)c.emplaceBack(E+S,p+E+S+1,p+E+S+2),c.emplaceBack(E+S,p+E+S+2,E+S+1);return this._mesh={indexBuffer:t.createIndexBuffer(c),vertexBuffer:t.createVertexBuffer(s,kt.members),segments:l.SegmentVector.simpleSegment(0,0,s.length,c.length)},this._mesh}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return s&&s.dem&&(c.minElevation=(s.dem.min+this.elevationOffset)*this.exaggeration,c.maxElevation=(s.dem.max+this.elevationOffset)*this.exaggeration),c}}const Ct=(h,t)=>l.emitValidationErrors(h,t&&t.filter(s=>s.identifier!=="source.canvas")),Ut=l.pick(Et,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),En=l.pick(Et,["setCenter","setZoom","setBearing","setPitch"]),Ht=function(){const h={},t=l.spec.$version;for(const s in l.spec.$root){const c=l.spec.$root[s];if(c.required){let p=null;p=s==="version"?t:c.type==="array"?[]:{},p!=null&&(h[s]=p)}}return h}();class Fn extends l.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new mt(Po(),this),this.imageManager=new ae,this.imageManager.setEventedParent(this),this.glyphManager=new De(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Zt(256,512),this.crossTileSymbolIndex=new lt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const c=this;this._rtlTextPluginCallback=Fn.registerForPluginStateChange(p=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,x)=>{if(l.triggerPluginCompletionEvent(g),x&&x.every(S=>S))for(const S in c.sourceCaches)c.sourceCaches[S].reload()})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.sourceCaches[p.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const S in this._layers){const E=this._layers[S];E.source===x.id&&this._validateLayer(E)}})}loadURL(t,s={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const c=typeof s.validate!="boolean"||s.validate,p=this.map._requestManager.transformRequest(t,l.ResourceType.Style);this._request=l.getJSON(p,(g,x)=>{this._request=null,g?this.fire(new l.ErrorEvent(g)):x&&this._load(x,c)})}loadJSON(t,s={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(Ht,!1)}_load(t,s){if(s&&Ct(this,l.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const p in t.sources)this.addSource(p,t.sources[p],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const c=Ss(this.stylesheet.layers);this._order=c.map(p=>p.id),this._layers={},this._serializedLayers={};for(let p of c)p=l.createStyleLayer(p),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Qe(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(s,c,p,g){let x,S,E;const k=p>1?"@2x":"";let P=l.getJSON(c.transformRequest(c.normalizeSpriteURL(s,k,".json"),l.ResourceType.SpriteJSON),(G,$)=>{P=null,E||(E=G,x=$,R())}),D=l.getImage(c.transformRequest(c.normalizeSpriteURL(s,k,".png"),l.ResourceType.SpriteImage),(G,$)=>{D=null,E||(E=G,S=$,R())});function R(){if(E)g(E);else if(x&&S){const G=l.exported.getImageData(S),$={};for(const j in x){const{width:Q,height:ie,x:ue,y:Z,sdf:de,pixelRatio:ce,stretchX:_e,stretchY:xe,content:Ee}=x[j],ye=new l.RGBAImage({width:Q,height:ie});l.RGBAImage.copy(G,ye,{x:ue,y:Z},{x:0,y:0},{width:Q,height:ie}),$[j]={data:ye,pixelRatio:ce,sdf:de,stretchX:_e,stretchY:xe,content:Ee}}g(null,$)}}return{cancel(){P&&(P.cancel(),P=null),D&&(D.cancel(),D=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(s,c)=>{if(this._spriteRequest=null,s)this.fire(new l.ErrorEvent(s));else if(c)for(const p in c)this.imageManager.addImage(p,c[p]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const c=t.sourceLayer;if(!c)return;const p=s.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(c)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${c}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const c of t){const p=this._layers[c];p.type!=="custom"&&s.push(p.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(p.length||g.length)&&this._updateWorkerLayers(p,g);for(const x in this._updatedSources){const S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const c={};for(const p in this.sourceCaches){const g=this.sourceCaches[p];c[p]=g.used,g.used=!1}for(const p of this._order){const g=this._layers[p];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const p in c){const g=this.sourceCaches[p];c[p]!==g.used&&g.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const s=this.sourceCaches[t.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new yt(this,s,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=c=>{c.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=c=>{c.tile&&(c.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(c.sourceId,c.tile.tileID)):c.source.type==="geojson"&&this.terrain.rememberForRerender(c.sourceId,c.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),Ct(this,l.validateStyle(t)))return!1;(t=l.clone$1(t)).layers=Ss(t.layers);const s=function(p,g){if(!p)return[{command:Et.setStyle,args:[g]}];let x=[];try{if(!le(p.version,g.version))return[{command:Et.setStyle,args:[g]}];le(p.center,g.center)||x.push({command:Et.setCenter,args:[g.center]}),le(p.zoom,g.zoom)||x.push({command:Et.setZoom,args:[g.zoom]}),le(p.bearing,g.bearing)||x.push({command:Et.setBearing,args:[g.bearing]}),le(p.pitch,g.pitch)||x.push({command:Et.setPitch,args:[g.pitch]}),le(p.sprite,g.sprite)||x.push({command:Et.setSprite,args:[g.sprite]}),le(p.glyphs,g.glyphs)||x.push({command:Et.setGlyphs,args:[g.glyphs]}),le(p.transition,g.transition)||x.push({command:Et.setTransition,args:[g.transition]}),le(p.light,g.light)||x.push({command:Et.setLight,args:[g.light]});const S={},E=[];(function(P,D,R,G){let $;for($ in D=D||{},P=P||{})Object.prototype.hasOwnProperty.call(P,$)&&(Object.prototype.hasOwnProperty.call(D,$)||Br($,R,G));for($ in D)Object.prototype.hasOwnProperty.call(D,$)&&(Object.prototype.hasOwnProperty.call(P,$)?le(P[$],D[$])||(P[$].type==="geojson"&&D[$].type==="geojson"&&Es(P,D,$)?R.push({command:Et.setGeoJSONSourceData,args:[$,D[$].data]}):Fr($,D,R,G)):tr($,D,R))})(p.sources,g.sources,E,S);const k=[];p.layers&&p.layers.forEach(P=>{S[P.source]?x.push({command:Et.removeLayer,args:[P.id]}):k.push(P)}),x=x.concat(E),function(P,D,R){D=D||[];const G=(P=P||[]).map(yr),$=D.map(yr),j=P.reduce(Ao,{}),Q=D.reduce(Ao,{}),ie=G.slice(),ue=Object.create(null);let Z,de,ce,_e,xe,Ee,ye;for(Z=0,de=0;Z<G.length;Z++)ce=G[Z],Object.prototype.hasOwnProperty.call(Q,ce)?de++:(R.push({command:Et.removeLayer,args:[ce]}),ie.splice(ie.indexOf(ce,de),1));for(Z=0,de=0;Z<$.length;Z++)ce=$[$.length-1-Z],ie[ie.length-1-Z]!==ce&&(Object.prototype.hasOwnProperty.call(j,ce)?(R.push({command:Et.removeLayer,args:[ce]}),ie.splice(ie.lastIndexOf(ce,ie.length-de),1)):de++,Ee=ie[ie.length-Z],R.push({command:Et.addLayer,args:[Q[ce],Ee]}),ie.splice(ie.length-Z,0,ce),ue[ce]=!0);for(Z=0;Z<$.length;Z++)if(ce=$[Z],_e=j[ce],xe=Q[ce],!ue[ce]&&!le(_e,xe))if(le(_e.source,xe.source)&&le(_e["source-layer"],xe["source-layer"])&&le(_e.type,xe.type)){for(ye in gr(_e.layout,xe.layout,R,ce,null,Et.setLayoutProperty),gr(_e.paint,xe.paint,R,ce,null,Et.setPaintProperty),le(_e.filter,xe.filter)||R.push({command:Et.setFilter,args:[ce,xe.filter]}),le(_e.minzoom,xe.minzoom)&&le(_e.maxzoom,xe.maxzoom)||R.push({command:Et.setLayerZoomRange,args:[ce,xe.minzoom,xe.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?gr(_e[ye],xe[ye],R,ce,ye.slice(6),Et.setPaintProperty):le(_e[ye],xe[ye])||R.push({command:Et.setLayerProperty,args:[ce,ye,xe[ye]]}));for(ye in xe)Object.prototype.hasOwnProperty.call(xe,ye)&&!Object.prototype.hasOwnProperty.call(_e,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?gr(_e[ye],xe[ye],R,ce,ye.slice(6),Et.setPaintProperty):le(_e[ye],xe[ye])||R.push({command:Et.setLayerProperty,args:[ce,ye,xe[ye]]}))}else R.push({command:Et.removeLayer,args:[ce]}),Ee=ie[ie.lastIndexOf(ce)+1],R.push({command:Et.addLayer,args:[xe,Ee]})}(k,g.layers,x)}catch(S){console.warn("Unable to compute style diff:",S),x=[{command:Et.setStyle,args:[g]}]}return x}(this.serialize(),t).filter(p=>!(p.command in En));if(s.length===0)return!1;const c=s.filter(p=>!(p.command in Ut));if(c.length>0)throw new Error(`Unimplemented: ${c.map(p=>p.command).join(", ")}.`);return s.forEach(p=>{p.command!=="setTransition"&&this[p.command].apply(this,p.args)}),this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new l.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,c={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(l.validateStyle.source,`sources.${t}`,s,null,c))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=this.sourceCaches[t]=new ti(t,s,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:p.serialize(),sourceId:t})),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new l.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.sourceCaches[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,c={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new l.ErrorEvent(new Error(`Layer "${p}" already exists on this map.`)));let g;if(t.type==="custom"){if(Ct(this,l.validateCustomStyleLayer(t)))return;g=l.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=l.clone$1(t),t=l.extend(t,{source:p})),this._validate(l.validateStyle.layer,`layers.${p}`,t,{arrayIndex:-1},c))return;g=l.createStyleLayer(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[g.id]=g.serialize()}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${p}" before non-existing layer "${s}".`)));else{if(this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=g,this._removedLayers[p]&&g.source&&g.type!=="custom"){const S=this._removedLayers[p];delete this._removedLayers[p],S.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const c=this._order.indexOf(t);this._order.splice(c,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,c){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===s&&p.maxzoom===c||(s!=null&&(p.minzoom=s),c!=null&&(p.maxzoom=c),this._updateLayer(p)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,c={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!le(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(l.validateStyle.filter,`layers.${p.id}.filter`,s,null,c)||(p.filter=l.clone$1(s),this._updateLayer(p)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,s,c,p={}){this._checkLoaded();const g=this.getLayer(t);g?le(g.getLayoutProperty(s),c)||(g.setLayoutProperty(s,c,p),this._updateLayer(g)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const c=this.getLayer(t);if(c)return c.getLayoutProperty(s);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,c,p={}){this._checkLoaded();const g=this.getLayer(t);g?le(g.getPaintProperty(s),c)||(g.setPaintProperty(s,c,p)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const c=t.source,p=t.sourceLayer,g=this.sourceCaches[c];if(g===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const x=g.getSource().type;x==="geojson"&&p?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||p?(t.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),g.setFeatureState(p,t.id,s)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const c=t.source,p=this.sourceCaches[c];if(p===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const g=p.getSource().type,x=g==="vector"?t.sourceLayer:void 0;g!=="vector"||x?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(x,t.id,s):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,c=t.sourceLayer,p=this.sourceCaches[s];if(p!==void 0)return p.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),p.getFeatureState(c,t.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=x=>this._layers[x].type==="fill-extrusion",c={},p=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(s(S)){c[S]=x;for(const E of t){const k=E[S];if(k)for(const P of k)p.push(P)}}}p.sort((x,S)=>S.intersectionZ-x.intersectionZ);const g=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(s(S))for(let E=p.length-1;E>=0;E--){const k=p[E].feature;if(c[k.layer.id]<x)break;g.push(k),p.pop()}else for(const E of t){const k=E[S];if(k)for(const P of k)g.push(P.feature)}}return g}queryRenderedFeatures(t,s,c){s&&s.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const x of s.layers){const S=this._layers[x];if(!S)return this.fire(new l.ErrorEvent(new Error(`The layer '${x}' does not exist in the map's style and cannot be queried for features.`))),[];p[S.source]=!0}}const g=[];s.availableImages=this._availableImages;for(const x in this.sourceCaches)s.layers&&!p[x]||g.push(Qn(this.sourceCaches[x],this._layers,this._serializedLayers,t,s,c));return this.placement&&g.push(function(x,S,E,k,P,D,R){const G={},$=D.queryRenderedSymbols(k),j=[];for(const Q of Object.keys($).map(Number))j.push(R[Q]);j.sort(ei);for(const Q of j){const ie=Q.featureIndex.lookupSymbolFeatures($[Q.bucketInstanceId],S,Q.bucketIndex,Q.sourceLayerIndex,P.filter,P.layers,P.availableImages,x);for(const ue in ie){const Z=G[ue]=G[ue]||[],de=ie[ue];de.sort((ce,_e)=>{const xe=Q.featureSortOrder;if(xe){const Ee=xe.indexOf(ce.featureIndex);return xe.indexOf(_e.featureIndex)-Ee}return _e.featureIndex-ce.featureIndex});for(const ce of de)Z.push(ce)}}for(const Q in G)G[Q].forEach(ie=>{const ue=ie.feature,Z=E[x[Q].source].getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=Z});return G}(this._layers,this._serializedLayers,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,s){s&&s.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const c=this.sourceCaches[t];return c?function(p,g){const x=p.getRenderableIds().map(k=>p.getTileByID(k)),S=[],E={};for(let k=0;k<x.length;k++){const P=x[k],D=P.tileID.canonical.key;E[D]||(E[D]=!0,P.querySourceFeatures(S,g))}return S}(c,s):[]}addSourceType(t,s,c){return Fn.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(Fn.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},c):c(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const c=this.light.getLight();let p=!1;for(const x in t)if(!le(t[x],c[x])){p=!0;break}if(!p)return;const g={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(g)}_validate(t,s,c,p,g={}){return(!g||g.validate!==!1)&&Ct(this,t.call(l.validateStyle,l.extend({key:s,style:this.serialize(),value:c,styleSpec:l.spec},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const s=this.sourceCaches[t];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,c,p,g=!1){let x=!1,S=!1;const E={};for(const k of this._order){const P=this._layers[k];if(P.type!=="symbol")continue;if(!E[P.source]){const R=this.sourceCaches[P.source];E[P.source]=R.getRenderableIds(!0).map(G=>R.getTileByID(G)).sort((G,$)=>$.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan($.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(P,E[P.source],t.center.lng);x=x||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),t.zoom))&&(this.pauseablePlacement=new me(t,this.terrain,this._order,g,s,c,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(const k of this._order){const P=this._layers[k];P.type==="symbol"&&this.placement.updateLayerOpacities(P,E[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,c){this.imageManager.getImages(s.icons,c),this._updateTilesForChangedImages();const p=this.sourceCaches[s.source];p&&p.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,c){this.glyphManager.getGlyphs(s.stacks,c)}getResource(t,s,c){return l.makeRequest(s,c)}}Fn.getSourceType=function(h){return Xt[h]},Fn.setSourceType=function(h,t){Xt[h]=t},Fn.registerForPluginStateChange=l.registerForPluginStateChange;var Bo="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ts={prelude:Vt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Vt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Vt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Vt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Vt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Vt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Vt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Vt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Vt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Vt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Vt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Vt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Vt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Vt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Vt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Vt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Vt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Vt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Vt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Vt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Vt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Vt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Vt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Vt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Vt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Bo),terrainDepth:Vt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Bo),terrainCoords:Vt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Bo)};function Vt(h,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/attribute ([\w]+) ([\w]+)/g),p=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(p):p,S={};return{fragmentSource:h=h.replace(s,(E,k,P,D,R)=>(S[R]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${R}
varying ${P} ${D} ${R};
#else
uniform ${P} ${D} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${P} ${D} ${R} = u_${R};
#endif
`)),vertexSource:t=t.replace(s,(E,k,P,D,R)=>{const G=D==="float"?"vec2":"vec4",$=R.match(/color/)?"color":G;return S[R]?k==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${P} ${G} a_${R};
varying ${P} ${D} ${R};
#else
uniform ${P} ${D} u_${R};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${P} ${D} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${$}(a_${R}, u_${R}_t);
#else
    ${P} ${D} ${R} = u_${R};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${P} ${G} a_${R};
#else
uniform ${P} ${D} u_${R};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${P} ${D} ${R} = a_${R};
#else
    ${P} ${D} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${P} ${D} ${R} = unpack_mix_${$}(a_${R}, u_${R}_t);
#else
    ${P} ${D} ${R} = u_${R};
#endif
`}),staticAttributes:c,staticUniforms:x}}class wl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,c,p,g,x,S,E,k){this.context=t;let P=this.boundPaintVertexBuffers.length!==p.length;for(let D=0;!P&&D<p.length;D++)this.boundPaintVertexBuffers[D]!==p[D]&&(P=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===c&&!P&&this.boundIndexBuffer===g&&this.boundVertexOffset===x&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===E&&this.boundDynamicVertexBuffer3===k?(t.bindVertexArrayOES.set(this.vao),S&&S.bind(),g&&g.dynamicDraw&&g.bind(),E&&E.bind(),k&&k.bind()):this.freshBind(s,c,p,g,x,S,E,k)}freshBind(t,s,c,p,g,x,S,E){let k;const P=t.numAttributes,D=this.context,R=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=E;else{k=D.currentNumAttributes||0;for(let G=P;G<k;G++)R.disableVertexAttribArray(G)}s.enableAttributes(R,t);for(const G of c)G.enableAttributes(R,t);x&&x.enableAttributes(R,t),S&&S.enableAttributes(R,t),E&&E.enableAttributes(R,t),s.bind(),s.setVertexAttribPointers(R,t,g);for(const G of c)G.bind(),G.setVertexAttribPointers(R,t,g);x&&(x.bind(),x.setVertexAttribPointers(R,t,g)),p&&p.bind(),S&&(S.bind(),S.setVertexAttribPointers(R,t,g)),E&&(E.bind(),E.setVertexAttribPointers(R,t,g)),D.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function bl(h){const t=[];for(let s=0;s<h.length;s++){if(h[s]===null)continue;const c=h[s].split(" ");t.push(c.pop())}return t}class uc{constructor(t,s,c,p,g,x,S){const E=t.gl;this.program=E.createProgram();const k=bl(c.staticAttributes),P=p?p.getBinderAttributes():[],D=k.concat(P),R=Ts.prelude.staticUniforms?bl(Ts.prelude.staticUniforms):[],G=c.staticUniforms?bl(c.staticUniforms):[],$=p?p.getBinderUniforms():[],j=R.concat(G).concat($),Q=[];for(const xe of j)Q.indexOf(xe)<0&&Q.push(xe);const ie=p?p.defines():[];x&&ie.push("#define OVERDRAW_INSPECTOR;"),S&&ie.push("#define TERRAIN3D;");const ue=ie.concat(Ts.prelude.fragmentSource,c.fragmentSource).join(`
`),Z=ie.concat(Ts.prelude.vertexSource,c.vertexSource).join(`
`),de=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(de,ue),E.compileShader(de),E.attachShader(this.program,de);const ce=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(ce,Z),E.compileShader(ce),E.attachShader(this.program,ce),this.attributes={};const _e={};this.numAttributes=D.length;for(let xe=0;xe<this.numAttributes;xe++)D[xe]&&(E.bindAttribLocation(this.program,xe,D[xe]),this.attributes[D[xe]]=xe);E.linkProgram(this.program),E.deleteShader(ce),E.deleteShader(de);for(let xe=0;xe<Q.length;xe++){const Ee=Q[xe];if(Ee&&!_e[Ee]){const ye=E.getUniformLocation(this.program,Ee);ye&&(_e[Ee]=ye)}}this.fixedUniforms=g(t,_e),this.terrainUniforms=((xe,Ee)=>({u_depth:new l.Uniform1i(xe,Ee.u_depth),u_terrain:new l.Uniform1i(xe,Ee.u_terrain),u_terrain_dim:new l.Uniform1f(xe,Ee.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(xe,Ee.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(xe,Ee.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(xe,Ee.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(xe,Ee.u_terrain_exaggeration)}))(t,_e),this.binderUniforms=p?p.getUniforms(t,_e):[]}draw(t,s,c,p,g,x,S,E,k,P,D,R,G,$,j,Q,ie,ue){const Z=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(p),t.setColorMode(g),t.setCullFace(x),E){t.activeTexture.set(Z.TEXTURE2),Z.bindTexture(Z.TEXTURE_2D,E.depthTexture),t.activeTexture.set(Z.TEXTURE3),Z.bindTexture(Z.TEXTURE_2D,E.texture);for(const ce in this.terrainUniforms)this.terrainUniforms[ce].set(E[ce])}for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(S[ce]);j&&j.setUniforms(t,this.binderUniforms,G,{zoom:$});let de=0;switch(s){case Z.LINES:de=2;break;case Z.TRIANGLES:de=3;break;case Z.LINE_STRIP:de=1}for(const ce of R.get()){const _e=ce.vaos||(ce.vaos={});(_e[k]||(_e[k]=new wl)).bind(t,this,P,j?j.getPaintVertexBuffers():[],D,ce.vertexOffset,Q,ie,ue),Z.drawElements(s,ce.primitiveLength*de,Z.UNSIGNED_SHORT,ce.primitiveOffset*de*2)}}}function cc(h,t,s){const c=1/pn(s,1,t.transform.tileZoom),p=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,t.transform.tileZoom)/p,x=g*(s.tileID.canonical.x+s.tileID.wrap*p),S=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[c,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const Sl=(h,t,s,c)=>{const p=t.style.light,g=p.properties.get("position"),x=[g.x,g.y,g.z],S=l.create$1();p.properties.get("anchor")==="viewport"&&l.fromRotation(S,-t.transform.angle),l.transformMat3(x,x,S);const E=p.properties.get("color");return{u_matrix:h,u_lightpos:x,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+s,u_opacity:c}},Ld=(h,t,s,c,p,g,x)=>l.extend(Sl(h,t,s,c),cc(g,t,x),{u_height_factor:-Math.pow(2,p.overscaledZ)/x.tileSize/8}),ma=h=>({u_matrix:h}),El=(h,t,s,c)=>l.extend(ma(h),cc(s,t,c)),hc=(h,t)=>({u_matrix:h,u_world:t}),dc=(h,t,s,c,p)=>l.extend(El(h,t,s,c),{u_world:p}),pc=(h,t,s,c)=>{const p=h.transform;let g,x;if(c.paint.get("circle-pitch-alignment")==="map"){const S=pn(s,1,p.zoom);g=!0,x=[S,S]}else g=!1,x=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(t.posMatrix,s,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:x}},ro=(h,t,s)=>{const c=pn(s,1,t.zoom),p=Math.pow(2,t.zoom-s.tileID.overscaledZ),g=s.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:c,u_extrude_scale:[t.pixelsToGLUnits[0]/(c*p),t.pixelsToGLUnits[1]/(c*p)],u_overscale_factor:g}},ks=(h,t,s=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:s}),Fo=h=>({u_matrix:h}),ga=(h,t,s,c)=>({u_matrix:h,u_extrude_scale:pn(t,1,s),u_intensity:c});function ya(h,t){const s=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new l.MercatorCoordinate(0,c/s).toLngLat().lat,new l.MercatorCoordinate(0,(c+1)/s).toLngLat().lat]}const Oo=(h,t,s,c)=>{const p=h.transform;return{u_matrix:Is(h,t,s,c),u_ratio:1/pn(t,1,p.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Tl=(h,t,s,c,p)=>l.extend(Oo(h,t,s,p),{u_image:0,u_image_height:c}),_a=(h,t,s,c,p)=>{const g=h.transform,x=Kt(t,g);return{u_matrix:Is(h,t,s,p),u_texsize:t.imageAtlasTexture.size,u_ratio:1/pn(t,1,g.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[x,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Cs=(h,t,s,c,p,g)=>{const x=h.lineAtlas,S=Kt(t,h.transform),E=s.layout.get("line-cap")==="round",k=x.getDash(c.from,E),P=x.getDash(c.to,E),D=k.width*p.fromScale,R=P.width*p.toScale;return l.extend(Oo(h,t,s,g),{u_patternscale_a:[S/D,-k.height/2],u_patternscale_b:[S/R,-P.height/2],u_sdfgamma:x.width/(256*Math.min(D,R)*h.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:P.y,u_mix:p.t})};function Kt(h,t){return 1/pn(h,1,t.tileZoom)}function Is(h,t,s,c){return h.translatePosMatrix(c?c.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const fc=(h,t,s,c,p)=>{return{u_matrix:h,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(x=p.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=p.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:mc(p.paint.get("raster-hue-rotate"))};var g,x};function mc(h){h*=Math.PI/180;const t=Math.sin(h),s=Math.cos(h);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const kl=(h,t,s,c,p,g,x,S,E,k)=>{const P=p.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:P.cameraToCenterDistance,u_pitch:P.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:P.width/P.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:S,u_is_text:+E,u_pitch_with_map:+c,u_texsize:k,u_texture:0}},xa=(h,t,s,c,p,g,x,S,E,k,P)=>{const D=p.transform;return l.extend(kl(h,t,s,c,p,g,x,S,E,k),{u_gamma_scale:c?Math.cos(D._pitch)*D.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+P})},gc=(h,t,s,c,p,g,x,S,E,k)=>l.extend(xa(h,t,s,c,p,g,x,S,!0,E,!0),{u_texsize_icon:k,u_texture_icon:1}),Rd=(h,t,s)=>({u_matrix:h,u_opacity:t,u_color:s}),Bd=(h,t,s,c,p,g)=>l.extend(function(x,S,E,k){const P=E.imageManager.getPattern(x.from.toString()),D=E.imageManager.getPattern(x.to.toString()),{width:R,height:G}=E.imageManager.getPixelSize(),$=Math.pow(2,k.tileID.overscaledZ),j=k.tileSize*Math.pow(2,E.transform.tileZoom)/$,Q=j*(k.tileID.canonical.x+k.tileID.wrap*$),ie=j*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[R,G],u_mix:S.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/pn(k,1,E.transform.tileZoom),u_pixel_coord_upper:[Q>>16,ie>>16],u_pixel_coord_lower:[65535&Q,65535&ie]}}(c,g,s,p),{u_matrix:h,u_opacity:t}),Cl={fillExtrusion:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_lightpos:new l.Uniform3f(h,t.u_lightpos),u_lightintensity:new l.Uniform1f(h,t.u_lightintensity),u_lightcolor:new l.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new l.Uniform1f(h,t.u_vertical_gradient),u_opacity:new l.Uniform1f(h,t.u_opacity)}),fillExtrusionPattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_lightpos:new l.Uniform3f(h,t.u_lightpos),u_lightintensity:new l.Uniform1f(h,t.u_lightintensity),u_lightcolor:new l.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new l.Uniform1f(h,t.u_vertical_gradient),u_height_factor:new l.Uniform1f(h,t.u_height_factor),u_image:new l.Uniform1i(h,t.u_image),u_texsize:new l.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade),u_opacity:new l.Uniform1f(h,t.u_opacity)}),fill:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),fillPattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_image:new l.Uniform1i(h,t.u_image),u_texsize:new l.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade)}),fillOutline:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_world:new l.Uniform2f(h,t.u_world)}),fillOutlinePattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_world:new l.Uniform2f(h,t.u_world),u_image:new l.Uniform1i(h,t.u_image),u_texsize:new l.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade)}),circle:(h,t)=>({u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(h,t.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(h,t.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),collisionBox:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(h,t.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(h,t.u_extrude_scale),u_overscale_factor:new l.Uniform1f(h,t.u_overscale_factor)}),collisionCircle:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_inv_matrix:new l.UniformMatrix4f(h,t.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(h,t.u_viewport_size)}),debug:(h,t)=>({u_color:new l.UniformColor(h,t.u_color),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_overlay:new l.Uniform1i(h,t.u_overlay),u_overlay_scale:new l.Uniform1f(h,t.u_overlay_scale)}),clippingMask:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),heatmap:(h,t)=>({u_extrude_scale:new l.Uniform1f(h,t.u_extrude_scale),u_intensity:new l.Uniform1f(h,t.u_intensity),u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),heatmapTexture:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_world:new l.Uniform2f(h,t.u_world),u_image:new l.Uniform1i(h,t.u_image),u_color_ramp:new l.Uniform1i(h,t.u_color_ramp),u_opacity:new l.Uniform1f(h,t.u_opacity)}),hillshade:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_image:new l.Uniform1i(h,t.u_image),u_latrange:new l.Uniform2f(h,t.u_latrange),u_light:new l.Uniform2f(h,t.u_light),u_shadow:new l.UniformColor(h,t.u_shadow),u_highlight:new l.UniformColor(h,t.u_highlight),u_accent:new l.UniformColor(h,t.u_accent)}),hillshadePrepare:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_image:new l.Uniform1i(h,t.u_image),u_dimension:new l.Uniform2f(h,t.u_dimension),u_zoom:new l.Uniform1f(h,t.u_zoom),u_unpack:new l.Uniform4f(h,t.u_unpack)}),line:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_ratio:new l.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(h,t.u_units_to_pixels)}),lineGradient:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_ratio:new l.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(h,t.u_units_to_pixels),u_image:new l.Uniform1i(h,t.u_image),u_image_height:new l.Uniform1f(h,t.u_image_height)}),linePattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_texsize:new l.Uniform2f(h,t.u_texsize),u_ratio:new l.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_image:new l.Uniform1i(h,t.u_image),u_units_to_pixels:new l.Uniform2f(h,t.u_units_to_pixels),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade)}),lineSDF:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_ratio:new l.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(h,t.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(h,t.u_patternscale_a),u_patternscale_b:new l.Uniform2f(h,t.u_patternscale_b),u_sdfgamma:new l.Uniform1f(h,t.u_sdfgamma),u_image:new l.Uniform1i(h,t.u_image),u_tex_y_a:new l.Uniform1f(h,t.u_tex_y_a),u_tex_y_b:new l.Uniform1f(h,t.u_tex_y_b),u_mix:new l.Uniform1f(h,t.u_mix)}),raster:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_tl_parent:new l.Uniform2f(h,t.u_tl_parent),u_scale_parent:new l.Uniform1f(h,t.u_scale_parent),u_buffer_scale:new l.Uniform1f(h,t.u_buffer_scale),u_fade_t:new l.Uniform1f(h,t.u_fade_t),u_opacity:new l.Uniform1f(h,t.u_opacity),u_image0:new l.Uniform1i(h,t.u_image0),u_image1:new l.Uniform1i(h,t.u_image1),u_brightness_low:new l.Uniform1f(h,t.u_brightness_low),u_brightness_high:new l.Uniform1f(h,t.u_brightness_high),u_saturation_factor:new l.Uniform1f(h,t.u_saturation_factor),u_contrast_factor:new l.Uniform1f(h,t.u_contrast_factor),u_spin_weights:new l.Uniform3f(h,t.u_spin_weights)}),symbolIcon:(h,t)=>({u_is_size_zoom_constant:new l.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(h,t.u_size_t),u_size:new l.Uniform1f(h,t.u_size),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(h,t.u_pitch),u_rotate_symbol:new l.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(h,t.u_fade_change),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new l.Uniform1i(h,t.u_is_text),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_texsize:new l.Uniform2f(h,t.u_texsize),u_texture:new l.Uniform1i(h,t.u_texture)}),symbolSDF:(h,t)=>({u_is_size_zoom_constant:new l.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(h,t.u_size_t),u_size:new l.Uniform1f(h,t.u_size),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(h,t.u_pitch),u_rotate_symbol:new l.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(h,t.u_fade_change),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new l.Uniform1i(h,t.u_is_text),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_texsize:new l.Uniform2f(h,t.u_texsize),u_texture:new l.Uniform1i(h,t.u_texture),u_gamma_scale:new l.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(h,t.u_is_halo)}),symbolTextAndIcon:(h,t)=>({u_is_size_zoom_constant:new l.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(h,t.u_size_t),u_size:new l.Uniform1f(h,t.u_size),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(h,t.u_pitch),u_rotate_symbol:new l.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(h,t.u_fade_change),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new l.Uniform1i(h,t.u_is_text),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_texsize:new l.Uniform2f(h,t.u_texsize),u_texsize_icon:new l.Uniform2f(h,t.u_texsize_icon),u_texture:new l.Uniform1i(h,t.u_texture),u_texture_icon:new l.Uniform1i(h,t.u_texture_icon),u_gamma_scale:new l.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(h,t.u_is_halo)}),background:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_opacity:new l.Uniform1f(h,t.u_opacity),u_color:new l.UniformColor(h,t.u_color)}),backgroundPattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_opacity:new l.Uniform1f(h,t.u_opacity),u_image:new l.Uniform1i(h,t.u_image),u_pattern_tl_a:new l.Uniform2f(h,t.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(h,t.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(h,t.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(h,t.u_pattern_br_b),u_texsize:new l.Uniform2f(h,t.u_texsize),u_mix:new l.Uniform1f(h,t.u_mix),u_pattern_size_a:new l.Uniform2f(h,t.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(h,t.u_pattern_size_b),u_scale_a:new l.Uniform1f(h,t.u_scale_a),u_scale_b:new l.Uniform1f(h,t.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(h,t.u_tile_units_to_pixels)}),terrain:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_texture:new l.Uniform1i(h,t.u_texture)}),terrainDepth:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),terrainCoords:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_texture:new l.Uniform1i(h,t.u_texture),u_terrain_coords_id:new l.Uniform1f(h,t.u_terrain_coords_id)})};class Il{constructor(t,s,c){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Pl{constructor(t,s,c,p){this.length=s.length,this.attributes=c,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let c=0;c<this.attributes.length;c++){const p=s.attributes[this.attributes[c].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,s,c){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],x=s.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[zl[g.type]],!1,this.itemSize,g.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Pt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yc extends Pt{getDefault(){return l.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Fd extends Pt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class zs extends Pt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ps extends Pt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _c extends Pt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class gi extends Pt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ml extends Pt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class va extends Pt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class wa extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Al extends Pt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Dl extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class ba extends Pt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ll extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Rl extends Pt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Sa extends Pt{getDefault(){return l.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class xc extends Pt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class vc extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class No extends Pt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Od extends Pt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Nd extends Pt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ud extends Pt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Vd extends Pt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $d extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class jd extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Bl extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ea extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Fl extends Pt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ol extends Pt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Uo extends Pt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class wc extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class bc extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ta extends Pt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class oo extends Ta{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Sc extends Ta{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Vo{constructor(t,s,c,p){this.context=t,this.width=s,this.height=c;const g=t.gl,x=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new oo(t,x),p&&(this.depthAttachment=new Sc(t,x)),g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class qt{constructor(t,s,c){this.blendFunction=t,this.blendColor=s,this.mask=c}}qt.Replace=[1,0],qt.disabled=new qt(qt.Replace,l.Color.transparent,[!1,!1,!1,!1]),qt.unblended=new qt(qt.Replace,l.Color.transparent,[!0,!0,!0,!0]),qt.alphaBlended=new qt([1,771],l.Color.transparent,[!0,!0,!0,!0]);class Ec{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new yc(this),this.clearDepth=new Fd(this),this.clearStencil=new zs(this),this.colorMask=new Ps(this),this.depthMask=new _c(this),this.stencilMask=new gi(this),this.stencilFunc=new Ml(this),this.stencilOp=new va(this),this.stencilTest=new wa(this),this.depthRange=new Al(this),this.depthTest=new Dl(this),this.depthFunc=new ba(this),this.blend=new Ll(this),this.blendFunc=new Rl(this),this.blendColor=new Sa(this),this.blendEquation=new xc(this),this.cullFace=new vc(this),this.cullFaceSide=new No(this),this.frontFace=new Od(this),this.program=new Nd(this),this.activeTexture=new Ud(this),this.viewport=new Vd(this),this.bindFramebuffer=new $d(this),this.bindRenderbuffer=new jd(this),this.bindTexture=new Bl(this),this.bindVertexBuffer=new Ea(this),this.bindElementBuffer=new Fl(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ol(this),this.pixelStoreUnpack=new Uo(this),this.pixelStoreUnpackPremultiplyAlpha=new wc(this),this.pixelStoreUnpackFlipY=new bc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Il(this,t,s)}createVertexBuffer(t,s,c){return new Pl(this,t,s,c)}createRenderbuffer(t,s,c){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,t,s,c),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,c){return new Vo(this,t,s,c)}clear({color:t,depth:s}){const c=this.gl;let p=0;t&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),c.clear(p)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){le(t.blendFunction,qt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class bt{constructor(t,s,c){this.func=t,this.mask=s,this.range=c}}bt.ReadOnly=!1,bt.ReadWrite=!0,bt.disabled=new bt(519,bt.ReadOnly,[0,1]);const Mt=7680;class jt{constructor(t,s,c,p,g,x){this.test=t,this.ref=s,this.mask=c,this.fail=p,this.depthFail=g,this.pass=x}}jt.disabled=new jt({func:519,mask:0},0,0,Mt,Mt,Mt);class Yt{constructor(t,s,c){this.enable=t,this.mode=s,this.frontFace=c}}let Ms;function $o(h,t,s,c,p,g,x){const S=h.context,E=S.gl,k=h.useProgram("collisionBox"),P=[];let D=0,R=0;for(let Z=0;Z<c.length;Z++){const de=c[Z],ce=t.getTile(de),_e=ce.getBucket(s);if(!_e)continue;let xe=de.posMatrix;p[0]===0&&p[1]===0||(xe=h.translatePosMatrix(de.posMatrix,ce,p,g));const Ee=x?_e.textCollisionBox:_e.iconCollisionBox,ye=_e.collisionCircleArray;if(ye.length>0){const $e=l.create(),Me=xe;l.mul($e,_e.placementInvProjMatrix,h.transform.glCoordMatrix),l.mul($e,$e,_e.placementViewportMatrix),P.push({circleArray:ye,circleOffset:R,transform:Me,invTransform:$e,coord:de}),D+=ye.length/4,R=D}Ee&&k.draw(S,E.LINES,bt.disabled,jt.disabled,h.colorModeForRenderPass(),Yt.disabled,ro(xe,h.transform,ce),h.style.terrain&&h.style.terrain.getTerrainData(de),s.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,h.transform.zoom,null,null,Ee.collisionVertexBuffer)}if(!x||!P.length)return;const G=h.useProgram("collisionCircle"),$=new l.CollisionCircleLayoutArray;$.resize(4*D),$._trim();let j=0;for(const Z of P)for(let de=0;de<Z.circleArray.length/4;de++){const ce=4*de,_e=Z.circleArray[ce+0],xe=Z.circleArray[ce+1],Ee=Z.circleArray[ce+2],ye=Z.circleArray[ce+3];$.emplace(j++,_e,xe,Ee,ye,0),$.emplace(j++,_e,xe,Ee,ye,1),$.emplace(j++,_e,xe,Ee,ye,2),$.emplace(j++,_e,xe,Ee,ye,3)}(!Ms||Ms.length<2*D)&&(Ms=function(Z){const de=2*Z,ce=new l.QuadTriangleArray;ce.resize(de),ce._trim();for(let _e=0;_e<de;_e++){const xe=6*_e;ce.uint16[xe+0]=4*_e+0,ce.uint16[xe+1]=4*_e+1,ce.uint16[xe+2]=4*_e+2,ce.uint16[xe+3]=4*_e+2,ce.uint16[xe+4]=4*_e+3,ce.uint16[xe+5]=4*_e+0}return ce}(D));const Q=S.createIndexBuffer(Ms,!0),ie=S.createVertexBuffer($,l.collisionCircleLayout.members,!0);for(const Z of P){const de={u_matrix:Z.transform,u_inv_matrix:Z.invTransform,u_camera_to_center_distance:(ue=h.transform).cameraToCenterDistance,u_viewport_size:[ue.width,ue.height]};G.draw(S,E.TRIANGLES,bt.disabled,jt.disabled,h.colorModeForRenderPass(),Yt.disabled,de,h.style.terrain&&h.style.terrain.getTerrainData(Z.coord),s.id,ie,Q,l.SegmentVector.simpleSegment(0,2*Z.circleOffset,Z.circleArray.length,Z.circleArray.length/2),null,h.transform.zoom,null,null,null)}var ue;ie.destroy(),Q.destroy()}Yt.disabled=new Yt(!1,1029,2305),Yt.backCCW=new Yt(!0,1029,2305);const Gd=l.identity(new Float32Array(16));function Zd(h,t,s,c,p,g){const{horizontalAlign:x,verticalAlign:S}=l.getAnchorAlignment(h),E=-(x-.5)*t,k=-(S-.5)*s,P=l.evaluateVariableOffset(h,c);return new l.pointGeometry((E/p+P[0])*g,(k/p+P[1])*g)}function Tc(h,t,s,c,p,g,x,S,E,k,P){const D=h.text.placedSymbolArray,R=h.text.dynamicLayoutVertexArray,G=h.icon.dynamicLayoutVertexArray,$={};R.clear();for(let j=0;j<D.length;j++){const Q=D.get(j),ie=h.allowVerticalPlacement&&!Q.placedOrientation,ue=Q.hidden||!Q.crossTileID||ie?null:c[Q.crossTileID];if(ue){const Z=new l.pointGeometry(Q.anchorX,Q.anchorY),de=Tt(Z,s?x:g,P),ce=zi(p.cameraToCenterDistance,de.signedDistanceFromCamera);let _e=l.evaluateSizeForFeature(h.textSizeData,E,Q)*ce/l.ONE_EM;s&&(_e*=h.tilePixelRatio/S);const{width:xe,height:Ee,anchor:ye,textOffset:$e,textBoxScale:Me}=ue,je=Zd(ye,xe,Ee,$e,Me,_e),ft=s?Tt(Z.add(je),g,P).point:de.point.add(t?je.rotate(-p.angle):je),_t=h.allowVerticalPlacement&&Q.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let nt=0;nt<Q.numGlyphs;nt++)l.addDynamicAttributes(R,ft,_t);k&&Q.associatedIconIndex>=0&&($[Q.associatedIconIndex]={shiftedAnchor:ft,angle:_t})}else ht(Q.numGlyphs,R)}if(k){G.clear();const j=h.icon.placedSymbolArray;for(let Q=0;Q<j.length;Q++){const ie=j.get(Q);if(ie.hidden)ht(ie.numGlyphs,G);else{const ue=$[Q];if(ue)for(let Z=0;Z<ie.numGlyphs;Z++)l.addDynamicAttributes(G,ue.shiftedAnchor,ue.angle);else ht(ie.numGlyphs,G)}}h.icon.dynamicLayoutVertexBuffer.updateData(G)}h.text.dynamicLayoutVertexBuffer.updateData(R)}function qd(h,t,s){return s.iconsInText&&t?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function ka(h,t,s,c,p,g,x,S,E,k,P,D){const R=h.context,G=R.gl,$=h.transform,j=S==="map",Q=E==="map",ie=S!=="viewport"&&s.layout.get("symbol-placement")!=="point",ue=j&&!Q&&!ie,Z=!s.layout.get("symbol-sort-key").isConstant();let de=!1;const ce=h.depthModeForSublayer(0,bt.ReadOnly),_e=s.layout.get("text-variable-anchor"),xe=[];for(const Ee of c){const ye=t.getTile(Ee),$e=ye.getBucket(s);if(!$e)continue;const Me=p?$e.text:$e.icon;if(!Me||!Me.segments.get().length)continue;const je=Me.programConfigurations.get(s.id),ft=p||$e.sdfIcons,_t=p?$e.textSizeData:$e.iconSizeData,nt=Q||$.pitch!==0,Dt=h.useProgram(qd(ft,p,$e),je),Lt=l.evaluateSizeForZoom(_t,$.zoom),St=h.style.terrain&&h.style.terrain.getTerrainData(Ee);let It,Ft,Tn,or,ji=[0,0],sr=null;if(p){if(Ft=ye.glyphAtlasTexture,Tn=G.LINEAR,It=ye.glyphAtlasTexture.size,$e.iconsInText){ji=ye.imageAtlasTexture.size,sr=ye.imageAtlasTexture;const Ai=_t.kind==="composite"||_t.kind==="camera";or=nt||h.options.rotating||h.options.zooming||Ai?G.LINEAR:G.NEAREST}}else{const Ai=s.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear;Ft=ye.imageAtlasTexture,Tn=ft||h.options.rotating||h.options.zooming||Ai||nt?G.LINEAR:G.NEAREST,It=ye.imageAtlasTexture.size}const qr=pn(ye,1,h.transform.zoom),Mi=eo(Ee.posMatrix,Q,j,h.transform,qr),ii=Vi(Ee.posMatrix,Q,j,h.transform,qr),br=_e&&$e.hasTextData(),La=s.layout.get("icon-text-fit")!=="none"&&br&&$e.hasIconData();if(ie){const Ai=h.style.terrain?(Ql,Xo)=>h.style.terrain.getElevation(Ee,Ql,Xo):null,uo=s.layout.get("text-rotation-alignment")==="map";mi($e,Ee.posMatrix,h,p,Mi,ii,Q,k,uo,Ai)}const xn=h.translatePosMatrix(Ee.posMatrix,ye,g,x),vt=ie||p&&_e||La?Gd:Mi,At=h.translatePosMatrix(ii,ye,g,x,!0),kn=ft&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Cn;Cn=ft?$e.iconsInText?gc(_t.kind,Lt,ue,Q,h,xn,vt,At,It,ji):xa(_t.kind,Lt,ue,Q,h,xn,vt,At,p,It,!0):kl(_t.kind,Lt,ue,Q,h,xn,vt,At,p,It);const Qt={program:Dt,buffers:Me,uniformValues:Cn,atlasTexture:Ft,atlasTextureIcon:sr,atlasInterpolation:Tn,atlasInterpolationIcon:or,isSDF:ft,hasHalo:kn};if(Z&&$e.canOverlap){de=!0;const Ai=Me.segments.get();for(const uo of Ai)xe.push({segments:new l.SegmentVector([uo]),sortKey:uo.sortKey,state:Qt,terrainData:St})}else xe.push({segments:Me.segments,sortKey:0,state:Qt,terrainData:St})}de&&xe.sort((Ee,ye)=>Ee.sortKey-ye.sortKey);for(const Ee of xe){const ye=Ee.state;if(R.activeTexture.set(G.TEXTURE0),ye.atlasTexture.bind(ye.atlasInterpolation,G.CLAMP_TO_EDGE),ye.atlasTextureIcon&&(R.activeTexture.set(G.TEXTURE1),ye.atlasTextureIcon&&ye.atlasTextureIcon.bind(ye.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),ye.isSDF){const $e=ye.uniformValues;ye.hasHalo&&($e.u_is_halo=1,As(ye.buffers,Ee.segments,s,h,ye.program,ce,P,D,$e,Ee.terrainData)),$e.u_is_halo=0}As(ye.buffers,Ee.segments,s,h,ye.program,ce,P,D,ye.uniformValues,Ee.terrainData)}}function As(h,t,s,c,p,g,x,S,E,k){const P=c.context;p.draw(P,P.gl.TRIANGLES,g,x,S,Yt.disabled,E,k,s.id,h.layoutVertexBuffer,h.indexBuffer,t,s.paint,c.transform.zoom,h.programConfigurations.get(s.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Ds(h,t,s,c,p,g,x){const S=h.context.gl,E=s.paint.get("fill-pattern"),k=E&&E.constantOr(1),P=s.getCrossfadeParameters();let D,R,G,$,j;x?(R=k&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=S.LINES):(R=k?"fillPattern":"fill",D=S.TRIANGLES);for(const Q of c){const ie=t.getTile(Q);if(k&&!ie.patternsLoaded())continue;const ue=ie.getBucket(s);if(!ue)continue;const Z=ue.programConfigurations.get(s.id),de=h.useProgram(R,Z),ce=h.style.terrain&&h.style.terrain.getTerrainData(Q);k&&(h.context.activeTexture.set(S.TEXTURE0),ie.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Z.updatePaintBuffers(P));const _e=E.constantOr(null);if(_e&&ie.imageAtlas){const ye=ie.imageAtlas,$e=ye.patternPositions[_e.to.toString()],Me=ye.patternPositions[_e.from.toString()];$e&&Me&&Z.setConstantPatternPositions($e,Me)}const xe=ce?Q:null,Ee=h.translatePosMatrix(xe?xe.posMatrix:Q.posMatrix,ie,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(x){$=ue.indexBuffer2,j=ue.segments2;const ye=[S.drawingBufferWidth,S.drawingBufferHeight];G=R==="fillOutlinePattern"&&k?dc(Ee,h,P,ie,ye):hc(Ee,ye)}else $=ue.indexBuffer,j=ue.segments,G=k?El(Ee,h,P,ie):ma(Ee);de.draw(h.context,D,p,h.stencilModeForClipping(Q),g,Yt.disabled,G,ce,s.id,ue.layoutVertexBuffer,$,j,s.paint,h.transform.zoom,Z)}}function Ls(h,t,s,c,p,g,x){const S=h.context,E=S.gl,k=s.paint.get("fill-extrusion-pattern"),P=k.constantOr(1),D=s.getCrossfadeParameters(),R=s.paint.get("fill-extrusion-opacity");for(const G of c){const $=t.getTile(G),j=$.getBucket(s);if(!j)continue;const Q=h.style.terrain&&h.style.terrain.getTerrainData(G),ie=j.programConfigurations.get(s.id),ue=h.useProgram(P?"fillExtrusionPattern":"fillExtrusion",ie);P&&(h.context.activeTexture.set(E.TEXTURE0),$.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ie.updatePaintBuffers(D));const Z=k.constantOr(null);if(Z&&$.imageAtlas){const xe=$.imageAtlas,Ee=xe.patternPositions[Z.to.toString()],ye=xe.patternPositions[Z.from.toString()];Ee&&ye&&ie.setConstantPatternPositions(Ee,ye)}const de=h.translatePosMatrix(G.posMatrix,$,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ce=s.paint.get("fill-extrusion-vertical-gradient"),_e=P?Ld(de,h,ce,R,G,D,$):Sl(de,h,ce,R);ue.draw(S,S.gl.TRIANGLES,p,g,x,Yt.backCCW,_e,Q,s.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,s.paint,h.transform.zoom,ie,h.style.terrain&&j.centroidVertexBuffer)}}function Nl(h,t,s,c,p,g,x){const S=h.context,E=S.gl,k=s.fbo;if(!k)return;const P=h.useProgram("hillshade"),D=h.style.terrain&&h.style.terrain.getTerrainData(t);S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,k.colorAttachment.get()),P.draw(S,E.TRIANGLES,p,g,x,Yt.disabled,((R,G,$,j)=>{const Q=$.paint.get("hillshade-shadow-color"),ie=$.paint.get("hillshade-highlight-color"),ue=$.paint.get("hillshade-accent-color");let Z=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(Z-=R.transform.angle);const de=!R.options.moving;return{u_matrix:j?j.posMatrix:R.transform.calculatePosMatrix(G.tileID.toUnwrapped(),de),u_image:0,u_latrange:ya(0,G.tileID),u_light:[$.paint.get("hillshade-exaggeration"),Z],u_shadow:Q,u_highlight:ie,u_accent:ue}})(h,s,c,D?t:null),D,c.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function kc(h,t,s,c,p,g){const x=h.context,S=x.gl,E=t.dem;if(E&&E.data){const k=E.dim,P=E.stride,D=E.getPixels();if(x.activeTexture.set(S.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(P),t.demTexture){const G=t.demTexture;G.update(D,{premultiply:!1}),G.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else t.demTexture=new Ce(x,D,S.RGBA,{premultiply:!1}),t.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);x.activeTexture.set(S.TEXTURE0);let R=t.fbo;if(!R){const G=new Ce(x,{width:k,height:k,data:null},S.RGBA);G.bind(S.LINEAR,S.CLAMP_TO_EDGE),R=t.fbo=x.createFramebuffer(k,k,!0),R.colorAttachment.set(G.texture)}x.bindFramebuffer.set(R.framebuffer),x.viewport.set([0,0,k,k]),h.useProgram("hillshadePrepare").draw(x,S.TRIANGLES,c,p,g,Yt.disabled,((G,$)=>{const j=$.stride,Q=l.create();return l.ortho(Q,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(Q,Q,[0,-l.EXTENT,0]),{u_matrix:Q,u_image:1,u_dimension:[j,j],u_zoom:G.overscaledZ,u_unpack:$.getUnpackVector()}})(t.tileID,E),null,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Ca(h,t,s,c,p,g){const x=c.paint.get("raster-fade-duration");if(!g&&x>0){const S=l.exported.now(),E=(S-h.timeAdded)/x,k=t?(S-t.timeAdded)/x:-1,P=s.getSource(),D=p.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),R=!t||Math.abs(t.tileID.overscaledZ-D)>Math.abs(h.tileID.overscaledZ-D),G=R&&h.refreshedUponExpiration?1:l.clamp(R?E:1-k,0,1);return h.refreshedUponExpiration&&E>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const Ia=new l.Color(1,0,0,1),$i=new l.Color(0,1,0,1),Cc=new l.Color(0,0,1,1),Ul=new l.Color(1,0,1,1),Ic=new l.Color(0,1,1,1);function so(h,t,s,c){jo(h,0,t+s/2,h.transform.width,s,c)}function Rs(h,t,s,c){jo(h,t-s/2,0,s,h.transform.height,c)}function jo(h,t,s,c,p,g){const x=h.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*h.pixelRatio,s*h.pixelRatio,c*h.pixelRatio,p*h.pixelRatio),x.clear({color:g}),S.disable(S.SCISSOR_TEST)}function Wd(h,t,s){const c=h.context,p=c.gl,g=s.posMatrix,x=h.useProgram("debug"),S=bt.disabled,E=jt.disabled,k=h.colorModeForRenderPass(),P="$debug",D=h.style.terrain&&h.style.terrain.getTerrainData(s);c.activeTexture.set(p.TEXTURE0),h.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE);const R=t.getTileByID(s.key).latestRawTileData,G=Math.floor((R&&R.byteLength||0)/1024),$=t.getTile(s).tileSize,j=512/Math.min($,512)*(s.overscaledZ/h.transform.zoom)*.5;let Q=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Q+=` => ${s.overscaledZ}`),function(ie,ue){ie.initDebugOverlayCanvas();const Z=ie.debugOverlayCanvas,de=ie.context.gl,ce=ie.debugOverlayCanvas.getContext("2d");ce.clearRect(0,0,Z.width,Z.height),ce.shadowColor="white",ce.shadowBlur=2,ce.lineWidth=1.5,ce.strokeStyle="white",ce.textBaseline="top",ce.font="bold 36px Open Sans, sans-serif",ce.fillText(ue,5,5),ce.strokeText(ue,5,5),ie.debugOverlayTexture.update(Z),ie.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(h,`${Q} ${G}kB`),x.draw(c,p.TRIANGLES,S,E,qt.alphaBlended,Yt.disabled,ks(g,l.Color.transparent,j),null,P,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),x.draw(c,p.LINE_STRIP,S,E,k,Yt.disabled,ks(g,l.Color.red),D,P,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function za(h,t,s){const c=h.context,p=c.gl,g=h.colorModeForRenderPass(),x=new bt(p.LEQUAL,bt.ReadWrite,h.depthRangeFor3D),S=h.useProgram("terrain"),E=t.getTerrainMesh(),k=t.getTerrainData(s.tileID);c.bindFramebuffer.set(null),c.viewport.set([0,0,h.width,h.height]),c.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const P=h.transform.calculatePosMatrix(s.tileID.toUnwrapped());S.draw(c,p.TRIANGLES,x,jt.disabled,g,Yt.backCCW,{u_matrix:P,u_texture:0},k,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}function zc(h,t,s,c){const p=h.context,g=s.tileSize*t.qualityFactor;s.textures[c]||(s.textures[c]=h.getTileTexture(g)||new Ce(p,{width:g,height:g,data:null},p.gl.RGBA),s.textures[c].bind(p.gl.LINEAR,p.gl.CLAMP_TO_EDGE),c===0&&t.sourceCache.renderHistory.unshift(s.tileID.key));const x=t.getRTTFramebuffer();x.colorAttachment.set(s.textures[c].texture),p.bindFramebuffer.set(x.framebuffer),p.viewport.set([0,0,g,g])}class Pc{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,s=t.terrain;for(const c in t.sourceCaches){this._coordsDescendingInv[c]={};const p=t.sourceCaches[c].getVisibleCoordinates();for(const g of p){const x=s.sourceCache.getTerrainCoords(g);for(const S in x)this._coordsDescendingInv[c][S]||(this._coordsDescendingInv[c][S]=[]),this._coordsDescendingInv[c][S].push(x[S])}}for(const c of t._order){const p=t._layers[c],g=p.source;if(this._renderToTexture[p.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const x in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][x]=this._coordsDescendingInv[g][x].map(S=>S.key).sort().join()}}return this._renderableTiles.forEach(c=>{for(const p in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[p][c.tileID.key];g&&g!==c.textureCoords[p]&&c.clearTextures(this.painter),s.needsRerender(p,c.tileID)&&c.clearTextures(this.painter)}this._rerender[c.tileID.key]=!c.textures.length}),s.clearRerenderCache(),s.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const s=t.type,c=this.painter,p=c.style._order,g=c.currentLayer,x=g+1===p.length;if(this._renderToTexture[s]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(p[g]),!x))return!0;if(this._renderToTexture[this._prevType]||s==="hillshade"||this._renderToTexture[s]&&x){this._prevType=s;const S=this._stacks.length-1,E=this._stacks[S]||[];for(const k of this._renderableTiles){if(zc(c,c.style.terrain,k,S),this._rerender[k.tileID.key]){c.context.clear({color:l.Color.transparent});for(let P=0;P<E.length;P++){const D=c.style._layers[E[P]],R=D.source?this._coordsDescendingInv[D.source][k.tileID.key]:[k.tileID];c._renderTileClippingMasks(D,R),c.renderLayer(c,c.style.sourceCaches[D.source],D,R),D.source&&(k.textureCoords[D.source]=this._coordsDescendingInvStr[D.source][k.tileID.key])}}za(c,c.style.terrain,k)}if(s==="hillshade"){this._stacks.push([p[g]]);for(const k of this._renderableTiles){const P=this._coordsDescendingInv[t.source][k.tileID.key];zc(c,c.style.terrain,k,this._stacks.length-1),c.context.clear({color:l.Color.transparent}),c._renderTileClippingMasks(t,P),c.renderLayer(c,c.style.sourceCaches[t.source],t,P),za(c,c.style.terrain,k)}return!0}return this._renderToTexture[s]}return!1}}const Bs={symbol:function(h,t,s,c,p){if(h.renderPass!=="translucent")return;const g=jt.disabled,x=h.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(S,E,k,P,D,R,G){const $=E.transform,j=D==="map",Q=R==="map";for(const ie of S){const ue=P.getTile(ie),Z=ue.getBucket(k);if(!Z||!Z.text||!Z.text.segments.get().length)continue;const de=l.evaluateSizeForZoom(Z.textSizeData,$.zoom),ce=pn(ue,1,E.transform.zoom),_e=eo(ie.posMatrix,Q,j,E.transform,ce),xe=k.layout.get("icon-text-fit")!=="none"&&Z.hasIconData();if(de){const Ee=Math.pow(2,$.zoom-ue.tileID.overscaledZ);Tc(Z,j,Q,G,$,_e,ie.posMatrix,Ee,de,xe,E.style.terrain?(ye,$e)=>E.style.terrain.getElevation(ie,ye,$e):null)}}}(c,h,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),p),s.paint.get("icon-opacity").constantOr(1)!==0&&ka(h,t,s,c,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),g,x),s.paint.get("text-opacity").constantOr(1)!==0&&ka(h,t,s,c,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),g,x),t.map.showCollisionBoxes&&($o(h,t,s,c,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),$o(h,t,s,c,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,s,c){if(h.renderPass!=="translucent")return;const p=s.paint.get("circle-opacity"),g=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),S=!s.layout.get("circle-sort-key").isConstant();if(p.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const E=h.context,k=E.gl,P=h.depthModeForSublayer(0,bt.ReadOnly),D=jt.disabled,R=h.colorModeForRenderPass(),G=[];for(let $=0;$<c.length;$++){const j=c[$],Q=t.getTile(j),ie=Q.getBucket(s);if(!ie)continue;const ue=ie.programConfigurations.get(s.id),Z=h.useProgram("circle",ue),de=ie.layoutVertexBuffer,ce=ie.indexBuffer,_e=h.style.terrain&&h.style.terrain.getTerrainData(j),xe={programConfiguration:ue,program:Z,layoutVertexBuffer:de,indexBuffer:ce,uniformValues:pc(h,j,Q,s),terrainData:_e};if(S){const Ee=ie.segments.get();for(const ye of Ee)G.push({segments:new l.SegmentVector([ye]),sortKey:ye.sortKey,state:xe})}else G.push({segments:ie.segments,sortKey:0,state:xe})}S&&G.sort(($,j)=>$.sortKey-j.sortKey);for(const $ of G){const{programConfiguration:j,program:Q,layoutVertexBuffer:ie,indexBuffer:ue,uniformValues:Z,terrainData:de}=$.state;Q.draw(E,k.TRIANGLES,P,D,R,Yt.disabled,Z,de,s.id,ie,ue,$.segments,s.paint,h.transform.zoom,j)}},heatmap:function(h,t,s,c){if(s.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const p=h.context,g=p.gl,x=jt.disabled,S=new qt([g.ONE,g.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(E,k,P){const D=E.gl;E.activeTexture.set(D.TEXTURE1),E.viewport.set([0,0,k.width/4,k.height/4]);let R=P.heatmapFbo;if(R)D.bindTexture(D.TEXTURE_2D,R.colorAttachment.get()),E.bindFramebuffer.set(R.framebuffer);else{const G=D.createTexture();D.bindTexture(D.TEXTURE_2D,G),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),R=P.heatmapFbo=E.createFramebuffer(k.width/4,k.height/4,!1),function($,j,Q,ie){const ue=$.gl;ue.texImage2D(ue.TEXTURE_2D,0,ue.RGBA,j.width/4,j.height/4,0,ue.RGBA,$.extRenderToTextureHalfFloat?$.extTextureHalfFloat.HALF_FLOAT_OES:ue.UNSIGNED_BYTE,null),ie.colorAttachment.set(Q)}(E,k,G,R)}})(p,h,s),p.clear({color:l.Color.transparent});for(let E=0;E<c.length;E++){const k=c[E];if(t.hasRenderableParent(k))continue;const P=t.getTile(k),D=P.getBucket(s);if(!D)continue;const R=D.programConfigurations.get(s.id),G=h.useProgram("heatmap",R),{zoom:$}=h.transform;G.draw(p,g.TRIANGLES,bt.disabled,x,S,Yt.disabled,ga(k.posMatrix,P,$,s.paint.get("heatmap-intensity")),null,s.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,s.paint,h.transform.zoom,R)}p.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(p,g){const x=p.context,S=x.gl,E=g.heatmapFbo;if(!E)return;x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,E.colorAttachment.get()),x.activeTexture.set(S.TEXTURE1);let k=g.colorRampTexture;k||(k=g.colorRampTexture=new Ce(x,g.colorRamp,S.RGBA)),k.bind(S.LINEAR,S.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(x,S.TRIANGLES,bt.disabled,jt.disabled,p.colorModeForRenderPass(),Yt.disabled,((P,D,R,G)=>{const $=l.create();l.ortho($,0,P.width,P.height,0,0,1);const j=P.context.gl;return{u_matrix:$,u_world:[j.drawingBufferWidth,j.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:D.paint.get("heatmap-opacity")}})(p,g),null,g.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,g.paint,p.transform.zoom)}(h,s))},line:function(h,t,s,c){if(h.renderPass!=="translucent")return;const p=s.paint.get("line-opacity"),g=s.paint.get("line-width");if(p.constantOr(1)===0||g.constantOr(1)===0)return;const x=h.depthModeForSublayer(0,bt.ReadOnly),S=h.colorModeForRenderPass(),E=s.paint.get("line-dasharray"),k=s.paint.get("line-pattern"),P=k.constantOr(1),D=s.paint.get("line-gradient"),R=s.getCrossfadeParameters(),G=P?"linePattern":E?"lineSDF":D?"lineGradient":"line",$=h.context,j=$.gl;let Q=!0;for(const ie of c){const ue=t.getTile(ie);if(P&&!ue.patternsLoaded())continue;const Z=ue.getBucket(s);if(!Z)continue;const de=Z.programConfigurations.get(s.id),ce=h.context.program.get(),_e=h.useProgram(G,de),xe=Q||_e.program!==ce,Ee=h.style.terrain&&h.style.terrain.getTerrainData(ie),ye=k.constantOr(null);if(ye&&ue.imageAtlas){const je=ue.imageAtlas,ft=je.patternPositions[ye.to.toString()],_t=je.patternPositions[ye.from.toString()];ft&&_t&&de.setConstantPatternPositions(ft,_t)}const $e=Ee?ie:null,Me=P?_a(h,ue,s,R,$e):E?Cs(h,ue,s,E,R,$e):D?Tl(h,ue,s,Z.lineClipsArray.length,$e):Oo(h,ue,s,$e);if(P)$.activeTexture.set(j.TEXTURE0),ue.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),de.updatePaintBuffers(R);else if(E&&(xe||h.lineAtlas.dirty))$.activeTexture.set(j.TEXTURE0),h.lineAtlas.bind($);else if(D){const je=Z.gradients[s.id];let ft=je.texture;if(s.gradientVersion!==je.version){let _t=256;if(s.stepInterpolant){const nt=t.getSource().maxzoom,Dt=ie.canonical.z===nt?Math.ceil(1<<h.transform.maxZoom-ie.canonical.z):1;_t=l.clamp(l.nextPowerOfTwo(Z.maxLineLength/l.EXTENT*1024*Dt),256,$.maxTextureSize)}je.gradient=l.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:_t,image:je.gradient||void 0,clips:Z.lineClipsArray}),je.texture?je.texture.update(je.gradient):je.texture=new Ce($,je.gradient,j.RGBA),je.version=s.gradientVersion,ft=je.texture}$.activeTexture.set(j.TEXTURE0),ft.bind(s.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}_e.draw($,j.TRIANGLES,x,h.stencilModeForClipping(ie),S,Yt.disabled,Me,Ee,s.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,s.paint,h.transform.zoom,de,Z.layoutVertexBuffer2),Q=!1}},fill:function(h,t,s,c){const p=s.paint.get("fill-color"),g=s.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const x=h.colorModeForRenderPass(),S=s.paint.get("fill-pattern"),E=h.opaquePassEnabledForLayer()&&!S.constantOr(1)&&p.constantOr(l.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===E){const k=h.depthModeForSublayer(1,h.renderPass==="opaque"?bt.ReadWrite:bt.ReadOnly);Ds(h,t,s,c,k,x,!1)}if(h.renderPass==="translucent"&&s.paint.get("fill-antialias")){const k=h.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,bt.ReadOnly);Ds(h,t,s,c,k,x,!0)}},"fill-extrusion":function(h,t,s,c){const p=s.paint.get("fill-extrusion-opacity");if(p!==0&&h.renderPass==="translucent"){const g=new bt(h.context.gl.LEQUAL,bt.ReadWrite,h.depthRangeFor3D);if(p!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Ls(h,t,s,c,g,jt.disabled,qt.disabled),Ls(h,t,s,c,g,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const x=h.colorModeForRenderPass();Ls(h,t,s,c,g,jt.disabled,x)}}},hillshade:function(h,t,s,c){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const p=h.context,g=h.depthModeForSublayer(0,bt.ReadOnly),x=h.colorModeForRenderPass(),[S,E]=h.renderPass==="translucent"?h.stencilConfigForOverlap(c):[{},c];for(const k of E){const P=t.getTile(k);P.needsHillshadePrepare!==void 0&&P.needsHillshadePrepare&&h.renderPass==="offscreen"?kc(h,P,s,g,jt.disabled,x):h.renderPass==="translucent"&&Nl(h,k,P,s,g,S[k.overscaledZ],x)}p.viewport.set([0,0,h.width,h.height])},raster:function(h,t,s,c){if(h.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!c.length)return;const p=h.context,g=p.gl,x=t.getSource(),S=h.useProgram("raster"),E=h.colorModeForRenderPass(),[k,P]=x instanceof at?[{},c]:h.stencilConfigForOverlap(c),D=P[P.length-1].overscaledZ,R=!h.options.moving;for(const G of P){const $=h.depthModeForSublayer(G.overscaledZ-D,s.paint.get("raster-opacity")===1?bt.ReadWrite:bt.ReadOnly,g.LESS),j=t.getTile(G);j.registerFadeDuration(s.paint.get("raster-fade-duration"));const Q=t.findLoadedParent(G,0),ie=Ca(j,Q,t,s,h.transform,h.style.terrain);let ue,Z;const de=s.paint.get("raster-resampling")==="nearest"?g.NEAREST:g.LINEAR;p.activeTexture.set(g.TEXTURE0),j.texture.bind(de,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),p.activeTexture.set(g.TEXTURE1),Q?(Q.texture.bind(de,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),ue=Math.pow(2,Q.tileID.overscaledZ-j.tileID.overscaledZ),Z=[j.tileID.canonical.x*ue%1,j.tileID.canonical.y*ue%1]):j.texture.bind(de,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);const ce=h.style.terrain&&h.style.terrain.getTerrainData(G),_e=ce?G:null,xe=_e?_e.posMatrix:h.transform.calculatePosMatrix(G.toUnwrapped(),R),Ee=fc(xe,Z||[0,0],ue||1,ie,s);x instanceof at?S.draw(p,g.TRIANGLES,$,jt.disabled,E,Yt.disabled,Ee,ce,s.id,x.boundsBuffer,h.quadTriangleIndexBuffer,x.boundsSegments):S.draw(p,g.TRIANGLES,$,k[G.overscaledZ],E,Yt.disabled,Ee,ce,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,t,s,c){const p=s.paint.get("background-color"),g=s.paint.get("background-opacity");if(g===0)return;const x=h.context,S=x.gl,E=h.transform,k=E.tileSize,P=s.paint.get("background-pattern");if(h.isPatternMissing(P))return;const D=!P&&p.a===1&&g===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==D)return;const R=jt.disabled,G=h.depthModeForSublayer(0,D==="opaque"?bt.ReadWrite:bt.ReadOnly),$=h.colorModeForRenderPass(),j=h.useProgram(P?"backgroundPattern":"background"),Q=c||E.coveringTiles({tileSize:k,terrain:h.style.terrain});P&&(x.activeTexture.set(S.TEXTURE0),h.imageManager.bind(h.context));const ie=s.getCrossfadeParameters();for(const ue of Q){const Z=c?ue.posMatrix:h.transform.calculatePosMatrix(ue.toUnwrapped()),de=P?Bd(Z,g,h,P,{tileID:ue,tileSize:k},ie):Rd(Z,g,p),ce=h.style.terrain&&h.style.terrain.getTerrainData(ue);j.draw(x,S.TRIANGLES,G,R,$,Yt.disabled,de,ce,s.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}},debug:function(h,t,s){for(let c=0;c<s.length;c++)Wd(h,t,s[c])},custom:function(h,t,s){const c=h.context,p=s.implementation;if(h.renderPass==="offscreen"){const g=p.prerender;g&&(h.setCustomLayerDefaults(),c.setColorMode(h.colorModeForRenderPass()),g.call(p,c.gl,h.transform.customLayerMatrix()),c.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),c.setColorMode(h.colorModeForRenderPass()),c.setStencilMode(jt.disabled);const g=p.renderingMode==="3d"?new bt(h.context.gl.LEQUAL,bt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,bt.ReadOnly);c.setDepthMode(g),p.render(c.gl,h.transform.customLayerMatrix()),c.setDirty(),h.setBaseState(),c.bindFramebuffer.set(null)}}};class Vl{constructor(t,s){this.context=new Ec(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=ti.maxUnderzooming+ti.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new lt,this.gpuTimers={}}resize(t,s,c){if(this.width=t*c,this.height=s*c,this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,s=new l.PosArray;s.emplaceBack(0,0),s.emplaceBack(l.EXTENT,0),s.emplaceBack(0,l.EXTENT),s.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,kt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const c=new l.PosArray;c.emplaceBack(0,0),c.emplaceBack(l.EXTENT,0),c.emplaceBack(0,l.EXTENT),c.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=t.createVertexBuffer(c,kt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const p=new l.RasterBoundsArray;p.emplaceBack(0,0,0,0),p.emplaceBack(l.EXTENT,0,l.EXTENT,0),p.emplaceBack(0,l.EXTENT,0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(p,Ze.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const g=new l.PosArray;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,kt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const x=new l.LineStripIndexArray;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const S=new l.TriangleIndexArray;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new Ce(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const E=this.context.gl;this.stencilClearMode=new jt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=l.create();l.ortho(c,0,this.width,this.height,0,0,1),l.scale(c,c,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,bt.disabled,this.stencilClearMode,qt.disabled,Yt.disabled,Fo(c),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const c=this.context,p=c.gl;this.nextStencilID+s.length>256&&this.clearStencil(),c.setColorMode(qt.disabled),c.setDepthMode(bt.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of s){const S=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,E=this.style.terrain&&this.style.terrain.getTerrainData(x);g.draw(c,p.TRIANGLES,bt.disabled,new jt({func:p.ALWAYS,mask:0},S,255,p.KEEP,p.KEEP,p.REPLACE),qt.disabled,Yt.disabled,Fo(x.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new jt({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new jt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,c=t.sort((x,S)=>S.overscaledZ-x.overscaledZ),p=c[c.length-1].overscaledZ,g=c[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let S=0;S<g;S++)x[S+p]=new jt({func:s.GEQUAL,mask:255},S+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[x,c]}return[{[p]:jt.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new qt([t.CONSTANT_COLOR,t.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?qt.unblended:qt.alphaBlended}depthModeForSublayer(t,s,c){if(!this.opaquePassEnabledForLayer())return bt.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new bt(c||this.context.gl.LEQUAL,s,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const c=this.style._order,p=this.style.sourceCaches,g=this.style.terrain&&new Pc(this);for(const k in p){const P=p[k];P.used&&P.prepare(this.context)}const x={},S={},E={};for(const k in p){const P=p[k];x[k]=P.getVisibleCoordinates(),S[k]=x[k].slice().reverse(),E[k]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<c.length;k++)if(this.style._layers[c[k]].is3D()){this.opaquePassCutoff=k;break}if(g){this.opaquePassCutoff=0;const k=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(P,D){const R=P.context,G=R.gl,$=qt.unblended,j=new bt(G.LEQUAL,bt.ReadWrite,[0,1]),Q=D.getTerrainMesh(),ie=D.sourceCache.getRenderableTiles(),ue=P.useProgram("terrainDepth");R.bindFramebuffer.set(D.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,P.width/devicePixelRatio,P.height/devicePixelRatio]),R.clear({color:l.Color.transparent,depth:1});for(const Z of ie){const de=D.getTerrainData(Z.tileID),ce=P.transform.calculatePosMatrix(Z.tileID.toUnwrapped());ue.draw(R,G.TRIANGLES,j,jt.disabled,$,Yt.backCCW,{u_matrix:ce},de,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,P.width,P.height])}(this,this.style.terrain),function(P,D){const R=P.context,G=R.gl,$=qt.unblended,j=new bt(G.LEQUAL,bt.ReadWrite,[0,1]),Q=D.getTerrainMesh(),ie=D.getCoordsTexture(),ue=D.sourceCache.getRenderableTiles(),Z=P.useProgram("terrainCoords");R.bindFramebuffer.set(D.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,P.width/devicePixelRatio,P.height/devicePixelRatio]),R.clear({color:l.Color.transparent,depth:1}),D.coordsIndex=[];for(const de of ue){const ce=D.getTerrainData(de.tileID);R.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,ie.texture);const _e=P.transform.calculatePosMatrix(de.tileID.toUnwrapped());Z.draw(R,G.TRIANGLES,j,jt.disabled,$,Yt.backCCW,{u_matrix:_e,u_terrain_coords_id:(255-D.coordsIndex.length)/255,u_texture:0},ce,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),D.coordsIndex.push(de.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,P.width,P.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const k of c){const P=this.style._layers[k];if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const D=S[P.source];(P.type==="custom"||D.length)&&this.renderLayer(this,p[P.source],P,D)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!g)for(this.renderPass="opaque",this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[c[this.currentLayer]],P=p[k.source],D=x[k.source];this._renderTileClippingMasks(k,D),this.renderLayer(this,P,k,D)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){const k=this.style._layers[c[this.currentLayer]],P=p[k.source];if(g&&g.renderLayer(k))continue;const D=(k.type==="symbol"?E:S)[k.source];this._renderTileClippingMasks(k,x[k.source]),this.renderLayer(this,P,k,D)}if(this.options.showTileBoundaries){let k,P;Object.values(this.style._layers).forEach(D=>{D.source&&!D.isHidden(this.transform.zoom)&&(D.source!==(P&&P.id)&&(P=this.style.sourceCaches[D.source]),(!k||k.getSource().maxzoom<P.getSource().maxzoom)&&(k=P))}),k&&Bs.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const P=k.transform.padding;so(k,k.transform.height-(P.top||0),3,Ia),so(k,P.bottom||0,3,$i),Rs(k,P.left||0,3,Cc),Rs(k,k.transform.width-(P.right||0),3,Ul);const D=k.transform.centerPoint;(function(R,G,$,j){jo(R,G-1,$-10,2,20,j),jo(R,G-10,$-1,20,2,j)})(k,D.x,k.transform.height-D.y,Ic)}(this),this.context.setDefault()}renderLayer(t,s,c,p){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(p||[]).length)&&(this.id=c.id,this.gpuTimingStart(c),Bs[c.type](t,s,c,p,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let c=this.gpuTimers[t.id];c||(c=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),c.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,c.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const c in t){const p=t[c],g=this.context.extTimerQuery,x=g.getQueryObjectEXT(p.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(p.query),s[c]=x}return s}translatePosMatrix(t,s,c,p,g){if(!c[0]&&!c[1])return t;const x=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){const k=Math.sin(x),P=Math.cos(x);c=[c[0]*P-c[1]*k,c[0]*k+c[1]*P]}const S=[g?c[0]:pn(s,c[0],this.transform.zoom),g?c[1]:pn(s,c[1],this.transform.zoom),0],E=new Float32Array(16);return l.translate(E,t,S),E}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!s||!c}useProgram(t,s){this.cache=this.cache||{};const c=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[c]||(this.cache[c]=new uc(this.context,t,Ts[t],s,Cl[t],this._showOverdrawInspector,this.style.terrain)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ce(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Pa{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,c){const p=Math.pow(2,c),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const E=1/(S=l.transformMat4([],S,t))[3]/s*p;return l.mul$1(S,S,[E,E,1/S[3],E])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const E=l.sub([],g[S[0]],g[S[1]]),k=l.sub([],g[S[2]],g[S[1]]),P=l.normalize([],l.cross([],E,k)),D=-l.dot(P,g[S[1]]);return P.concat(D)});return new Pa(g,x)}}class Fs{constructor(t,s){this.min=t,this.max=s,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],c=l.clone$2(this.min),p=l.clone$2(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],p[g]=s[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new Fs(c,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let c=!0;for(let p=0;p<t.planes.length;p++){const g=t.planes[p];let x=0;for(let S=0;S<s.length;S++)l.dot$1(g,s[S])>=0&&x++;if(x===0)return 0;x!==s.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let S=0;S<t.points.length;S++){const E=t.points[S][p]-this.min[p];g=Math.min(g,E),x=Math.max(x,E)}if(x<0||g>this.max[p]-this.min[p])return 0}return 1}}class Go{constructor(t=0,s=0,c=0,p=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=c,this.right=p}interpolate(t,s,c){return s.top!=null&&t.top!=null&&(this.top=l.number(t.top,s.top,c)),s.bottom!=null&&t.bottom!=null&&(this.bottom=l.number(t.bottom,s.bottom,c)),s.left!=null&&t.left!=null&&(this.left=l.number(t.left,s.left,c)),s.right!=null&&t.right!=null&&(this.right=l.number(t.right,s.right,c)),this}getCenter(t,s){const c=l.clamp((this.left+t-this.right)/2,0,t),p=l.clamp((this.top+s-this.bottom)/2,0,s);return new l.pointGeometry(c,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Go(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Os{constructor(t,s,c,p,g){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=g===void 0||!!g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=c??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Go,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new Os(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-l.wrap(t,-180,180)*Math.PI/180;var c;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(c=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c),function(p,g,x){var S=g[0],E=g[1],k=g[2],P=g[3],D=Math.sin(x),R=Math.cos(x);p[0]=S*R+k*D,p[1]=E*R+P*D,p[2]=S*-D+k*R,p[3]=E*-D+P*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=l.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,c){this._unmodified=!1,this._edgeInsets.interpolate(t,s,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new l.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const c=this.pointCoordinate(new l.pointGeometry(0,0)),p=this.pointCoordinate(new l.pointGeometry(this.width,0)),g=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),x=this.pointCoordinate(new l.pointGeometry(0,this.height)),S=Math.floor(Math.min(c.x,p.x,g.x,x.x)),E=Math.floor(Math.max(c.x,p.x,g.x,x.x)),k=1;for(let P=S-k;P<=E+k;P++)P!==0&&s.push(new l.UnwrappedTileID(P,t))}return s}coveringTiles(t){var s,c;let p=this.coveringZoomLevel(t);const g=p;if(t.minzoom!==void 0&&p<t.minzoom)return[];t.maxzoom!==void 0&&p>t.maxzoom&&(p=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),S=l.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,p),k=[E*x.x,E*x.y,0],P=[E*S.x,E*S.y,0],D=Pa.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let R=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(R=p);const G=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,$=Z=>({aabb:new Fs([Z*E,0,0],[(Z+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Z,fullyVisible:!1}),j=[],Q=[],ie=p,ue=t.reparseOverscaled?g:p;if(this._renderWorldCopies)for(let Z=1;Z<=3;Z++)j.push($(-Z)),j.push($(Z));for(j.push($(0));j.length>0;){const Z=j.pop(),de=Z.x,ce=Z.y;let _e=Z.fullyVisible;if(!_e){const je=Z.aabb.intersects(D);if(je===0)continue;_e=je===2}const xe=t.terrain?k:P,Ee=Z.aabb.distanceX(xe),ye=Z.aabb.distanceY(xe),$e=Math.max(Math.abs(Ee),Math.abs(ye)),Me=G+(1<<ie-Z.zoom)-2;if(Z.zoom===ie||$e>Me&&Z.zoom>=R){const je=ie-Z.zoom,ft=k[0]-.5-(de<<je),_t=k[1]-.5-(ce<<je);Q.push({tileID:new l.OverscaledTileID(Z.zoom===ie?ue:Z.zoom,Z.wrap,Z.zoom,de,ce),distanceSq:l.sqrLen([P[0]-.5-de,P[1]-.5-ce]),tileDistanceToCamera:Math.sqrt(ft*ft+_t*_t)})}else for(let je=0;je<4;je++){const ft=(de<<1)+je%2,_t=(ce<<1)+(je>>1),nt=Z.zoom+1;let Dt=Z.aabb.quadrant(je);if(t.terrain){const Lt=new l.OverscaledTileID(nt,Z.wrap,nt,ft,_t),St=t.terrain.getMinMaxElevation(Lt),It=(s=St.minElevation)!==null&&s!==void 0?s:this.elevation,Ft=(c=St.maxElevation)!==null&&c!==void 0?c:this.elevation;Dt=new Fs([Dt.min[0],Dt.min[1],It],[Dt.max[0],Dt.max[1],Ft])}j.push({aabb:Dt,zoom:nt,x:ft,y:_t,wrap:Z.wrap,fullyVisible:_e})}}return Q.sort((Z,de)=>Z.distanceSq-de.distanceSq).map(Z=>Z.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=l.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(t.lng)*this.worldSize,l.mercatorYfromLat(s)*this.worldSize)}unproject(t){return new l.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,s){const c=l.MercatorCoordinate.fromLngLat(t),p=(1<<this.tileZoom)*l.EXTENT,g=c.x*p,x=c.y*p,S=Math.floor(g/l.EXTENT),E=Math.floor(x/l.EXTENT),k=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,S,E);return s.getElevation(k,g%l.EXTENT,x%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),c=this.getElevation(s,t);if(!(this.elevation-c))return;const p=this.getCameraPosition(),g=l.MercatorCoordinate.fromLngLat(p.lngLat,p.altitude),x=l.MercatorCoordinate.fromLngLat(s,c),S=g.x-x.x,E=g.y-x.y,k=g.z-x.z,P=Math.sqrt(S*S+E*E+k*k),D=this.scaleZoom(this.cameraToCenterDistance/P/this.tileSize);this._elevation=c,this._center=s,this.zoom=D}setLocationAtPoint(t,s){const c=this.pointCoordinate(s),p=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t),x=new l.MercatorCoordinate(g.x-(c.x-p.x),g.y-(c.y-p.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return l.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const R=s.pointCoordinate(t);if(R!=null)return R}const c=[t.x,t.y,0,1],p=[t.x,t.y,1,1];l.transformMat4(c,c,this.pixelMatrixInverse),l.transformMat4(p,p,this.pixelMatrixInverse);const g=c[3],x=p[3],S=c[1]/g,E=p[1]/x,k=c[2]/g,P=p[2]/x,D=k===P?0:(0-k)/(P-k);return new l.MercatorCoordinate(l.number(c[0]/g,p[0]/x,D)/this.worldSize,l.number(S,E,D)/this.worldSize)}coordinatePoint(t,s=0,c=this.pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,s,1];return l.transformMat4(p,p,c),new l.pointGeometry(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,t))).extend(this.pointLocation(new l.pointGeometry(this.width,t))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const c=t.key,p=s?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];const g=t.canonical,x=this.worldSize/this.zoomScale(g.z),S=g.x+Math.pow(2,g.z)*t.wrap,E=l.identity(new Float64Array(16));return l.translate(E,E,[S*x,g.y*x,0]),l.scale(E,E,[x/l.EXTENT,x/l.EXTENT,1]),l.multiply(E,s?this.alignedProjMatrix:this.projMatrix,E),p[c]=new Float32Array(E),p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,c,p,g=-90,x=90,S=-180,E=180;const k=this.size,P=this._unmodified;if(this.latRange){const G=this.latRange;g=l.mercatorYfromLat(G[1])*this.worldSize,x=l.mercatorYfromLat(G[0])*this.worldSize,t=x-g<k.y?k.y/(x-g):0}if(this.lngRange){const G=this.lngRange;S=l.wrap(l.mercatorXfromLng(G[0])*this.worldSize,0,this.worldSize),E=l.wrap(l.mercatorXfromLng(G[1])*this.worldSize,0,this.worldSize),E<S&&(E+=this.worldSize),s=E-S<k.x?k.x/(E-S):0}const D=this.point,R=Math.max(s||0,t||0);if(R)return this.center=this.unproject(new l.pointGeometry(s?(E+S)/2:D.x,t?(x+g)/2:D.y)),this.zoom+=this.scaleZoom(R),this._unmodified=P,void(this._constraining=!1);if(this.latRange){const G=D.y,$=k.y/2;G-$<g&&(p=g+$),G+$>x&&(p=x-$)}if(this.lngRange){const G=(S+E)/2,$=l.wrap(D.x,G-this.worldSize/2,G+this.worldSize/2),j=k.x/2;$-j<S&&(c=S+j),$+j>E&&(c=E-j)}c===void 0&&p===void 0||(this.center=this.unproject(new l.pointGeometry(c!==void 0?c:D.x,p!==void 0?p:D.y)).wrap()),this._unmodified=P,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,c=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let p=l.identity(new Float64Array(16));l.scale(p,p,[this.width/2,-this.height/2,1]),l.translate(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=l.identity(new Float64Array(16)),l.scale(p,p,[1,-1,1]),l.translate(p,p,[-1,-1,0]),l.scale(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const g=Math.PI/2+this._pitch,x=this._fov*(.5+t.y/this.height),S=Math.sin(x)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-g-x,.01,Math.PI-.01)),E=this.getHorizon(),k=2*Math.atan(E/this.cameraToCenterDistance)*(.5+t.y/(2*E)),P=Math.sin(k)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-g-k,.01,Math.PI-.01)),D=Math.cos(Math.PI/2-this._pitch)*S+this.cameraToSeaLevelDistance,R=Math.cos(Math.PI/2-this._pitch)*P+this.cameraToSeaLevelDistance,G=1.01*Math.min(D,R),$=this.height/50;p=new Float64Array(16),l.perspective(p,this._fov,this.width/this.height,$,G),p[8]=2*-t.x/this.width,p[9]=2*t.y/this.height,l.scale(p,p,[1,-1,1]),l.translate(p,p,[0,0,-this.cameraToCenterDistance]),l.rotateX(p,p,this._pitch),l.rotateZ(p,p,this.angle),l.translate(p,p,[-s,-c,0]),this.mercatorMatrix=l.scale([],p,[this.worldSize,this.worldSize,this.worldSize]),l.scale(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,p),l.translate(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=l.invert([],p),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,p);const j=this.width%2/2,Q=this.height%2/2,ie=Math.cos(this.angle),ue=Math.sin(this.angle),Z=s-Math.round(s)+ie*j+ue*Q,de=c-Math.round(c)+ie*Q+ue*j,ce=new Float64Array(p);if(l.translate(ce,ce,[Z>.5?Z-1:Z,de>.5?de-1:de,0]),this.alignedProjMatrix=ce,p=l.invert(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new l.pointGeometry(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let c=s.x,p=s.y,g=s.x,x=s.y;for(const S of t)c=Math.min(c,S.x),p=Math.min(p,S.y),g=Math.max(g,S.x),x=Math.max(x,S.y);return[new l.pointGeometry(c,p),new l.pointGeometry(g,p),new l.pointGeometry(g,x),new l.pointGeometry(c,x),new l.pointGeometry(c,p)]}}}class Mc{constructor(t){this._hashName=t&&encodeURIComponent(t),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,c){let p=!1,g=null;const x=()=>{g=null,p&&(s(),g=setTimeout(x,300),p=!1)};return()=>(p=!0,g||x(),g)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),x=Math.round(s.lng*g)/g,S=Math.round(s.lat*g)/g,E=this._map.getBearing(),k=this._map.getPitch();let P="";if(P+=t?`/${x}/${S}/${c}`:`${c}/${S}/${x}`,(E||k)&&(P+="/"+Math.round(10*E)/10),k&&(P+=`/${Math.round(k)}`),this._hashName){const D=this._hashName;let R=!1;const G=window.location.hash.slice(1).split("&").map($=>{const j=$.split("=")[0];return j===D?(R=!0,`${j}=${P}`):$}).filter($=>$);return R||G.push(`${D}=${P}`),`#${G.join("&")}`}return`#${P}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(s=c)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:s,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const Ns={linearity:.3,easing:l.bezier(0,0,.3,1)},Ac=l.extend({deceleration:2500,maxSpeed:1400},Ns),Dc=l.extend({deceleration:20,maxSpeed:1400},Ns),Lc=l.extend({deceleration:1e3,maxSpeed:360},Ns),Zo=l.extend({deceleration:1e3,maxSpeed:90},Ns);class Rc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=l.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const g=Vs(s.pan.mag(),c,l.extend({},Ac,t||{}));p.offset=s.pan.mult(g.amount/s.pan.mag()),p.center=this._map.transform.center,Us(p,g)}if(s.zoom){const g=Vs(s.zoom,c,Dc);p.zoom=this._map.transform.zoom+g.amount,Us(p,g)}if(s.bearing){const g=Vs(s.bearing,c,Lc);p.bearing=this._map.transform.bearing+l.clamp(g.amount,-179,179),Us(p,g)}if(s.pitch){const g=Vs(s.pitch,c,Zo);p.pitch=this._map.transform.pitch+g.amount,Us(p,g)}if(p.zoom||p.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),l.extend(p,{noMoveStart:!0})}}function Us(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Vs(h,t,s){const{maxSpeed:c,linearity:p,deceleration:g}=s,x=l.clamp(h*p/(t/1e3),-c,c),S=Math.abs(x)/(g*p);return{easing:s.easing,duration:1e3*S,amount:x*(S/2)}}class yi extends l.Event{constructor(t,s,c,p={}){const g=W.mousePos(s.getCanvasContainer(),c),x=s.unproject(g);super(t,l.extend({point:g,lngLat:x,originalEvent:c},p)),this._defaultPrevented=!1,this.target=s}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class $s extends l.Event{constructor(t,s,c){const p=t==="touchend"?c.changedTouches:c.touches,g=W.touchPos(s.getCanvasContainer(),p),x=g.map(E=>s.unproject(E)),S=g.reduce((E,k,P,D)=>E.add(k.div(D.length)),new l.pointGeometry(0,0));super(t,{points:g,point:S,lngLats:x,lngLat:s.unproject(S),originalEvent:c}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class _i extends l.Event{constructor(t,s,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Xd{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new _i(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new yi(t.type,this._map,t))}mouseup(t){this._map.fire(new yi(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new yi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new yi(t.type,this._map,t))}mouseover(t){this._map.fire(new yi(t.type,this._map,t))}mouseout(t){this._map.fire(new yi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new $s(t.type,this._map,t))}touchmove(t){this._map.fire(new $s(t.type,this._map,t))}touchend(t){this._map.fire(new $s(t.type,this._map,t))}touchcancel(t){this._map.fire(new $s(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ur{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new yi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new yi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bc{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(W.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const c=s;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=c,this._box||(this._box=W.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(p.x,c.x),x=Math.max(p.x,c.x),S=Math.min(p.y,c.y),E=Math.max(p.y,c.y);W.setTransform(this._box,`translate(${g}px,${S}px)`),this._box.style.width=x-g+"px",this._box.style.height=E-S+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const c=this._startPos,p=s;if(this.reset(),W.suppressClick(),c.x!==p.x||c.y!==p.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(c,p,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new l.Event(t,{originalEvent:s}))}}function vr(h,t){if(h.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${t.length}`);const s={};for(let c=0;c<h.length;c++)s[h[c].identifier]=t[c];return s}class js{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){const g=new l.pointGeometry(0,0);for(const x of p)g._add(x);return g.div(p.length)}(s),this.touches=vr(c,s)))}touchmove(t,s,c){if(this.aborted||!this.centroid)return;const p=vr(c,s);for(const g in this.touches){const x=this.touches[g],S=p[g];(!S||S.dist(x)>30)&&(this.aborted=!0)}}touchend(t,s,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class $l{constructor(t){this.singleTap=new js(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,c){this.singleTap.touchstart(t,s,c)}touchmove(t,s,c){this.singleTap.touchmove(t,s,c)}touchend(t,s,c){const p=this.singleTap.touchend(t,s,c);if(p){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Hd{constructor(){this._zoomIn=new $l({numTouches:1,numTaps:2}),this._zoomOut=new $l({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,c){this._zoomIn.touchstart(t,s,c),this._zoomOut.touchstart(t,s,c)}touchmove(t,s,c){this._zoomIn.touchmove(t,s,c),this._zoomOut.touchmove(t,s,c)}touchend(t,s,c){const p=this._zoomIn.touchend(t,s,c),g=this._zoomOut.touchend(t,s,c);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(p)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Kd={0:1,2:2};class Ma{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const c=W.mouseButton(t);this._correctButton(t,c)&&(this._lastPoint=s,this._eventButton=c)}mousemoveWindow(t,s){const c=this._lastPoint;if(c){if(t.preventDefault(),function(p,g){const x=Kd[g];return p.buttons===void 0||(p.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(c,s)}}mouseupWindow(t){this._lastPoint&&W.mouseButton(t)===this._eventButton&&(this._moved&&W.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gs extends Ma{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class wr extends Ma{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const c=.8*(s.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){t.preventDefault()}}class qe extends Ma{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const c=-.5*(s.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){t.preventDefault()}}class Fc{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,c){return this._calculateTransform(t,s,c)}touchmove(t,s,c){if(this._map._cooperativeGestures&&(this._minTouches===2&&c.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,c.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(c.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,c)}touchend(t,s,c){this._calculateTransform(t,s,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,c){c.length>0&&(this._active=!0);const p=vr(c,s),g=new l.pointGeometry(0,0),x=new l.pointGeometry(0,0);let S=0;for(const k in p){const P=p[k],D=this._touches[k];D&&(g._add(P),x._add(P.sub(D)),S++,p[k]=P)}if(this._touches=p,S<this._minTouches||!x.mag())return;const E=x.div(S);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(S),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ao{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,s,c){return{}}touchstart(t,s,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,c){if(!this._firstTwoTouches)return;t.preventDefault();const[p,g]=this._firstTwoTouches,x=Vr(c,s,p),S=Vr(c,s,g);if(!x||!S)return;const E=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],E,t)}touchend(t,s,c){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,x=Vr(c,s,p),S=Vr(c,s,g);x&&S||(this._active&&W.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vr(h,t,s){for(let c=0;c<h.length;c++)if(h[c].identifier===s)return t[c]}function jl(h,t){return Math.log(h/t)/Math.LN2}class Oe extends ao{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(jl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jl(this._distance,c),pinchAround:s}}}function Aa(h,t){return 180*h.angleWith(t)/Math.PI}class Yd extends ao{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Aa(this._vector,c),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,c=Aa(t,this._startVector);return Math.abs(c)<s}}function Gl(h){return Math.abs(h.y)>Math.abs(h.x)}class Zl extends ao{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,c){super.touchstart(t,s,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Gl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,c){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,g,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,c){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,g=s.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return Gl(t)&&Gl(s)&&x}}const Oc={panStep:100,bearingStep:15,pitchStep:10};class Nc{constructor(){const t=Oc;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,c=0,p=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(c=0,p=0),{cameraAnimation:S=>{const E=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Jd,zoom:s?Math.round(E)+s*(t.shiftKey?2:1):E,bearing:S.getBearing()+c*this._bearingStep,pitch:S.getPitch()+p*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jd(h){return h*(2-h)}const Uc=4.000244140625;class ql{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=l.exported.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,s!==0&&s%Uc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=W.mousePos(this._el,t);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Uc?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&E!==0&&(E=1/E);const k=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(k*E))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,c=this._startZoom,p=this._easing;let g,x=!1;if(this._type==="wheel"&&c&&p){const S=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),E=p(S);g=l.number(c,s,E),S<1?this._frameId||(this._frameId=!0):x=!0}else g=s,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=l.ease;if(this._prevEase){const c=this._prevEase,p=(l.exported.now()-c.start)/c.duration,g=c.easing(p+.01)-c.easing(p),x=.27/Math.sqrt(g*g+1e-4)*.01,S=Math.sqrt(.0729-x*x);s=l.bezier(x,S,.25,1)}return this._prevEase={start:l.exported.now(),duration:t,easing:s},s}reset(){this._active=!1}}class Wl{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Xl{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hl{constructor(){this._tap=new $l({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,s,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=s[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,s,c))}touchmove(t,s,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const p=s[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,c)}touchend(t,s,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,s,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ni{constructor(t,s,c){this._el=t,this._mousePan=s,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $r{constructor(t,s,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vc{constructor(t,s,c,p){this._el=t,this._touchZoom=s,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qo=h=>h.zoom||h.drag||h.pitch||h.rotate;class Kl extends l.Event{}function Zs(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class $c{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rc(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),l.bindAll(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,x]of this._listeners)W.addEventListener(p,g,p===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,s,c]of this._listeners)W.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const s=this._map,c=s.getCanvasContainer();this._add("mapEvent",new Xd(s,t));const p=s.boxZoom=new Bc(s,t);this._add("boxZoom",p);const g=new Hd,x=new Xl;s.doubleClickZoom=new Wl(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const S=new Hl;this._add("tapDragZoom",S);const E=s.touchPitch=new Zl(s);this._add("touchPitch",E);const k=new wr(t),P=new qe(t);s.dragRotate=new $r(t,k,P),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const D=new Gs(t),R=new Fc(t,s);s.dragPan=new ni(c,D,R),this._add("mousePan",D),this._add("touchPan",R,["touchZoom","touchRotate"]);const G=new Yd,$=new Oe;s.touchZoomRotate=new Vc(c,$,G,S),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]);const j=s.scrollZoom=new ql(s,this);this._add("scrollZoom",j,["mousePan"]);const Q=s.keyboard=new Nc;this._add("keyboard",Q),this._add("blockableMapEvent",new Ur(s));for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ie]&&s[ie].enable(t[ie])}_add(t,s,c){this._handlers.push({handlerName:t,handler:s,allowed:c}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(qo(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,s,c){for(const p in t)if(p!==c&&(!s||s.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const c of t)this._el.contains(c.target)&&s.push(c);return s}handleEvent(t,s){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const c=t.type==="renderFrame"?void 0:t,p={needsRenderFrame:!1},g={},x={},S=t.touches,E=S?this._getMapTouches(S):void 0,k=E?W.touchPos(this._el,E):W.mousePos(this._el,t);for(const{handlerName:R,handler:G,allowed:$}of this._handlers){if(!G.isEnabled())continue;let j;this._blockedByActive(x,$,R)?G.reset():G[s||t.type]&&(j=G[s||t.type](t,k,E),this.mergeHandlerResult(p,g,j,R,c),j&&j.needsRenderFrame&&this._triggerRenderFrame()),(j||G.isActive())&&(x[R]=G)}const P={};for(const R in this._previousActiveHandlers)x[R]||(P[R]=c);this._previousActiveHandlers=x,(Object.keys(P).length||Zs(p))&&(this._changes.push([p,g,P]),this._triggerRenderFrame()),(Object.keys(x).length||Zs(p))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:D}=p;D&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],D(this._map))}mergeHandlerResult(t,s,c,p,g){if(!c)return;l.extend(t,c);const x={handlerName:p,originalEvent:c.originalEvent||g};c.zoomDelta!==void 0&&(s.zoom=x),c.panDelta!==void 0&&(s.drag=x),c.pitchDelta!==void 0&&(s.pitch=x),c.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},c={};for(const[p,g,x]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new l.pointGeometry(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),l.extend(s,g),l.extend(c,x);this._updateMapTransform(t,s,c),this._changes=[]}_updateMapTransform(t,s,c){const p=this._map,g=p.transform,x=p.style&&p.style.terrain;if(!(Zs(t)||x&&this._drag))return this._fireEvents(s,c,!0);let{panDelta:S,zoomDelta:E,bearingDelta:k,pitchDelta:P,around:D,pinchAround:R}=t;R!==void 0&&(D=R),p._stop(!0),D=D||p.transform.centerPoint;const G=g.pointLocation(S?D.sub(S):D);k&&(g.bearing+=k),P&&(g.pitch+=P),E&&(g.zoom+=E),x?s.drag&&!this._drag?(this._drag={center:g.centerPoint,lngLat:g.pointLocation(D),point:D,handlerName:s.drag.handlerName},p.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&c[this._drag.handlerName]?(p.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):s.drag&&this._drag&&(g.center=g.pointLocation(g.centerPoint.sub(S))):g.setLocationAtPoint(G,D),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,c,!0)}_fireEvents(t,s,c){const p=qo(this._eventsInProgress),g=qo(t),x={};for(const P in t){const{originalEvent:D}=t[P];this._eventsInProgress[P]||(x[`${P}start`]=D),this._eventsInProgress[P]=t[P]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const P in x)this._fireEvent(P,x[P]);g&&this._fireEvent("move",g.originalEvent);for(const P in t){const{originalEvent:D}=t[P];this._fireEvent(P,D)}const S={};let E;for(const P in this._eventsInProgress){const{handlerName:D,originalEvent:R}=this._eventsInProgress[P];this._handlersById[D].isActive()||(delete this._eventsInProgress[P],E=s[D]||R,S[`${P}end`]=E)}for(const P in S)this._fireEvent(P,S[P]);const k=qo(this._eventsInProgress);if(c&&(p||g)&&!k){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=R=>R!==0&&-this._bearingSnap<R&&R<this._bearingSnap;P?(D(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:E})):(this._map.fire(new l.Event("moveend",{originalEvent:E})),D(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new l.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Kl("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Pi={extend:(h,...t)=>l.extend(h,...t),run(h){h()},logToElement(h,t=!1,s="log"){const c=window.document.getElementById(s);c&&(t&&(c.innerHTML=""),c.innerHTML+=`<br>${h}`)}};class Jt extends l.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,c){return t=l.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,l.extend({offset:t},s),c)}panTo(t,s,c){return this.easeTo(l.extend({center:t},s),c)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,c){return this.easeTo(l.extend({zoom:t},s),c)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,c){return this.easeTo(l.extend({bearing:t},s),c)}resetNorth(t,s){return this.rotateTo(0,l.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=l.LngLatBounds.convert(t);const c=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,s)}_cameraForBoxAndBearing(t,s,c,p){const g={top:0,bottom:0,right:0,left:0};if(typeof(p=l.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const ce=p.padding;p.padding={top:ce,bottom:ce,right:ce,left:ce}}p.padding=l.extend(g,p.padding);const x=this.transform,S=x.padding,E=x.project(l.LngLat.convert(t)),k=x.project(l.LngLat.convert(s)),P=E.rotate(-c*Math.PI/180),D=k.rotate(-c*Math.PI/180),R=new l.pointGeometry(Math.max(P.x,D.x),Math.max(P.y,D.y)),G=new l.pointGeometry(Math.min(P.x,D.x),Math.min(P.y,D.y)),$=R.sub(G),j=(x.width-(S.left+S.right+p.padding.left+p.padding.right))/$.x,Q=(x.height-(S.top+S.bottom+p.padding.top+p.padding.bottom))/$.y;if(Q<0||j<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ie=Math.min(x.scaleZoom(x.scale*Math.min(j,Q)),p.maxZoom),ue=l.pointGeometry.convert(p.offset),Z=new l.pointGeometry((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(c*Math.PI/180),de=ue.add(Z).mult(x.scale/x.zoomScale(ie));return{center:x.unproject(E.add(k).div(2).sub(de)),zoom:ie,bearing:c}}fitBounds(t,s,c){return this._fitInternal(this.cameraForBounds(t,s),s,c)}fitScreenCoordinates(t,s,c,p,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(t)),this.transform.pointLocation(l.pointGeometry.convert(s)),c,p),p,g)}_fitInternal(t,s,c){return t?(delete(s=l.extend(t,s)).padding,s.linear?this.easeTo(s,c):this.flyTo(s,c)):this}jumpTo(t,s){this.stop();const c=this.transform;let p=!1,g=!1,x=!1;return"zoom"in t&&c.zoom!==+t.zoom&&(p=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=l.LngLat.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(g=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(x=!0,c.pitch=+t.pitch),t.padding==null||c.isPaddingEqual(t.padding)||(c.padding=t.padding),this.fire(new l.Event("movestart",s)).fire(new l.Event("move",s)),p&&this.fire(new l.Event("zoomstart",s)).fire(new l.Event("zoom",s)).fire(new l.Event("zoomend",s)),g&&this.fire(new l.Event("rotatestart",s)).fire(new l.Event("rotate",s)).fire(new l.Event("rotateend",s)),x&&this.fire(new l.Event("pitchstart",s)).fire(new l.Event("pitch",s)).fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))}calculateCameraOptionsFromTo(t,s,c,p=0){const g=l.MercatorCoordinate.fromLngLat(t,s),x=l.MercatorCoordinate.fromLngLat(c,p),S=x.x-g.x,E=x.y-g.y,k=x.z-g.z,P=Math.hypot(S,E,k);if(P===0)throw new Error("Can't calculate camera options with same From and To");const D=Math.hypot(S,E),R=this.transform.scaleZoom(this.transform.cameraToCenterDistance/P/this.transform.tileSize),G=180*Math.atan2(S,-E)/Math.PI;let $=180*Math.acos(D/P)/Math.PI;return $=k<0?90-$:90+$,{center:x.toLngLat(),zoom:R,pitch:$,bearing:G}}easeTo(t,s){this._stop(!1,t.easeId),((t=l.extend({offset:[0,0],duration:500,easing:l.ease},t)).animate===!1||!t.essential&&l.exported.prefersReducedMotion)&&(t.duration=0);const c=this.transform,p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),S=this.getPadding(),E="zoom"in t?+t.zoom:p,k="bearing"in t?this._normalizeBearing(t.bearing,g):g,P="pitch"in t?+t.pitch:x,D="padding"in t?t.padding:c.padding,R=l.pointGeometry.convert(t.offset);let G=c.centerPoint.add(R);const $=c.pointLocation(G),j=l.LngLat.convert(t.center||$);this._normalizeCenter(j);const Q=c.project($),ie=c.project(j).sub(Q),ue=c.zoomScale(E-p);let Z,de;t.around&&(Z=l.LngLat.convert(t.around),de=c.locationPoint(Z));const ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||E!==p,this._rotating=this._rotating||g!==k,this._pitching=this._pitching||P!==x,this._padding=!c.isPaddingEqual(D),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,ce),this._ease(_e=>{if(this._zooming&&(c.zoom=l.number(p,E,_e)),this._rotating&&(c.bearing=l.number(g,k,_e)),this._pitching&&(c.pitch=l.number(x,P,_e)),this._padding&&(c.interpolatePadding(S,D,_e),G=c.centerPoint.add(R)),Z)c.setLocationAtPoint(Z,de);else{const xe=c.zoomScale(c.zoom-p),Ee=E>p?Math.min(2,ue):Math.max(.5,ue),ye=Math.pow(Ee,1-_e),$e=c.unproject(Q.add(ie.mult(_e*ye)).mult(xe));c.setLocationAtPoint(c.renderWorldCopies?$e.wrap():$e,G)}this._fireMoveEvents(s)},_e=>{this._afterEase(s,_e)},t),this}_prepareEase(t,s,c={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),s||c.moving||this.fire(new l.Event("movestart",t)),this._zooming&&!c.zooming&&this.fire(new l.Event("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new l.Event("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new l.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new l.Event("move",t)),this._zooming&&this.fire(new l.Event("zoom",t)),this._rotating&&this.fire(new l.Event("rotate",t)),this._pitching&&this.fire(new l.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const c=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new l.Event("zoomend",t)),p&&this.fire(new l.Event("rotateend",t)),g&&this.fire(new l.Event("pitchend",t)),this.fire(new l.Event("moveend",t))}flyTo(t,s){if(!t.essential&&l.exported.prefersReducedMotion){const nt=l.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(nt,s)}this.stop(),t=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},t);const c=this.transform,p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),S=this.getPadding(),E="zoom"in t?l.clamp(+t.zoom,c.minZoom,c.maxZoom):p,k="bearing"in t?this._normalizeBearing(t.bearing,g):g,P="pitch"in t?+t.pitch:x,D="padding"in t?t.padding:c.padding,R=c.zoomScale(E-p),G=l.pointGeometry.convert(t.offset);let $=c.centerPoint.add(G);const j=c.pointLocation($),Q=l.LngLat.convert(t.center||j);this._normalizeCenter(Q);const ie=c.project(j),ue=c.project(Q).sub(ie);let Z=t.curve;const de=Math.max(c.width,c.height),ce=de/R,_e=ue.mag();if("minZoom"in t){const nt=l.clamp(Math.min(t.minZoom,p,E),c.minZoom,c.maxZoom),Dt=de/c.zoomScale(nt-p);Z=Math.sqrt(Dt/_e*2)}const xe=Z*Z;function Ee(nt){const Dt=(ce*ce-de*de+(nt?-1:1)*xe*xe*_e*_e)/(2*(nt?ce:de)*xe*_e);return Math.log(Math.sqrt(Dt*Dt+1)-Dt)}function ye(nt){return(Math.exp(nt)-Math.exp(-nt))/2}function $e(nt){return(Math.exp(nt)+Math.exp(-nt))/2}const Me=Ee(0);let je=function(nt){return $e(Me)/$e(Me+Z*nt)},ft=function(nt){return de*(($e(Me)*(ye(Dt=Me+Z*nt)/$e(Dt))-ye(Me))/xe)/_e;var Dt},_t=(Ee(1)-Me)/Z;if(Math.abs(_e)<1e-6||!isFinite(_t)){if(Math.abs(de-ce)<1e-6)return this.easeTo(t,s);const nt=ce<de?-1:1;_t=Math.abs(Math.log(ce/de))/Z,ft=function(){return 0},je=function(Dt){return Math.exp(nt*Z*Dt)}}return t.duration="duration"in t?+t.duration:1e3*_t/("screenSpeed"in t?+t.screenSpeed/Z:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==k,this._pitching=P!==x,this._padding=!c.isPaddingEqual(D),this._prepareEase(s,!1),this._ease(nt=>{const Dt=nt*_t,Lt=1/je(Dt);c.zoom=nt===1?E:p+c.scaleZoom(Lt),this._rotating&&(c.bearing=l.number(g,k,nt)),this._pitching&&(c.pitch=l.number(x,P,nt)),this._padding&&(c.interpolatePadding(S,D,nt),$=c.centerPoint.add(G));const St=nt===1?Q:c.unproject(ie.add(ue.mult(ft(Dt))).mult(Lt));c.setLocationAtPoint(c.renderWorldCopies?St.wrap():St,$),this._fireMoveEvents(s)},()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,s)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,s,c){c.animate===!1||c.duration===0?(t(1),s()):(this._easeStart=l.exported.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=l.wrap(t,-180,180);const c=Math.abs(t-s);return Math.abs(t-360-s)<c&&(t-=360),Math.abs(t+360-s)<c&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const c=t.lng-s.center.lng;t.lng+=c>180?-360:c<-180?360:0}}class qs{constructor(t={}){this.options=t,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=W.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const c=this._map._getUIString(`AttributionControl.${s}`);t.title=c,t.setAttribute("aria-label",c)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style.sourceCaches;for(const p in s){const g=s[p];if(g.used||g.usedForTerrain){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(p=>String(p).trim()),t.sort((p,g)=>p.length-g.length),t=t.filter((p,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(p)>=0)return!1;return!0});const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Da{constructor(t={}){this.options=t,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=W.create("div","maplibregl-ctrl mapboxgl-ctrl");const s=W.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){W.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact","mapboxgl-compact"):s.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class jc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,c=s?this._queue.concat(s):this._queue;for(const p of c)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const c of s)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Gc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Zc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Qd={showCompass:!0,showZoom:!0,visualizePitch:!1};class ir{constructor(t,s,c=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new wr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new qe({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),W.addEventListener(s,"mousedown",this.mousedown),W.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(s,"touchmove",this.touchmove),W.addEventListener(s,"touchend",this.touchend),W.addEventListener(s,"touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),W.disableDrag()}move(t,s){const c=this.map,p=this.mouseRotate.mousemoveWindow(t,s);if(p&&p.bearingDelta&&c.setBearing(c.getBearing()+p.bearingDelta),this.mousePitch){const g=this.mousePitch.mousemoveWindow(t,s);g&&g.pitchDelta&&c.setPitch(c.getPitch()+g.pitchDelta)}}off(){const t=this.element;W.removeEventListener(t,"mousedown",this.mousedown),W.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(t,"touchmove",this.touchmove),W.removeEventListener(t,"touchend",this.touchend),W.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){W.enableDrag(),W.removeEventListener(window,"mousemove",this.mousemove),W.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(l.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),W.mousePos(this.element,t)),W.addEventListener(window,"mousemove",this.mousemove),W.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,W.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ws(h,t,s){if(h=new l.LngLat(h.lng,h.lat),t){const c=new l.LngLat(h.lng-360,h.lat),p=new l.LngLat(h.lng+360,h.lat),g=s.locationPoint(h).distSqr(t);s.locationPoint(c).distSqr(t)<g?h=c:s.locationPoint(p).distSqr(t)<g&&(h=p)}for(;Math.abs(h.lng-s.center.lng)>180;){const c=s.locationPoint(h);if(c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height)break;h.lng>s.center.lng?h.lng-=360:h.lng+=360}return h}const Ye={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ot(h,t,s){const c=h.classList;for(const p in Ye)c.remove(`maplibregl-${s}-anchor-${p}`,`mapboxgl-${s}-anchor-${p}`);c.add(`maplibregl-${s}-anchor-${t}`,`mapboxgl-${s}-anchor-${t}`)}class Wo extends l.Evented{constructor(t,s){if(super(),(t instanceof HTMLElement||s)&&(t=l.extend({element:t},s)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=l.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div"),this._element.setAttribute("aria-label","Map marker");const c=W.createNS("http://www.w3.org/2000/svg","svg"),p=41,g=27;c.setAttributeNS(null,"display","block"),c.setAttributeNS(null,"height",`${p}px`),c.setAttributeNS(null,"width",`${g}px`),c.setAttributeNS(null,"viewBox",`0 0 ${g} ${p}`);const x=W.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const S=W.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const E=W.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ue of k){const Z=W.createNS("http://www.w3.org/2000/svg","ellipse");Z.setAttributeNS(null,"opacity","0.04"),Z.setAttributeNS(null,"cx","10.5"),Z.setAttributeNS(null,"cy","5.80029008"),Z.setAttributeNS(null,"rx",ue.rx),Z.setAttributeNS(null,"ry",ue.ry),E.appendChild(Z)}const P=W.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const D=W.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(D);const R=W.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const G=W.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(G);const $=W.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const j=W.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=W.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const ie=W.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),j.appendChild(Q),j.appendChild(ie),S.appendChild(E),S.appendChild(P),S.appendChild(R),S.appendChild($),S.appendChild(j),c.appendChild(S),c.setAttributeNS(null,"height",p*this._scale+"px"),c.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(c),this._offset=l.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()}),ot(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const s=t.code,c=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,c=this._element;this._popup&&(s===c||c.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ws(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let c="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?c="rotateX(0deg)":this._pitchAlignment==="map"&&(c=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,`${Ye[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${c} ${s}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const p=this._map.unproject(this._pos),g=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=p.distanceTo(this._lngLat)>20*g?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=l.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Yl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let jr,An=0,Gr=!1;const rr={maxWidth:100,unit:"metric"};function qc(h,t,s){const c=s&&s.maxWidth||100,p=h._container.clientHeight/2,g=h.unproject([0,p]),x=h.unproject([c,p]),S=g.distanceTo(x);if(s&&s.unit==="imperial"){const E=3.2808*S;E>5280?Zr(t,c,E/5280,h._getUIString("ScaleControl.Miles")):Zr(t,c,E,h._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Zr(t,c,S/1852,h._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Zr(t,c,S/1e3,h._getUIString("ScaleControl.Kilometers")):Zr(t,c,S,h._getUIString("ScaleControl.Meters"))}function Zr(h,t,s,c){const p=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let S=g/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(E){const k=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*k)/k}(S),x*S}(s);h.style.width=t*(p/s)+"px",h.innerHTML=`${p}&nbsp;${c}`}const sn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},fn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Jl(h){if(h){if(typeof h=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(h,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,h),"top-left":new l.pointGeometry(t,t),"top-right":new l.pointGeometry(-t,t),bottom:new l.pointGeometry(0,-h),"bottom-left":new l.pointGeometry(t,-t),"bottom-right":new l.pointGeometry(-t,-t),left:new l.pointGeometry(h,0),right:new l.pointGeometry(-h,0)}}if(h instanceof l.pointGeometry||Array.isArray(h)){const t=l.pointGeometry.convert(h);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.pointGeometry.convert(h.center||[0,0]),top:l.pointGeometry.convert(h.top||[0,0]),"top-left":l.pointGeometry.convert(h["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(h["top-right"]||[0,0]),bottom:l.pointGeometry.convert(h.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(h["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(h["bottom-right"]||[0,0]),left:l.pointGeometry.convert(h.left||[0,0]),right:l.pointGeometry.convert(h.right||[0,0])}}return Jl(new l.pointGeometry(0,0))}const lo={supported:U,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends Jt{constructor(h){var t;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(h=l.extend({},Zc,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Os(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),{bearingSnap:h.bearingSnap}),this._interactive=h.interactive,this._cooperativeGestures=h.cooperativeGestures,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new jc,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Gc,h.locale),this._clickTolerance=h.clickTolerance,this._pixelRatio=(t=h.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new Fe(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new $c(this,h),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=h.hash&&new Mc(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,l.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new qs({customAttribution:h.customAttribution})),h.maplibreLogo&&this.addControl(new Da,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new l.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new l.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new l.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=h.onAdd(this);this._controls.push(h);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(s,c.firstChild):c.appendChild(s),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,t,s,c){return c==null&&this.style.terrain&&(c=this.transform.getElevation(s,this.style.terrain)),super.calculateCameraOptionsFromTo(h,t,s,c)}resize(h){const t=this._containerDimensions(),s=t[0],c=t[1];this._resizeCanvas(s,c,this.getPixelRatio()),this.transform.resize(s,c),this.painter.resize(s,c,this.getPixelRatio());const p=!this._moving;return p&&(this.stop(),this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h))),this.fire(new l.Event("resize",h)),p&&this.fire(new l.Event("moveend",h)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(h){const[t,s]=this._containerDimensions();this._pixelRatio=h,this._resizeCanvas(t,s,h),this.painter.resize(t,s,h)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(l.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}project(h){return this.transform.locationPoint(l.LngLat.convert(h),this.style&&this.style.terrain)}unproject(h){return this.transform.pointLocation(l.pointGeometry.convert(h),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(h,t,s){if(h==="mouseenter"||h==="mouseover"){let c=!1;return{layer:t,listener:s,delegates:{mousemove:g=>{const x=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];x.length?c||(c=!0,s.call(this,new yi(h,this,g.originalEvent,{features:x}))):c=!1},mouseout:()=>{c=!1}}}}if(h==="mouseleave"||h==="mouseout"){let c=!1;return{layer:t,listener:s,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?c=!0:c&&(c=!1,s.call(this,new yi(h,this,x.originalEvent)))},mouseout:x=>{c&&(c=!1,s.call(this,new yi(h,this,x.originalEvent)))}}}}{const c=p=>{const g=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];g.length&&(p.features=g,s.call(this,p),delete p.features)};return{layer:t,listener:s,delegates:{[h]:c}}}}on(h,t,s){if(s===void 0)return super.on(h,t);const c=this._createDelegatedListener(h,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(c);for(const p in c.delegates)this.on(p,c.delegates[p]);return this}once(h,t,s){if(s===void 0)return super.once(h,t);const c=this._createDelegatedListener(h,t,s);for(const p in c.delegates)this.once(p,c.delegates[p]);return this}off(h,t,s){return s===void 0?super.off(h,t):(this._delegatedListeners&&this._delegatedListeners[h]&&(c=>{const p=this._delegatedListeners[h];for(let g=0;g<p.length;g++){const x=p[g];if(x.layer===t&&x.listener===s){for(const S in x.delegates)this.off(S,x.delegates[S]);return p.splice(g,1),this}}})(),this)}queryRenderedFeatures(h,t){if(!this.style)return[];let s;if(t!==void 0||h===void 0||h instanceof l.pointGeometry||Array.isArray(h)||(t=h,h=void 0),t=t||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof h[0]=="number")s=[l.pointGeometry.convert(h)];else{const c=l.pointGeometry.convert(h[0]),p=l.pointGeometry.convert(h[1]);s=[c,new l.pointGeometry(p.x,c.y),p,new l.pointGeometry(c.x,p.y),c]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(h,t){return this.style.querySourceFeatures(h,t)}setStyle(h,t){return(t=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(h,t))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new Fn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Fn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,t){if(typeof h=="string"){const s=this._requestManager.transformRequest(h,l.ResourceType.Style);l.getJSON(s,(c,p)=>{c?this.fire(new l.ErrorEvent(c)):p&&this._updateDiff(p,t)})}else typeof h=="object"&&this._updateDiff(h,t)}_updateDiff(h,t){try{this.style.setState(h)&&this._update(!0)}catch(s){l.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(h,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(h,t){return this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)}isSourceLoaded(h){const t=this.style&&this.style.sourceCaches[h];if(t!==void 0)return t.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){return this.style.setTerrain(h),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const t in h){const s=h[t]._tiles;for(const c in s){const p=s[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(h,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,s)}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,t,{pixelRatio:s=1,sdf:c=!1,stretchX:p,stretchY:g,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||l.isImageBitmap(t)){const{width:S,height:E,data:k}=l.exported.getImageData(t);this.style.addImage(h,{data:new l.RGBAImage({width:S,height:E},k),pixelRatio:s,stretchX:p,stretchY:g,content:x,sdf:c,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:E,data:k}=t,P=t;this.style.addImage(h,{data:new l.RGBAImage({width:S,height:E},new Uint8Array(k)),pixelRatio:s,stretchX:p,stretchY:g,content:x,sdf:c,version:0,userImage:P}),P.onAdd&&P.onAdd(this,h)}}}updateImage(h,t){const s=this.style.getImage(h);if(!s)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||l.isImageBitmap(t)?l.exported.getImageData(t):t,{width:p,height:g,data:x}=c;if(p===void 0||g===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==s.data.width||g!==s.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(t instanceof HTMLImageElement||l.isImageBitmap(t));s.data.replace(x,S),this.style.updateImage(h,s)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){l.getImage(this._requestManager.transformRequest(h,l.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(h,t){return this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)}moveLayer(h,t){return this.style.moveLayer(h,t),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,t,s){return this.style.setLayerZoomRange(h,t,s),this._update(!0)}setFilter(h,t,s={}){return this.style.setFilter(h,t,s),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,t,s,c={}){return this.style.setPaintProperty(h,t,s,c),this._update(!0)}getPaintProperty(h,t){return this.style.getPaintProperty(h,t)}setLayoutProperty(h,t,s,c={}){return this.style.setLayoutProperty(h,t,s,c),this._update(!0)}getLayoutProperty(h,t){return this.style.getLayoutProperty(h,t)}setLight(h,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(h,t){return this.style.setFeatureState(h,t),this._update()}removeFeatureState(h,t){return this.style.removeFeatureState(h,t),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,t=0;return this._container&&(h=this._container.clientWidth||400,t=this._container.clientHeight||300),[h,t]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=W.create("div","maplibregl-canvas-container mapboxgl-canvas-container",h);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=W.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const c=this._controlContainer=W.create("div","maplibregl-control-container mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{p[g]=W.create("div",`maplibregl-ctrl-${g} mapboxgl-ctrl-${g}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const h=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=W.create("div","maplibregl-cooperative-gesture-screen",h);let t="Control",s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${s}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",c=>{c.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",c=>{c.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",c=>{this._onCooperativeGesture(c,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(h,t,s){this._canvas.width=s*h,this._canvas.height=s*t,this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const h=l.extend({},U.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);t?(this.painter=new Vl(t,this.transform),l.exported$1.testSupport(t)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(h,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){let t,s=0;const c=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,t),s=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let p=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const x=this.transform.zoom,S=l.exported.now();this.style.zoomHistory.update(x,S);const E=new l.EvaluationParameters(x,{now:S,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=E.crossFadingFactor();k===1&&k===this._crossFadingFactor||(p=!0,this._crossFadingFactor=k),this.style.update(E)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||p)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const x=l.exported.now()-s;c.endQueryEXT(c.TIME_ELAPSED_EXT,t),setTimeout(()=>{const S=c.getQueryObjectEXT(t,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(t),this.fire(new l.Event("gpu-timing-frame",{cpuTime:x,gpuTime:S}))},50)}if(this.listens("gpu-timing-layer")){const x=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(x);this.fire(new l.Event("gpu-timing-layer",{layerTimes:S}))},50)}const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),W.remove(this._canvasContainer),W.remove(this._controlContainer),this._cooperativeGestures&&W.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(h=>{l.PerformanceUtils.frame(h),this._frame=null,this._render(h)}))}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,t){l.setCacheLimits(h,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(h){this.options=l.extend({},Qd,h),this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),W.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),W.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=W.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map.getZoom(),t=h===this._map.getMaxZoom(),s=h===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=h}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ir(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,t){const s=W.create("button",h,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(h,t){const s=this._map._getUIString(`NavigationControl.${t}`);h.title=s,h.setAttribute("aria-label",s)}},GeolocateControl:class extends l.Evented{constructor(h){super(),this.options=l.extend({},Yl,h),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(h){var t;return this._map=h,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,jr!==void 0?t(jr):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(s=>{jr=s.state!=="denied",t(jr)}):(jr=!!window.navigator.geolocation,t(jr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,An=0,Gr=!1}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),s=h.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",h)),this._finish()}}_updateCamera(h){const t=new l.LngLat(h.coords.longitude,h.coords.latitude),s=h.coords.accuracy,c=this._map.getBearing(),p=l.extend({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),p,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new l.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map._container.clientHeight/2,t=this._map.unproject([0,h]),s=this._map.unproject([1,h]),c=t.distanceTo(s),p=Math.ceil(2*this._accuracy/c);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&Gr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=W.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),W.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Wo(this._dotElement),this._circleElement=W.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":An--,Gr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),An++,An>1?(h={maximumAge:6e5,timeout:0},Gr=!0):(h=this.options.positionOptions,Gr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:qs,LogoControl:Da,ScaleControl:class{constructor(h){this.options=l.extend({},rr,h),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){qc(this._map,this._container,this.options)}onAdd(h){return this._map=h,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(h){this.options.unit=h,qc(this._map,this._container,this.options)}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){W.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=W.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);W.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(h){this.options=h,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(h){return this._map=h,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=W.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),W.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){W.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(h){super(),this.options=l.extend(Object.create(sn),h),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=l.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),s=document.createElement("body");let c;for(s.innerHTML=h;c=s.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){this._container&&this._container.classList.add(h)}removeClassName(h){this._container&&this._container.classList.remove(h)}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}_createCloseButton(){this.options.closeButton&&(this._closeButton=W.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(h){this._update(h.point)}_onMouseMove(h){this._update(h.point)}_onDrag(h){this._update(h.point)}_update(h){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=W.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=W.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(g=>this._container.classList.add(g)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ws(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!h))return;const t=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat);let s=this.options.anchor;const c=Jl(this.options.offset);if(!s){const g=this._container.offsetWidth,x=this._container.offsetHeight;let S;S=t.y+c.bottom.y<x?["top"]:t.y>this._map.transform.height-x?["bottom"]:[],t.x<g/2?S.push("left"):t.x>this._map.transform.width-g/2&&S.push("right"),s=S.length===0?"bottom":S.join("-")}const p=t.add(c[s]).round();W.setTransform(this._container,`${Ye[s]} translate(${p.x}px,${p.y}px)`),ot(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(fn);h&&h.focus()}_onClose(){this.remove()}},Marker:Wo,Style:Fn,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:Nt,GeoJSONSource:hi,ImageSource:at,RasterDEMTileSource:st,RasterTileSource:Ni,VectorTileSource:Ii,VideoSource:ut,prewarm:function(){Po().acquire(mr)},clearPrewarmedResources:function(){const h=Rr;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(mr),Rr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return pi.workerCount},set workerCount(h){pi.workerCount=h},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){l.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){l.clearTileCache(h)},workerUrl:"",addProtocol(h,t){l.config.REGISTERED_PROTOCOLS[h]=t},removeProtocol(h){delete l.config.REGISTERED_PROTOCOLS[h]}};return Pi.extend(lo,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),lo});var z=_;return z})})(G2);const Z2=sm;const q2=()=>jn("div",{className:"emoji-wrap",style:{display:"flex",backgroundColor:"rgba(0, 0, 0, 0.5)",height:"2em",padding:"8px 8px 2px",marginRight:"4px",borderRadius:"6px",justifyContent:"center",zIndex:50},children:jn("span",{style:{fontSize:"1.4em",color:"white",fontWeight:"bold",paddingLeft:"2px"},children:"+"})}),U_={":igyo:":{src:"./emoji/igyo.png",name:"偉業",height:23,width:23},":tiken:":{src:"./emoji/tiken.png",name:"知見",height:23,width:23},":dekai:":{src:"./emoji/dekai.png",name:"デカい",height:23,width:23},":chian_saikou:":{src:"./emoji/chian_saikou.gif",name:"治安最高",height:23,width:23},":desyo:":{src:"./emoji/desyo.png",name:"寿司",height:23,width:23},":mog:":{src:"./emoji/mog.png",name:"もぐ…",height:23,width:23},":saikou:":{src:"./emoji/saikou.png",name:"最高",height:23,width:23},":muzu:":{src:"./emoji/muzu.png",name:"難",height:23,width:23},":wakaran:":{src:"./emoji/wakaran.png",name:"わからん",height:23,width:23},":send_money:":{src:"./emoji/send_money.png",name:"レターパックで現金送れ",height:23,width:210},":is_all_scam:":{src:"./emoji/is_all_scam.png",name:"はすべて詐欺です",height:23,width:160}},W2=({emoji:n,count:o})=>qh("div",{className:"emoji-wrap",style:{display:"flex",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",height:"33px",padding:"0 8px",marginRight:"4px",borderRadius:"6px",justifyContent:"center",alignItems:"center",zIndex:50},children:[jn("span",{className:"emoji",style:{fontSize:"2em",color:"blue",fontFamily:"serif",fontWeight:"bold"},children:(()=>{if(Object.keys(U_).includes(n)){const u=U_[n];return jn("img",{src:u.src,height:u.height,width:u.width})}else return n})()}),o&&jn("span",{style:{fontSize:"1.2em",color:"white",paddingLeft:"2px"},children:o})]}),X2=({latitude:n,longitude:o,zIndex:u,onClick:m,children:_})=>jn(B2,{latitude:n,longitude:o,onClick:w=>{m&&m(w)},style:u?{zIndex:u}:{},children:_}),H2=({latitude:n,longitude:o,name:u,emoji_reactions:m})=>jn(X2,{latitude:n,longitude:o,children:qh("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[jn("div",{style:{cursor:"pointer",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(2px)",color:"white",fontFamily:"monospace",fontSize:"2em",padding:"8px",borderRadius:"6px",zIndex:1e3},children:u}),qh("div",{style:{cursor:"pointer",display:"flex",fontFamily:"sans-serif, emoji",padding:"6px",height:"auto"},children:[m&&Object.keys(m).map(_=>jn(W2,{emoji:_,count:m[_]})),jn(q2,{})]})]})}),K2=[{latitude:35.7133757,longitude:139.7766557,name:"JR上野駅",emoji_reactions:{"🚃":20,"🚉":20,駅:20,":dekai:":10}},{latitude:35.711833,longitude:139.774139,name:"西郷隆盛像",emoji_reactions:{"🗿":100,":dekai:":25,西郷隆盛:25}},{latitude:35.7162851,longitude:139.7756758,name:"野口英世像",emoji_reactions:{"🗿":100,":dekai:":25,野口英世:25}},{latitude:35.715932,longitude:139.774175,name:"上野恩賜公園",emoji_reactions:{"⛲":20,":saikou:":10,憩い:10,和める:5,":chian_saikou:":5}},{latitude:35.7175,longitude:139.771389,name:"上野動物園",emoji_reactions:{"🐼":100,"🐧":25,"🦍":10,圧倒的パンダ:10}},{latitude:35.712104,longitude:139.770757,name:"不忍池",emoji_reactions:{池:10,泳ぐな:3}},{latitude:35.719056,longitude:139.776667,name:"東京国立博物館",emoji_reactions:{"🏛️":10,":tiken:":10,":muzu:":10,":wakaran:":10}},{latitude:35.712583,longitude:139.780056,name:"台東区役所",emoji_reactions:{役所:10,遠い:10,親切:1,だるい:1}},{latitude:35.7105915,longitude:139.7759588,name:"上野駅前郵便局",emoji_reactions:{":send_money:":20,":is_all_scam:":20,"🏣":10}},{latitude:35.7151507,longitude:139.7798906,name:"上野七郵便局",emoji_reactions:{":send_money:":20,":is_all_scam:":20,"🏣":10}},{latitude:35.7100576,longitude:139.7728115,name:"スシロー 上野店",emoji_reactions:{"🍣":20,":desyo:":20,":mog:":10}},{latitude:35.698715,longitude:139.772942,name:"JR秋葉原駅",emoji_reactions:{}},{latitude:35.698889,longitude:139.774722,name:"ヨドバシAkiba",emoji_reactions:{}},{latitude:35.6973306,longitude:139.7751523,name:"書泉ブックタワー",emoji_reactions:{}}],Y2=()=>jn("div",{style:{width:"100vw",height:"100vh"},children:qh(tg,{style:{display:"block",width:"100%",height:"100%"},mapLib:Z2,mapStyle:"https://tile.openstreetmap.jp/styles/osm-bright/style.json",initialViewState:{latitude:35.713728,longitude:139.776605,zoom:15},hash:!0,maxZoom:22,maxPitch:85,attributionControl:!1,children:[K2.map(n=>jn(H2,{...n})),jn(N2,{customAttribution:"Original Emoji by <a href='https://misskey.io/'>Misskey.io</a>"}),jn($2,{position:"bottom-right",visualizePitch:!0,showZoom:!0,showCompass:!0})]})});function J2(){return jn("div",{className:"App",children:jn(Y2,{})})}df.createRoot(document.getElementById("root")).render(jn(sw.StrictMode,{children:jn(J2,{})}));
